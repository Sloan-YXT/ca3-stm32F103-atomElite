; generated by Component: ARM Compiler 5.06 update 6 (build 750) Tool: ArmCC [4d3637]
; commandline ArmCC [--c99 --list --split_sections --debug -c --asm --interleave -o..\obj\ff.o --asm_dir=..\OBJ\ --list_dir=..\OBJ\ --depend=..\obj\ff.d --cpu=Cortex-M3 --apcs=interwork -O0 --diag_suppress=9931 -I..\ATK-ESP8266 -I..\CORE -I..\FATFS\src -I..\FATFS\exfuns -I..\HARDWARE\24CXX -I..\HARDWARE\IIC -I..\HARDWARE\KEY -I..\HARDWARE\LCD -I..\HARDWARE\LED -I..\HARDWARE\SDIO -I..\HARDWARE\SPI -I..\HARDWARE\TIMER -I..\HARDWARE\TOUCH -I..\HARDWARE\USART3 -I..\HARDWARE\W25QXX -I..\MALLOC -I..\STM32F10x_FWLib\inc -I..\SYSTEM\delay -I..\SYSTEM\sys -I..\SYSTEM\usart -I..\TEXT -I..\USER -I..\USMART -I..\PICTURE -I..\HARDWARE\OV7725 -I..\HARDWARE\EXTI -I..\HARDWARE\BEEP -I..\HARDWARE\DHT11 -I.\RTE\_Target_1 -ID:\Users\86132\AppData\Local\Arm\Packs\Keil\STM32F1xx_DFP\2.3.0\Device\Include -ID:\Keil_v5\ARM\CMSIS\Include -D__UVISION_VERSION=529 -DSTM32F10X_HD -DSTM32F10X_HD -DUSE_STDPERIPH_DRIVER --omf_browse=..\obj\ff.crf ..\FATFS\src\ff.c]
                          THUMB

                          AREA ||i.check_fs||, CODE, READONLY, ALIGN=2

                  check_fs PROC
;;;2146   static
;;;2147   BYTE check_fs (	/* 0:FAT boor sector, 1:Valid boor sector but not FAT, 2:Not a boot sector, 3:Disk error */
000000  b570              PUSH     {r4-r6,lr}
;;;2148   	FATFS* fs,	/* File system object */
;;;2149   	DWORD sect	/* Sector# (lba) to check if it is an FAT boot record or not */
;;;2150   )
;;;2151   {
000002  4604              MOV      r4,r0
000004  460d              MOV      r5,r1
;;;2152   	fs->wflag = 0; fs->winsect = 0xFFFFFFFF;	/* Invaidate window */
000006  2000              MOVS     r0,#0
000008  7120              STRB     r0,[r4,#4]
00000a  1e40              SUBS     r0,r0,#1
00000c  62e0              STR      r0,[r4,#0x2c]
;;;2153   	if (move_window(fs, sect) != FR_OK)			/* Load boot record */
00000e  4629              MOV      r1,r5
000010  4620              MOV      r0,r4
000012  f7fffffe          BL       move_window
000016  b108              CBZ      r0,|L1.28|
;;;2154   		return 3;
000018  2003              MOVS     r0,#3
                  |L1.26|
;;;2155   
;;;2156   	if (LD_WORD(&fs->win[BS_55AA]) != 0xAA55)	/* Check boot record signature (always placed at offset 510 even if the sector size is >512) */
;;;2157   		return 2;
;;;2158   
;;;2159   	if ((LD_DWORD(&fs->win[BS_FilSysType]) & 0xFFFFFF) == 0x544146)		/* Check "FAT" string */
;;;2160   		return 0;
;;;2161   	if ((LD_DWORD(&fs->win[BS_FilSysType32]) & 0xFFFFFF) == 0x544146)	/* Check "FAT" string */
;;;2162   		return 0;
;;;2163   
;;;2164   	return 1;
;;;2165   }
00001a  bd70              POP      {r4-r6,pc}
                  |L1.28|
00001c  f894122e          LDRB     r1,[r4,#0x22e]        ;2156
000020  f894022f          LDRB     r0,[r4,#0x22f]        ;2156
000024  ea412000          ORR      r0,r1,r0,LSL #8       ;2156
000028  f64a2155          MOV      r1,#0xaa55            ;2156
00002c  4288              CMP      r0,r1                 ;2156
00002e  d001              BEQ      |L1.52|
000030  2002              MOVS     r0,#2                 ;2157
000032  e7f2              B        |L1.26|
                  |L1.52|
000034  f8940069          LDRB     r0,[r4,#0x69]         ;2159
000038  0601              LSLS     r1,r0,#24             ;2159
00003a  f8940068          LDRB     r0,[r4,#0x68]         ;2159
00003e  ea414100          ORR      r1,r1,r0,LSL #16      ;2159
000042  f8940067          LDRB     r0,[r4,#0x67]         ;2159
000046  ea412000          ORR      r0,r1,r0,LSL #8       ;2159
00004a  f8941066          LDRB     r1,[r4,#0x66]         ;2159
00004e  4308              ORRS     r0,r0,r1              ;2159
000050  f020407f          BIC      r0,r0,#0xff000000     ;2159
000054  490d              LDR      r1,|L1.140|
000056  4288              CMP      r0,r1                 ;2159
000058  d101              BNE      |L1.94|
00005a  2000              MOVS     r0,#0                 ;2160
00005c  e7dd              B        |L1.26|
                  |L1.94|
00005e  f8940085          LDRB     r0,[r4,#0x85]         ;2161
000062  0601              LSLS     r1,r0,#24             ;2161
000064  f8940084          LDRB     r0,[r4,#0x84]         ;2161
000068  ea414100          ORR      r1,r1,r0,LSL #16      ;2161
00006c  f8940083          LDRB     r0,[r4,#0x83]         ;2161
000070  ea412000          ORR      r0,r1,r0,LSL #8       ;2161
000074  f8941082          LDRB     r1,[r4,#0x82]         ;2161
000078  4308              ORRS     r0,r0,r1              ;2161
00007a  f020407f          BIC      r0,r0,#0xff000000     ;2161
00007e  4903              LDR      r1,|L1.140|
000080  4288              CMP      r0,r1                 ;2161
000082  d101              BNE      |L1.136|
000084  2000              MOVS     r0,#0                 ;2162
000086  e7c8              B        |L1.26|
                  |L1.136|
000088  2001              MOVS     r0,#1                 ;2164
00008a  e7c6              B        |L1.26|
;;;2166   
                          ENDP

                  |L1.140|
                          DCD      0x00544146

                          AREA ||i.chk_chr||, CODE, READONLY, ALIGN=1

                  chk_chr PROC
;;;516    static
;;;517    int chk_chr (const char* str, int chr) {
000000  4602              MOV      r2,r0
;;;518    	while (*str && *str != chr) str++;
000002  e000              B        |L2.6|
                  |L2.4|
000004  1c52              ADDS     r2,r2,#1
                  |L2.6|
000006  7810              LDRB     r0,[r2,#0]
000008  b110              CBZ      r0,|L2.16|
00000a  7810              LDRB     r0,[r2,#0]
00000c  4288              CMP      r0,r1
00000e  d1f9              BNE      |L2.4|
                  |L2.16|
;;;519    	return *str;
000010  7810              LDRB     r0,[r2,#0]
;;;520    }
000012  4770              BX       lr
;;;521    
                          ENDP


                          AREA ||i.clmt_clust||, CODE, READONLY, ALIGN=1

                  clmt_clust PROC
;;;1025   static
;;;1026   DWORD clmt_clust (	/* <2:Error, >=2:Cluster number */
000000  b570              PUSH     {r4-r6,lr}
;;;1027   	FIL* fp,		/* Pointer to the file object */
;;;1028   	DWORD ofs		/* File offset to be converted to cluster# */
;;;1029   )
;;;1030   {
000002  4603              MOV      r3,r0
000004  460d              MOV      r5,r1
;;;1031   	DWORD cl, ncl, *tbl;
;;;1032   
;;;1033   
;;;1034   	tbl = fp->cltbl + 1;	/* Top of CLMT */
000006  6a58              LDR      r0,[r3,#0x24]
000008  1d02              ADDS     r2,r0,#4
;;;1035   	cl = ofs / SS(fp->fs) / fp->fs->csize;	/* Cluster order from top of the file */
00000a  0a68              LSRS     r0,r5,#9
00000c  681e              LDR      r6,[r3,#0]
00000e  78b6              LDRB     r6,[r6,#2]
000010  fbb0f4f6          UDIV     r4,r0,r6
;;;1036   	for (;;) {
000014  bf00              NOP      
                  |L3.22|
;;;1037   		ncl = *tbl++;			/* Number of cluters in the fragment */
000016  ca02              LDM      r2!,{r1}
;;;1038   		if (!ncl) return 0;		/* End of table? (error) */
000018  b909              CBNZ     r1,|L3.30|
00001a  2000              MOVS     r0,#0
                  |L3.28|
;;;1039   		if (cl < ncl) break;	/* In this fragment? */
;;;1040   		cl -= ncl; tbl++;		/* Next fragment */
;;;1041   	}
;;;1042   	return cl + *tbl;	/* Return the cluster number */
;;;1043   }
00001c  bd70              POP      {r4-r6,pc}
                  |L3.30|
00001e  428c              CMP      r4,r1                 ;1039
000020  d200              BCS      |L3.36|
000022  e002              B        |L3.42|
                  |L3.36|
000024  1a64              SUBS     r4,r4,r1              ;1040
000026  1d12              ADDS     r2,r2,#4              ;1040
000028  e7f5              B        |L3.22|
                  |L3.42|
00002a  bf00              NOP                            ;1039
00002c  6810              LDR      r0,[r2,#0]            ;1042
00002e  4420              ADD      r0,r0,r4              ;1042
000030  e7f4              B        |L3.28|
;;;1044   #endif	/* _USE_FASTSEEK */
                          ENDP


                          AREA ||i.clust2sect||, CODE, READONLY, ALIGN=1

                  clust2sect PROC
;;;773    
;;;774    DWORD clust2sect (	/* !=0: Sector number, 0: Failed - invalid cluster# */
000000  4602              MOV      r2,r0
;;;775    	FATFS* fs,		/* File system object */
;;;776    	DWORD clst		/* Cluster# to be converted */
;;;777    )
;;;778    {
;;;779    	clst -= 2;
000002  1e89              SUBS     r1,r1,#2
;;;780    	if (clst >= fs->n_fatent - 2) return 0;		/* Invalid cluster# */
000004  6950              LDR      r0,[r2,#0x14]
000006  1e80              SUBS     r0,r0,#2
000008  4288              CMP      r0,r1
00000a  d801              BHI      |L4.16|
00000c  2000              MOVS     r0,#0
                  |L4.14|
;;;781    	return clst * fs->csize + fs->database;
;;;782    }
00000e  4770              BX       lr
                  |L4.16|
000010  7893              LDRB     r3,[r2,#2]            ;781
000012  6a90              LDR      r0,[r2,#0x28]         ;781
000014  fb010003          MLA      r0,r1,r3,r0           ;781
000018  e7f9              B        |L4.14|
;;;783    
                          ENDP


                          AREA ||i.cmp_lfn||, CODE, READONLY, ALIGN=2

                  cmp_lfn PROC
;;;1247   static
;;;1248   int cmp_lfn (			/* 1:Matched, 0:Not matched */
000000  e92d41f0          PUSH     {r4-r8,lr}
;;;1249   	WCHAR* lfnbuf,		/* Pointer to the LFN to be compared */
;;;1250   	BYTE* dir			/* Pointer to the directory entry containing a part of LFN */
;;;1251   )
;;;1252   {
000004  4604              MOV      r4,r0
000006  460b              MOV      r3,r1
;;;1253   	UINT i, s;
;;;1254   	WCHAR wc, uc;
;;;1255   
;;;1256   
;;;1257   	i = ((dir[LDIR_Ord] & ~LLEF) - 1) * 13;	/* Get offset in the LFN buffer */
000008  7818              LDRB     r0,[r3,#0]
00000a  f0200040          BIC      r0,r0,#0x40
00000e  1e40              SUBS     r0,r0,#1
000010  eb000180          ADD      r1,r0,r0,LSL #2
000014  eb0105c0          ADD      r5,r1,r0,LSL #3
;;;1258   	s = 0; wc = 1;
000018  2600              MOVS     r6,#0
00001a  2701              MOVS     r7,#1
;;;1259   	do {
00001c  bf00              NOP      
                  |L5.30|
;;;1260   		uc = LD_WORD(dir + LfnOfs[s]);	/* Pick an LFN character from the entry */
00001e  4818              LDR      r0,|L5.128|
000020  5d80              LDRB     r0,[r0,r6]
000022  5c18              LDRB     r0,[r3,r0]
000024  4916              LDR      r1,|L5.128|
000026  5d89              LDRB     r1,[r1,r6]
000028  4419              ADD      r1,r1,r3
00002a  7849              LDRB     r1,[r1,#1]
00002c  ea402801          ORR      r8,r0,r1,LSL #8
;;;1261   		if (wc) {	/* Last character has not been processed */
000030  b187              CBZ      r7,|L5.84|
;;;1262   			wc = ff_wtoupper(uc);		/* Convert it to upper case */
000032  4640              MOV      r0,r8
000034  f7fffffe          BL       ff_wtoupper
000038  4607              MOV      r7,r0
;;;1263   			if (i >= _MAX_LFN || wc != ff_wtoupper(lfnbuf[i++]))	/* Compare it */
00003a  2dff              CMP      r5,#0xff
00003c  d207              BCS      |L5.78|
00003e  4629              MOV      r1,r5
000040  1c6d              ADDS     r5,r5,#1
000042  f8340011          LDRH     r0,[r4,r1,LSL #1]
000046  f7fffffe          BL       ff_wtoupper
00004a  42b8              CMP      r0,r7
00004c  d008              BEQ      |L5.96|
                  |L5.78|
;;;1264   				return 0;				/* Not matched */
00004e  2000              MOVS     r0,#0
                  |L5.80|
;;;1265   		} else {
;;;1266   			if (uc != 0xFFFF) return 0;	/* Check filler */
;;;1267   		}
;;;1268   	} while (++s < 13);				/* Repeat until all characters in the entry are checked */
;;;1269   
;;;1270   	if ((dir[LDIR_Ord] & LLEF) && wc && lfnbuf[i])	/* Last segment matched but different length */
;;;1271   		return 0;
;;;1272   
;;;1273   	return 1;						/* The part of LFN matched */
;;;1274   }
000050  e8bd81f0          POP      {r4-r8,pc}
                  |L5.84|
000054  f64f70ff          MOV      r0,#0xffff            ;1266
000058  4580              CMP      r8,r0                 ;1266
00005a  d001              BEQ      |L5.96|
00005c  2000              MOVS     r0,#0                 ;1266
00005e  e7f7              B        |L5.80|
                  |L5.96|
000060  1c70              ADDS     r0,r6,#1              ;1268
000062  4606              MOV      r6,r0                 ;1268
000064  280d              CMP      r0,#0xd               ;1268
000066  d3da              BCC      |L5.30|
000068  7818              LDRB     r0,[r3,#0]            ;1270
00006a  f0000040          AND      r0,r0,#0x40           ;1270
00006e  b128              CBZ      r0,|L5.124|
000070  b127              CBZ      r7,|L5.124|
000072  f8340015          LDRH     r0,[r4,r5,LSL #1]     ;1270
000076  b108              CBZ      r0,|L5.124|
000078  2000              MOVS     r0,#0                 ;1271
00007a  e7e9              B        |L5.80|
                  |L5.124|
00007c  2001              MOVS     r0,#1                 ;1273
00007e  e7e7              B        |L5.80|
;;;1275   
                          ENDP

                  |L5.128|
                          DCD      LfnOfs

                          AREA ||i.create_chain||, CODE, READONLY, ALIGN=1

                  create_chain PROC
;;;963    static
;;;964    DWORD create_chain (	/* 0:No free cluster, 1:Internal error, 0xFFFFFFFF:Disk error, >=2:New cluster# */
000000  e92d47f0          PUSH     {r4-r10,lr}
;;;965    	FATFS* fs,			/* File system object */
;;;966    	DWORD clst			/* Cluster# to stretch. 0 means create a new chain. */
;;;967    )
;;;968    {
000004  4604              MOV      r4,r0
000006  4689              MOV      r9,r1
;;;969    	DWORD cs, ncl, scl;
;;;970    	FRESULT res;
;;;971    
;;;972    
;;;973    	if (clst == 0) {		/* Create a new chain */
000008  f1b90f00          CMP      r9,#0
00000c  d106              BNE      |L6.28|
;;;974    		scl = fs->last_clust;			/* Get suggested start point */
00000e  68e7              LDR      r7,[r4,#0xc]
;;;975    		if (!scl || scl >= fs->n_fatent) scl = 1;
000010  b117              CBZ      r7,|L6.24|
000012  6960              LDR      r0,[r4,#0x14]
000014  42b8              CMP      r0,r7
000016  d815              BHI      |L6.68|
                  |L6.24|
000018  2701              MOVS     r7,#1
00001a  e013              B        |L6.68|
                  |L6.28|
;;;976    	}
;;;977    	else {					/* Stretch the current chain */
;;;978    		cs = get_fat(fs, clst);			/* Check the cluster status */
00001c  4649              MOV      r1,r9
00001e  4620              MOV      r0,r4
000020  f7fffffe          BL       get_fat
000024  4606              MOV      r6,r0
;;;979    		if (cs < 2) return 1;			/* Invalid value */
000026  2e02              CMP      r6,#2
000028  d202              BCS      |L6.48|
00002a  2001              MOVS     r0,#1
                  |L6.44|
;;;980    		if (cs == 0xFFFFFFFF) return cs;	/* A disk error occurred */
;;;981    		if (cs < fs->n_fatent) return cs;	/* It is already followed by next cluster */
;;;982    		scl = clst;
;;;983    	}
;;;984    
;;;985    	ncl = scl;				/* Start cluster */
;;;986    	for (;;) {
;;;987    		ncl++;							/* Next cluster */
;;;988    		if (ncl >= fs->n_fatent) {		/* Check wrap around */
;;;989    			ncl = 2;
;;;990    			if (ncl > scl) return 0;	/* No free cluster */
;;;991    		}
;;;992    		cs = get_fat(fs, ncl);			/* Get the cluster status */
;;;993    		if (cs == 0) break;				/* Found a free cluster */
;;;994    		if (cs == 0xFFFFFFFF || cs == 1)/* An error occurred */
;;;995    			return cs;
;;;996    		if (ncl == scl) return 0;		/* No free cluster */
;;;997    	}
;;;998    
;;;999    	res = put_fat(fs, ncl, 0x0FFFFFFF);	/* Mark the new cluster "last link" */
;;;1000   	if (res == FR_OK && clst != 0) {
;;;1001   		res = put_fat(fs, clst, ncl);	/* Link it to the previous one if needed */
;;;1002   	}
;;;1003   	if (res == FR_OK) {
;;;1004   		fs->last_clust = ncl;			/* Update FSINFO */
;;;1005   		if (fs->free_clust != 0xFFFFFFFF) {
;;;1006   			fs->free_clust--;
;;;1007   			fs->fsi_flag |= 1;
;;;1008   		}
;;;1009   	} else {
;;;1010   		ncl = (res == FR_DISK_ERR) ? 0xFFFFFFFF : 1;
;;;1011   	}
;;;1012   
;;;1013   	return ncl;		/* Return new cluster number or error code */
;;;1014   }
00002c  e8bd87f0          POP      {r4-r10,pc}
                  |L6.48|
000030  1c70              ADDS     r0,r6,#1              ;980
000032  b908              CBNZ     r0,|L6.56|
000034  4630              MOV      r0,r6                 ;980
000036  e7f9              B        |L6.44|
                  |L6.56|
000038  6960              LDR      r0,[r4,#0x14]         ;981
00003a  42b0              CMP      r0,r6                 ;981
00003c  d901              BLS      |L6.66|
00003e  4630              MOV      r0,r6                 ;981
000040  e7f4              B        |L6.44|
                  |L6.66|
000042  464f              MOV      r7,r9                 ;982
                  |L6.68|
000044  463d              MOV      r5,r7                 ;985
000046  bf00              NOP                            ;986
                  |L6.72|
000048  1c6d              ADDS     r5,r5,#1              ;987
00004a  6960              LDR      r0,[r4,#0x14]         ;988
00004c  42a8              CMP      r0,r5                 ;988
00004e  d804              BHI      |L6.90|
000050  2502              MOVS     r5,#2                 ;989
000052  42bd              CMP      r5,r7                 ;990
000054  d901              BLS      |L6.90|
000056  2000              MOVS     r0,#0                 ;990
000058  e7e8              B        |L6.44|
                  |L6.90|
00005a  4629              MOV      r1,r5                 ;992
00005c  4620              MOV      r0,r4                 ;992
00005e  f7fffffe          BL       get_fat
000062  4606              MOV      r6,r0                 ;992
000064  b906              CBNZ     r6,|L6.104|
000066  e009              B        |L6.124|
                  |L6.104|
000068  1c70              ADDS     r0,r6,#1              ;994
00006a  b108              CBZ      r0,|L6.112|
00006c  2e01              CMP      r6,#1                 ;994
00006e  d101              BNE      |L6.116|
                  |L6.112|
000070  4630              MOV      r0,r6                 ;995
000072  e7db              B        |L6.44|
                  |L6.116|
000074  42bd              CMP      r5,r7                 ;996
000076  d1e7              BNE      |L6.72|
000078  2000              MOVS     r0,#0                 ;996
00007a  e7d7              B        |L6.44|
                  |L6.124|
00007c  bf00              NOP                            ;993
00007e  f06f4270          MVN      r2,#0xf0000000        ;999
000082  4629              MOV      r1,r5                 ;999
000084  4620              MOV      r0,r4                 ;999
000086  f7fffffe          BL       put_fat
00008a  4680              MOV      r8,r0                 ;999
00008c  f1b80f00          CMP      r8,#0                 ;1000
000090  d108              BNE      |L6.164|
000092  f1b90f00          CMP      r9,#0                 ;1000
000096  d005              BEQ      |L6.164|
000098  462a              MOV      r2,r5                 ;1001
00009a  4649              MOV      r1,r9                 ;1001
00009c  4620              MOV      r0,r4                 ;1001
00009e  f7fffffe          BL       put_fat
0000a2  4680              MOV      r8,r0                 ;1001
                  |L6.164|
0000a4  f1b80f00          CMP      r8,#0                 ;1003
0000a8  d10b              BNE      |L6.194|
0000aa  60e5              STR      r5,[r4,#0xc]          ;1004
0000ac  6920              LDR      r0,[r4,#0x10]         ;1005
0000ae  1c40              ADDS     r0,r0,#1              ;1005
0000b0  b178              CBZ      r0,|L6.210|
0000b2  6920              LDR      r0,[r4,#0x10]         ;1006
0000b4  1e40              SUBS     r0,r0,#1              ;1006
0000b6  6120              STR      r0,[r4,#0x10]         ;1006
0000b8  7960              LDRB     r0,[r4,#5]            ;1007
0000ba  f0400001          ORR      r0,r0,#1              ;1007
0000be  7160              STRB     r0,[r4,#5]            ;1007
0000c0  e007              B        |L6.210|
                  |L6.194|
0000c2  f1b80f01          CMP      r8,#1                 ;1010
0000c6  d102              BNE      |L6.206|
0000c8  f04f30ff          MOV      r0,#0xffffffff        ;1010
0000cc  e000              B        |L6.208|
                  |L6.206|
0000ce  2001              MOVS     r0,#1                 ;1010
                  |L6.208|
0000d0  4605              MOV      r5,r0                 ;1010
                  |L6.210|
0000d2  4628              MOV      r0,r5                 ;1013
0000d4  e7aa              B        |L6.44|
;;;1015   #endif /* !_FS_READONLY */
                          ENDP


                          AREA ||i.create_name||, CODE, READONLY, ALIGN=2

                  create_name PROC
;;;1813   static
;;;1814   FRESULT create_name (
000000  e92d4ff3          PUSH     {r0,r1,r4-r11,lr}
;;;1815   	DIR* dp,			/* Pointer to the directory object */
;;;1816   	const TCHAR** path	/* Pointer to pointer to the segment in the path string */
;;;1817   )
;;;1818   {
000004  b083              SUB      sp,sp,#0xc
000006  4681              MOV      r9,r0
;;;1819   #if _USE_LFN	/* LFN configuration */
;;;1820   	BYTE b, cf;
;;;1821   	WCHAR w, *lfn;
;;;1822   	UINT i, ni, si, di;
;;;1823   	const TCHAR *p;
;;;1824   
;;;1825   	/* Create LFN in Unicode */
;;;1826   	for (p = *path; *p == '/' || *p == '\\'; p++) ;	/* Strip duplicated separator */
000008  9804              LDR      r0,[sp,#0x10]
00000a  6800              LDR      r0,[r0,#0]
00000c  9001              STR      r0,[sp,#4]
00000e  e002              B        |L7.22|
                  |L7.16|
000010  9801              LDR      r0,[sp,#4]
000012  1c40              ADDS     r0,r0,#1
000014  9001              STR      r0,[sp,#4]
                  |L7.22|
000016  9801              LDR      r0,[sp,#4]
000018  7800              LDRB     r0,[r0,#0]
00001a  282f              CMP      r0,#0x2f
00001c  d0f8              BEQ      |L7.16|
00001e  9801              LDR      r0,[sp,#4]
000020  7800              LDRB     r0,[r0,#0]
000022  285c              CMP      r0,#0x5c
000024  d0f4              BEQ      |L7.16|
;;;1827   	lfn = dp->lfn;
000026  f8d9a01c          LDR      r10,[r9,#0x1c]
;;;1828   	si = di = 0;
00002a  2500              MOVS     r5,#0
00002c  462f              MOV      r7,r5
;;;1829   	for (;;) {
00002e  bf00              NOP      
                  |L7.48|
;;;1830   		w = p[si++];					/* Get a character */
000030  4638              MOV      r0,r7
000032  1c7f              ADDS     r7,r7,#1
000034  9901              LDR      r1,[sp,#4]
000036  5c0c              LDRB     r4,[r1,r0]
;;;1831   		if (w < ' ' || w == '/' || w == '\\') break;	/* Break on end of segment */
000038  2c20              CMP      r4,#0x20
00003a  db03              BLT      |L7.68|
00003c  2c2f              CMP      r4,#0x2f
00003e  d001              BEQ      |L7.68|
000040  2c5c              CMP      r4,#0x5c
000042  d100              BNE      |L7.70|
                  |L7.68|
000044  e032              B        |L7.172|
                  |L7.70|
;;;1832   		if (di >= _MAX_LFN)				/* Reject too long name */
000046  2dff              CMP      r5,#0xff
000048  d303              BCC      |L7.82|
;;;1833   			return FR_INVALID_NAME;
00004a  2006              MOVS     r0,#6
                  |L7.76|
;;;1834   #if !_LFN_UNICODE
;;;1835   		w &= 0xFF;
;;;1836   		if (IsDBCS1(w)) {				/* Check if it is a DBC 1st byte (always false on SBCS cfg) */
;;;1837   			b = (BYTE)p[si++];			/* Get 2nd byte */
;;;1838   			w = (w << 8) + b;			/* Create a DBC */
;;;1839   			if (!IsDBCS2(b))
;;;1840   				return FR_INVALID_NAME;	/* Reject invalid sequence */
;;;1841   		}
;;;1842   		w = ff_convert(w, 1);			/* Convert ANSI/OEM to Unicode */
;;;1843   		if (!w) return FR_INVALID_NAME;	/* Reject invalid code */
;;;1844   #endif
;;;1845   		if (w < 0x80 && chk_chr("\"*:<>\?|\x7F", w)) /* Reject illegal characters for LFN */
;;;1846   			return FR_INVALID_NAME;
;;;1847   		lfn[di++] = w;					/* Store the Unicode character */
;;;1848   	}
;;;1849   	*path = &p[si];						/* Return pointer to the next segment */
;;;1850   	cf = (w < ' ') ? NS_LAST : 0;		/* Set last segment flag if end of path */
;;;1851   #if _FS_RPATH
;;;1852   	if ((di == 1 && lfn[di - 1] == '.') || /* Is this a dot entry? */
;;;1853   		(di == 2 && lfn[di - 1] == '.' && lfn[di - 2] == '.')) {
;;;1854   		lfn[di] = 0;
;;;1855   		for (i = 0; i < 11; i++)
;;;1856   			dp->fn[i] = (i < di) ? '.' : ' ';
;;;1857   		dp->fn[i] = cf | NS_DOT;		/* This is a dot entry */
;;;1858   		return FR_OK;
;;;1859   	}
;;;1860   #endif
;;;1861   	while (di) {						/* Strip trailing spaces and dots */
;;;1862   		w = lfn[di - 1];
;;;1863   		if (w != ' ' && w != '.') break;
;;;1864   		di--;
;;;1865   	}
;;;1866   	if (!di) return FR_INVALID_NAME;	/* Reject nul string */
;;;1867   
;;;1868   	lfn[di] = 0;						/* LFN is created */
;;;1869   
;;;1870   	/* Create SFN in directory form */
;;;1871   	mem_set(dp->fn, ' ', 11);
;;;1872   	for (si = 0; lfn[si] == ' ' || lfn[si] == '.'; si++) ;	/* Strip leading spaces and dots */
;;;1873   	if (si) cf |= NS_LOSS | NS_LFN;
;;;1874   	while (di && lfn[di - 1] != '.') di--;	/* Find extension (di<=si: no extension) */
;;;1875   
;;;1876   	b = i = 0; ni = 8;
;;;1877   	for (;;) {
;;;1878   		w = lfn[si++];					/* Get an LFN character */
;;;1879   		if (!w) break;					/* Break on end of the LFN */
;;;1880   		if (w == ' ' || (w == '.' && si != di)) {	/* Remove spaces and dots */
;;;1881   			cf |= NS_LOSS | NS_LFN; continue;
;;;1882   		}
;;;1883   
;;;1884   		if (i >= ni || si == di) {		/* Extension or end of SFN */
;;;1885   			if (ni == 11) {				/* Long extension */
;;;1886   				cf |= NS_LOSS | NS_LFN; break;
;;;1887   			}
;;;1888   			if (si != di) cf |= NS_LOSS | NS_LFN;	/* Out of 8.3 format */
;;;1889   			if (si > di) break;			/* No extension */
;;;1890   			si = di; i = 8; ni = 11;	/* Enter extension section */
;;;1891   			b <<= 2; continue;
;;;1892   		}
;;;1893   
;;;1894   		if (w >= 0x80) {				/* Non ASCII character */
;;;1895   #ifdef _EXCVT
;;;1896   			w = ff_convert(w, 0);		/* Unicode -> OEM code */
;;;1897   			if (w) w = ExCvt[w - 0x80];	/* Convert extended character to upper (SBCS) */
;;;1898   #else
;;;1899   			w = ff_convert(ff_wtoupper(w), 0);	/* Upper converted Unicode -> OEM code */
;;;1900   #endif
;;;1901   			cf |= NS_LFN;				/* Force create LFN entry */
;;;1902   		}
;;;1903   
;;;1904   		if (_DF1S && w >= 0x100) {		/* DBC (always false at SBCS cfg) */
;;;1905   			if (i >= ni - 1) {
;;;1906   				cf |= NS_LOSS | NS_LFN; i = ni; continue;
;;;1907   			}
;;;1908   			dp->fn[i++] = (BYTE)(w >> 8);
;;;1909   		} else {						/* SBC */
;;;1910   			if (!w || chk_chr("+,;=[]", w)) {	/* Replace illegal characters for SFN */
;;;1911   				w = '_'; cf |= NS_LOSS | NS_LFN;/* Lossy conversion */
;;;1912   			} else {
;;;1913   				if (IsUpper(w)) {		/* ASCII large capital */
;;;1914   					b |= 2;
;;;1915   				} else {
;;;1916   					if (IsLower(w)) {	/* ASCII small capital */
;;;1917   						b |= 1; w -= 0x20;
;;;1918   					}
;;;1919   				}
;;;1920   			}
;;;1921   		}
;;;1922   		dp->fn[i++] = (BYTE)w;
;;;1923   	}
;;;1924   
;;;1925   	if (dp->fn[0] == DDEM) dp->fn[0] = RDDEM;	/* If the first character collides with deleted mark, replace it with RDDEM */
;;;1926   
;;;1927   	if (ni == 8) b <<= 2;
;;;1928   	if ((b & 0x0C) == 0x0C || (b & 0x03) == 0x03)	/* Create LFN entry when there are composite capitals */
;;;1929   		cf |= NS_LFN;
;;;1930   	if (!(cf & NS_LFN)) {						/* When LFN is in 8.3 format without extended character, NT flags are created */
;;;1931   		if ((b & 0x03) == 0x01) cf |= NS_EXT;	/* NT flag (Extension has only small capital) */
;;;1932   		if ((b & 0x0C) == 0x04) cf |= NS_BODY;	/* NT flag (Filename has only small capital) */
;;;1933   	}
;;;1934   
;;;1935   	dp->fn[NSFLAG] = cf;	/* SFN is created */
;;;1936   
;;;1937   	return FR_OK;
;;;1938   
;;;1939   
;;;1940   #else	/* Non-LFN configuration */
;;;1941   	BYTE b, c, d, *sfn;
;;;1942   	UINT ni, si, i;
;;;1943   	const char *p;
;;;1944   
;;;1945   	/* Create file name in directory form */
;;;1946   	for (p = *path; *p == '/' || *p == '\\'; p++) ;	/* Strip duplicated separator */
;;;1947   	sfn = dp->fn;
;;;1948   	mem_set(sfn, ' ', 11);
;;;1949   	si = i = b = 0; ni = 8;
;;;1950   #if _FS_RPATH
;;;1951   	if (p[si] == '.') { /* Is this a dot entry? */
;;;1952   		for (;;) {
;;;1953   			c = (BYTE)p[si++];
;;;1954   			if (c != '.' || si >= 3) break;
;;;1955   			sfn[i++] = c;
;;;1956   		}
;;;1957   		if (c != '/' && c != '\\' && c > ' ') return FR_INVALID_NAME;
;;;1958   		*path = &p[si];									/* Return pointer to the next segment */
;;;1959   		sfn[NSFLAG] = (c <= ' ') ? NS_LAST | NS_DOT : NS_DOT;	/* Set last segment flag if end of path */
;;;1960   		return FR_OK;
;;;1961   	}
;;;1962   #endif
;;;1963   	for (;;) {
;;;1964   		c = (BYTE)p[si++];
;;;1965   		if (c <= ' ' || c == '/' || c == '\\') break;	/* Break on end of segment */
;;;1966   		if (c == '.' || i >= ni) {
;;;1967   			if (ni != 8 || c != '.') return FR_INVALID_NAME;
;;;1968   			i = 8; ni = 11;
;;;1969   			b <<= 2; continue;
;;;1970   		}
;;;1971   		if (c >= 0x80) {				/* Extended character? */
;;;1972   			b |= 3;						/* Eliminate NT flag */
;;;1973   #ifdef _EXCVT
;;;1974   			c = ExCvt[c - 0x80];		/* To upper extended characters (SBCS cfg) */
;;;1975   #else
;;;1976   #if !_DF1S
;;;1977   			return FR_INVALID_NAME;		/* Reject extended characters (ASCII cfg) */
;;;1978   #endif
;;;1979   #endif
;;;1980   		}
;;;1981   		if (IsDBCS1(c)) {				/* Check if it is a DBC 1st byte (always false on SBCS cfg) */
;;;1982   			d = (BYTE)p[si++];			/* Get 2nd byte */
;;;1983   			if (!IsDBCS2(d) || i >= ni - 1)	/* Reject invalid DBC */
;;;1984   				return FR_INVALID_NAME;
;;;1985   			sfn[i++] = c;
;;;1986   			sfn[i++] = d;
;;;1987   		} else {						/* SBC */
;;;1988   			if (chk_chr("\"*+,:;<=>\?[]|\x7F", c))	/* Reject illegal chrs for SFN */
;;;1989   				return FR_INVALID_NAME;
;;;1990   			if (IsUpper(c)) {			/* ASCII large capital? */
;;;1991   				b |= 2;
;;;1992   			} else {
;;;1993   				if (IsLower(c)) {		/* ASCII small capital? */
;;;1994   					b |= 1; c -= 0x20;
;;;1995   				}
;;;1996   			}
;;;1997   			sfn[i++] = c;
;;;1998   		}
;;;1999   	}
;;;2000   	*path = &p[si];						/* Return pointer to the next segment */
;;;2001   	c = (c <= ' ') ? NS_LAST : 0;		/* Set last segment flag if end of path */
;;;2002   
;;;2003   	if (!i) return FR_INVALID_NAME;		/* Reject nul string */
;;;2004   	if (sfn[0] == DDEM) sfn[0] = RDDEM;	/* When first character collides with DDEM, replace it with RDDEM */
;;;2005   
;;;2006   	if (ni == 8) b <<= 2;
;;;2007   	if ((b & 0x03) == 0x01) c |= NS_EXT;	/* NT flag (Name extension has only small capital) */
;;;2008   	if ((b & 0x0C) == 0x04) c |= NS_BODY;	/* NT flag (Name body has only small capital) */
;;;2009   
;;;2010   	sfn[NSFLAG] = c;		/* Store NT flag, File name is created */
;;;2011   
;;;2012   	return FR_OK;
;;;2013   #endif
;;;2014   }
00004c  b005              ADD      sp,sp,#0x14
00004e  e8bd8ff0          POP      {r4-r11,pc}
                  |L7.82|
000052  b2e4              UXTB     r4,r4                 ;1835
000054  2c81              CMP      r4,#0x81              ;1836
000056  db13              BLT      |L7.128|
000058  b2e0              UXTB     r0,r4                 ;1836
00005a  28fe              CMP      r0,#0xfe              ;1836
00005c  dc10              BGT      |L7.128|
00005e  4638              MOV      r0,r7                 ;1837
000060  1c7f              ADDS     r7,r7,#1              ;1837
000062  9901              LDR      r1,[sp,#4]            ;1837
000064  5c0e              LDRB     r6,[r1,r0]            ;1837
000066  eb062004          ADD      r0,r6,r4,LSL #8       ;1838
00006a  b284              UXTH     r4,r0                 ;1838
00006c  2e40              CMP      r6,#0x40              ;1839
00006e  db01              BLT      |L7.116|
000070  2e7e              CMP      r6,#0x7e              ;1839
000072  dd05              BLE      |L7.128|
                  |L7.116|
000074  2e80              CMP      r6,#0x80              ;1839
000076  db01              BLT      |L7.124|
000078  2efe              CMP      r6,#0xfe              ;1839
00007a  dd01              BLE      |L7.128|
                  |L7.124|
00007c  2006              MOVS     r0,#6                 ;1840
00007e  e7e5              B        |L7.76|
                  |L7.128|
000080  2101              MOVS     r1,#1                 ;1842
000082  4620              MOV      r0,r4                 ;1842
000084  f7fffffe          BL       ff_convert
000088  4604              MOV      r4,r0                 ;1842
00008a  b90c              CBNZ     r4,|L7.144|
00008c  2006              MOVS     r0,#6                 ;1843
00008e  e7dd              B        |L7.76|
                  |L7.144|
000090  2c80              CMP      r4,#0x80              ;1845
000092  da06              BGE      |L7.162|
000094  4621              MOV      r1,r4                 ;1845
000096  a071              ADR      r0,|L7.604|
000098  f7fffffe          BL       chk_chr
00009c  b108              CBZ      r0,|L7.162|
00009e  2006              MOVS     r0,#6                 ;1846
0000a0  e7d4              B        |L7.76|
                  |L7.162|
0000a2  4628              MOV      r0,r5                 ;1847
0000a4  1c6d              ADDS     r5,r5,#1              ;1847
0000a6  f82a4010          STRH     r4,[r10,r0,LSL #1]    ;1847
0000aa  e7c1              B        |L7.48|
                  |L7.172|
0000ac  bf00              NOP                            ;1831
0000ae  9801              LDR      r0,[sp,#4]            ;1849
0000b0  19c1              ADDS     r1,r0,r7              ;1849
0000b2  9804              LDR      r0,[sp,#0x10]         ;1849
0000b4  6001              STR      r1,[r0,#0]            ;1849
0000b6  2c20              CMP      r4,#0x20              ;1850
0000b8  da01              BGE      |L7.190|
0000ba  2004              MOVS     r0,#4                 ;1850
0000bc  e000              B        |L7.192|
                  |L7.190|
0000be  2000              MOVS     r0,#0                 ;1850
                  |L7.192|
0000c0  4680              MOV      r8,r0                 ;1850
0000c2  e008              B        |L7.214|
                  |L7.196|
0000c4  1e68              SUBS     r0,r5,#1              ;1862
0000c6  f83a4010          LDRH     r4,[r10,r0,LSL #1]    ;1862
0000ca  2c20              CMP      r4,#0x20              ;1863
0000cc  d002              BEQ      |L7.212|
0000ce  2c2e              CMP      r4,#0x2e              ;1863
0000d0  d000              BEQ      |L7.212|
0000d2  e002              B        |L7.218|
                  |L7.212|
0000d4  1e6d              SUBS     r5,r5,#1              ;1864
                  |L7.214|
0000d6  2d00              CMP      r5,#0                 ;1861
0000d8  d1f4              BNE      |L7.196|
                  |L7.218|
0000da  bf00              NOP                            ;1863
0000dc  b90d              CBNZ     r5,|L7.226|
0000de  2006              MOVS     r0,#6                 ;1866
0000e0  e7b4              B        |L7.76|
                  |L7.226|
0000e2  2000              MOVS     r0,#0                 ;1868
0000e4  f82a0015          STRH     r0,[r10,r5,LSL #1]    ;1868
0000e8  220b              MOVS     r2,#0xb               ;1871
0000ea  2120              MOVS     r1,#0x20              ;1871
0000ec  f8d90018          LDR      r0,[r9,#0x18]         ;1871
0000f0  f7fffffe          BL       mem_set
0000f4  2700              MOVS     r7,#0                 ;1872
0000f6  e000              B        |L7.250|
                  |L7.248|
0000f8  1c7f              ADDS     r7,r7,#1              ;1872
                  |L7.250|
0000fa  f83a0017          LDRH     r0,[r10,r7,LSL #1]    ;1872
0000fe  2820              CMP      r0,#0x20              ;1872
000100  d0fa              BEQ      |L7.248|
000102  f83a0017          LDRH     r0,[r10,r7,LSL #1]    ;1872
000106  282e              CMP      r0,#0x2e              ;1872
000108  d0f6              BEQ      |L7.248|
00010a  b10f              CBZ      r7,|L7.272|
00010c  f0480803          ORR      r8,r8,#3              ;1873
                  |L7.272|
000110  e000              B        |L7.276|
                  |L7.274|
000112  1e6d              SUBS     r5,r5,#1              ;1874
                  |L7.276|
000114  b125              CBZ      r5,|L7.288|
000116  1e68              SUBS     r0,r5,#1              ;1874
000118  f83a0010          LDRH     r0,[r10,r0,LSL #1]    ;1874
00011c  282e              CMP      r0,#0x2e              ;1874
00011e  d1f8              BNE      |L7.274|
                  |L7.288|
000120  2000              MOVS     r0,#0                 ;1876
000122  4606              MOV      r6,r0                 ;1876
000124  9002              STR      r0,[sp,#8]            ;1876
000126  f04f0b08          MOV      r11,#8                ;1876
00012a  bf00              NOP                            ;1877
                  |L7.300|
00012c  4638              MOV      r0,r7                 ;1878
00012e  1c7f              ADDS     r7,r7,#1              ;1878
000130  f83a4010          LDRH     r4,[r10,r0,LSL #1]    ;1878
000134  b904              CBNZ     r4,|L7.312|
000136  e063              B        |L7.512|
                  |L7.312|
000138  2c20              CMP      r4,#0x20              ;1880
00013a  d003              BEQ      |L7.324|
00013c  2c2e              CMP      r4,#0x2e              ;1880
00013e  d104              BNE      |L7.330|
000140  42af              CMP      r7,r5                 ;1880
000142  d002              BEQ      |L7.330|
                  |L7.324|
000144  f0480803          ORR      r8,r8,#3              ;1881
000148  e7f0              B        |L7.300|
                  |L7.330|
00014a  9802              LDR      r0,[sp,#8]            ;1884
00014c  4558              CMP      r0,r11                ;1884
00014e  d201              BCS      |L7.340|
000150  42af              CMP      r7,r5                 ;1884
000152  d114              BNE      |L7.382|
                  |L7.340|
000154  f1bb0f0b          CMP      r11,#0xb              ;1885
000158  d102              BNE      |L7.352|
00015a  f0480803          ORR      r8,r8,#3              ;1886
00015e  e04f              B        |L7.512|
                  |L7.352|
000160  42af              CMP      r7,r5                 ;1888
000162  d001              BEQ      |L7.360|
000164  f0480803          ORR      r8,r8,#3              ;1888
                  |L7.360|
000168  42af              CMP      r7,r5                 ;1889
00016a  d900              BLS      |L7.366|
00016c  e048              B        |L7.512|
                  |L7.366|
00016e  462f              MOV      r7,r5                 ;1890
000170  2008              MOVS     r0,#8                 ;1890
000172  9002              STR      r0,[sp,#8]            ;1890
000174  f04f0b0b          MOV      r11,#0xb              ;1890
000178  06b0              LSLS     r0,r6,#26             ;1891
00017a  0e06              LSRS     r6,r0,#24             ;1891
00017c  e7d6              B        |L7.300|
                  |L7.382|
00017e  2c80              CMP      r4,#0x80              ;1894
000180  db09              BLT      |L7.406|
000182  4620              MOV      r0,r4                 ;1899
000184  f7fffffe          BL       ff_wtoupper
000188  4603              MOV      r3,r0                 ;1899
00018a  2100              MOVS     r1,#0                 ;1899
00018c  f7fffffe          BL       ff_convert
000190  4604              MOV      r4,r0                 ;1899
000192  f0480802          ORR      r8,r8,#2              ;1901
                  |L7.406|
000196  2cff              CMP      r4,#0xff              ;1904
000198  dd11              BLE      |L7.446|
00019a  f1ab0001          SUB      r0,r11,#1             ;1905
00019e  9902              LDR      r1,[sp,#8]            ;1905
0001a0  4288              CMP      r0,r1                 ;1905
0001a2  d804              BHI      |L7.430|
0001a4  f0480803          ORR      r8,r8,#3              ;1906
0001a8  f8cdb008          STR      r11,[sp,#8]           ;1906
0001ac  e7be              B        |L7.300|
                  |L7.430|
0001ae  1222              ASRS     r2,r4,#8              ;1908
0001b0  f8d93018          LDR      r3,[r9,#0x18]         ;1908
0001b4  9802              LDR      r0,[sp,#8]            ;1908
0001b6  1c41              ADDS     r1,r0,#1              ;1908
0001b8  9102              STR      r1,[sp,#8]            ;1908
0001ba  541a              STRB     r2,[r3,r0]            ;1908
0001bc  e019              B        |L7.498|
                  |L7.446|
0001be  b124              CBZ      r4,|L7.458|
0001c0  4621              MOV      r1,r4                 ;1910
0001c2  a029              ADR      r0,|L7.616|
0001c4  f7fffffe          BL       chk_chr
0001c8  b118              CBZ      r0,|L7.466|
                  |L7.458|
0001ca  245f              MOVS     r4,#0x5f              ;1911
0001cc  f0480803          ORR      r8,r8,#3              ;1911
0001d0  e00f              B        |L7.498|
                  |L7.466|
0001d2  2c41              CMP      r4,#0x41              ;1913
0001d4  db04              BLT      |L7.480|
0001d6  2c5a              CMP      r4,#0x5a              ;1913
0001d8  dc02              BGT      |L7.480|
0001da  f0460602          ORR      r6,r6,#2              ;1914
0001de  e008              B        |L7.498|
                  |L7.480|
0001e0  2c61              CMP      r4,#0x61              ;1916
0001e2  db06              BLT      |L7.498|
0001e4  2c7a              CMP      r4,#0x7a              ;1916
0001e6  dc04              BGT      |L7.498|
0001e8  f0460601          ORR      r6,r6,#1              ;1917
0001ec  f1a40020          SUB      r0,r4,#0x20           ;1917
0001f0  b284              UXTH     r4,r0                 ;1917
                  |L7.498|
0001f2  f8d93018          LDR      r3,[r9,#0x18]         ;1922
0001f6  9802              LDR      r0,[sp,#8]            ;1922
0001f8  1c41              ADDS     r1,r0,#1              ;1922
0001fa  9102              STR      r1,[sp,#8]            ;1922
0001fc  541c              STRB     r4,[r3,r0]            ;1922
0001fe  e795              B        |L7.300|
                  |L7.512|
000200  bf00              NOP                            ;1879
000202  f8d90018          LDR      r0,[r9,#0x18]         ;1925
000206  7800              LDRB     r0,[r0,#0]            ;1925
000208  28e5              CMP      r0,#0xe5              ;1925
00020a  d103              BNE      |L7.532|
00020c  2005              MOVS     r0,#5                 ;1925
00020e  f8d91018          LDR      r1,[r9,#0x18]         ;1925
000212  7008              STRB     r0,[r1,#0]            ;1925
                  |L7.532|
000214  f1bb0f08          CMP      r11,#8                ;1927
000218  d101              BNE      |L7.542|
00021a  06b0              LSLS     r0,r6,#26             ;1927
00021c  0e06              LSRS     r6,r0,#24             ;1927
                  |L7.542|
00021e  f006000c          AND      r0,r6,#0xc            ;1928
000222  280c              CMP      r0,#0xc               ;1928
000224  d003              BEQ      |L7.558|
000226  f0060003          AND      r0,r6,#3              ;1928
00022a  2803              CMP      r0,#3                 ;1928
00022c  d101              BNE      |L7.562|
                  |L7.558|
00022e  f0480802          ORR      r8,r8,#2              ;1929
                  |L7.562|
000232  f0080002          AND      r0,r8,#2              ;1930
000236  b958              CBNZ     r0,|L7.592|
000238  f0060003          AND      r0,r6,#3              ;1931
00023c  2801              CMP      r0,#1                 ;1931
00023e  d101              BNE      |L7.580|
000240  f0480810          ORR      r8,r8,#0x10           ;1931
                  |L7.580|
000244  f006000c          AND      r0,r6,#0xc            ;1932
000248  2804              CMP      r0,#4                 ;1932
00024a  d101              BNE      |L7.592|
00024c  f0480808          ORR      r8,r8,#8              ;1932
                  |L7.592|
000250  f8d90018          LDR      r0,[r9,#0x18]         ;1935
000254  f880800b          STRB     r8,[r0,#0xb]          ;1935
000258  2000              MOVS     r0,#0                 ;1937
00025a  e6f7              B        |L7.76|
;;;2015   
                          ENDP

                  |L7.604|
00025c  222a3a3c          DCB      """*:<>?|",127,0
000260  3e3f7c7f
000264  00      
000265  00                DCB      0
000266  00                DCB      0
000267  00                DCB      0
                  |L7.616|
000268  2b2c3b3d          DCB      "+,;=[]",0
00026c  5b5d00  
00026f  00                DCB      0

                          AREA ||i.dir_alloc||, CODE, READONLY, ALIGN=1

                  dir_alloc PROC
;;;1172   static
;;;1173   FRESULT dir_alloc (
000000  e92d41f0          PUSH     {r4-r8,lr}
;;;1174   	DIR* dp,	/* Pointer to the directory object */
;;;1175   	UINT nent	/* Number of contiguous entries to allocate (1-21) */
;;;1176   )
;;;1177   {
000004  4604              MOV      r4,r0
000006  460e              MOV      r6,r1
;;;1178   	FRESULT res;
;;;1179   	UINT n;
;;;1180   
;;;1181   
;;;1182   	res = dir_sdi(dp, 0);
000008  2100              MOVS     r1,#0
00000a  4620              MOV      r0,r4
00000c  f7fffffe          BL       dir_sdi
000010  4605              MOV      r5,r0
;;;1183   	if (res == FR_OK) {
000012  b9ed              CBNZ     r5,|L8.80|
;;;1184   		n = 0;
000014  2700              MOVS     r7,#0
;;;1185   		do {
000016  bf00              NOP      
                  |L8.24|
;;;1186   			res = move_window(dp->fs, dp->sect);
000018  6921              LDR      r1,[r4,#0x10]
00001a  6820              LDR      r0,[r4,#0]
00001c  f7fffffe          BL       move_window
000020  4605              MOV      r5,r0
;;;1187   			if (res != FR_OK) break;
000022  b105              CBZ      r5,|L8.38|
000024  e013              B        |L8.78|
                  |L8.38|
;;;1188   			if (dp->dir[0] == DDEM || dp->dir[0] == 0) {	/* Is it a free entry? */
000026  6960              LDR      r0,[r4,#0x14]
000028  7800              LDRB     r0,[r0,#0]
00002a  28e5              CMP      r0,#0xe5
00002c  d002              BEQ      |L8.52|
00002e  6960              LDR      r0,[r4,#0x14]
000030  7800              LDRB     r0,[r0,#0]
000032  b920              CBNZ     r0,|L8.62|
                  |L8.52|
;;;1189   				if (++n == nent) break;	/* A block of contiguous free entries is found */
000034  1c78              ADDS     r0,r7,#1
000036  4607              MOV      r7,r0
000038  42b0              CMP      r0,r6
00003a  d101              BNE      |L8.64|
00003c  e007              B        |L8.78|
                  |L8.62|
;;;1190   			} else {
;;;1191   				n = 0;					/* Not a blank entry. Restart to search */
00003e  2700              MOVS     r7,#0
                  |L8.64|
;;;1192   			}
;;;1193   			res = dir_next(dp, 1);		/* Next entry with table stretch enabled */
000040  2101              MOVS     r1,#1
000042  4620              MOV      r0,r4
000044  f7fffffe          BL       dir_next
000048  4605              MOV      r5,r0
;;;1194   		} while (res == FR_OK);
00004a  2d00              CMP      r5,#0
00004c  d0e4              BEQ      |L8.24|
                  |L8.78|
00004e  bf00              NOP                            ;1187
                  |L8.80|
;;;1195   	}
;;;1196   	if (res == FR_NO_FILE) res = FR_DENIED;	/* No directory entry to allocate */
000050  2d04              CMP      r5,#4
000052  d100              BNE      |L8.86|
000054  2507              MOVS     r5,#7
                  |L8.86|
;;;1197   	return res;
000056  4628              MOV      r0,r5
;;;1198   }
000058  e8bd81f0          POP      {r4-r8,pc}
;;;1199   #endif
                          ENDP


                          AREA ||i.dir_find||, CODE, READONLY, ALIGN=1

                  dir_find PROC
;;;1428   static
;;;1429   FRESULT dir_find (
000000  e92d47f0          PUSH     {r4-r10,lr}
;;;1430   	DIR* dp			/* Pointer to the directory object linked to the file name */
;;;1431   )
;;;1432   {
000004  4604              MOV      r4,r0
;;;1433   	FRESULT res;
;;;1434   	BYTE c, *dir;
;;;1435   #if _USE_LFN
;;;1436   	BYTE a, ord, sum;
;;;1437   #endif
;;;1438   
;;;1439   	res = dir_sdi(dp, 0);			/* Rewind directory object */
000006  2100              MOVS     r1,#0
000008  4620              MOV      r0,r4
00000a  f7fffffe          BL       dir_sdi
00000e  4607              MOV      r7,r0
;;;1440   	if (res != FR_OK) return res;
000010  b117              CBZ      r7,|L9.24|
000012  4638              MOV      r0,r7
                  |L9.20|
;;;1441   
;;;1442   #if _USE_LFN
;;;1443   	ord = sum = 0xFF; dp->lfn_idx = 0xFFFF;	/* Reset LFN sequence */
;;;1444   #endif
;;;1445   	do {
;;;1446   		res = move_window(dp->fs, dp->sect);
;;;1447   		if (res != FR_OK) break;
;;;1448   		dir = dp->dir;					/* Ptr to the directory entry of current index */
;;;1449   		c = dir[DIR_Name];
;;;1450   		if (c == 0) { res = FR_NO_FILE; break; }	/* Reached to end of table */
;;;1451   #if _USE_LFN	/* LFN configuration */
;;;1452   		a = dir[DIR_Attr] & AM_MASK;
;;;1453   		if (c == DDEM || ((a & AM_VOL) && a != AM_LFN)) {	/* An entry without valid data */
;;;1454   			ord = 0xFF; dp->lfn_idx = 0xFFFF;	/* Reset LFN sequence */
;;;1455   		} else {
;;;1456   			if (a == AM_LFN) {			/* An LFN entry is found */
;;;1457   				if (dp->lfn) {
;;;1458   					if (c & LLEF) {		/* Is it start of LFN sequence? */
;;;1459   						sum = dir[LDIR_Chksum];
;;;1460   						c &= ~LLEF; ord = c;	/* LFN start order */
;;;1461   						dp->lfn_idx = dp->index;	/* Start index of LFN */
;;;1462   					}
;;;1463   					/* Check validity of the LFN entry and compare it with given name */
;;;1464   					ord = (c == ord && sum == dir[LDIR_Chksum] && cmp_lfn(dp->lfn, dir)) ? ord - 1 : 0xFF;
;;;1465   				}
;;;1466   			} else {					/* An SFN entry is found */
;;;1467   				if (!ord && sum == sum_sfn(dir)) break;	/* LFN matched? */
;;;1468   				if (!(dp->fn[NSFLAG] & NS_LOSS) && !mem_cmp(dir, dp->fn, 11)) break;	/* SFN matched? */
;;;1469   				ord = 0xFF; dp->lfn_idx = 0xFFFF;	/* Reset LFN sequence */
;;;1470   			}
;;;1471   		}
;;;1472   #else		/* Non LFN configuration */
;;;1473   		if (!(dir[DIR_Attr] & AM_VOL) && !mem_cmp(dir, dp->fn, 11)) /* Is it a valid entry? */
;;;1474   			break;
;;;1475   #endif
;;;1476   		res = dir_next(dp, 0);		/* Next entry */
;;;1477   	} while (res == FR_OK);
;;;1478   
;;;1479   	return res;
;;;1480   }
000014  e8bd87f0          POP      {r4-r10,pc}
                  |L9.24|
000018  f04f09ff          MOV      r9,#0xff              ;1443
00001c  46ca              MOV      r10,r9                ;1443
00001e  f64f70ff          MOV      r0,#0xffff            ;1443
000022  8420              STRH     r0,[r4,#0x20]         ;1443
000024  bf00              NOP                            ;1445
                  |L9.38|
000026  6921              LDR      r1,[r4,#0x10]         ;1446
000028  6820              LDR      r0,[r4,#0]            ;1446
00002a  f7fffffe          BL       move_window
00002e  4607              MOV      r7,r0                 ;1446
000030  b107              CBZ      r7,|L9.52|
000032  e057              B        |L9.228|
                  |L9.52|
000034  6965              LDR      r5,[r4,#0x14]         ;1448
000036  782e              LDRB     r6,[r5,#0]            ;1449
000038  b90e              CBNZ     r6,|L9.62|
00003a  2704              MOVS     r7,#4                 ;1450
00003c  e052              B        |L9.228|
                  |L9.62|
00003e  7ae8              LDRB     r0,[r5,#0xb]          ;1452
000040  f000083f          AND      r8,r0,#0x3f           ;1452
000044  2ee5              CMP      r6,#0xe5              ;1453
000046  d005              BEQ      |L9.84|
000048  f0080008          AND      r0,r8,#8              ;1453
00004c  b140              CBZ      r0,|L9.96|
00004e  f1b80f0f          CMP      r8,#0xf               ;1453
000052  d005              BEQ      |L9.96|
                  |L9.84|
000054  f04f09ff          MOV      r9,#0xff              ;1454
000058  f64f70ff          MOV      r0,#0xffff            ;1454
00005c  8420              STRH     r0,[r4,#0x20]         ;1454
00005e  e03a              B        |L9.214|
                  |L9.96|
000060  f1b80f0f          CMP      r8,#0xf               ;1456
000064  d11c              BNE      |L9.160|
000066  69e0              LDR      r0,[r4,#0x1c]         ;1457
000068  b378              CBZ      r0,|L9.202|
00006a  f0060040          AND      r0,r6,#0x40           ;1458
00006e  b130              CBZ      r0,|L9.126|
000070  f895a00d          LDRB     r10,[r5,#0xd]         ;1459
000074  f0260640          BIC      r6,r6,#0x40           ;1460
000078  46b1              MOV      r9,r6                 ;1460
00007a  88e0              LDRH     r0,[r4,#6]            ;1461
00007c  8420              STRH     r0,[r4,#0x20]         ;1461
                  |L9.126|
00007e  454e              CMP      r6,r9                 ;1464
000080  d10a              BNE      |L9.152|
000082  7b68              LDRB     r0,[r5,#0xd]          ;1464
000084  4550              CMP      r0,r10                ;1464
000086  d107              BNE      |L9.152|
000088  4629              MOV      r1,r5                 ;1464
00008a  69e0              LDR      r0,[r4,#0x1c]         ;1464
00008c  f7fffffe          BL       cmp_lfn
000090  b110              CBZ      r0,|L9.152|
000092  f1a90001          SUB      r0,r9,#1              ;1464
000096  e000              B        |L9.154|
                  |L9.152|
000098  20ff              MOVS     r0,#0xff              ;1464
                  |L9.154|
00009a  f00009ff          AND      r9,r0,#0xff           ;1464
00009e  e01a              B        |L9.214|
                  |L9.160|
0000a0  f1b90f00          CMP      r9,#0                 ;1467
0000a4  d105              BNE      |L9.178|
0000a6  4628              MOV      r0,r5                 ;1467
0000a8  f7fffffe          BL       sum_sfn
0000ac  4550              CMP      r0,r10                ;1467
0000ae  d100              BNE      |L9.178|
0000b0  e018              B        |L9.228|
                  |L9.178|
0000b2  69a0              LDR      r0,[r4,#0x18]         ;1468
0000b4  7ac0              LDRB     r0,[r0,#0xb]          ;1468
0000b6  f0000001          AND      r0,r0,#1              ;1468
0000ba  b938              CBNZ     r0,|L9.204|
0000bc  220b              MOVS     r2,#0xb               ;1468
0000be  4628              MOV      r0,r5                 ;1468
0000c0  69a1              LDR      r1,[r4,#0x18]         ;1468
0000c2  f7fffffe          BL       mem_cmp
0000c6  b908              CBNZ     r0,|L9.204|
0000c8  e00c              B        |L9.228|
                  |L9.202|
0000ca  e004              B        |L9.214|
                  |L9.204|
0000cc  f04f09ff          MOV      r9,#0xff              ;1469
0000d0  f64f70ff          MOV      r0,#0xffff            ;1469
0000d4  8420              STRH     r0,[r4,#0x20]         ;1469
                  |L9.214|
0000d6  2100              MOVS     r1,#0                 ;1476
0000d8  4620              MOV      r0,r4                 ;1476
0000da  f7fffffe          BL       dir_next
0000de  4607              MOV      r7,r0                 ;1476
0000e0  2f00              CMP      r7,#0                 ;1477
0000e2  d0a0              BEQ      |L9.38|
                  |L9.228|
0000e4  bf00              NOP                            ;1447
0000e6  4638              MOV      r0,r7                 ;1479
0000e8  e794              B        |L9.20|
;;;1481   
                          ENDP


                          AREA ||i.dir_next||, CODE, READONLY, ALIGN=1

                  dir_next PROC
;;;1101   static
;;;1102   FRESULT dir_next (	/* FR_OK:Succeeded, FR_NO_FILE:End of table, FR_DENIED:Could not stretch */
000000  e92d41f0          PUSH     {r4-r8,lr}
;;;1103   	DIR* dp,		/* Pointer to the directory object */
;;;1104   	int stretch		/* 0: Do not stretch table, 1: Stretch table if needed */
;;;1105   )
;;;1106   {
000004  4604              MOV      r4,r0
000006  4688              MOV      r8,r1
;;;1107   	DWORD clst;
;;;1108   	UINT i;
;;;1109   #if !_FS_READONLY
;;;1110   	UINT c;
;;;1111   #endif
;;;1112   
;;;1113   
;;;1114   	i = dp->index + 1;
000008  88e0              LDRH     r0,[r4,#6]
00000a  1c46              ADDS     r6,r0,#1
;;;1115   	if (!(i & 0xFFFF) || !dp->sect)	/* Report EOT when index has reached 65535 */
00000c  b2b0              UXTH     r0,r6
00000e  b108              CBZ      r0,|L10.20|
000010  6920              LDR      r0,[r4,#0x10]
000012  b910              CBNZ     r0,|L10.26|
                  |L10.20|
;;;1116   		return FR_NO_FILE;
000014  2004              MOVS     r0,#4
                  |L10.22|
;;;1117   
;;;1118   	if (!(i % (SS(dp->fs) / SZ_DIRE))) {	/* Sector changed? */
;;;1119   		dp->sect++;					/* Next sector */
;;;1120   
;;;1121   		if (!dp->clust) {		/* Static table */
;;;1122   			if (i >= dp->fs->n_rootdir)	/* Report EOT if it reached end of static table */
;;;1123   				return FR_NO_FILE;
;;;1124   		}
;;;1125   		else {					/* Dynamic table */
;;;1126   			if (((i / (SS(dp->fs) / SZ_DIRE)) & (dp->fs->csize - 1)) == 0) {	/* Cluster changed? */
;;;1127   				clst = get_fat(dp->fs, dp->clust);				/* Get next cluster */
;;;1128   				if (clst <= 1) return FR_INT_ERR;
;;;1129   				if (clst == 0xFFFFFFFF) return FR_DISK_ERR;
;;;1130   				if (clst >= dp->fs->n_fatent) {					/* If it reached end of dynamic table, */
;;;1131   #if !_FS_READONLY
;;;1132   					if (!stretch) return FR_NO_FILE;			/* If do not stretch, report EOT */
;;;1133   					clst = create_chain(dp->fs, dp->clust);		/* Stretch cluster chain */
;;;1134   					if (clst == 0) return FR_DENIED;			/* No free cluster */
;;;1135   					if (clst == 1) return FR_INT_ERR;
;;;1136   					if (clst == 0xFFFFFFFF) return FR_DISK_ERR;
;;;1137   					/* Clean-up stretched table */
;;;1138   					if (sync_window(dp->fs)) return FR_DISK_ERR;/* Flush disk access window */
;;;1139   					mem_set(dp->fs->win, 0, SS(dp->fs));		/* Clear window buffer */
;;;1140   					dp->fs->winsect = clust2sect(dp->fs, clst);	/* Cluster start sector */
;;;1141   					for (c = 0; c < dp->fs->csize; c++) {		/* Fill the new cluster with 0 */
;;;1142   						dp->fs->wflag = 1;
;;;1143   						if (sync_window(dp->fs)) return FR_DISK_ERR;
;;;1144   						dp->fs->winsect++;
;;;1145   					}
;;;1146   					dp->fs->winsect -= c;						/* Rewind window offset */
;;;1147   #else
;;;1148   					if (!stretch) return FR_NO_FILE;			/* If do not stretch, report EOT (this is to suppress warning) */
;;;1149   					return FR_NO_FILE;							/* Report EOT */
;;;1150   #endif
;;;1151   				}
;;;1152   				dp->clust = clst;				/* Initialize data for new cluster */
;;;1153   				dp->sect = clust2sect(dp->fs, clst);
;;;1154   			}
;;;1155   		}
;;;1156   	}
;;;1157   
;;;1158   	dp->index = (WORD)i;	/* Current index */
;;;1159   	dp->dir = dp->fs->win + (i % (SS(dp->fs) / SZ_DIRE)) * SZ_DIRE;	/* Current entry in the window */
;;;1160   
;;;1161   	return FR_OK;
;;;1162   }
000016  e8bd81f0          POP      {r4-r8,pc}
                  |L10.26|
00001a  f006000f          AND      r0,r6,#0xf            ;1118
00001e  2800              CMP      r0,#0                 ;1118
000020  d16b              BNE      |L10.250|
000022  6920              LDR      r0,[r4,#0x10]         ;1119
000024  1c40              ADDS     r0,r0,#1              ;1119
000026  6120              STR      r0,[r4,#0x10]         ;1119
000028  68e0              LDR      r0,[r4,#0xc]          ;1121
00002a  b928              CBNZ     r0,|L10.56|
00002c  6820              LDR      r0,[r4,#0]            ;1122
00002e  8900              LDRH     r0,[r0,#8]            ;1122
000030  42b0              CMP      r0,r6                 ;1122
000032  d862              BHI      |L10.250|
000034  2004              MOVS     r0,#4                 ;1123
000036  e7ee              B        |L10.22|
                  |L10.56|
000038  6820              LDR      r0,[r4,#0]            ;1126
00003a  7880              LDRB     r0,[r0,#2]            ;1126
00003c  1e40              SUBS     r0,r0,#1              ;1126
00003e  ea001016          AND      r0,r0,r6,LSR #4       ;1126
000042  2800              CMP      r0,#0                 ;1126
000044  d159              BNE      |L10.250|
000046  68e1              LDR      r1,[r4,#0xc]          ;1127
000048  6820              LDR      r0,[r4,#0]            ;1127
00004a  f7fffffe          BL       get_fat
00004e  4605              MOV      r5,r0                 ;1127
000050  2d01              CMP      r5,#1                 ;1128
000052  d801              BHI      |L10.88|
000054  2002              MOVS     r0,#2                 ;1128
000056  e7de              B        |L10.22|
                  |L10.88|
000058  1c68              ADDS     r0,r5,#1              ;1129
00005a  b908              CBNZ     r0,|L10.96|
00005c  2001              MOVS     r0,#1                 ;1129
00005e  e7da              B        |L10.22|
                  |L10.96|
000060  6820              LDR      r0,[r4,#0]            ;1130
000062  6940              LDR      r0,[r0,#0x14]         ;1130
000064  42a8              CMP      r0,r5                 ;1130
000066  d842              BHI      |L10.238|
000068  f1b80f00          CMP      r8,#0                 ;1132
00006c  d101              BNE      |L10.114|
00006e  2004              MOVS     r0,#4                 ;1132
000070  e7d1              B        |L10.22|
                  |L10.114|
000072  68e1              LDR      r1,[r4,#0xc]          ;1133
000074  6820              LDR      r0,[r4,#0]            ;1133
000076  f7fffffe          BL       create_chain
00007a  4605              MOV      r5,r0                 ;1133
00007c  b90d              CBNZ     r5,|L10.130|
00007e  2007              MOVS     r0,#7                 ;1134
000080  e7c9              B        |L10.22|
                  |L10.130|
000082  2d01              CMP      r5,#1                 ;1135
000084  d101              BNE      |L10.138|
000086  2002              MOVS     r0,#2                 ;1135
000088  e7c5              B        |L10.22|
                  |L10.138|
00008a  1c68              ADDS     r0,r5,#1              ;1136
00008c  b908              CBNZ     r0,|L10.146|
00008e  2001              MOVS     r0,#1                 ;1136
000090  e7c1              B        |L10.22|
                  |L10.146|
000092  6820              LDR      r0,[r4,#0]            ;1138
000094  f7fffffe          BL       sync_window
000098  b108              CBZ      r0,|L10.158|
00009a  2001              MOVS     r0,#1                 ;1138
00009c  e7bb              B        |L10.22|
                  |L10.158|
00009e  6821              LDR      r1,[r4,#0]            ;1139
0000a0  f1010030          ADD      r0,r1,#0x30           ;1139
0000a4  f44f7200          MOV      r2,#0x200             ;1139
0000a8  2100              MOVS     r1,#0                 ;1139
0000aa  f7fffffe          BL       mem_set
0000ae  4629              MOV      r1,r5                 ;1140
0000b0  6820              LDR      r0,[r4,#0]            ;1140
0000b2  f7fffffe          BL       clust2sect
0000b6  6821              LDR      r1,[r4,#0]            ;1140
0000b8  62c8              STR      r0,[r1,#0x2c]         ;1140
0000ba  2700              MOVS     r7,#0                 ;1141
0000bc  e00e              B        |L10.220|
                  |L10.190|
0000be  2001              MOVS     r0,#1                 ;1142
0000c0  6821              LDR      r1,[r4,#0]            ;1142
0000c2  7108              STRB     r0,[r1,#4]            ;1142
0000c4  6820              LDR      r0,[r4,#0]            ;1143
0000c6  f7fffffe          BL       sync_window
0000ca  b108              CBZ      r0,|L10.208|
0000cc  2001              MOVS     r0,#1                 ;1143
0000ce  e7a2              B        |L10.22|
                  |L10.208|
0000d0  6820              LDR      r0,[r4,#0]            ;1144
0000d2  6ac0              LDR      r0,[r0,#0x2c]         ;1144
0000d4  1c40              ADDS     r0,r0,#1              ;1144
0000d6  6821              LDR      r1,[r4,#0]            ;1144
0000d8  62c8              STR      r0,[r1,#0x2c]         ;1144
0000da  1c7f              ADDS     r7,r7,#1              ;1141
                  |L10.220|
0000dc  6820              LDR      r0,[r4,#0]            ;1141
0000de  7880              LDRB     r0,[r0,#2]            ;1141
0000e0  42b8              CMP      r0,r7                 ;1141
0000e2  d8ec              BHI      |L10.190|
0000e4  6820              LDR      r0,[r4,#0]            ;1146
0000e6  6ac0              LDR      r0,[r0,#0x2c]         ;1146
0000e8  1bc0              SUBS     r0,r0,r7              ;1146
0000ea  6821              LDR      r1,[r4,#0]            ;1146
0000ec  62c8              STR      r0,[r1,#0x2c]         ;1146
                  |L10.238|
0000ee  60e5              STR      r5,[r4,#0xc]          ;1152
0000f0  4629              MOV      r1,r5                 ;1153
0000f2  6820              LDR      r0,[r4,#0]            ;1153
0000f4  f7fffffe          BL       clust2sect
0000f8  6120              STR      r0,[r4,#0x10]         ;1153
                  |L10.250|
0000fa  80e6              STRH     r6,[r4,#6]            ;1158
0000fc  6820              LDR      r0,[r4,#0]            ;1159
0000fe  3030              ADDS     r0,r0,#0x30           ;1159
000100  f006010f          AND      r1,r6,#0xf            ;1159
000104  eb001041          ADD      r0,r0,r1,LSL #5       ;1159
000108  6160              STR      r0,[r4,#0x14]         ;1159
00010a  2000              MOVS     r0,#0                 ;1161
00010c  e783              B        |L10.22|
;;;1163   
                          ENDP


                          AREA ||i.dir_read||, CODE, READONLY, ALIGN=1

                  dir_read PROC
;;;1489   static
;;;1490   FRESULT dir_read (
000000  e92d5ff0          PUSH     {r4-r12,lr}
;;;1491   	DIR* dp,		/* Pointer to the directory object */
;;;1492   	int vol			/* Filtered by 0:file/directory or 1:volume label */
;;;1493   )
;;;1494   {
000004  4604              MOV      r4,r0
000006  468a              MOV      r10,r1
;;;1495   	FRESULT res;
;;;1496   	BYTE a, c, *dir;
;;;1497   #if _USE_LFN
;;;1498   	BYTE ord = 0xFF, sum = 0xFF;
000008  f04f09ff          MOV      r9,#0xff
00000c  46cb              MOV      r11,r9
;;;1499   #endif
;;;1500   
;;;1501   	res = FR_NO_FILE;
00000e  2704              MOVS     r7,#4
;;;1502   	while (dp->sect) {
000010  e04f              B        |L11.178|
                  |L11.18|
;;;1503   		res = move_window(dp->fs, dp->sect);
000012  6921              LDR      r1,[r4,#0x10]
000014  6820              LDR      r0,[r4,#0]
000016  f7fffffe          BL       move_window
00001a  4607              MOV      r7,r0
;;;1504   		if (res != FR_OK) break;
00001c  b107              CBZ      r7,|L11.32|
00001e  e04b              B        |L11.184|
                  |L11.32|
;;;1505   		dir = dp->dir;					/* Ptr to the directory entry of current index */
000020  6966              LDR      r6,[r4,#0x14]
;;;1506   		c = dir[DIR_Name];
000022  7835              LDRB     r5,[r6,#0]
;;;1507   		if (c == 0) { res = FR_NO_FILE; break; }	/* Reached to end of table */
000024  b90d              CBNZ     r5,|L11.42|
000026  2704              MOVS     r7,#4
000028  e046              B        |L11.184|
                  |L11.42|
;;;1508   		a = dir[DIR_Attr] & AM_MASK;
00002a  7af0              LDRB     r0,[r6,#0xb]
00002c  f000083f          AND      r8,r0,#0x3f
;;;1509   #if _USE_LFN	/* LFN configuration */
;;;1510   		if (c == DDEM || (!_FS_RPATH && c == '.') || (int)((a & ~AM_ARC) == AM_VOL) != vol) {	/* An entry without valid data */
000030  2de5              CMP      r5,#0xe5
000032  d00a              BEQ      |L11.74|
000034  2d2e              CMP      r5,#0x2e
000036  d008              BEQ      |L11.74|
000038  f0280020          BIC      r0,r8,#0x20
00003c  2808              CMP      r0,#8
00003e  d101              BNE      |L11.68|
000040  2001              MOVS     r0,#1
000042  e000              B        |L11.70|
                  |L11.68|
000044  2000              MOVS     r0,#0
                  |L11.70|
000046  4550              CMP      r0,r10
000048  d002              BEQ      |L11.80|
                  |L11.74|
;;;1511   			ord = 0xFF;
00004a  f04f09ff          MOV      r9,#0xff
00004e  e029              B        |L11.164|
                  |L11.80|
;;;1512   		} else {
;;;1513   			if (a == AM_LFN) {			/* An LFN entry is found */
000050  f1b80f0f          CMP      r8,#0xf
000054  d11a              BNE      |L11.140|
;;;1514   				if (c & LLEF) {			/* Is it start of LFN sequence? */
000056  f0050040          AND      r0,r5,#0x40
00005a  b130              CBZ      r0,|L11.106|
;;;1515   					sum = dir[LDIR_Chksum];
00005c  f896b00d          LDRB     r11,[r6,#0xd]
;;;1516   					c &= ~LLEF; ord = c;
000060  f0250540          BIC      r5,r5,#0x40
000064  46a9              MOV      r9,r5
;;;1517   					dp->lfn_idx = dp->index;
000066  88e0              LDRH     r0,[r4,#6]
000068  8420              STRH     r0,[r4,#0x20]
                  |L11.106|
;;;1518   				}
;;;1519   				/* Check LFN validity and capture it */
;;;1520   				ord = (c == ord && sum == dir[LDIR_Chksum] && pick_lfn(dp->lfn, dir)) ? ord - 1 : 0xFF;
00006a  454d              CMP      r5,r9
00006c  d10a              BNE      |L11.132|
00006e  7b70              LDRB     r0,[r6,#0xd]
000070  4558              CMP      r0,r11
000072  d107              BNE      |L11.132|
000074  4631              MOV      r1,r6
000076  69e0              LDR      r0,[r4,#0x1c]
000078  f7fffffe          BL       pick_lfn
00007c  b110              CBZ      r0,|L11.132|
00007e  f1a90001          SUB      r0,r9,#1
000082  e000              B        |L11.134|
                  |L11.132|
000084  20ff              MOVS     r0,#0xff
                  |L11.134|
000086  f00009ff          AND      r9,r0,#0xff
00008a  e00b              B        |L11.164|
                  |L11.140|
;;;1521   			} else {					/* An SFN entry is found */
;;;1522   				if (ord || sum != sum_sfn(dir))	/* Is there a valid LFN? */
00008c  f1b90f00          CMP      r9,#0
000090  d104              BNE      |L11.156|
000092  4630              MOV      r0,r6
000094  f7fffffe          BL       sum_sfn
000098  4558              CMP      r0,r11
00009a  d002              BEQ      |L11.162|
                  |L11.156|
;;;1523   					dp->lfn_idx = 0xFFFF;		/* It has no LFN. */
00009c  f64f70ff          MOV      r0,#0xffff
0000a0  8420              STRH     r0,[r4,#0x20]
                  |L11.162|
;;;1524   				break;
0000a2  e009              B        |L11.184|
                  |L11.164|
;;;1525   			}
;;;1526   		}
;;;1527   #else		/* Non LFN configuration */
;;;1528   		if (c != DDEM && (_FS_RPATH || c != '.') && a != AM_LFN && (int)((a & ~AM_ARC) == AM_VOL) == vol)	/* Is it a valid entry? */
;;;1529   			break;
;;;1530   #endif
;;;1531   		res = dir_next(dp, 0);				/* Next entry */
0000a4  2100              MOVS     r1,#0
0000a6  4620              MOV      r0,r4
0000a8  f7fffffe          BL       dir_next
0000ac  4607              MOV      r7,r0
;;;1532   		if (res != FR_OK) break;
0000ae  b107              CBZ      r7,|L11.178|
0000b0  e002              B        |L11.184|
                  |L11.178|
0000b2  6920              LDR      r0,[r4,#0x10]         ;1502
0000b4  2800              CMP      r0,#0                 ;1502
0000b6  d1ac              BNE      |L11.18|
                  |L11.184|
0000b8  bf00              NOP                            ;1504
;;;1533   	}
;;;1534   
;;;1535   	if (res != FR_OK) dp->sect = 0;
0000ba  b10f              CBZ      r7,|L11.192|
0000bc  2000              MOVS     r0,#0
0000be  6120              STR      r0,[r4,#0x10]
                  |L11.192|
;;;1536   
;;;1537   	return res;
0000c0  4638              MOV      r0,r7
;;;1538   }
0000c2  e8bd9ff0          POP      {r4-r12,pc}
;;;1539   #endif	/* _FS_MINIMIZE <= 1 || _USE_LABEL || _FS_RPATH >= 2 */
                          ENDP


                          AREA ||i.dir_register||, CODE, READONLY, ALIGN=1

                  dir_register PROC
;;;1548   static
;;;1549   FRESULT dir_register (	/* FR_OK:Successful, FR_DENIED:No free entry or too many SFN collision, FR_DISK_ERR:Disk error */
000000  e92d4ffe          PUSH     {r1-r11,lr}
;;;1550   	DIR* dp				/* Target directory with object name to be created */
;;;1551   )
;;;1552   {
000004  4604              MOV      r4,r0
;;;1553   	FRESULT res;
;;;1554   #if _USE_LFN	/* LFN configuration */
;;;1555   	UINT n, nent;
;;;1556   	BYTE sn[12], *fn, sum;
;;;1557   	WCHAR *lfn;
;;;1558   
;;;1559   
;;;1560   	fn = dp->fn; lfn = dp->lfn;
000006  f8d48018          LDR      r8,[r4,#0x18]
00000a  f8d4901c          LDR      r9,[r4,#0x1c]
;;;1561   	mem_cpy(sn, fn, 12);
00000e  220c              MOVS     r2,#0xc
000010  4641              MOV      r1,r8
000012  4668              MOV      r0,sp
000014  f7fffffe          BL       mem_cpy
;;;1562   
;;;1563   	if (_FS_RPATH && (sn[NSFLAG] & NS_DOT))		/* Cannot create dot entry */
000018  bf00              NOP      
;;;1564   		return FR_INVALID_NAME;
;;;1565   
;;;1566   	if (sn[NSFLAG] & NS_LOSS) {			/* When LFN is out of 8.3 format, generate a numbered name */
00001a  f89d000b          LDRB     r0,[sp,#0xb]
00001e  f0000001          AND      r0,r0,#1
000022  b320              CBZ      r0,|L12.110|
;;;1567   		fn[NSFLAG] = 0; dp->lfn = 0;			/* Find only SFN */
000024  2000              MOVS     r0,#0
000026  f888000b          STRB     r0,[r8,#0xb]
00002a  61e0              STR      r0,[r4,#0x1c]
;;;1568   		for (n = 1; n < 100; n++) {
00002c  2601              MOVS     r6,#1
00002e  e00c              B        |L12.74|
                  |L12.48|
;;;1569   			gen_numname(fn, sn, lfn, n);	/* Generate a numbered name */
000030  4633              MOV      r3,r6
000032  464a              MOV      r2,r9
000034  4669              MOV      r1,sp
000036  4640              MOV      r0,r8
000038  f7fffffe          BL       gen_numname
;;;1570   			res = dir_find(dp);				/* Check if the name collides with existing SFN */
00003c  4620              MOV      r0,r4
00003e  f7fffffe          BL       dir_find
000042  4605              MOV      r5,r0
;;;1571   			if (res != FR_OK) break;
000044  b105              CBZ      r5,|L12.72|
000046  e002              B        |L12.78|
                  |L12.72|
000048  1c76              ADDS     r6,r6,#1              ;1568
                  |L12.74|
00004a  2e64              CMP      r6,#0x64              ;1568
00004c  d3f0              BCC      |L12.48|
                  |L12.78|
00004e  bf00              NOP      
;;;1572   		}
;;;1573   		if (n == 100) return FR_DENIED;		/* Abort if too many collisions */
000050  2e64              CMP      r6,#0x64
000052  d102              BNE      |L12.90|
000054  2007              MOVS     r0,#7
                  |L12.86|
;;;1574   		if (res != FR_NO_FILE) return res;	/* Abort if the result is other than 'not collided' */
;;;1575   		fn[NSFLAG] = sn[NSFLAG]; dp->lfn = lfn;
;;;1576   	}
;;;1577   
;;;1578   	if (sn[NSFLAG] & NS_LFN) {			/* When LFN is to be created, allocate entries for an SFN + LFNs. */
;;;1579   		for (n = 0; lfn[n]; n++) ;
;;;1580   		nent = (n + 25) / 13;
;;;1581   	} else {						/* Otherwise allocate an entry for an SFN  */
;;;1582   		nent = 1;
;;;1583   	}
;;;1584   	res = dir_alloc(dp, nent);		/* Allocate entries */
;;;1585   
;;;1586   	if (res == FR_OK && --nent) {	/* Set LFN entry if needed */
;;;1587   		res = dir_sdi(dp, dp->index - nent);
;;;1588   		if (res == FR_OK) {
;;;1589   			sum = sum_sfn(dp->fn);	/* Sum value of the SFN tied to the LFN */
;;;1590   			do {					/* Store LFN entries in bottom first */
;;;1591   				res = move_window(dp->fs, dp->sect);
;;;1592   				if (res != FR_OK) break;
;;;1593   				fit_lfn(dp->lfn, dp->dir, (BYTE)nent, sum);
;;;1594   				dp->fs->wflag = 1;
;;;1595   				res = dir_next(dp, 0);	/* Next entry */
;;;1596   			} while (res == FR_OK && --nent);
;;;1597   		}
;;;1598   	}
;;;1599   #else	/* Non LFN configuration */
;;;1600   	res = dir_alloc(dp, 1);		/* Allocate an entry for SFN */
;;;1601   #endif
;;;1602   
;;;1603   	if (res == FR_OK) {				/* Set SFN entry */
;;;1604   		res = move_window(dp->fs, dp->sect);
;;;1605   		if (res == FR_OK) {
;;;1606   			mem_set(dp->dir, 0, SZ_DIRE);	/* Clean the entry */
;;;1607   			mem_cpy(dp->dir, dp->fn, 11);	/* Put SFN */
;;;1608   #if _USE_LFN
;;;1609   			dp->dir[DIR_NTres] = dp->fn[NSFLAG] & (NS_BODY | NS_EXT);	/* Put NT flag */
;;;1610   #endif
;;;1611   			dp->fs->wflag = 1;
;;;1612   		}
;;;1613   	}
;;;1614   
;;;1615   	return res;
;;;1616   }
000056  e8bd8ffe          POP      {r1-r11,pc}
                  |L12.90|
00005a  2d04              CMP      r5,#4                 ;1574
00005c  d001              BEQ      |L12.98|
00005e  4628              MOV      r0,r5                 ;1574
000060  e7f9              B        |L12.86|
                  |L12.98|
000062  f89d000b          LDRB     r0,[sp,#0xb]          ;1575
000066  f888000b          STRB     r0,[r8,#0xb]          ;1575
00006a  f8c4901c          STR      r9,[r4,#0x1c]         ;1575
                  |L12.110|
00006e  f89d000b          LDRB     r0,[sp,#0xb]          ;1578
000072  f0000002          AND      r0,r0,#2              ;1578
000076  b160              CBZ      r0,|L12.146|
000078  2600              MOVS     r6,#0                 ;1579
00007a  e000              B        |L12.126|
                  |L12.124|
00007c  1c76              ADDS     r6,r6,#1              ;1579
                  |L12.126|
00007e  f8390016          LDRH     r0,[r9,r6,LSL #1]     ;1579
000082  2800              CMP      r0,#0                 ;1579
000084  d1fa              BNE      |L12.124|
000086  f1060019          ADD      r0,r6,#0x19           ;1580
00008a  210d              MOVS     r1,#0xd               ;1580
00008c  fbb0f7f1          UDIV     r7,r0,r1              ;1580
000090  e000              B        |L12.148|
                  |L12.146|
000092  2701              MOVS     r7,#1                 ;1582
                  |L12.148|
000094  4639              MOV      r1,r7                 ;1584
000096  4620              MOV      r0,r4                 ;1584
000098  f7fffffe          BL       dir_alloc
00009c  4605              MOV      r5,r0                 ;1584
00009e  bb45              CBNZ     r5,|L12.242|
0000a0  1e78              SUBS     r0,r7,#1              ;1586
0000a2  1e07              SUBS     r7,r0,#0              ;1586
0000a4  d025              BEQ      |L12.242|
0000a6  88e0              LDRH     r0,[r4,#6]            ;1587
0000a8  1bc1              SUBS     r1,r0,r7              ;1587
0000aa  4620              MOV      r0,r4                 ;1587
0000ac  f7fffffe          BL       dir_sdi
0000b0  4605              MOV      r5,r0                 ;1587
0000b2  b9f5              CBNZ     r5,|L12.242|
0000b4  69a0              LDR      r0,[r4,#0x18]         ;1589
0000b6  f7fffffe          BL       sum_sfn
0000ba  4682              MOV      r10,r0                ;1589
0000bc  bf00              NOP                            ;1590
                  |L12.190|
0000be  6921              LDR      r1,[r4,#0x10]         ;1591
0000c0  6820              LDR      r0,[r4,#0]            ;1591
0000c2  f7fffffe          BL       move_window
0000c6  4605              MOV      r5,r0                 ;1591
0000c8  b105              CBZ      r5,|L12.204|
0000ca  e011              B        |L12.240|
                  |L12.204|
0000cc  b2fa              UXTB     r2,r7                 ;1593
0000ce  4653              MOV      r3,r10                ;1593
0000d0  6961              LDR      r1,[r4,#0x14]         ;1593
0000d2  69e0              LDR      r0,[r4,#0x1c]         ;1593
0000d4  f7fffffe          BL       fit_lfn
0000d8  2001              MOVS     r0,#1                 ;1594
0000da  6821              LDR      r1,[r4,#0]            ;1594
0000dc  7108              STRB     r0,[r1,#4]            ;1594
0000de  2100              MOVS     r1,#0                 ;1595
0000e0  4620              MOV      r0,r4                 ;1595
0000e2  f7fffffe          BL       dir_next
0000e6  4605              MOV      r5,r0                 ;1595
0000e8  b915              CBNZ     r5,|L12.240|
0000ea  1e78              SUBS     r0,r7,#1              ;1596
0000ec  1e07              SUBS     r7,r0,#0              ;1596
0000ee  d1e6              BNE      |L12.190|
                  |L12.240|
0000f0  bf00              NOP                            ;1592
                  |L12.242|
0000f2  b9c5              CBNZ     r5,|L12.294|
0000f4  6921              LDR      r1,[r4,#0x10]         ;1604
0000f6  6820              LDR      r0,[r4,#0]            ;1604
0000f8  f7fffffe          BL       move_window
0000fc  4605              MOV      r5,r0                 ;1604
0000fe  b995              CBNZ     r5,|L12.294|
000100  2220              MOVS     r2,#0x20              ;1606
000102  2100              MOVS     r1,#0                 ;1606
000104  6960              LDR      r0,[r4,#0x14]         ;1606
000106  f7fffffe          BL       mem_set
00010a  220b              MOVS     r2,#0xb               ;1607
00010c  e9d40105          LDRD     r0,r1,[r4,#0x14]      ;1607
000110  f7fffffe          BL       mem_cpy
000114  69a0              LDR      r0,[r4,#0x18]         ;1609
000116  7ac0              LDRB     r0,[r0,#0xb]          ;1609
000118  f0000018          AND      r0,r0,#0x18           ;1609
00011c  6961              LDR      r1,[r4,#0x14]         ;1609
00011e  7308              STRB     r0,[r1,#0xc]          ;1609
000120  2001              MOVS     r0,#1                 ;1611
000122  6821              LDR      r1,[r4,#0]            ;1611
000124  7108              STRB     r0,[r1,#4]            ;1611
                  |L12.294|
000126  4628              MOV      r0,r5                 ;1615
000128  e795              B        |L12.86|
;;;1617   #endif /* !_FS_READONLY */
                          ENDP


                          AREA ||i.dir_remove||, CODE, READONLY, ALIGN=1

                  dir_remove PROC
;;;1626   static
;;;1627   FRESULT dir_remove (	/* FR_OK: Successful, FR_DISK_ERR: A disk error */
000000  b570              PUSH     {r4-r6,lr}
;;;1628   	DIR* dp				/* Directory object pointing the entry to be removed */
;;;1629   )
;;;1630   {
000002  4604              MOV      r4,r0
;;;1631   	FRESULT res;
;;;1632   #if _USE_LFN	/* LFN configuration */
;;;1633   	UINT i;
;;;1634   
;;;1635   	i = dp->index;	/* SFN index */
000004  88e6              LDRH     r6,[r4,#6]
;;;1636   	res = dir_sdi(dp, (dp->lfn_idx == 0xFFFF) ? i : dp->lfn_idx);	/* Goto the SFN or top of the LFN entries */
000006  8c20              LDRH     r0,[r4,#0x20]
000008  f64f72ff          MOV      r2,#0xffff
00000c  4290              CMP      r0,r2
00000e  d101              BNE      |L13.20|
000010  4630              MOV      r0,r6
000012  e000              B        |L13.22|
                  |L13.20|
000014  8c20              LDRH     r0,[r4,#0x20]
                  |L13.22|
000016  4601              MOV      r1,r0
000018  4620              MOV      r0,r4
00001a  f7fffffe          BL       dir_sdi
00001e  4605              MOV      r5,r0
;;;1637   	if (res == FR_OK) {
000020  bb0d              CBNZ     r5,|L13.102|
;;;1638   		do {
000022  bf00              NOP      
                  |L13.36|
;;;1639   			res = move_window(dp->fs, dp->sect);
000024  6921              LDR      r1,[r4,#0x10]
000026  6820              LDR      r0,[r4,#0]
000028  f7fffffe          BL       move_window
00002c  4605              MOV      r5,r0
;;;1640   			if (res != FR_OK) break;
00002e  b105              CBZ      r5,|L13.50|
000030  e015              B        |L13.94|
                  |L13.50|
;;;1641   			mem_set(dp->dir, 0, SZ_DIRE);	/* Clear and mark the entry "deleted" */
000032  2220              MOVS     r2,#0x20
000034  2100              MOVS     r1,#0
000036  6960              LDR      r0,[r4,#0x14]
000038  f7fffffe          BL       mem_set
;;;1642   			*dp->dir = DDEM;
00003c  20e5              MOVS     r0,#0xe5
00003e  6961              LDR      r1,[r4,#0x14]
000040  7008              STRB     r0,[r1,#0]
;;;1643   			dp->fs->wflag = 1;
000042  2001              MOVS     r0,#1
000044  6821              LDR      r1,[r4,#0]
000046  7108              STRB     r0,[r1,#4]
;;;1644   			if (dp->index >= i) break;	/* When reached SFN, all entries of the object has been deleted. */
000048  88e0              LDRH     r0,[r4,#6]
00004a  42b0              CMP      r0,r6
00004c  d300              BCC      |L13.80|
00004e  e006              B        |L13.94|
                  |L13.80|
;;;1645   			res = dir_next(dp, 0);		/* Next entry */
000050  2100              MOVS     r1,#0
000052  4620              MOV      r0,r4
000054  f7fffffe          BL       dir_next
000058  4605              MOV      r5,r0
;;;1646   		} while (res == FR_OK);
00005a  2d00              CMP      r5,#0
00005c  d0e2              BEQ      |L13.36|
                  |L13.94|
00005e  bf00              NOP                            ;1640
;;;1647   		if (res == FR_NO_FILE) res = FR_INT_ERR;
000060  2d04              CMP      r5,#4
000062  d100              BNE      |L13.102|
000064  2502              MOVS     r5,#2
                  |L13.102|
;;;1648   	}
;;;1649   
;;;1650   #else			/* Non LFN configuration */
;;;1651   	res = dir_sdi(dp, dp->index);
;;;1652   	if (res == FR_OK) {
;;;1653   		res = move_window(dp->fs, dp->sect);
;;;1654   		if (res == FR_OK) {
;;;1655   			mem_set(dp->dir, 0, SZ_DIRE);	/* Clear and mark the entry "deleted" */
;;;1656   			*dp->dir = DDEM;
;;;1657   			dp->fs->wflag = 1;
;;;1658   		}
;;;1659   	}
;;;1660   #endif
;;;1661   
;;;1662   	return res;
000066  4628              MOV      r0,r5
;;;1663   }
000068  bd70              POP      {r4-r6,pc}
;;;1664   #endif /* !_FS_READONLY */
                          ENDP


                          AREA ||i.dir_sdi||, CODE, READONLY, ALIGN=1

                  dir_sdi PROC
;;;1053   //static //
;;;1054   FRESULT dir_sdi (
000000  e92d41f0          PUSH     {r4-r8,lr}
;;;1055   	DIR* dp,		/* Pointer to directory object */
;;;1056   	UINT idx		/* Index of directory table */
;;;1057   )
;;;1058   {
000004  4604              MOV      r4,r0
000006  460e              MOV      r6,r1
;;;1059   	DWORD clst, sect;
;;;1060   	UINT ic;
;;;1061   
;;;1062   
;;;1063   	dp->index = (WORD)idx;	/* Current index */
000008  80e6              STRH     r6,[r4,#6]
;;;1064   	clst = dp->sclust;		/* Table start cluster (0:root) */
00000a  68a5              LDR      r5,[r4,#8]
;;;1065   	if (clst == 1 || clst >= dp->fs->n_fatent)	/* Check start cluster range */
00000c  2d01              CMP      r5,#1
00000e  d003              BEQ      |L14.24|
000010  6820              LDR      r0,[r4,#0]
000012  6940              LDR      r0,[r0,#0x14]
000014  42a8              CMP      r0,r5
000016  d802              BHI      |L14.30|
                  |L14.24|
;;;1066   		return FR_INT_ERR;
000018  2002              MOVS     r0,#2
                  |L14.26|
;;;1067   	if (!clst && dp->fs->fs_type == FS_FAT32)	/* Replace cluster# 0 with root cluster# if in FAT32 */
;;;1068   		clst = dp->fs->dirbase;
;;;1069   
;;;1070   	if (clst == 0) {	/* Static table (root-directory in FAT12/16) */
;;;1071   		if (idx >= dp->fs->n_rootdir)	/* Is index out of range? */
;;;1072   			return FR_INT_ERR;
;;;1073   		sect = dp->fs->dirbase;
;;;1074   	}
;;;1075   	else {				/* Dynamic table (root-directory in FAT32 or sub-directory) */
;;;1076   		ic = SS(dp->fs) / SZ_DIRE * dp->fs->csize;	/* Entries per cluster */
;;;1077   		while (idx >= ic) {	/* Follow cluster chain */
;;;1078   			clst = get_fat(dp->fs, clst);				/* Get next cluster */
;;;1079   			if (clst == 0xFFFFFFFF) return FR_DISK_ERR;	/* Disk error */
;;;1080   			if (clst < 2 || clst >= dp->fs->n_fatent)	/* Reached to end of table or internal error */
;;;1081   				return FR_INT_ERR;
;;;1082   			idx -= ic;
;;;1083   		}
;;;1084   		sect = clust2sect(dp->fs, clst);
;;;1085   	}
;;;1086   	dp->clust = clst;	/* Current cluster# */
;;;1087   	if (!sect) return FR_INT_ERR;
;;;1088   	dp->sect = sect + idx / (SS(dp->fs) / SZ_DIRE);					/* Sector# of the directory entry */
;;;1089   	dp->dir = dp->fs->win + (idx % (SS(dp->fs) / SZ_DIRE)) * SZ_DIRE;	/* Ptr to the entry in the sector */
;;;1090   
;;;1091   	return FR_OK;
;;;1092   }
00001a  e8bd81f0          POP      {r4-r8,pc}
                  |L14.30|
00001e  b92d              CBNZ     r5,|L14.44|
000020  6820              LDR      r0,[r4,#0]            ;1067
000022  7800              LDRB     r0,[r0,#0]            ;1067
000024  2803              CMP      r0,#3                 ;1067
000026  d101              BNE      |L14.44|
000028  6820              LDR      r0,[r4,#0]            ;1068
00002a  6a45              LDR      r5,[r0,#0x24]         ;1068
                  |L14.44|
00002c  b945              CBNZ     r5,|L14.64|
00002e  6820              LDR      r0,[r4,#0]            ;1071
000030  8900              LDRH     r0,[r0,#8]            ;1071
000032  42b0              CMP      r0,r6                 ;1071
000034  d801              BHI      |L14.58|
000036  2002              MOVS     r0,#2                 ;1072
000038  e7ef              B        |L14.26|
                  |L14.58|
00003a  6820              LDR      r0,[r4,#0]            ;1073
00003c  6a47              LDR      r7,[r0,#0x24]         ;1073
00003e  e01e              B        |L14.126|
                  |L14.64|
000040  6820              LDR      r0,[r4,#0]            ;1076
000042  7880              LDRB     r0,[r0,#2]            ;1076
000044  ea4f1800          LSL      r8,r0,#4              ;1076
000048  e012              B        |L14.112|
                  |L14.74|
00004a  4629              MOV      r1,r5                 ;1078
00004c  6820              LDR      r0,[r4,#0]            ;1078
00004e  f7fffffe          BL       get_fat
000052  4605              MOV      r5,r0                 ;1078
000054  1c68              ADDS     r0,r5,#1              ;1079
000056  b908              CBNZ     r0,|L14.92|
000058  2001              MOVS     r0,#1                 ;1079
00005a  e7de              B        |L14.26|
                  |L14.92|
00005c  2d02              CMP      r5,#2                 ;1080
00005e  d303              BCC      |L14.104|
000060  6820              LDR      r0,[r4,#0]            ;1080
000062  6940              LDR      r0,[r0,#0x14]         ;1080
000064  42a8              CMP      r0,r5                 ;1080
000066  d801              BHI      |L14.108|
                  |L14.104|
000068  2002              MOVS     r0,#2                 ;1081
00006a  e7d6              B        |L14.26|
                  |L14.108|
00006c  eba60608          SUB      r6,r6,r8              ;1082
                  |L14.112|
000070  4546              CMP      r6,r8                 ;1077
000072  d2ea              BCS      |L14.74|
000074  4629              MOV      r1,r5                 ;1084
000076  6820              LDR      r0,[r4,#0]            ;1084
000078  f7fffffe          BL       clust2sect
00007c  4607              MOV      r7,r0                 ;1084
                  |L14.126|
00007e  60e5              STR      r5,[r4,#0xc]          ;1086
000080  b90f              CBNZ     r7,|L14.134|
000082  2002              MOVS     r0,#2                 ;1087
000084  e7c9              B        |L14.26|
                  |L14.134|
000086  eb071016          ADD      r0,r7,r6,LSR #4       ;1088
00008a  6120              STR      r0,[r4,#0x10]         ;1088
00008c  6820              LDR      r0,[r4,#0]            ;1089
00008e  3030              ADDS     r0,r0,#0x30           ;1089
000090  f006010f          AND      r1,r6,#0xf            ;1089
000094  eb001041          ADD      r0,r0,r1,LSL #5       ;1089
000098  6160              STR      r0,[r4,#0x14]         ;1089
00009a  2000              MOVS     r0,#0                 ;1091
00009c  e7bd              B        |L14.26|
;;;1093   
                          ENDP


                          AREA ||i.f_chmod||, CODE, READONLY, ALIGN=1

                  f_chmod PROC
;;;3644   
;;;3645   FRESULT f_chmod (
000000  e92d41f7          PUSH     {r0-r2,r4-r8,lr}
;;;3646   	const TCHAR* path,	/* Pointer to the file path */
;;;3647   	BYTE attr,			/* Attribute bits */
;;;3648   	BYTE mask			/* Attribute mask to change */
;;;3649   )
;;;3650   {
000004  b08d              SUB      sp,sp,#0x34
000006  4688              MOV      r8,r1
000008  4614              MOV      r4,r2
;;;3651   	FRESULT res;
;;;3652   	DIR dj;
;;;3653   	BYTE *dir;
;;;3654   	DEFINE_NAMEBUF;
;;;3655   
;;;3656   
;;;3657   	/* Get logical drive number */
;;;3658   	res = find_volume(&dj.fs, &path, 1);
00000a  2201              MOVS     r2,#1
00000c  a90d              ADD      r1,sp,#0x34
00000e  a804              ADD      r0,sp,#0x10
000010  f7fffffe          BL       find_volume
000014  4607              MOV      r7,r0
;;;3659   	if (res == FR_OK) {
000016  bb4f              CBNZ     r7,|L15.108|
;;;3660   		INIT_BUF(dj);
000018  f44f7000          MOV      r0,#0x200
00001c  f7fffffe          BL       ff_memalloc
000020  4606              MOV      r6,r0
000022  b91e              CBNZ     r6,|L15.44|
000024  2011              MOVS     r0,#0x11
                  |L15.38|
;;;3661   		res = follow_path(&dj, path);		/* Follow the file path */
;;;3662   		FREE_BUF();
;;;3663   		if (_FS_RPATH && res == FR_OK && (dj.fn[NSFLAG] & NS_DOT))
;;;3664   			res = FR_INVALID_NAME;
;;;3665   		if (res == FR_OK) {
;;;3666   			dir = dj.dir;
;;;3667   			if (!dir) {						/* Is it a root directory? */
;;;3668   				res = FR_INVALID_NAME;
;;;3669   			} else {						/* File or sub directory */
;;;3670   				mask &= AM_RDO|AM_HID|AM_SYS|AM_ARC;	/* Valid attribute mask */
;;;3671   				dir[DIR_Attr] = (attr & mask) | (dir[DIR_Attr] & (BYTE)~mask);	/* Apply attribute change */
;;;3672   				dj.fs->wflag = 1;
;;;3673   				res = sync_fs(dj.fs);
;;;3674   			}
;;;3675   		}
;;;3676   	}
;;;3677   
;;;3678   	LEAVE_FF(dj.fs, res);
;;;3679   }
000026  b010              ADD      sp,sp,#0x40
000028  e8bd81f0          POP      {r4-r8,pc}
                  |L15.44|
00002c  960b              STR      r6,[sp,#0x2c]         ;3660
00002e  a801              ADD      r0,sp,#4              ;3660
000030  900a              STR      r0,[sp,#0x28]         ;3660
000032  a804              ADD      r0,sp,#0x10           ;3661
000034  990d              LDR      r1,[sp,#0x34]         ;3661
000036  f7fffffe          BL       follow_path
00003a  4607              MOV      r7,r0                 ;3661
00003c  4630              MOV      r0,r6                 ;3662
00003e  f7fffffe          BL       ff_memfree
000042  bf00              NOP                            ;3663
000044  b997              CBNZ     r7,|L15.108|
000046  9d09              LDR      r5,[sp,#0x24]         ;3666
000048  b90d              CBNZ     r5,|L15.78|
00004a  2706              MOVS     r7,#6                 ;3668
00004c  e00e              B        |L15.108|
                  |L15.78|
00004e  f0040427          AND      r4,r4,#0x27           ;3670
000052  ea080004          AND      r0,r8,r4              ;3671
000056  7ae9              LDRB     r1,[r5,#0xb]          ;3671
000058  43a1              BICS     r1,r1,r4              ;3671
00005a  4308              ORRS     r0,r0,r1              ;3671
00005c  72e8              STRB     r0,[r5,#0xb]          ;3671
00005e  2001              MOVS     r0,#1                 ;3672
000060  9904              LDR      r1,[sp,#0x10]         ;3672
000062  7108              STRB     r0,[r1,#4]            ;3672
000064  9804              LDR      r0,[sp,#0x10]         ;3673
000066  f7fffffe          BL       sync_fs
00006a  4607              MOV      r7,r0                 ;3673
                  |L15.108|
00006c  4638              MOV      r0,r7                 ;3678
00006e  e7da              B        |L15.38|
;;;3680   
                          ENDP


                          AREA ||i.f_close||, CODE, READONLY, ALIGN=1

                  f_close PROC
;;;2831   
;;;2832   FRESULT f_close (
000000  b570              PUSH     {r4-r6,lr}
;;;2833   	FIL *fp		/* Pointer to the file object to be closed */
;;;2834   )
;;;2835   {
000002  4605              MOV      r5,r0
;;;2836   	FRESULT res;
;;;2837   
;;;2838   
;;;2839   #if !_FS_READONLY
;;;2840   	res = f_sync(fp);					/* Flush cached data */
000004  4628              MOV      r0,r5
000006  f7fffffe          BL       f_sync
00000a  4604              MOV      r4,r0
;;;2841   	if (res == FR_OK)
00000c  b934              CBNZ     r4,|L16.28|
;;;2842   #endif
;;;2843   	{
;;;2844   		res = validate(fp);				/* Lock volume */
00000e  4628              MOV      r0,r5
000010  f7fffffe          BL       validate
000014  4604              MOV      r4,r0
;;;2845   		if (res == FR_OK) {
000016  b90c              CBNZ     r4,|L16.28|
;;;2846   #if _FS_REENTRANT
;;;2847   			FATFS *fs = fp->fs;
;;;2848   #endif
;;;2849   #if _FS_LOCK
;;;2850   			res = dec_lock(fp->lockid);	/* Decrement file open counter */
;;;2851   			if (res == FR_OK)
;;;2852   #endif
;;;2853   				fp->fs = 0;				/* Invalidate file object */
000018  2000              MOVS     r0,#0
00001a  6028              STR      r0,[r5,#0]
                  |L16.28|
;;;2854   #if _FS_REENTRANT
;;;2855   			unlock_fs(fs, FR_OK);		/* Unlock volume */
;;;2856   #endif
;;;2857   		}
;;;2858   	}
;;;2859   	return res;
00001c  4620              MOV      r0,r4
;;;2860   }
00001e  bd70              POP      {r4-r6,pc}
;;;2861   
                          ENDP


                          AREA ||i.f_closedir||, CODE, READONLY, ALIGN=1

                  f_closedir PROC
;;;3217   
;;;3218   FRESULT f_closedir (
000000  b570              PUSH     {r4-r6,lr}
;;;3219   	DIR *dp		/* Pointer to the directory object to be closed */
;;;3220   )
;;;3221   {
000002  4604              MOV      r4,r0
;;;3222   	FRESULT res;
;;;3223   
;;;3224   
;;;3225   	res = validate(dp);
000004  4620              MOV      r0,r4
000006  f7fffffe          BL       validate
00000a  4605              MOV      r5,r0
;;;3226   	if (res == FR_OK) {
00000c  b90d              CBNZ     r5,|L17.18|
;;;3227   #if _FS_REENTRANT
;;;3228   		FATFS *fs = dp->fs;
;;;3229   #endif
;;;3230   #if _FS_LOCK
;;;3231   		if (dp->lockid)				/* Decrement sub-directory open counter */
;;;3232   			res = dec_lock(dp->lockid);
;;;3233   		if (res == FR_OK)
;;;3234   #endif
;;;3235   			dp->fs = 0;				/* Invalidate directory object */
00000e  2000              MOVS     r0,#0
000010  6020              STR      r0,[r4,#0]
                  |L17.18|
;;;3236   #if _FS_REENTRANT
;;;3237   		unlock_fs(fs, FR_OK);		/* Unlock volume */
;;;3238   #endif
;;;3239   	}
;;;3240   	return res;
000012  4628              MOV      r0,r5
;;;3241   }
000014  bd70              POP      {r4-r6,pc}
;;;3242   
                          ENDP


                          AREA ||i.f_getfree||, CODE, READONLY, ALIGN=1

                  f_getfree PROC
;;;3378   
;;;3379   FRESULT f_getfree (
000000  e92d4ff7          PUSH     {r0-r2,r4-r11,lr}
;;;3380   	const TCHAR* path,	/* Path name of the logical drive number */
;;;3381   	DWORD* nclst,		/* Pointer to a variable to return number of free clusters */
;;;3382   	FATFS** fatfs		/* Pointer to return pointer to corresponding file system object */
;;;3383   )
;;;3384   {
000004  b082              SUB      sp,sp,#8
000006  468a              MOV      r10,r1
;;;3385   	FRESULT res;
;;;3386   	FATFS *fs;
;;;3387   	DWORD n, clst, sect, stat;
;;;3388   	UINT i;
;;;3389   	BYTE fat, *p;
;;;3390   
;;;3391   
;;;3392   	/* Get logical drive number */
;;;3393   	res = find_volume(fatfs, &path, 0);
000008  2200              MOVS     r2,#0
00000a  a902              ADD      r1,sp,#8
00000c  9804              LDR      r0,[sp,#0x10]
00000e  f7fffffe          BL       find_volume
000012  9001              STR      r0,[sp,#4]
;;;3394   	fs = *fatfs;
000014  9804              LDR      r0,[sp,#0x10]
000016  6804              LDR      r4,[r0,#0]
;;;3395   	if (res == FR_OK) {
000018  9801              LDR      r0,[sp,#4]
00001a  2800              CMP      r0,#0
00001c  d16d              BNE      |L18.250|
;;;3396   		/* If free_clust is valid, return it without full cluster scan */
;;;3397   		if (fs->free_clust <= fs->n_fatent - 2) {
00001e  e9d41004          LDRD     r1,r0,[r4,#0x10]
000022  1e80              SUBS     r0,r0,#2
000024  4281              CMP      r1,r0
000026  d803              BHI      |L18.48|
;;;3398   			*nclst = fs->free_clust;
000028  6920              LDR      r0,[r4,#0x10]
00002a  f8ca0000          STR      r0,[r10,#0]
00002e  e064              B        |L18.250|
                  |L18.48|
;;;3399   		} else {
;;;3400   			/* Get number of free clusters */
;;;3401   			fat = fs->fs_type;
000030  f894b000          LDRB     r11,[r4,#0]
;;;3402   			n = 0;
000034  2600              MOVS     r6,#0
;;;3403   			if (fat == FS_FAT12) {
000036  f1bb0f01          CMP      r11,#1
00003a  d11c              BNE      |L18.118|
;;;3404   				clst = 2;
00003c  2702              MOVS     r7,#2
;;;3405   				do {
00003e  bf00              NOP      
                  |L18.64|
;;;3406   					stat = get_fat(fs, clst);
000040  4639              MOV      r1,r7
000042  4620              MOV      r0,r4
000044  f7fffffe          BL       get_fat
000048  4680              MOV      r8,r0
;;;3407   					if (stat == 0xFFFFFFFF) { res = FR_DISK_ERR; break; }
00004a  f1080001          ADD      r0,r8,#1
00004e  b910              CBNZ     r0,|L18.86|
000050  2001              MOVS     r0,#1
000052  9001              STR      r0,[sp,#4]
000054  e00e              B        |L18.116|
                  |L18.86|
;;;3408   					if (stat == 1) { res = FR_INT_ERR; break; }
000056  f1b80f01          CMP      r8,#1
00005a  d102              BNE      |L18.98|
00005c  2002              MOVS     r0,#2
00005e  9001              STR      r0,[sp,#4]
000060  e008              B        |L18.116|
                  |L18.98|
;;;3409   					if (stat == 0) n++;
000062  f1b80f00          CMP      r8,#0
000066  d100              BNE      |L18.106|
000068  1c76              ADDS     r6,r6,#1
                  |L18.106|
;;;3410   				} while (++clst < fs->n_fatent);
00006a  1c78              ADDS     r0,r7,#1
00006c  4607              MOV      r7,r0
00006e  6961              LDR      r1,[r4,#0x14]
000070  4288              CMP      r0,r1
000072  d3e5              BCC      |L18.64|
                  |L18.116|
000074  e03a              B        |L18.236|
                  |L18.118|
;;;3411   			} else {
;;;3412   				clst = fs->n_fatent;
000076  6967              LDR      r7,[r4,#0x14]
;;;3413   				sect = fs->fatbase;
000078  6a20              LDR      r0,[r4,#0x20]
00007a  9000              STR      r0,[sp,#0]
;;;3414   				i = 0; p = 0;
00007c  f04f0900          MOV      r9,#0
000080  2500              MOVS     r5,#0
;;;3415   				do {
000082  bf00              NOP      
                  |L18.132|
;;;3416   					if (!i) {
000084  f1b90f00          CMP      r9,#0
000088  d10e              BNE      |L18.168|
;;;3417   						res = move_window(fs, sect++);
00008a  9800              LDR      r0,[sp,#0]
00008c  1c42              ADDS     r2,r0,#1
00008e  4601              MOV      r1,r0
000090  4620              MOV      r0,r4
000092  9200              STR      r2,[sp,#0]
000094  f7fffffe          BL       move_window
000098  9001              STR      r0,[sp,#4]
;;;3418   						if (res != FR_OK) break;
00009a  9801              LDR      r0,[sp,#4]
00009c  b100              CBZ      r0,|L18.160|
00009e  e024              B        |L18.234|
                  |L18.160|
;;;3419   						p = fs->win;
0000a0  f1040530          ADD      r5,r4,#0x30
;;;3420   						i = SS(fs);
0000a4  f44f7900          MOV      r9,#0x200
                  |L18.168|
;;;3421   					}
;;;3422   					if (fat == FS_FAT16) {
0000a8  f1bb0f02          CMP      r11,#2
0000ac  d109              BNE      |L18.194|
;;;3423   						if (LD_WORD(p) == 0) n++;
0000ae  7828              LDRB     r0,[r5,#0]
0000b0  7869              LDRB     r1,[r5,#1]
0000b2  ea402001          ORR      r0,r0,r1,LSL #8
0000b6  b900              CBNZ     r0,|L18.186|
0000b8  1c76              ADDS     r6,r6,#1
                  |L18.186|
;;;3424   						p += 2; i -= 2;
0000ba  1cad              ADDS     r5,r5,#2
0000bc  f1a90902          SUB      r9,r9,#2
0000c0  e010              B        |L18.228|
                  |L18.194|
;;;3425   					} else {
;;;3426   						if ((LD_DWORD(p) & 0x0FFFFFFF) == 0) n++;
0000c2  78e8              LDRB     r0,[r5,#3]
0000c4  0600              LSLS     r0,r0,#24
0000c6  78a9              LDRB     r1,[r5,#2]
0000c8  ea404001          ORR      r0,r0,r1,LSL #16
0000cc  7869              LDRB     r1,[r5,#1]
0000ce  ea402001          ORR      r0,r0,r1,LSL #8
0000d2  7829              LDRB     r1,[r5,#0]
0000d4  4308              ORRS     r0,r0,r1
0000d6  f0204070          BIC      r0,r0,#0xf0000000
0000da  b900              CBNZ     r0,|L18.222|
0000dc  1c76              ADDS     r6,r6,#1
                  |L18.222|
;;;3427   						p += 4; i -= 4;
0000de  1d2d              ADDS     r5,r5,#4
0000e0  f1a90904          SUB      r9,r9,#4
                  |L18.228|
;;;3428   					}
;;;3429   				} while (--clst);
0000e4  1e78              SUBS     r0,r7,#1
0000e6  1e07              SUBS     r7,r0,#0
0000e8  d1cc              BNE      |L18.132|
                  |L18.234|
0000ea  bf00              NOP                            ;3418
                  |L18.236|
;;;3430   			}
;;;3431   			fs->free_clust = n;
0000ec  6126              STR      r6,[r4,#0x10]
;;;3432   			fs->fsi_flag |= 1;
0000ee  7960              LDRB     r0,[r4,#5]
0000f0  f0400001          ORR      r0,r0,#1
0000f4  7160              STRB     r0,[r4,#5]
;;;3433   			*nclst = n;
0000f6  f8ca6000          STR      r6,[r10,#0]
                  |L18.250|
;;;3434   		}
;;;3435   	}
;;;3436   	LEAVE_FF(fs, res);
0000fa  9801              LDR      r0,[sp,#4]
;;;3437   }
0000fc  b005              ADD      sp,sp,#0x14
0000fe  e8bd8ff0          POP      {r4-r11,pc}
;;;3438   
                          ENDP


                          AREA ||i.f_getlabel||, CODE, READONLY, ALIGN=1

                  f_getlabel PROC
;;;3813   
;;;3814   FRESULT f_getlabel (
000000  e92d41f7          PUSH     {r0-r2,r4-r8,lr}
;;;3815   	const TCHAR* path,	/* Path name of the logical drive number */
;;;3816   	TCHAR* label,		/* Pointer to a buffer to return the volume label */
;;;3817   	DWORD* vsn			/* Pointer to a variable to return the volume serial number */
;;;3818   )
;;;3819   {
000004  b089              SUB      sp,sp,#0x24
000006  460d              MOV      r5,r1
000008  4690              MOV      r8,r2
;;;3820   	FRESULT res;
;;;3821   	DIR dj;
;;;3822   	UINT i, j;
;;;3823   #if _USE_LFN && _LFN_UNICODE
;;;3824   	WCHAR w;
;;;3825   #endif
;;;3826   
;;;3827   
;;;3828   	/* Get logical drive number */
;;;3829   	res = find_volume(&dj.fs, &path, 0);
00000a  2200              MOVS     r2,#0
00000c  a909              ADD      r1,sp,#0x24
00000e  4668              MOV      r0,sp
000010  f7fffffe          BL       find_volume
000014  4604              MOV      r4,r0
;;;3830   
;;;3831   	/* Get volume label */
;;;3832   	if (res == FR_OK && label) {
000016  bb24              CBNZ     r4,|L19.98|
000018  b31d              CBZ      r5,|L19.98|
;;;3833   		dj.sclust = 0;					/* Open root directory */
00001a  2000              MOVS     r0,#0
00001c  9002              STR      r0,[sp,#8]
;;;3834   		res = dir_sdi(&dj, 0);
00001e  2100              MOVS     r1,#0
000020  4668              MOV      r0,sp
000022  f7fffffe          BL       dir_sdi
000026  4604              MOV      r4,r0
;;;3835   		if (res == FR_OK) {
000028  b9dc              CBNZ     r4,|L19.98|
;;;3836   			res = dir_read(&dj, 1);		/* Get an entry with AM_VOL */
00002a  2101              MOVS     r1,#1
00002c  4668              MOV      r0,sp
00002e  f7fffffe          BL       dir_read
000032  4604              MOV      r4,r0
;;;3837   			if (res == FR_OK) {			/* A volume label is exist */
000034  b984              CBNZ     r4,|L19.88|
;;;3838   #if _USE_LFN && _LFN_UNICODE
;;;3839   				i = j = 0;
;;;3840   				do {
;;;3841   					w = (i < 11) ? dj.dir[i++] : ' ';
;;;3842   					if (IsDBCS1(w) && i < 11 && IsDBCS2(dj.dir[i]))
;;;3843   						w = w << 8 | dj.dir[i++];
;;;3844   					label[j++] = ff_convert(w, 1);	/* OEM -> Unicode */
;;;3845   				} while (j < 11);
;;;3846   #else
;;;3847   				mem_cpy(label, dj.dir, 11);
000036  220b              MOVS     r2,#0xb
000038  4628              MOV      r0,r5
00003a  9905              LDR      r1,[sp,#0x14]
00003c  f7fffffe          BL       mem_cpy
;;;3848   #endif
;;;3849   				j = 11;
000040  270b              MOVS     r7,#0xb
;;;3850   				do {
000042  bf00              NOP      
                  |L19.68|
;;;3851   					label[j] = 0;
000044  2000              MOVS     r0,#0
000046  55e8              STRB     r0,[r5,r7]
;;;3852   					if (!j) break;
000048  b907              CBNZ     r7,|L19.76|
00004a  e004              B        |L19.86|
                  |L19.76|
;;;3853   				} while (label[--j] == ' ');
00004c  1e78              SUBS     r0,r7,#1
00004e  4607              MOV      r7,r0
000050  5c28              LDRB     r0,[r5,r0]
000052  2820              CMP      r0,#0x20
000054  d0f6              BEQ      |L19.68|
                  |L19.86|
000056  bf00              NOP                            ;3852
                  |L19.88|
;;;3854   			}
;;;3855   			if (res == FR_NO_FILE) {	/* No label, return nul string */
000058  2c04              CMP      r4,#4
00005a  d102              BNE      |L19.98|
;;;3856   				label[0] = 0;
00005c  2000              MOVS     r0,#0
00005e  7028              STRB     r0,[r5,#0]
;;;3857   				res = FR_OK;
000060  2400              MOVS     r4,#0
                  |L19.98|
;;;3858   			}
;;;3859   		}
;;;3860   	}
;;;3861   
;;;3862   	/* Get volume serial number */
;;;3863   	if (res == FR_OK && vsn) {
000062  bb44              CBNZ     r4,|L19.182|
000064  f1b80f00          CMP      r8,#0
000068  d025              BEQ      |L19.182|
;;;3864   		res = move_window(dj.fs, dj.fs->volbase);
00006a  9a00              LDR      r2,[sp,#0]
00006c  4610              MOV      r0,r2
00006e  69d1              LDR      r1,[r2,#0x1c]
000070  f7fffffe          BL       move_window
000074  4604              MOV      r4,r0
;;;3865   		if (res == FR_OK) {
000076  b9f4              CBNZ     r4,|L19.182|
;;;3866   			i = dj.fs->fs_type == FS_FAT32 ? BS_VolID32 : BS_VolID;
000078  9800              LDR      r0,[sp,#0]
00007a  7800              LDRB     r0,[r0,#0]
00007c  2803              CMP      r0,#3
00007e  d101              BNE      |L19.132|
000080  2043              MOVS     r0,#0x43
000082  e000              B        |L19.134|
                  |L19.132|
000084  2027              MOVS     r0,#0x27
                  |L19.134|
000086  4606              MOV      r6,r0
;;;3867   			*vsn = LD_DWORD(&dj.fs->win[i]);
000088  9800              LDR      r0,[sp,#0]
00008a  3030              ADDS     r0,r0,#0x30
00008c  4430              ADD      r0,r0,r6
00008e  78c0              LDRB     r0,[r0,#3]
000090  0601              LSLS     r1,r0,#24
000092  9800              LDR      r0,[sp,#0]
000094  3030              ADDS     r0,r0,#0x30
000096  4430              ADD      r0,r0,r6
000098  7880              LDRB     r0,[r0,#2]
00009a  ea414100          ORR      r1,r1,r0,LSL #16
00009e  9800              LDR      r0,[sp,#0]
0000a0  3030              ADDS     r0,r0,#0x30
0000a2  4430              ADD      r0,r0,r6
0000a4  7840              LDRB     r0,[r0,#1]
0000a6  ea412000          ORR      r0,r1,r0,LSL #8
0000aa  9900              LDR      r1,[sp,#0]
0000ac  3130              ADDS     r1,r1,#0x30
0000ae  5d89              LDRB     r1,[r1,r6]
0000b0  4308              ORRS     r0,r0,r1
0000b2  f8c80000          STR      r0,[r8,#0]
                  |L19.182|
;;;3868   		}
;;;3869   	}
;;;3870   
;;;3871   	LEAVE_FF(dj.fs, res);
0000b6  4620              MOV      r0,r4
;;;3872   }
0000b8  b00c              ADD      sp,sp,#0x30
0000ba  e8bd81f0          POP      {r4-r8,pc}
;;;3873   
                          ENDP


                          AREA ||i.f_gets||, CODE, READONLY, ALIGN=1

                  f_gets PROC
;;;4358   
;;;4359   TCHAR* f_gets (
000000  e92d47fc          PUSH     {r2-r10,lr}
;;;4360   	TCHAR* buff,	/* Pointer to the string buffer to read */
;;;4361   	int len,		/* Size of string buffer (characters) */
;;;4362   	FIL* fp			/* Pointer to the file object */
;;;4363   )
;;;4364   {
000004  4607              MOV      r7,r0
000006  4688              MOV      r8,r1
000008  4691              MOV      r9,r2
;;;4365   	int n = 0;
00000a  2400              MOVS     r4,#0
;;;4366   	TCHAR c, *p = buff;
00000c  463e              MOV      r6,r7
;;;4367   	BYTE s[2];
;;;4368   	UINT rc;
;;;4369   
;;;4370   
;;;4371   	while (n < len - 1) {	/* Read characters until buffer gets filled */
00000e  e013              B        |L20.56|
                  |L20.16|
;;;4372   #if _USE_LFN && _LFN_UNICODE
;;;4373   #if _STRF_ENCODE == 3		/* Read a character in UTF-8 */
;;;4374   		f_read(fp, s, 1, &rc);
;;;4375   		if (rc != 1) break;
;;;4376   		c = s[0];
;;;4377   		if (c >= 0x80) {
;;;4378   			if (c < 0xC0) continue;	/* Skip stray trailer */
;;;4379   			if (c < 0xE0) {			/* Two-byte sequence */
;;;4380   				f_read(fp, s, 1, &rc);
;;;4381   				if (rc != 1) break;
;;;4382   				c = (c & 0x1F) << 6 | (s[0] & 0x3F);
;;;4383   				if (c < 0x80) c = '?';
;;;4384   			} else {
;;;4385   				if (c < 0xF0) {		/* Three-byte sequence */
;;;4386   					f_read(fp, s, 2, &rc);
;;;4387   					if (rc != 2) break;
;;;4388   					c = c << 12 | (s[0] & 0x3F) << 6 | (s[1] & 0x3F);
;;;4389   					if (c < 0x800) c = '?';
;;;4390   				} else {			/* Reject four-byte sequence */
;;;4391   					c = '?';
;;;4392   				}
;;;4393   			}
;;;4394   		}
;;;4395   #elif _STRF_ENCODE == 2		/* Read a character in UTF-16BE */
;;;4396   		f_read(fp, s, 2, &rc);
;;;4397   		if (rc != 2) break;
;;;4398   		c = s[1] + (s[0] << 8);
;;;4399   #elif _STRF_ENCODE == 1		/* Read a character in UTF-16LE */
;;;4400   		f_read(fp, s, 2, &rc);
;;;4401   		if (rc != 2) break;
;;;4402   		c = s[0] + (s[1] << 8);
;;;4403   #else						/* Read a character in ANSI/OEM */
;;;4404   		f_read(fp, s, 1, &rc);
;;;4405   		if (rc != 1) break;
;;;4406   		c = s[0];
;;;4407   		if (IsDBCS1(c)) {
;;;4408   			f_read(fp, s, 1, &rc);
;;;4409   			if (rc != 1) break;
;;;4410   			c = (c << 8) + s[0];
;;;4411   		}
;;;4412   		c = ff_convert(c, 1);	/* OEM -> Unicode */
;;;4413   		if (!c) c = '?';
;;;4414   #endif
;;;4415   #else						/* Read a character without conversion */
;;;4416   		f_read(fp, s, 1, &rc);
000010  466b              MOV      r3,sp
000012  2201              MOVS     r2,#1
000014  a901              ADD      r1,sp,#4
000016  4648              MOV      r0,r9
000018  f7fffffe          BL       f_read
;;;4417   		if (rc != 1) break;
00001c  9800              LDR      r0,[sp,#0]
00001e  2801              CMP      r0,#1
000020  d000              BEQ      |L20.36|
000022  e00d              B        |L20.64|
                  |L20.36|
;;;4418   		c = s[0];
000024  f89d5004          LDRB     r5,[sp,#4]
;;;4419   #endif
;;;4420   		if (_USE_STRFUNC == 2 && c == '\r') continue;	/* Strip '\r' */
000028  bf00              NOP      
;;;4421   		*p++ = c;
00002a  f8065b01          STRB     r5,[r6],#1
;;;4422   		n++;
00002e  1c64              ADDS     r4,r4,#1
;;;4423   		if (c == '\n') break;		/* Break on EOL */
000030  2d0a              CMP      r5,#0xa
000032  d100              BNE      |L20.54|
000034  e004              B        |L20.64|
                  |L20.54|
000036  bf00              NOP                            ;4420
                  |L20.56|
000038  f1a80001          SUB      r0,r8,#1              ;4371
00003c  42a0              CMP      r0,r4                 ;4371
00003e  dce7              BGT      |L20.16|
                  |L20.64|
000040  bf00              NOP                            ;4417
;;;4424   	}
;;;4425   	*p = 0;
000042  2000              MOVS     r0,#0
000044  7030              STRB     r0,[r6,#0]
;;;4426   	return n ? buff : 0;			/* When no data read (eof or error), return with error. */
000046  b114              CBZ      r4,|L20.78|
000048  4638              MOV      r0,r7
                  |L20.74|
;;;4427   }
00004a  e8bd87fc          POP      {r2-r10,pc}
                  |L20.78|
00004e  2000              MOVS     r0,#0                 ;4426
000050  e7fb              B        |L20.74|
;;;4428   
                          ENDP


                          AREA ||i.f_lseek||, CODE, READONLY, ALIGN=1

                  f_lseek PROC
;;;3003   
;;;3004   FRESULT f_lseek (
000000  e92d4ff0          PUSH     {r4-r11,lr}
;;;3005   	FIL* fp,		/* Pointer to the file object */
;;;3006   	DWORD ofs		/* File pointer from top of file */
;;;3007   )
;;;3008   {
000004  b087              SUB      sp,sp,#0x1c
000006  4604              MOV      r4,r0
000008  460d              MOV      r5,r1
;;;3009   	FRESULT res;
;;;3010   	DWORD clst, bcs, nsect, ifptr;
;;;3011   #if _USE_FASTSEEK
;;;3012   	DWORD cl, pcl, ncl, tcl, dsc, tlen, ulen, *tbl;
;;;3013   #endif
;;;3014   
;;;3015   
;;;3016   	res = validate(fp);					/* Check validity of the object */
00000a  4620              MOV      r0,r4
00000c  f7fffffe          BL       validate
000010  9006              STR      r0,[sp,#0x18]
;;;3017   	if (res != FR_OK) LEAVE_FF(fp->fs, res);
000012  9806              LDR      r0,[sp,#0x18]
000014  b118              CBZ      r0,|L21.30|
000016  9806              LDR      r0,[sp,#0x18]
                  |L21.24|
;;;3018   	if (fp->err)						/* Check error */
;;;3019   		LEAVE_FF(fp->fs, (FRESULT)fp->err);
;;;3020   
;;;3021   #if _USE_FASTSEEK
;;;3022   	if (fp->cltbl) {	/* Fast seek */
;;;3023   		if (ofs == CREATE_LINKMAP) {	/* Create CLMT */
;;;3024   			tbl = fp->cltbl;
;;;3025   			tlen = *tbl++; ulen = 2;	/* Given table size and required table size */
;;;3026   			cl = fp->sclust;			/* Top of the chain */
;;;3027   			if (cl) {
;;;3028   				do {
;;;3029   					/* Get a fragment */
;;;3030   					tcl = cl; ncl = 0; ulen += 2;	/* Top, length and used items */
;;;3031   					do {
;;;3032   						pcl = cl; ncl++;
;;;3033   						cl = get_fat(fp->fs, cl);
;;;3034   						if (cl <= 1) ABORT(fp->fs, FR_INT_ERR);
;;;3035   						if (cl == 0xFFFFFFFF) ABORT(fp->fs, FR_DISK_ERR);
;;;3036   					} while (cl == pcl + 1);
;;;3037   					if (ulen <= tlen) {		/* Store the length and top of the fragment */
;;;3038   						*tbl++ = ncl; *tbl++ = tcl;
;;;3039   					}
;;;3040   				} while (cl < fp->fs->n_fatent);	/* Repeat until end of chain */
;;;3041   			}
;;;3042   			*fp->cltbl = ulen;	/* Number of items used */
;;;3043   			if (ulen <= tlen)
;;;3044   				*tbl = 0;		/* Terminate table */
;;;3045   			else
;;;3046   				res = FR_NOT_ENOUGH_CORE;	/* Given table size is smaller than required */
;;;3047   
;;;3048   		} else {						/* Fast seek */
;;;3049   			if (ofs > fp->fsize)		/* Clip offset at the file size */
;;;3050   				ofs = fp->fsize;
;;;3051   			fp->fptr = ofs;				/* Set file pointer */
;;;3052   			if (ofs) {
;;;3053   				fp->clust = clmt_clust(fp, ofs - 1);
;;;3054   				dsc = clust2sect(fp->fs, fp->clust);
;;;3055   				if (!dsc) ABORT(fp->fs, FR_INT_ERR);
;;;3056   				dsc += (ofs - 1) / SS(fp->fs) & (fp->fs->csize - 1);
;;;3057   				if (fp->fptr % SS(fp->fs) && dsc != fp->dsect) {	/* Refill sector cache if needed */
;;;3058   #if !_FS_TINY
;;;3059   #if !_FS_READONLY
;;;3060   					if (fp->flag & FA__DIRTY) {		/* Write-back dirty sector cache */
;;;3061   						if (disk_write(fp->fs->drv, fp->buf, fp->dsect, 1) != RES_OK)
;;;3062   							ABORT(fp->fs, FR_DISK_ERR);
;;;3063   						fp->flag &= ~FA__DIRTY;
;;;3064   					}
;;;3065   #endif
;;;3066   					if (disk_read(fp->fs->drv, fp->buf, dsc, 1) != RES_OK)	/* Load current sector */
;;;3067   						ABORT(fp->fs, FR_DISK_ERR);
;;;3068   #endif
;;;3069   					fp->dsect = dsc;
;;;3070   				}
;;;3071   			}
;;;3072   		}
;;;3073   	} else
;;;3074   #endif
;;;3075   
;;;3076   	/* Normal Seek */
;;;3077   	{
;;;3078   		if (ofs > fp->fsize					/* In read-only mode, clip offset with the file size */
;;;3079   #if !_FS_READONLY
;;;3080   			 && !(fp->flag & FA_WRITE)
;;;3081   #endif
;;;3082   			) ofs = fp->fsize;
;;;3083   
;;;3084   		ifptr = fp->fptr;
;;;3085   		fp->fptr = nsect = 0;
;;;3086   		if (ofs) {
;;;3087   			bcs = (DWORD)fp->fs->csize * SS(fp->fs);	/* Cluster size (byte) */
;;;3088   			if (ifptr > 0 &&
;;;3089   				(ofs - 1) / bcs >= (ifptr - 1) / bcs) {	/* When seek to same or following cluster, */
;;;3090   				fp->fptr = (ifptr - 1) & ~(bcs - 1);	/* start from the current cluster */
;;;3091   				ofs -= fp->fptr;
;;;3092   				clst = fp->clust;
;;;3093   			} else {									/* When seek to back cluster, */
;;;3094   				clst = fp->sclust;						/* start from the first cluster */
;;;3095   #if !_FS_READONLY
;;;3096   				if (clst == 0) {						/* If no cluster chain, create a new chain */
;;;3097   					clst = create_chain(fp->fs, 0);
;;;3098   					if (clst == 1) ABORT(fp->fs, FR_INT_ERR);
;;;3099   					if (clst == 0xFFFFFFFF) ABORT(fp->fs, FR_DISK_ERR);
;;;3100   					fp->sclust = clst;
;;;3101   				}
;;;3102   #endif
;;;3103   				fp->clust = clst;
;;;3104   			}
;;;3105   			if (clst != 0) {
;;;3106   				while (ofs > bcs) {						/* Cluster following loop */
;;;3107   #if !_FS_READONLY
;;;3108   					if (fp->flag & FA_WRITE) {			/* Check if in write mode or not */
;;;3109   						clst = create_chain(fp->fs, clst);	/* Force stretch if in write mode */
;;;3110   						if (clst == 0) {				/* When disk gets full, clip file size */
;;;3111   							ofs = bcs; break;
;;;3112   						}
;;;3113   					} else
;;;3114   #endif
;;;3115   						clst = get_fat(fp->fs, clst);	/* Follow cluster chain if not in write mode */
;;;3116   					if (clst == 0xFFFFFFFF) ABORT(fp->fs, FR_DISK_ERR);
;;;3117   					if (clst <= 1 || clst >= fp->fs->n_fatent) ABORT(fp->fs, FR_INT_ERR);
;;;3118   					fp->clust = clst;
;;;3119   					fp->fptr += bcs;
;;;3120   					ofs -= bcs;
;;;3121   				}
;;;3122   				fp->fptr += ofs;
;;;3123   				if (ofs % SS(fp->fs)) {
;;;3124   					nsect = clust2sect(fp->fs, clst);	/* Current sector */
;;;3125   					if (!nsect) ABORT(fp->fs, FR_INT_ERR);
;;;3126   					nsect += ofs / SS(fp->fs);
;;;3127   				}
;;;3128   			}
;;;3129   		}
;;;3130   		if (fp->fptr % SS(fp->fs) && nsect != fp->dsect) {	/* Fill sector cache if needed */
;;;3131   #if !_FS_TINY
;;;3132   #if !_FS_READONLY
;;;3133   			if (fp->flag & FA__DIRTY) {			/* Write-back dirty sector cache */
;;;3134   				if (disk_write(fp->fs->drv, fp->buf, fp->dsect, 1) != RES_OK)
;;;3135   					ABORT(fp->fs, FR_DISK_ERR);
;;;3136   				fp->flag &= ~FA__DIRTY;
;;;3137   			}
;;;3138   #endif
;;;3139   			if (disk_read(fp->fs->drv, fp->buf, nsect, 1) != RES_OK)	/* Fill sector cache */
;;;3140   				ABORT(fp->fs, FR_DISK_ERR);
;;;3141   #endif
;;;3142   			fp->dsect = nsect;
;;;3143   		}
;;;3144   #if !_FS_READONLY
;;;3145   		if (fp->fptr > fp->fsize) {			/* Set file change flag if the file size is extended */
;;;3146   			fp->fsize = fp->fptr;
;;;3147   			fp->flag |= FA__WRITTEN;
;;;3148   		}
;;;3149   #endif
;;;3150   	}
;;;3151   
;;;3152   	LEAVE_FF(fp->fs, res);
;;;3153   }
000018  b007              ADD      sp,sp,#0x1c
00001a  e8bd8ff0          POP      {r4-r11,pc}
                  |L21.30|
00001e  79e0              LDRB     r0,[r4,#7]            ;3018
000020  b108              CBZ      r0,|L21.38|
000022  79e0              LDRB     r0,[r4,#7]            ;3019
000024  e7f8              B        |L21.24|
                  |L21.38|
000026  6a60              LDR      r0,[r4,#0x24]         ;3022
000028  2800              CMP      r0,#0                 ;3022
00002a  d07c              BEQ      |L21.294|
00002c  1c68              ADDS     r0,r5,#1              ;3023
00002e  2800              CMP      r0,#0                 ;3023
000030  d143              BNE      |L21.186|
000032  f8d4a024          LDR      r10,[r4,#0x24]        ;3024
000036  f85a0b04          LDR      r0,[r10],#4           ;3025
00003a  9001              STR      r0,[sp,#4]            ;3025
00003c  2002              MOVS     r0,#2                 ;3025
00003e  9000              STR      r0,[sp,#0]            ;3025
000040  6927              LDR      r7,[r4,#0x10]         ;3026
000042  b367              CBZ      r7,|L21.158|
000044  bf00              NOP                            ;3028
                  |L21.70|
000046  9702              STR      r7,[sp,#8]            ;3030
000048  2000              MOVS     r0,#0                 ;3030
00004a  9003              STR      r0,[sp,#0xc]          ;3030
00004c  9800              LDR      r0,[sp,#0]            ;3030
00004e  1c80              ADDS     r0,r0,#2              ;3030
000050  9000              STR      r0,[sp,#0]            ;3030
000052  bf00              NOP                            ;3031
                  |L21.84|
000054  9704              STR      r7,[sp,#0x10]         ;3032
000056  9803              LDR      r0,[sp,#0xc]          ;3032
000058  1c40              ADDS     r0,r0,#1              ;3032
00005a  9003              STR      r0,[sp,#0xc]          ;3032
00005c  4639              MOV      r1,r7                 ;3033
00005e  6820              LDR      r0,[r4,#0]            ;3033
000060  f7fffffe          BL       get_fat
000064  4607              MOV      r7,r0                 ;3033
000066  2f01              CMP      r7,#1                 ;3034
000068  d802              BHI      |L21.112|
00006a  2002              MOVS     r0,#2                 ;3034
00006c  71e0              STRB     r0,[r4,#7]            ;3034
00006e  e7d3              B        |L21.24|
                  |L21.112|
000070  1c78              ADDS     r0,r7,#1              ;3035
000072  b910              CBNZ     r0,|L21.122|
000074  2001              MOVS     r0,#1                 ;3035
000076  71e0              STRB     r0,[r4,#7]            ;3035
000078  e7ce              B        |L21.24|
                  |L21.122|
00007a  9804              LDR      r0,[sp,#0x10]         ;3036
00007c  1c40              ADDS     r0,r0,#1              ;3036
00007e  4287              CMP      r7,r0                 ;3036
000080  d0e8              BEQ      |L21.84|
000082  e9dd0100          LDRD     r0,r1,[sp,#0]         ;3037
000086  4288              CMP      r0,r1                 ;3037
000088  d805              BHI      |L21.150|
00008a  9803              LDR      r0,[sp,#0xc]          ;3038
00008c  f84a0b04          STR      r0,[r10],#4           ;3038
000090  9802              LDR      r0,[sp,#8]            ;3038
000092  f84a0b04          STR      r0,[r10],#4           ;3038
                  |L21.150|
000096  6820              LDR      r0,[r4,#0]            ;3040
000098  6940              LDR      r0,[r0,#0x14]         ;3040
00009a  42b8              CMP      r0,r7                 ;3040
00009c  d8d3              BHI      |L21.70|
                  |L21.158|
00009e  9800              LDR      r0,[sp,#0]            ;3042
0000a0  6a61              LDR      r1,[r4,#0x24]         ;3042
0000a2  6008              STR      r0,[r1,#0]            ;3042
0000a4  e9dd0100          LDRD     r0,r1,[sp,#0]         ;3043
0000a8  4288              CMP      r0,r1                 ;3043
0000aa  d803              BHI      |L21.180|
0000ac  2000              MOVS     r0,#0                 ;3044
0000ae  f8ca0000          STR      r0,[r10,#0]           ;3044
                  |L21.178|
0000b2  e0f9              B        |L21.680|
                  |L21.180|
0000b4  2011              MOVS     r0,#0x11              ;3046
0000b6  9006              STR      r0,[sp,#0x18]         ;3046
0000b8  e0f6              B        |L21.680|
                  |L21.186|
0000ba  68e0              LDR      r0,[r4,#0xc]          ;3049
0000bc  42a8              CMP      r0,r5                 ;3049
0000be  d200              BCS      |L21.194|
0000c0  68e5              LDR      r5,[r4,#0xc]          ;3050
                  |L21.194|
0000c2  60a5              STR      r5,[r4,#8]            ;3051
0000c4  2d00              CMP      r5,#0                 ;3052
0000c6  d0f4              BEQ      |L21.178|
0000c8  1e69              SUBS     r1,r5,#1              ;3053
0000ca  4620              MOV      r0,r4                 ;3053
0000cc  f7fffffe          BL       clmt_clust
0000d0  6160              STR      r0,[r4,#0x14]         ;3053
0000d2  6961              LDR      r1,[r4,#0x14]         ;3054
0000d4  6820              LDR      r0,[r4,#0]            ;3054
0000d6  f7fffffe          BL       clust2sect
0000da  4681              MOV      r9,r0                 ;3054
0000dc  f1b90f00          CMP      r9,#0                 ;3055
0000e0  d102              BNE      |L21.232|
0000e2  2002              MOVS     r0,#2                 ;3055
0000e4  71e0              STRB     r0,[r4,#7]            ;3055
0000e6  e797              B        |L21.24|
                  |L21.232|
0000e8  6820              LDR      r0,[r4,#0]            ;3056
0000ea  7880              LDRB     r0,[r0,#2]            ;3056
0000ec  1e40              SUBS     r0,r0,#1              ;3056
0000ee  1e69              SUBS     r1,r5,#1              ;3056
0000f0  ea002051          AND      r0,r0,r1,LSR #9       ;3056
0000f4  4481              ADD      r9,r9,r0              ;3056
0000f6  8920              LDRH     r0,[r4,#8]            ;3057
0000f8  f3c00008          UBFX     r0,r0,#0,#9           ;3057
0000fc  2800              CMP      r0,#0                 ;3057
0000fe  d0d8              BEQ      |L21.178|
000100  69a0              LDR      r0,[r4,#0x18]         ;3057
000102  4548              CMP      r0,r9                 ;3057
000104  d0d5              BEQ      |L21.178|
000106  79a0              LDRB     r0,[r4,#6]            ;3060
000108  f0000040          AND      r0,r0,#0x40           ;3060
00010c  b180              CBZ      r0,|L21.304|
00010e  6821              LDR      r1,[r4,#0]            ;3061
000110  7848              LDRB     r0,[r1,#1]            ;3061
000112  2301              MOVS     r3,#1                 ;3061
000114  f1040128          ADD      r1,r4,#0x28           ;3061
000118  69a2              LDR      r2,[r4,#0x18]         ;3061
00011a  f7fffffe          BL       disk_write
00011e  b118              CBZ      r0,|L21.296|
000120  2001              MOVS     r0,#1                 ;3062
000122  71e0              STRB     r0,[r4,#7]            ;3062
000124  e778              B        |L21.24|
                  |L21.294|
000126  e012              B        |L21.334|
                  |L21.296|
000128  79a0              LDRB     r0,[r4,#6]            ;3063
00012a  f0200040          BIC      r0,r0,#0x40           ;3063
00012e  71a0              STRB     r0,[r4,#6]            ;3063
                  |L21.304|
000130  6821              LDR      r1,[r4,#0]            ;3066
000132  7848              LDRB     r0,[r1,#1]            ;3066
000134  2301              MOVS     r3,#1                 ;3066
000136  464a              MOV      r2,r9                 ;3066
000138  f1040128          ADD      r1,r4,#0x28           ;3066
00013c  f7fffffe          BL       disk_read
000140  b110              CBZ      r0,|L21.328|
000142  2001              MOVS     r0,#1                 ;3067
000144  71e0              STRB     r0,[r4,#7]            ;3067
000146  e767              B        |L21.24|
                  |L21.328|
000148  f8c49018          STR      r9,[r4,#0x18]         ;3069
00014c  e0ac              B        |L21.680|
                  |L21.334|
00014e  68e0              LDR      r0,[r4,#0xc]          ;3078
000150  42a8              CMP      r0,r5                 ;3078
000152  d204              BCS      |L21.350|
000154  79a0              LDRB     r0,[r4,#6]            ;3080
000156  f0000002          AND      r0,r0,#2              ;3080
00015a  b900              CBNZ     r0,|L21.350|
00015c  68e5              LDR      r5,[r4,#0xc]          ;3082
                  |L21.350|
00015e  68a0              LDR      r0,[r4,#8]            ;3084
000160  9005              STR      r0,[sp,#0x14]         ;3084
000162  f04f0b00          MOV      r11,#0                ;3085
000166  f8c4b008          STR      r11,[r4,#8]           ;3085
00016a  2d00              CMP      r5,#0                 ;3086
00016c  d069              BEQ      |L21.578|
00016e  6820              LDR      r0,[r4,#0]            ;3087
000170  7880              LDRB     r0,[r0,#2]            ;3087
000172  ea4f2840          LSL      r8,r0,#9              ;3087
000176  9805              LDR      r0,[sp,#0x14]         ;3088
000178  b190              CBZ      r0,|L21.416|
00017a  1e68              SUBS     r0,r5,#1              ;3089
00017c  fbb0f1f8          UDIV     r1,r0,r8              ;3089
000180  9805              LDR      r0,[sp,#0x14]         ;3089
000182  1e40              SUBS     r0,r0,#1              ;3089
000184  fbb0f0f8          UDIV     r0,r0,r8              ;3089
000188  4281              CMP      r1,r0                 ;3089
00018a  d309              BCC      |L21.416|
00018c  9805              LDR      r0,[sp,#0x14]         ;3090
00018e  1e40              SUBS     r0,r0,#1              ;3090
000190  f1a80101          SUB      r1,r8,#1              ;3090
000194  4388              BICS     r0,r0,r1              ;3090
000196  60a0              STR      r0,[r4,#8]            ;3090
000198  68a0              LDR      r0,[r4,#8]            ;3091
00019a  1a2d              SUBS     r5,r5,r0              ;3091
00019c  6966              LDR      r6,[r4,#0x14]         ;3092
00019e  e012              B        |L21.454|
                  |L21.416|
0001a0  6926              LDR      r6,[r4,#0x10]         ;3094
0001a2  b97e              CBNZ     r6,|L21.452|
0001a4  2100              MOVS     r1,#0                 ;3097
0001a6  6820              LDR      r0,[r4,#0]            ;3097
0001a8  f7fffffe          BL       create_chain
0001ac  4606              MOV      r6,r0                 ;3097
0001ae  2e01              CMP      r6,#1                 ;3098
0001b0  d102              BNE      |L21.440|
0001b2  2002              MOVS     r0,#2                 ;3098
0001b4  71e0              STRB     r0,[r4,#7]            ;3098
0001b6  e72f              B        |L21.24|
                  |L21.440|
0001b8  1c70              ADDS     r0,r6,#1              ;3099
0001ba  b910              CBNZ     r0,|L21.450|
0001bc  2001              MOVS     r0,#1                 ;3099
0001be  71e0              STRB     r0,[r4,#7]            ;3099
0001c0  e72a              B        |L21.24|
                  |L21.450|
0001c2  6126              STR      r6,[r4,#0x10]         ;3100
                  |L21.452|
0001c4  6166              STR      r6,[r4,#0x14]         ;3103
                  |L21.454|
0001c6  b3ce              CBZ      r6,|L21.572|
0001c8  e024              B        |L21.532|
                  |L21.458|
0001ca  79a0              LDRB     r0,[r4,#6]            ;3108
0001cc  f0000002          AND      r0,r0,#2              ;3108
0001d0  b138              CBZ      r0,|L21.482|
0001d2  4631              MOV      r1,r6                 ;3109
0001d4  6820              LDR      r0,[r4,#0]            ;3109
0001d6  f7fffffe          BL       create_chain
0001da  4606              MOV      r6,r0                 ;3109
0001dc  b936              CBNZ     r6,|L21.492|
0001de  4645              MOV      r5,r8                 ;3111
0001e0  e01a              B        |L21.536|
                  |L21.482|
0001e2  4631              MOV      r1,r6                 ;3115
0001e4  6820              LDR      r0,[r4,#0]            ;3115
0001e6  f7fffffe          BL       get_fat
0001ea  4606              MOV      r6,r0                 ;3115
                  |L21.492|
0001ec  1c70              ADDS     r0,r6,#1              ;3116
0001ee  b910              CBNZ     r0,|L21.502|
0001f0  2001              MOVS     r0,#1                 ;3116
0001f2  71e0              STRB     r0,[r4,#7]            ;3116
0001f4  e710              B        |L21.24|
                  |L21.502|
0001f6  2e01              CMP      r6,#1                 ;3117
0001f8  d903              BLS      |L21.514|
0001fa  6820              LDR      r0,[r4,#0]            ;3117
0001fc  6940              LDR      r0,[r0,#0x14]         ;3117
0001fe  42b0              CMP      r0,r6                 ;3117
000200  d802              BHI      |L21.520|
                  |L21.514|
000202  2002              MOVS     r0,#2                 ;3117
000204  71e0              STRB     r0,[r4,#7]            ;3117
000206  e707              B        |L21.24|
                  |L21.520|
000208  6166              STR      r6,[r4,#0x14]         ;3118
00020a  68a0              LDR      r0,[r4,#8]            ;3119
00020c  4440              ADD      r0,r0,r8              ;3119
00020e  60a0              STR      r0,[r4,#8]            ;3119
000210  eba50508          SUB      r5,r5,r8              ;3120
                  |L21.532|
000214  4545              CMP      r5,r8                 ;3106
000216  d8d8              BHI      |L21.458|
                  |L21.536|
000218  bf00              NOP                            ;3111
00021a  68a0              LDR      r0,[r4,#8]            ;3122
00021c  4428              ADD      r0,r0,r5              ;3122
00021e  60a0              STR      r0,[r4,#8]            ;3122
000220  f3c50008          UBFX     r0,r5,#0,#9           ;3123
000224  b150              CBZ      r0,|L21.572|
000226  4631              MOV      r1,r6                 ;3124
000228  6820              LDR      r0,[r4,#0]            ;3124
00022a  f7fffffe          BL       clust2sect
00022e  4683              MOV      r11,r0                ;3124
000230  f1bb0f00          CMP      r11,#0                ;3125
000234  d103              BNE      |L21.574|
000236  2002              MOVS     r0,#2                 ;3125
000238  71e0              STRB     r0,[r4,#7]            ;3125
00023a  e6ed              B        |L21.24|
                  |L21.572|
00023c  e001              B        |L21.578|
                  |L21.574|
00023e  eb0b2b55          ADD      r11,r11,r5,LSR #9     ;3126
                  |L21.578|
000242  8920              LDRH     r0,[r4,#8]            ;3130
000244  f3c00008          UBFX     r0,r0,#0,#9           ;3130
000248  b320              CBZ      r0,|L21.660|
00024a  69a0              LDR      r0,[r4,#0x18]         ;3130
00024c  4558              CMP      r0,r11                ;3130
00024e  d021              BEQ      |L21.660|
000250  79a0              LDRB     r0,[r4,#6]            ;3133
000252  f0000040          AND      r0,r0,#0x40           ;3133
000256  b178              CBZ      r0,|L21.632|
000258  6821              LDR      r1,[r4,#0]            ;3134
00025a  7848              LDRB     r0,[r1,#1]            ;3134
00025c  2301              MOVS     r3,#1                 ;3134
00025e  f1040128          ADD      r1,r4,#0x28           ;3134
000262  69a2              LDR      r2,[r4,#0x18]         ;3134
000264  f7fffffe          BL       disk_write
000268  b110              CBZ      r0,|L21.624|
00026a  2001              MOVS     r0,#1                 ;3135
00026c  71e0              STRB     r0,[r4,#7]            ;3135
00026e  e6d3              B        |L21.24|
                  |L21.624|
000270  79a0              LDRB     r0,[r4,#6]            ;3136
000272  f0200040          BIC      r0,r0,#0x40           ;3136
000276  71a0              STRB     r0,[r4,#6]            ;3136
                  |L21.632|
000278  6821              LDR      r1,[r4,#0]            ;3139
00027a  7848              LDRB     r0,[r1,#1]            ;3139
00027c  2301              MOVS     r3,#1                 ;3139
00027e  465a              MOV      r2,r11                ;3139
000280  f1040128          ADD      r1,r4,#0x28           ;3139
000284  f7fffffe          BL       disk_read
000288  b110              CBZ      r0,|L21.656|
00028a  2001              MOVS     r0,#1                 ;3140
00028c  71e0              STRB     r0,[r4,#7]            ;3140
00028e  e6c3              B        |L21.24|
                  |L21.656|
000290  f8c4b018          STR      r11,[r4,#0x18]        ;3142
                  |L21.660|
000294  e9d40102          LDRD     r0,r1,[r4,#8]         ;3145
000298  4288              CMP      r0,r1                 ;3145
00029a  d905              BLS      |L21.680|
00029c  68a0              LDR      r0,[r4,#8]            ;3146
00029e  60e0              STR      r0,[r4,#0xc]          ;3146
0002a0  79a0              LDRB     r0,[r4,#6]            ;3147
0002a2  f0400020          ORR      r0,r0,#0x20           ;3147
0002a6  71a0              STRB     r0,[r4,#6]            ;3147
                  |L21.680|
0002a8  9806              LDR      r0,[sp,#0x18]         ;3152
0002aa  e6b5              B        |L21.24|
;;;3154   
                          ENDP


                          AREA ||i.f_mkdir||, CODE, READONLY, ALIGN=1

                  f_mkdir PROC
;;;3570   
;;;3571   FRESULT f_mkdir (
000000  e92d4ff1          PUSH     {r0,r4-r11,lr}
;;;3572   	const TCHAR* path		/* Pointer to the directory path */
;;;3573   )
;;;3574   {
000004  b08c              SUB      sp,sp,#0x30
;;;3575   	FRESULT res;
;;;3576   	DIR dj;
;;;3577   	BYTE *dir, n;
;;;3578   	DWORD dsc, dcl, pcl, tm = GET_FATTIME();
000006  f7fffffe          BL       get_fattime
00000a  4606              MOV      r6,r0
;;;3579   	DEFINE_NAMEBUF;
;;;3580   
;;;3581   
;;;3582   	/* Get logical drive number */
;;;3583   	res = find_volume(&dj.fs, &path, 1);
00000c  2201              MOVS     r2,#1
00000e  a90c              ADD      r1,sp,#0x30
000010  a803              ADD      r0,sp,#0xc
000012  f7fffffe          BL       find_volume
000016  4605              MOV      r5,r0
;;;3584   	if (res == FR_OK) {
000018  2d00              CMP      r5,#0
00001a  d17b              BNE      |L22.276|
;;;3585   		INIT_BUF(dj);
00001c  f44f7000          MOV      r0,#0x200
000020  f7fffffe          BL       ff_memalloc
000024  4680              MOV      r8,r0
000026  f1b80f00          CMP      r8,#0
00002a  d103              BNE      |L22.52|
00002c  2011              MOVS     r0,#0x11
                  |L22.46|
;;;3586   		res = follow_path(&dj, path);			/* Follow the file path */
;;;3587   		if (res == FR_OK) res = FR_EXIST;		/* Any object with same name is already existing */
;;;3588   		if (_FS_RPATH && res == FR_NO_FILE && (dj.fn[NSFLAG] & NS_DOT))
;;;3589   			res = FR_INVALID_NAME;
;;;3590   		if (res == FR_NO_FILE) {				/* Can create a new directory */
;;;3591   			dcl = create_chain(dj.fs, 0);		/* Allocate a cluster for the new directory table */
;;;3592   			res = FR_OK;
;;;3593   			if (dcl == 0) res = FR_DENIED;		/* No space to allocate a new cluster */
;;;3594   			if (dcl == 1) res = FR_INT_ERR;
;;;3595   			if (dcl == 0xFFFFFFFF) res = FR_DISK_ERR;
;;;3596   			if (res == FR_OK)					/* Flush FAT */
;;;3597   				res = sync_window(dj.fs);
;;;3598   			if (res == FR_OK) {					/* Initialize the new directory table */
;;;3599   				dsc = clust2sect(dj.fs, dcl);
;;;3600   				dir = dj.fs->win;
;;;3601   				mem_set(dir, 0, SS(dj.fs));
;;;3602   				mem_set(dir + DIR_Name, ' ', 11);	/* Create "." entry */
;;;3603   				dir[DIR_Name] = '.';
;;;3604   				dir[DIR_Attr] = AM_DIR;
;;;3605   				ST_DWORD(dir + DIR_WrtTime, tm);
;;;3606   				st_clust(dir, dcl);
;;;3607   				mem_cpy(dir + SZ_DIRE, dir, SZ_DIRE); 	/* Create ".." entry */
;;;3608   				dir[SZ_DIRE + 1] = '.'; pcl = dj.sclust;
;;;3609   				if (dj.fs->fs_type == FS_FAT32 && pcl == dj.fs->dirbase)
;;;3610   					pcl = 0;
;;;3611   				st_clust(dir + SZ_DIRE, pcl);
;;;3612   				for (n = dj.fs->csize; n; n--) {	/* Write dot entries and clear following sectors */
;;;3613   					dj.fs->winsect = dsc++;
;;;3614   					dj.fs->wflag = 1;
;;;3615   					res = sync_window(dj.fs);
;;;3616   					if (res != FR_OK) break;
;;;3617   					mem_set(dir, 0, SS(dj.fs));
;;;3618   				}
;;;3619   			}
;;;3620   			if (res == FR_OK) res = dir_register(&dj);	/* Register the object to the directoy */
;;;3621   			if (res != FR_OK) {
;;;3622   				remove_chain(dj.fs, dcl);			/* Could not register, remove cluster chain */
;;;3623   			} else {
;;;3624   				dir = dj.dir;
;;;3625   				dir[DIR_Attr] = AM_DIR;				/* Attribute */
;;;3626   				ST_DWORD(dir + DIR_WrtTime, tm);	/* Created time */
;;;3627   				st_clust(dir, dcl);					/* Table start cluster */
;;;3628   				dj.fs->wflag = 1;
;;;3629   				res = sync_fs(dj.fs);
;;;3630   			}
;;;3631   		}
;;;3632   		FREE_BUF();
;;;3633   	}
;;;3634   
;;;3635   	LEAVE_FF(dj.fs, res);
;;;3636   }
00002e  b00d              ADD      sp,sp,#0x34
000030  e8bd8ff0          POP      {r4-r11,pc}
                  |L22.52|
000034  f8cd8028          STR      r8,[sp,#0x28]         ;3585
000038  f8cdd024          STR      sp,[sp,#0x24]         ;3585
00003c  a803              ADD      r0,sp,#0xc            ;3586
00003e  990c              LDR      r1,[sp,#0x30]         ;3586
000040  f7fffffe          BL       follow_path
000044  4605              MOV      r5,r0                 ;3586
000046  b905              CBNZ     r5,|L22.74|
000048  2508              MOVS     r5,#8                 ;3587
                  |L22.74|
00004a  bf00              NOP                            ;3588
00004c  2d04              CMP      r5,#4                 ;3590
00004e  d17a              BNE      |L22.326|
000050  2100              MOVS     r1,#0                 ;3591
000052  9803              LDR      r0,[sp,#0xc]          ;3591
000054  f7fffffe          BL       create_chain
000058  4607              MOV      r7,r0                 ;3591
00005a  2500              MOVS     r5,#0                 ;3592
00005c  b907              CBNZ     r7,|L22.96|
00005e  2507              MOVS     r5,#7                 ;3593
                  |L22.96|
000060  2f01              CMP      r7,#1                 ;3594
000062  d100              BNE      |L22.102|
000064  2502              MOVS     r5,#2                 ;3594
                  |L22.102|
000066  1c78              ADDS     r0,r7,#1              ;3595
000068  b900              CBNZ     r0,|L22.108|
00006a  2501              MOVS     r5,#1                 ;3595
                  |L22.108|
00006c  b91d              CBNZ     r5,|L22.118|
00006e  9803              LDR      r0,[sp,#0xc]          ;3597
000070  f7fffffe          BL       sync_window
000074  4605              MOV      r5,r0                 ;3597
                  |L22.118|
000076  2d00              CMP      r5,#0                 ;3598
000078  d15b              BNE      |L22.306|
00007a  4639              MOV      r1,r7                 ;3599
00007c  9803              LDR      r0,[sp,#0xc]          ;3599
00007e  f7fffffe          BL       clust2sect
000082  4682              MOV      r10,r0                ;3599
000084  9803              LDR      r0,[sp,#0xc]          ;3600
000086  f1000430          ADD      r4,r0,#0x30           ;3600
00008a  f44f7200          MOV      r2,#0x200             ;3601
00008e  2100              MOVS     r1,#0                 ;3601
000090  4620              MOV      r0,r4                 ;3601
000092  f7fffffe          BL       mem_set
000096  220b              MOVS     r2,#0xb               ;3602
000098  2120              MOVS     r1,#0x20              ;3602
00009a  4620              MOV      r0,r4                 ;3602
00009c  f7fffffe          BL       mem_set
0000a0  202e              MOVS     r0,#0x2e              ;3603
0000a2  7020              STRB     r0,[r4,#0]            ;3603
0000a4  2010              MOVS     r0,#0x10              ;3604
0000a6  72e0              STRB     r0,[r4,#0xb]          ;3604
0000a8  75a6              STRB     r6,[r4,#0x16]         ;3605
0000aa  0a31              LSRS     r1,r6,#8              ;3605
0000ac  75e1              STRB     r1,[r4,#0x17]         ;3605
0000ae  0c31              LSRS     r1,r6,#16             ;3605
0000b0  7621              STRB     r1,[r4,#0x18]         ;3605
0000b2  0e31              LSRS     r1,r6,#24             ;3605
0000b4  7661              STRB     r1,[r4,#0x19]         ;3605
0000b6  4639              MOV      r1,r7                 ;3606
0000b8  4620              MOV      r0,r4                 ;3606
0000ba  f7fffffe          BL       st_clust
0000be  2220              MOVS     r2,#0x20              ;3607
0000c0  4621              MOV      r1,r4                 ;3607
0000c2  f1040020          ADD      r0,r4,#0x20           ;3607
0000c6  f7fffffe          BL       mem_cpy
0000ca  202e              MOVS     r0,#0x2e              ;3608
0000cc  f8840021          STRB     r0,[r4,#0x21]         ;3608
0000d0  f8ddb014          LDR      r11,[sp,#0x14]        ;3608
0000d4  9803              LDR      r0,[sp,#0xc]          ;3609
0000d6  7800              LDRB     r0,[r0,#0]            ;3609
0000d8  2803              CMP      r0,#3                 ;3609
0000da  d104              BNE      |L22.230|
0000dc  9803              LDR      r0,[sp,#0xc]          ;3609
0000de  6a40              LDR      r0,[r0,#0x24]         ;3609
0000e0  4558              CMP      r0,r11                ;3609
0000e2  d100              BNE      |L22.230|
0000e4  46ab              MOV      r11,r5                ;3610
                  |L22.230|
0000e6  4659              MOV      r1,r11                ;3611
0000e8  f1040020          ADD      r0,r4,#0x20           ;3611
0000ec  f7fffffe          BL       st_clust
0000f0  9803              LDR      r0,[sp,#0xc]          ;3612
0000f2  f8909002          LDRB     r9,[r0,#2]            ;3612
0000f6  e018              B        |L22.298|
                  |L22.248|
0000f8  9803              LDR      r0,[sp,#0xc]          ;3613
0000fa  f8c0a02c          STR      r10,[r0,#0x2c]        ;3613
0000fe  f10a0a01          ADD      r10,r10,#1            ;3613
000102  2001              MOVS     r0,#1                 ;3614
000104  9903              LDR      r1,[sp,#0xc]          ;3614
000106  7108              STRB     r0,[r1,#4]            ;3614
000108  9803              LDR      r0,[sp,#0xc]          ;3615
00010a  f7fffffe          BL       sync_window
00010e  4605              MOV      r5,r0                 ;3615
000110  b10d              CBZ      r5,|L22.278|
000112  e00d              B        |L22.304|
                  |L22.276|
000114  e030              B        |L22.376|
                  |L22.278|
000116  f44f7200          MOV      r2,#0x200             ;3617
00011a  2100              MOVS     r1,#0                 ;3617
00011c  4620              MOV      r0,r4                 ;3617
00011e  f7fffffe          BL       mem_set
000122  f1a90001          SUB      r0,r9,#1              ;3612
000126  f00009ff          AND      r9,r0,#0xff           ;3612
                  |L22.298|
00012a  f1b90f00          CMP      r9,#0                 ;3612
00012e  d1e3              BNE      |L22.248|
                  |L22.304|
000130  bf00              NOP                            ;3616
                  |L22.306|
000132  b91d              CBNZ     r5,|L22.316|
000134  a803              ADD      r0,sp,#0xc            ;3620
000136  f7fffffe          BL       dir_register
00013a  4605              MOV      r5,r0                 ;3620
                  |L22.316|
00013c  b125              CBZ      r5,|L22.328|
00013e  4639              MOV      r1,r7                 ;3622
000140  9803              LDR      r0,[sp,#0xc]          ;3622
000142  f7fffffe          BL       remove_chain
                  |L22.326|
000146  e014              B        |L22.370|
                  |L22.328|
000148  9c08              LDR      r4,[sp,#0x20]         ;3624
00014a  2010              MOVS     r0,#0x10              ;3625
00014c  72e0              STRB     r0,[r4,#0xb]          ;3625
00014e  75a6              STRB     r6,[r4,#0x16]         ;3626
000150  0a31              LSRS     r1,r6,#8              ;3626
000152  75e1              STRB     r1,[r4,#0x17]         ;3626
000154  0c31              LSRS     r1,r6,#16             ;3626
000156  7621              STRB     r1,[r4,#0x18]         ;3626
000158  0e31              LSRS     r1,r6,#24             ;3626
00015a  7661              STRB     r1,[r4,#0x19]         ;3626
00015c  4639              MOV      r1,r7                 ;3627
00015e  4620              MOV      r0,r4                 ;3627
000160  f7fffffe          BL       st_clust
000164  2001              MOVS     r0,#1                 ;3628
000166  9903              LDR      r1,[sp,#0xc]          ;3628
000168  7108              STRB     r0,[r1,#4]            ;3628
00016a  9803              LDR      r0,[sp,#0xc]          ;3629
00016c  f7fffffe          BL       sync_fs
000170  4605              MOV      r5,r0                 ;3629
                  |L22.370|
000172  4640              MOV      r0,r8                 ;3632
000174  f7fffffe          BL       ff_memfree
                  |L22.376|
000178  4628              MOV      r0,r5                 ;3635
00017a  e758              B        |L22.46|
;;;3637   
                          ENDP


                          AREA ||i.f_mkfs||, CODE, READONLY, ALIGN=2

                  f_mkfs PROC
;;;4039   
;;;4040   FRESULT f_mkfs (
000000  e92d4ff7          PUSH     {r0-r2,r4-r11,lr}
;;;4041   	const TCHAR* path,	/* Logical drive number */
;;;4042   	BYTE sfd,			/* Partitioning rule 0:FDISK, 1:SFD */
;;;4043   	UINT au				/* Size of allocation unit in unit of byte or sector */
;;;4044   )
;;;4045   {
000004  b090              SUB      sp,sp,#0x40
000006  4690              MOV      r8,r2
;;;4046   	static const WORD vst[] = { 1024,   512,  256,  128,   64,    32,   16,    8,    4,    2,   0};
;;;4047   	static const WORD cst[] = {32768, 16384, 8192, 4096, 2048, 16384, 8192, 4096, 2048, 1024, 512};
;;;4048   	int vol;
;;;4049   	BYTE fmt, md, sys, *tbl, pdrv, part;
;;;4050   	DWORD n_clst, vs, n, wsect;
;;;4051   	UINT i;
;;;4052   	DWORD b_vol, b_fat, b_dir, b_data;	/* LBA */
;;;4053   	DWORD n_vol, n_rsv, n_fat, n_dir;	/* Size */
;;;4054   	FATFS *fs;
;;;4055   	DSTATUS stat;
;;;4056   #if _USE_TRIM
;;;4057   	DWORD eb[2];
;;;4058   #endif
;;;4059   
;;;4060   
;;;4061   	/* Check mounted drive and clear work area */
;;;4062   	if (sfd > 1) return FR_INVALID_PARAMETER;
000008  9811              LDR      r0,[sp,#0x44]
00000a  2801              CMP      r0,#1
00000c  dd03              BLE      |L23.22|
00000e  2013              MOVS     r0,#0x13
                  |L23.16|
;;;4063   	vol = get_ldnumber(&path);
;;;4064   	if (vol < 0) return FR_INVALID_DRIVE;
;;;4065   	fs = FatFs[vol];
;;;4066   	if (!fs) return FR_NOT_ENABLED;
;;;4067   	fs->fs_type = 0;
;;;4068   	pdrv = LD2PD(vol);	/* Physical drive */
;;;4069   	part = LD2PT(vol);	/* Partition (0:auto detect, 1-4:get from partition table)*/
;;;4070   
;;;4071   	/* Get disk statics */
;;;4072   	stat = disk_initialize(pdrv);
;;;4073   	if (stat & STA_NOINIT) return FR_NOT_READY;
;;;4074   	if (stat & STA_PROTECT) return FR_WRITE_PROTECTED;
;;;4075   #if _MAX_SS != _MIN_SS		/* Get disk sector size */
;;;4076   	if (disk_ioctl(pdrv, GET_SECTOR_SIZE, &SS(fs)) != RES_OK || SS(fs) > _MAX_SS || SS(fs) < _MIN_SS)
;;;4077   		return FR_DISK_ERR;
;;;4078   #endif
;;;4079   	if (_MULTI_PARTITION && part) {
;;;4080   		/* Get partition information from partition table in the MBR */
;;;4081   		if (disk_read(pdrv, fs->win, 0, 1) != RES_OK) return FR_DISK_ERR;
;;;4082   		if (LD_WORD(fs->win + BS_55AA) != 0xAA55) return FR_MKFS_ABORTED;
;;;4083   		tbl = &fs->win[MBR_Table + (part - 1) * SZ_PTE];
;;;4084   		if (!tbl[4]) return FR_MKFS_ABORTED;	/* No partition? */
;;;4085   		b_vol = LD_DWORD(tbl + 8);	/* Volume start sector */
;;;4086   		n_vol = LD_DWORD(tbl + 12);	/* Volume size */
;;;4087   	} else {
;;;4088   		/* Create a partition in this function */
;;;4089   		if (disk_ioctl(pdrv, GET_SECTOR_COUNT, &n_vol) != RES_OK || n_vol < 128)
;;;4090   			return FR_DISK_ERR;
;;;4091   		b_vol = (sfd) ? 0 : 63;		/* Volume start sector */
;;;4092   		n_vol -= b_vol;				/* Volume size */
;;;4093   	}
;;;4094   
;;;4095   	if (au & (au - 1)) au = 0;
;;;4096   	if (!au) {						/* AU auto selection */
;;;4097   		vs = n_vol / (2000 / (SS(fs) / 512));
;;;4098   		for (i = 0; vs < vst[i]; i++) ;
;;;4099   		au = cst[i];
;;;4100   	}
;;;4101   	if (au >= _MIN_SS) au /= SS(fs);	/* Number of sectors per cluster */
;;;4102   	if (!au) au = 1;
;;;4103   	if (au > 128) au = 128;
;;;4104   
;;;4105   	/* Pre-compute number of clusters and FAT sub-type */
;;;4106   	n_clst = n_vol / au;
;;;4107   	fmt = FS_FAT12;
;;;4108   	if (n_clst >= MIN_FAT16) fmt = FS_FAT16;
;;;4109   	if (n_clst >= MIN_FAT32) fmt = FS_FAT32;
;;;4110   
;;;4111   	/* Determine offset and size of FAT structure */
;;;4112   	if (fmt == FS_FAT32) {
;;;4113   		n_fat = ((n_clst * 4) + 8 + SS(fs) - 1) / SS(fs);
;;;4114   		n_rsv = 32;
;;;4115   		n_dir = 0;
;;;4116   	} else {
;;;4117   		n_fat = (fmt == FS_FAT12) ? (n_clst * 3 + 1) / 2 + 3 : (n_clst * 2) + 4;
;;;4118   		n_fat = (n_fat + SS(fs) - 1) / SS(fs);
;;;4119   		n_rsv = 1;
;;;4120   		n_dir = (DWORD)N_ROOTDIR * SZ_DIRE / SS(fs);
;;;4121   	}
;;;4122   	b_fat = b_vol + n_rsv;				/* FAT area start sector */
;;;4123   	b_dir = b_fat + n_fat * N_FATS;		/* Directory area start sector */
;;;4124   	b_data = b_dir + n_dir;				/* Data area start sector */
;;;4125   	if (n_vol < b_data + au - b_vol) return FR_MKFS_ABORTED;	/* Too small volume */
;;;4126   
;;;4127   	/* Align data start sector to erase block boundary (for flash memory media) */
;;;4128   	if (disk_ioctl(pdrv, GET_BLOCK_SIZE, &n) != RES_OK || !n || n > 32768) n = 1;
;;;4129   	n = (b_data + n - 1) & ~(n - 1);	/* Next nearest erase block from current data start */
;;;4130   	n = (n - b_data) / N_FATS;
;;;4131   	if (fmt == FS_FAT32) {		/* FAT32: Move FAT offset */
;;;4132   		n_rsv += n;
;;;4133   		b_fat += n;
;;;4134   	} else {					/* FAT12/16: Expand FAT size */
;;;4135   		n_fat += n;
;;;4136   	}
;;;4137   
;;;4138   	/* Determine number of clusters and final check of validity of the FAT sub-type */
;;;4139   	n_clst = (n_vol - n_rsv - n_fat * N_FATS - n_dir) / au;
;;;4140   	if (   (fmt == FS_FAT16 && n_clst < MIN_FAT16)
;;;4141   		|| (fmt == FS_FAT32 && n_clst < MIN_FAT32))
;;;4142   		return FR_MKFS_ABORTED;
;;;4143   
;;;4144   	/* Determine system ID in the partition table */
;;;4145   	if (fmt == FS_FAT32) {
;;;4146   		sys = 0x0C;		/* FAT32X */
;;;4147   	} else {
;;;4148   		if (fmt == FS_FAT12 && n_vol < 0x10000) {
;;;4149   			sys = 0x01;	/* FAT12(<65536) */
;;;4150   		} else {
;;;4151   			sys = (n_vol < 0x10000) ? 0x04 : 0x06;	/* FAT16(<65536) : FAT12/16(>=65536) */
;;;4152   		}
;;;4153   	}
;;;4154   
;;;4155   	if (_MULTI_PARTITION && part) {
;;;4156   		/* Update system ID in the partition table */
;;;4157   		tbl = &fs->win[MBR_Table + (part - 1) * SZ_PTE];
;;;4158   		tbl[4] = sys;
;;;4159   		if (disk_write(pdrv, fs->win, 0, 1) != RES_OK)	/* Write it to teh MBR */
;;;4160   			return FR_DISK_ERR;
;;;4161   		md = 0xF8;
;;;4162   	} else {
;;;4163   		if (sfd) {	/* No partition table (SFD) */
;;;4164   			md = 0xF0;
;;;4165   		} else {	/* Create partition table (FDISK) */
;;;4166   			mem_set(fs->win, 0, SS(fs));
;;;4167   			tbl = fs->win + MBR_Table;	/* Create partition table for single partition in the drive */
;;;4168   			tbl[1] = 1;						/* Partition start head */
;;;4169   			tbl[2] = 1;						/* Partition start sector */
;;;4170   			tbl[3] = 0;						/* Partition start cylinder */
;;;4171   			tbl[4] = sys;					/* System type */
;;;4172   			tbl[5] = 254;					/* Partition end head */
;;;4173   			n = (b_vol + n_vol) / 63 / 255;
;;;4174   			tbl[6] = (BYTE)(n >> 2 | 63);	/* Partition end sector */
;;;4175   			tbl[7] = (BYTE)n;				/* End cylinder */
;;;4176   			ST_DWORD(tbl + 8, 63);			/* Partition start in LBA */
;;;4177   			ST_DWORD(tbl + 12, n_vol);		/* Partition size in LBA */
;;;4178   			ST_WORD(fs->win + BS_55AA, 0xAA55);	/* MBR signature */
;;;4179   			if (disk_write(pdrv, fs->win, 0, 1) != RES_OK)	/* Write it to the MBR */
;;;4180   				return FR_DISK_ERR;
;;;4181   			md = 0xF8;
;;;4182   		}
;;;4183   	}
;;;4184   
;;;4185   	/* Create BPB in the VBR */
;;;4186   	tbl = fs->win;							/* Clear sector */
;;;4187   	mem_set(tbl, 0, SS(fs));
;;;4188   	mem_cpy(tbl, "\xEB\xFE\x90" "MSDOS5.0", 11);/* Boot jump code, OEM name */
;;;4189   	i = SS(fs);								/* Sector size */
;;;4190   	ST_WORD(tbl + BPB_BytsPerSec, i);
;;;4191   	tbl[BPB_SecPerClus] = (BYTE)au;			/* Sectors per cluster */
;;;4192   	ST_WORD(tbl + BPB_RsvdSecCnt, n_rsv);	/* Reserved sectors */
;;;4193   	tbl[BPB_NumFATs] = N_FATS;				/* Number of FATs */
;;;4194   	i = (fmt == FS_FAT32) ? 0 : N_ROOTDIR;	/* Number of root directory entries */
;;;4195   	ST_WORD(tbl + BPB_RootEntCnt, i);
;;;4196   	if (n_vol < 0x10000) {					/* Number of total sectors */
;;;4197   		ST_WORD(tbl + BPB_TotSec16, n_vol);
;;;4198   	} else {
;;;4199   		ST_DWORD(tbl + BPB_TotSec32, n_vol);
;;;4200   	}
;;;4201   	tbl[BPB_Media] = md;					/* Media descriptor */
;;;4202   	ST_WORD(tbl + BPB_SecPerTrk, 63);		/* Number of sectors per track */
;;;4203   	ST_WORD(tbl + BPB_NumHeads, 255);		/* Number of heads */
;;;4204   	ST_DWORD(tbl + BPB_HiddSec, b_vol);		/* Hidden sectors */
;;;4205   	n = GET_FATTIME();						/* Use current time as VSN */
;;;4206   	if (fmt == FS_FAT32) {
;;;4207   		ST_DWORD(tbl + BS_VolID32, n);		/* VSN */
;;;4208   		ST_DWORD(tbl + BPB_FATSz32, n_fat);	/* Number of sectors per FAT */
;;;4209   		ST_DWORD(tbl + BPB_RootClus, 2);	/* Root directory start cluster (2) */
;;;4210   		ST_WORD(tbl + BPB_FSInfo, 1);		/* FSINFO record offset (VBR + 1) */
;;;4211   		ST_WORD(tbl + BPB_BkBootSec, 6);	/* Backup boot record offset (VBR + 6) */
;;;4212   		tbl[BS_DrvNum32] = 0x80;			/* Drive number */
;;;4213   		tbl[BS_BootSig32] = 0x29;			/* Extended boot signature */
;;;4214   		mem_cpy(tbl + BS_VolLab32, "NO NAME    " "FAT32   ", 19);	/* Volume label, FAT signature */
;;;4215   	} else {
;;;4216   		ST_DWORD(tbl + BS_VolID, n);		/* VSN */
;;;4217   		ST_WORD(tbl + BPB_FATSz16, n_fat);	/* Number of sectors per FAT */
;;;4218   		tbl[BS_DrvNum] = 0x80;				/* Drive number */
;;;4219   		tbl[BS_BootSig] = 0x29;				/* Extended boot signature */
;;;4220   		mem_cpy(tbl + BS_VolLab, "NO NAME    " "FAT     ", 19);	/* Volume label, FAT signature */
;;;4221   	}
;;;4222   	ST_WORD(tbl + BS_55AA, 0xAA55);			/* Signature (Offset is fixed here regardless of sector size) */
;;;4223   	if (disk_write(pdrv, tbl, b_vol, 1) != RES_OK)	/* Write it to the VBR sector */
;;;4224   		return FR_DISK_ERR;
;;;4225   	if (fmt == FS_FAT32)					/* Write backup VBR if needed (VBR + 6) */
;;;4226   		disk_write(pdrv, tbl, b_vol + 6, 1);
;;;4227   
;;;4228   	/* Initialize FAT area */
;;;4229   	wsect = b_fat;
;;;4230   	for (i = 0; i < N_FATS; i++) {		/* Initialize each FAT copy */
;;;4231   		mem_set(tbl, 0, SS(fs));			/* 1st sector of the FAT  */
;;;4232   		n = md;								/* Media descriptor byte */
;;;4233   		if (fmt != FS_FAT32) {
;;;4234   			n |= (fmt == FS_FAT12) ? 0x00FFFF00 : 0xFFFFFF00;
;;;4235   			ST_DWORD(tbl + 0, n);			/* Reserve cluster #0-1 (FAT12/16) */
;;;4236   		} else {
;;;4237   			n |= 0xFFFFFF00;
;;;4238   			ST_DWORD(tbl + 0, n);			/* Reserve cluster #0-1 (FAT32) */
;;;4239   			ST_DWORD(tbl + 4, 0xFFFFFFFF);
;;;4240   			ST_DWORD(tbl + 8, 0x0FFFFFFF);	/* Reserve cluster #2 for root directory */
;;;4241   		}
;;;4242   		if (disk_write(pdrv, tbl, wsect++, 1) != RES_OK)
;;;4243   			return FR_DISK_ERR;
;;;4244   		mem_set(tbl, 0, SS(fs));			/* Fill following FAT entries with zero */
;;;4245   		for (n = 1; n < n_fat; n++) {		/* This loop may take a time on FAT32 volume due to many single sector writes */
;;;4246   			if (disk_write(pdrv, tbl, wsect++, 1) != RES_OK)
;;;4247   				return FR_DISK_ERR;
;;;4248   		}
;;;4249   	}
;;;4250   
;;;4251   	/* Initialize root directory */
;;;4252   	i = (fmt == FS_FAT32) ? au : (UINT)n_dir;
;;;4253   	do {
;;;4254   		if (disk_write(pdrv, tbl, wsect++, 1) != RES_OK)
;;;4255   			return FR_DISK_ERR;
;;;4256   	} while (--i);
;;;4257   
;;;4258   #if _USE_TRIM	/* Erase data area if needed */
;;;4259   	{
;;;4260   		eb[0] = wsect; eb[1] = wsect + (n_clst - ((fmt == FS_FAT32) ? 1 : 0)) * au - 1;
;;;4261   		disk_ioctl(pdrv, CTRL_TRIM, eb);
;;;4262   	}
;;;4263   #endif
;;;4264   
;;;4265   	/* Create FSINFO if needed */
;;;4266   	if (fmt == FS_FAT32) {
;;;4267   		ST_DWORD(tbl + FSI_LeadSig, 0x41615252);
;;;4268   		ST_DWORD(tbl + FSI_StrucSig, 0x61417272);
;;;4269   		ST_DWORD(tbl + FSI_Free_Count, n_clst - 1);	/* Number of free clusters */
;;;4270   		ST_DWORD(tbl + FSI_Nxt_Free, 2);			/* Last allocated cluster# */
;;;4271   		ST_WORD(tbl + BS_55AA, 0xAA55);
;;;4272   		disk_write(pdrv, tbl, b_vol + 1, 1);	/* Write original (VBR + 1) */
;;;4273   		disk_write(pdrv, tbl, b_vol + 7, 1);	/* Write backup (VBR + 7) */
;;;4274   	}
;;;4275   
;;;4276   	return (disk_ioctl(pdrv, CTRL_SYNC, 0) == RES_OK) ? FR_OK : FR_DISK_ERR;
;;;4277   }
000010  b013              ADD      sp,sp,#0x4c
000012  e8bd8ff0          POP      {r4-r11,pc}
                  |L23.22|
000016  a810              ADD      r0,sp,#0x40           ;4063
000018  f7fffffe          BL       get_ldnumber
00001c  900f              STR      r0,[sp,#0x3c]         ;4063
00001e  980f              LDR      r0,[sp,#0x3c]         ;4064
000020  2800              CMP      r0,#0                 ;4064
000022  da01              BGE      |L23.40|
000024  200b              MOVS     r0,#0xb               ;4064
000026  e7f3              B        |L23.16|
                  |L23.40|
000028  49fc              LDR      r1,|L23.1052|
00002a  980f              LDR      r0,[sp,#0x3c]         ;4065
00002c  f851b020          LDR      r11,[r1,r0,LSL #2]    ;4065
000030  f1bb0f00          CMP      r11,#0                ;4066
000034  d101              BNE      |L23.58|
000036  200c              MOVS     r0,#0xc               ;4066
000038  e7ea              B        |L23.16|
                  |L23.58|
00003a  2000              MOVS     r0,#0                 ;4067
00003c  f88b0000          STRB     r0,[r11,#0]           ;4067
000040  980f              LDR      r0,[sp,#0x3c]         ;4068
000042  b2c0              UXTB     r0,r0                 ;4068
000044  900c              STR      r0,[sp,#0x30]         ;4068
000046  2000              MOVS     r0,#0                 ;4069
000048  900b              STR      r0,[sp,#0x2c]         ;4069
00004a  980c              LDR      r0,[sp,#0x30]         ;4072
00004c  f7fffffe          BL       disk_initialize
000050  9001              STR      r0,[sp,#4]            ;4072
000052  9801              LDR      r0,[sp,#4]            ;4073
000054  f0000001          AND      r0,r0,#1              ;4073
000058  b108              CBZ      r0,|L23.94|
00005a  2003              MOVS     r0,#3                 ;4073
00005c  e7d8              B        |L23.16|
                  |L23.94|
00005e  9801              LDR      r0,[sp,#4]            ;4074
000060  f0000004          AND      r0,r0,#4              ;4074
000064  b108              CBZ      r0,|L23.106|
000066  200a              MOVS     r0,#0xa               ;4074
000068  e7d2              B        |L23.16|
                  |L23.106|
00006a  bf00              NOP                            ;4079
00006c  aa04              ADD      r2,sp,#0x10           ;4089
00006e  2101              MOVS     r1,#1                 ;4089
000070  980c              LDR      r0,[sp,#0x30]         ;4089
000072  f7fffffe          BL       disk_ioctl
000076  b910              CBNZ     r0,|L23.126|
000078  9804              LDR      r0,[sp,#0x10]         ;4089
00007a  2880              CMP      r0,#0x80              ;4089
00007c  d201              BCS      |L23.130|
                  |L23.126|
00007e  2001              MOVS     r0,#1                 ;4090
000080  e7c6              B        |L23.16|
                  |L23.130|
000082  9811              LDR      r0,[sp,#0x44]         ;4091
000084  b108              CBZ      r0,|L23.138|
000086  2000              MOVS     r0,#0                 ;4091
000088  e000              B        |L23.140|
                  |L23.138|
00008a  203f              MOVS     r0,#0x3f              ;4091
                  |L23.140|
00008c  4681              MOV      r9,r0                 ;4091
00008e  9804              LDR      r0,[sp,#0x10]         ;4092
000090  eba00009          SUB      r0,r0,r9              ;4092
000094  9004              STR      r0,[sp,#0x10]         ;4092
000096  f1a80001          SUB      r0,r8,#1              ;4095
00009a  ea000008          AND      r0,r0,r8              ;4095
00009e  b108              CBZ      r0,|L23.164|
0000a0  f04f0800          MOV      r8,#0                 ;4095
                  |L23.164|
0000a4  f1b80f00          CMP      r8,#0                 ;4096
0000a8  d113              BNE      |L23.210|
0000aa  f44f61fa          MOV      r1,#0x7d0             ;4097
0000ae  9804              LDR      r0,[sp,#0x10]         ;4097
0000b0  fbb0f0f1          UDIV     r0,r0,r1              ;4097
0000b4  900a              STR      r0,[sp,#0x28]         ;4097
0000b6  f04f0a00          MOV      r10,#0                ;4098
0000ba  e001              B        |L23.192|
                  |L23.188|
0000bc  f10a0a01          ADD      r10,r10,#1            ;4098
                  |L23.192|
0000c0  48d7              LDR      r0,|L23.1056|
0000c2  f830101a          LDRH     r1,[r0,r10,LSL #1]    ;4098
0000c6  980a              LDR      r0,[sp,#0x28]         ;4098
0000c8  4281              CMP      r1,r0                 ;4098
0000ca  d8f7              BHI      |L23.188|
0000cc  48d5              LDR      r0,|L23.1060|
0000ce  f830801a          LDRH     r8,[r0,r10,LSL #1]    ;4099
                  |L23.210|
0000d2  f5b87f00          CMP      r8,#0x200             ;4101
0000d6  d301              BCC      |L23.220|
0000d8  ea4f2858          LSR      r8,r8,#9              ;4101
                  |L23.220|
0000dc  f1b80f00          CMP      r8,#0                 ;4102
0000e0  d101              BNE      |L23.230|
0000e2  f04f0801          MOV      r8,#1                 ;4102
                  |L23.230|
0000e6  f1b80f80          CMP      r8,#0x80              ;4103
0000ea  d901              BLS      |L23.240|
0000ec  f04f0880          MOV      r8,#0x80              ;4103
                  |L23.240|
0000f0  9804              LDR      r0,[sp,#0x10]         ;4106
0000f2  fbb0f7f8          UDIV     r7,r0,r8              ;4106
0000f6  2501              MOVS     r5,#1                 ;4107
0000f8  f64070f6          MOV      r0,#0xff6             ;4108
0000fc  4287              CMP      r7,r0                 ;4108
0000fe  d300              BCC      |L23.258|
000100  2502              MOVS     r5,#2                 ;4108
                  |L23.258|
000102  f64f70f6          MOV      r0,#0xfff6            ;4109
000106  4287              CMP      r7,r0                 ;4109
000108  d300              BCC      |L23.268|
00010a  2503              MOVS     r5,#3                 ;4109
                  |L23.268|
00010c  2d03              CMP      r5,#3                 ;4112
00010e  d10a              BNE      |L23.294|
000110  2008              MOVS     r0,#8                 ;4113
000112  eb000087          ADD      r0,r0,r7,LSL #2       ;4113
000116  f20010ff          ADD      r0,r0,#0x1ff          ;4113
00011a  0a46              LSRS     r6,r0,#9              ;4113
00011c  2020              MOVS     r0,#0x20              ;4114
00011e  9003              STR      r0,[sp,#0xc]          ;4114
000120  2000              MOVS     r0,#0                 ;4115
000122  9002              STR      r0,[sp,#8]            ;4115
000124  e011              B        |L23.330|
                  |L23.294|
000126  2d01              CMP      r5,#1                 ;4117
000128  d105              BNE      |L23.310|
00012a  eb070047          ADD      r0,r7,r7,LSL #1       ;4117
00012e  1c40              ADDS     r0,r0,#1              ;4117
000130  0840              LSRS     r0,r0,#1              ;4117
000132  1cc0              ADDS     r0,r0,#3              ;4117
000134  e001              B        |L23.314|
                  |L23.310|
000136  0078              LSLS     r0,r7,#1              ;4117
000138  1d00              ADDS     r0,r0,#4              ;4117
                  |L23.314|
00013a  4606              MOV      r6,r0                 ;4117
00013c  f20610ff          ADD      r0,r6,#0x1ff          ;4118
000140  0a46              LSRS     r6,r0,#9              ;4118
000142  2001              MOVS     r0,#1                 ;4119
000144  9003              STR      r0,[sp,#0xc]          ;4119
000146  2020              MOVS     r0,#0x20              ;4120
000148  9002              STR      r0,[sp,#8]            ;4120
                  |L23.330|
00014a  9803              LDR      r0,[sp,#0xc]          ;4122
00014c  4448              ADD      r0,r0,r9              ;4122
00014e  9007              STR      r0,[sp,#0x1c]         ;4122
000150  9807              LDR      r0,[sp,#0x1c]         ;4123
000152  4430              ADD      r0,r0,r6              ;4123
000154  9006              STR      r0,[sp,#0x18]         ;4123
000156  9902              LDR      r1,[sp,#8]            ;4124
000158  9806              LDR      r0,[sp,#0x18]         ;4124
00015a  4408              ADD      r0,r0,r1              ;4124
00015c  9005              STR      r0,[sp,#0x14]         ;4124
00015e  9805              LDR      r0,[sp,#0x14]         ;4125
000160  4440              ADD      r0,r0,r8              ;4125
000162  eba00009          SUB      r0,r0,r9              ;4125
000166  9904              LDR      r1,[sp,#0x10]         ;4125
000168  4288              CMP      r0,r1                 ;4125
00016a  d901              BLS      |L23.368|
00016c  200e              MOVS     r0,#0xe               ;4125
00016e  e74f              B        |L23.16|
                  |L23.368|
000170  aa09              ADD      r2,sp,#0x24           ;4128
000172  2103              MOVS     r1,#3                 ;4128
000174  980c              LDR      r0,[sp,#0x30]         ;4128
000176  f7fffffe          BL       disk_ioctl
00017a  b928              CBNZ     r0,|L23.392|
00017c  9809              LDR      r0,[sp,#0x24]         ;4128
00017e  b118              CBZ      r0,|L23.392|
000180  9809              LDR      r0,[sp,#0x24]         ;4128
000182  f5b04f00          CMP      r0,#0x8000            ;4128
000186  d901              BLS      |L23.396|
                  |L23.392|
000188  2001              MOVS     r0,#1                 ;4128
00018a  9009              STR      r0,[sp,#0x24]         ;4128
                  |L23.396|
00018c  9909              LDR      r1,[sp,#0x24]         ;4129
00018e  9805              LDR      r0,[sp,#0x14]         ;4129
000190  4408              ADD      r0,r0,r1              ;4129
000192  1e40              SUBS     r0,r0,#1              ;4129
000194  1e49              SUBS     r1,r1,#1              ;4129
000196  4388              BICS     r0,r0,r1              ;4129
000198  9009              STR      r0,[sp,#0x24]         ;4129
00019a  9909              LDR      r1,[sp,#0x24]         ;4130
00019c  9805              LDR      r0,[sp,#0x14]         ;4130
00019e  1a08              SUBS     r0,r1,r0              ;4130
0001a0  9009              STR      r0,[sp,#0x24]         ;4130
0001a2  2d03              CMP      r5,#3                 ;4131
0001a4  d108              BNE      |L23.440|
0001a6  9909              LDR      r1,[sp,#0x24]         ;4132
0001a8  9803              LDR      r0,[sp,#0xc]          ;4132
0001aa  4408              ADD      r0,r0,r1              ;4132
0001ac  9003              STR      r0,[sp,#0xc]          ;4132
0001ae  9909              LDR      r1,[sp,#0x24]         ;4133
0001b0  9807              LDR      r0,[sp,#0x1c]         ;4133
0001b2  4408              ADD      r0,r0,r1              ;4133
0001b4  9007              STR      r0,[sp,#0x1c]         ;4133
0001b6  e001              B        |L23.444|
                  |L23.440|
0001b8  9809              LDR      r0,[sp,#0x24]         ;4135
0001ba  4406              ADD      r6,r6,r0              ;4135
                  |L23.444|
0001bc  e9dd0103          LDRD     r0,r1,[sp,#0xc]       ;4139
0001c0  1a08              SUBS     r0,r1,r0              ;4139
0001c2  1b81              SUBS     r1,r0,r6              ;4139
0001c4  9802              LDR      r0,[sp,#8]            ;4139
0001c6  1a08              SUBS     r0,r1,r0              ;4139
0001c8  fbb0f7f8          UDIV     r7,r0,r8              ;4139
0001cc  2d02              CMP      r5,#2                 ;4140
0001ce  d103              BNE      |L23.472|
0001d0  f64070f6          MOV      r0,#0xff6             ;4140
0001d4  4287              CMP      r7,r0                 ;4140
0001d6  d305              BCC      |L23.484|
                  |L23.472|
0001d8  2d03              CMP      r5,#3                 ;4141
0001da  d105              BNE      |L23.488|
0001dc  f64f70f6          MOV      r0,#0xfff6            ;4141
0001e0  4287              CMP      r7,r0                 ;4141
0001e2  d201              BCS      |L23.488|
                  |L23.484|
0001e4  200e              MOVS     r0,#0xe               ;4142
0001e6  e713              B        |L23.16|
                  |L23.488|
0001e8  2d03              CMP      r5,#3                 ;4145
0001ea  d102              BNE      |L23.498|
0001ec  200c              MOVS     r0,#0xc               ;4146
0001ee  900d              STR      r0,[sp,#0x34]         ;4146
0001f0  e010              B        |L23.532|
                  |L23.498|
0001f2  2d01              CMP      r5,#1                 ;4148
0001f4  d106              BNE      |L23.516|
0001f6  9804              LDR      r0,[sp,#0x10]         ;4148
0001f8  f5b03f80          CMP      r0,#0x10000           ;4148
0001fc  d202              BCS      |L23.516|
0001fe  2001              MOVS     r0,#1                 ;4149
000200  900d              STR      r0,[sp,#0x34]         ;4149
000202  e007              B        |L23.532|
                  |L23.516|
000204  9804              LDR      r0,[sp,#0x10]         ;4151
000206  f5b03f80          CMP      r0,#0x10000           ;4151
00020a  d201              BCS      |L23.528|
00020c  2004              MOVS     r0,#4                 ;4151
00020e  e000              B        |L23.530|
                  |L23.528|
000210  2006              MOVS     r0,#6                 ;4151
                  |L23.530|
000212  900d              STR      r0,[sp,#0x34]         ;4151
                  |L23.532|
000214  bf00              NOP                            ;4155
000216  9811              LDR      r0,[sp,#0x44]         ;4163
000218  b110              CBZ      r0,|L23.544|
00021a  20f0              MOVS     r0,#0xf0              ;4164
00021c  900e              STR      r0,[sp,#0x38]         ;4164
00021e  e044              B        |L23.682|
                  |L23.544|
000220  f44f7200          MOV      r2,#0x200             ;4166
000224  2100              MOVS     r1,#0                 ;4166
000226  f10b0030          ADD      r0,r11,#0x30          ;4166
00022a  f7fffffe          BL       mem_set
00022e  f50b74f7          ADD      r4,r11,#0x1ee         ;4167
000232  2001              MOVS     r0,#1                 ;4168
000234  7060              STRB     r0,[r4,#1]            ;4168
000236  70a0              STRB     r0,[r4,#2]            ;4169
000238  2000              MOVS     r0,#0                 ;4170
00023a  70e0              STRB     r0,[r4,#3]            ;4170
00023c  980d              LDR      r0,[sp,#0x34]         ;4171
00023e  7120              STRB     r0,[r4,#4]            ;4171
000240  20fe              MOVS     r0,#0xfe              ;4172
000242  7160              STRB     r0,[r4,#5]            ;4172
000244  9804              LDR      r0,[sp,#0x10]         ;4173
000246  4448              ADD      r0,r0,r9              ;4173
000248  213f              MOVS     r1,#0x3f              ;4173
00024a  fbb0f0f1          UDIV     r0,r0,r1              ;4173
00024e  21ff              MOVS     r1,#0xff              ;4173
000250  fbb0f0f1          UDIV     r0,r0,r1              ;4173
000254  9009              STR      r0,[sp,#0x24]         ;4173
000256  213f              MOVS     r1,#0x3f              ;4174
000258  9809              LDR      r0,[sp,#0x24]         ;4174
00025a  ea410090          ORR      r0,r1,r0,LSR #2       ;4174
00025e  71a0              STRB     r0,[r4,#6]            ;4174
000260  9809              LDR      r0,[sp,#0x24]         ;4175
000262  71e0              STRB     r0,[r4,#7]            ;4175
000264  203f              MOVS     r0,#0x3f              ;4176
000266  7220              STRB     r0,[r4,#8]            ;4176
000268  2100              MOVS     r1,#0                 ;4176
00026a  7261              STRB     r1,[r4,#9]            ;4176
00026c  72a1              STRB     r1,[r4,#0xa]          ;4176
00026e  72e1              STRB     r1,[r4,#0xb]          ;4176
000270  9804              LDR      r0,[sp,#0x10]         ;4177
000272  7320              STRB     r0,[r4,#0xc]          ;4177
000274  9804              LDR      r0,[sp,#0x10]         ;4177
000276  0a01              LSRS     r1,r0,#8              ;4177
000278  7361              STRB     r1,[r4,#0xd]          ;4177
00027a  9804              LDR      r0,[sp,#0x10]         ;4177
00027c  0c01              LSRS     r1,r0,#16             ;4177
00027e  73a1              STRB     r1,[r4,#0xe]          ;4177
000280  9804              LDR      r0,[sp,#0x10]         ;4177
000282  0e01              LSRS     r1,r0,#24             ;4177
000284  73e1              STRB     r1,[r4,#0xf]          ;4177
000286  2155              MOVS     r1,#0x55              ;4178
000288  f88b122e          STRB     r1,[r11,#0x22e]       ;4178
00028c  21aa              MOVS     r1,#0xaa              ;4178
00028e  f88b122f          STRB     r1,[r11,#0x22f]       ;4178
000292  2301              MOVS     r3,#1                 ;4179
000294  2200              MOVS     r2,#0                 ;4179
000296  f10b0130          ADD      r1,r11,#0x30          ;4179
00029a  980c              LDR      r0,[sp,#0x30]         ;4179
00029c  f7fffffe          BL       disk_write
0002a0  b108              CBZ      r0,|L23.678|
0002a2  2001              MOVS     r0,#1                 ;4180
0002a4  e6b4              B        |L23.16|
                  |L23.678|
0002a6  20f8              MOVS     r0,#0xf8              ;4181
0002a8  900e              STR      r0,[sp,#0x38]         ;4181
                  |L23.682|
0002aa  f10b0430          ADD      r4,r11,#0x30          ;4186
0002ae  f44f7200          MOV      r2,#0x200             ;4187
0002b2  2100              MOVS     r1,#0                 ;4187
0002b4  4620              MOV      r0,r4                 ;4187
0002b6  f7fffffe          BL       mem_set
0002ba  220b              MOVS     r2,#0xb               ;4188
0002bc  a15a              ADR      r1,|L23.1064|
0002be  4620              MOV      r0,r4                 ;4188
0002c0  f7fffffe          BL       mem_cpy
0002c4  f44f7a00          MOV      r10,#0x200            ;4189
0002c8  f884a00b          STRB     r10,[r4,#0xb]         ;4190
0002cc  ea4f211a          LSR      r1,r10,#8             ;4190
0002d0  7321              STRB     r1,[r4,#0xc]          ;4190
0002d2  f884800d          STRB     r8,[r4,#0xd]          ;4191
0002d6  9803              LDR      r0,[sp,#0xc]          ;4192
0002d8  73a0              STRB     r0,[r4,#0xe]          ;4192
0002da  9803              LDR      r0,[sp,#0xc]          ;4192
0002dc  0a01              LSRS     r1,r0,#8              ;4192
0002de  73e1              STRB     r1,[r4,#0xf]          ;4192
0002e0  2001              MOVS     r0,#1                 ;4193
0002e2  7420              STRB     r0,[r4,#0x10]         ;4193
0002e4  2d03              CMP      r5,#3                 ;4194
0002e6  d101              BNE      |L23.748|
0002e8  2000              MOVS     r0,#0                 ;4194
0002ea  e001              B        |L23.752|
                  |L23.748|
0002ec  f44f7000          MOV      r0,#0x200             ;4194
                  |L23.752|
0002f0  4682              MOV      r10,r0                ;4194
0002f2  f884a011          STRB     r10,[r4,#0x11]        ;4195
0002f6  ea4f211a          LSR      r1,r10,#8             ;4195
0002fa  74a1              STRB     r1,[r4,#0x12]         ;4195
0002fc  9804              LDR      r0,[sp,#0x10]         ;4196
0002fe  f5b03f80          CMP      r0,#0x10000           ;4196
000302  d205              BCS      |L23.784|
000304  9804              LDR      r0,[sp,#0x10]         ;4197
000306  74e0              STRB     r0,[r4,#0x13]         ;4197
000308  9804              LDR      r0,[sp,#0x10]         ;4197
00030a  0a01              LSRS     r1,r0,#8              ;4197
00030c  7521              STRB     r1,[r4,#0x14]         ;4197
00030e  e010              B        |L23.818|
                  |L23.784|
000310  9804              LDR      r0,[sp,#0x10]         ;4199
000312  f8840020          STRB     r0,[r4,#0x20]         ;4199
000316  9804              LDR      r0,[sp,#0x10]         ;4199
000318  f3c02107          UBFX     r1,r0,#8,#8           ;4199
00031c  2021              MOVS     r0,#0x21              ;4199
00031e  5501              STRB     r1,[r0,r4]            ;4199
000320  9804              LDR      r0,[sp,#0x10]         ;4199
000322  f3c04107          UBFX     r1,r0,#16,#8          ;4199
000326  2022              MOVS     r0,#0x22              ;4199
000328  5501              STRB     r1,[r0,r4]            ;4199
00032a  9804              LDR      r0,[sp,#0x10]         ;4199
00032c  0e01              LSRS     r1,r0,#24             ;4199
00032e  2023              MOVS     r0,#0x23              ;4199
000330  5501              STRB     r1,[r0,r4]            ;4199
                  |L23.818|
000332  980e              LDR      r0,[sp,#0x38]         ;4201
000334  7560              STRB     r0,[r4,#0x15]         ;4201
000336  203f              MOVS     r0,#0x3f              ;4202
000338  7620              STRB     r0,[r4,#0x18]         ;4202
00033a  2100              MOVS     r1,#0                 ;4202
00033c  7661              STRB     r1,[r4,#0x19]         ;4202
00033e  20ff              MOVS     r0,#0xff              ;4203
000340  76a0              STRB     r0,[r4,#0x1a]         ;4203
000342  76e1              STRB     r1,[r4,#0x1b]         ;4203
000344  f884901c          STRB     r9,[r4,#0x1c]         ;4204
000348  ea4f2119          LSR      r1,r9,#8              ;4204
00034c  7761              STRB     r1,[r4,#0x1d]         ;4204
00034e  ea4f4119          LSR      r1,r9,#16             ;4204
000352  77a1              STRB     r1,[r4,#0x1e]         ;4204
000354  ea4f6119          LSR      r1,r9,#24             ;4204
000358  77e1              STRB     r1,[r4,#0x1f]         ;4204
00035a  f7fffffe          BL       get_fattime
00035e  9009              STR      r0,[sp,#0x24]         ;4205
000360  2d03              CMP      r5,#3                 ;4206
000362  d13e              BNE      |L23.994|
000364  9809              LDR      r0,[sp,#0x24]         ;4207
000366  f8840043          STRB     r0,[r4,#0x43]         ;4207
00036a  9809              LDR      r0,[sp,#0x24]         ;4207
00036c  f3c02107          UBFX     r1,r0,#8,#8           ;4207
000370  2044              MOVS     r0,#0x44              ;4207
000372  5501              STRB     r1,[r0,r4]            ;4207
000374  9809              LDR      r0,[sp,#0x24]         ;4207
000376  f3c04107          UBFX     r1,r0,#16,#8          ;4207
00037a  2045              MOVS     r0,#0x45              ;4207
00037c  5501              STRB     r1,[r0,r4]            ;4207
00037e  9809              LDR      r0,[sp,#0x24]         ;4207
000380  0e01              LSRS     r1,r0,#24             ;4207
000382  2046              MOVS     r0,#0x46              ;4207
000384  5501              STRB     r1,[r0,r4]            ;4207
000386  f8846024          STRB     r6,[r4,#0x24]         ;4208
00038a  f3c62107          UBFX     r1,r6,#8,#8           ;4208
00038e  2025              MOVS     r0,#0x25              ;4208
000390  5501              STRB     r1,[r0,r4]            ;4208
000392  f3c64107          UBFX     r1,r6,#16,#8          ;4208
000396  2026              MOVS     r0,#0x26              ;4208
000398  5501              STRB     r1,[r0,r4]            ;4208
00039a  0e31              LSRS     r1,r6,#24             ;4208
00039c  2027              MOVS     r0,#0x27              ;4208
00039e  5501              STRB     r1,[r0,r4]            ;4208
0003a0  2002              MOVS     r0,#2                 ;4209
0003a2  f884002c          STRB     r0,[r4,#0x2c]         ;4209
0003a6  2100              MOVS     r1,#0                 ;4209
0003a8  202d              MOVS     r0,#0x2d              ;4209
0003aa  5501              STRB     r1,[r0,r4]            ;4209
0003ac  202e              MOVS     r0,#0x2e              ;4209
0003ae  5501              STRB     r1,[r0,r4]            ;4209
0003b0  202f              MOVS     r0,#0x2f              ;4209
0003b2  5501              STRB     r1,[r0,r4]            ;4209
0003b4  2001              MOVS     r0,#1                 ;4210
0003b6  f8840030          STRB     r0,[r4,#0x30]         ;4210
0003ba  2031              MOVS     r0,#0x31              ;4210
0003bc  5501              STRB     r1,[r0,r4]            ;4210
0003be  2006              MOVS     r0,#6                 ;4211
0003c0  f8840032          STRB     r0,[r4,#0x32]         ;4211
0003c4  2033              MOVS     r0,#0x33              ;4211
0003c6  5501              STRB     r1,[r0,r4]            ;4211
0003c8  2080              MOVS     r0,#0x80              ;4212
0003ca  f8840040          STRB     r0,[r4,#0x40]         ;4212
0003ce  2029              MOVS     r0,#0x29              ;4213
0003d0  f8840042          STRB     r0,[r4,#0x42]         ;4213
0003d4  2213              MOVS     r2,#0x13              ;4214
0003d6  a117              ADR      r1,|L23.1076|
0003d8  f1040047          ADD      r0,r4,#0x47           ;4214
0003dc  f7fffffe          BL       mem_cpy
0003e0  e037              B        |L23.1106|
                  |L23.994|
0003e2  9809              LDR      r0,[sp,#0x24]         ;4216
0003e4  f8840027          STRB     r0,[r4,#0x27]         ;4216
0003e8  9809              LDR      r0,[sp,#0x24]         ;4216
0003ea  f3c02107          UBFX     r1,r0,#8,#8           ;4216
0003ee  2028              MOVS     r0,#0x28              ;4216
0003f0  5501              STRB     r1,[r0,r4]            ;4216
0003f2  9809              LDR      r0,[sp,#0x24]         ;4216
0003f4  f3c04107          UBFX     r1,r0,#16,#8          ;4216
0003f8  2029              MOVS     r0,#0x29              ;4216
0003fa  5501              STRB     r1,[r0,r4]            ;4216
0003fc  9809              LDR      r0,[sp,#0x24]         ;4216
0003fe  0e01              LSRS     r1,r0,#24             ;4216
000400  202a              MOVS     r0,#0x2a              ;4216
000402  5501              STRB     r1,[r0,r4]            ;4216
000404  75a6              STRB     r6,[r4,#0x16]         ;4217
000406  0a31              LSRS     r1,r6,#8              ;4217
000408  75e1              STRB     r1,[r4,#0x17]         ;4217
00040a  2080              MOVS     r0,#0x80              ;4218
00040c  f8840024          STRB     r0,[r4,#0x24]         ;4218
000410  2029              MOVS     r0,#0x29              ;4219
000412  f8840026          STRB     r0,[r4,#0x26]         ;4219
000416  2213              MOVS     r2,#0x13              ;4220
000418  e016              B        |L23.1096|
00041a  0000              DCW      0x0000
                  |L23.1052|
                          DCD      FatFs
                  |L23.1056|
                          DCD      vst
                  |L23.1060|
                          DCD      ||cst||
                  |L23.1064|
000428  ebfe904d          DCB      235,254,144,"MSDOS5.0",0
00042c  53444f53
000430  352e3000
                  |L23.1076|
000434  4e4f204e          DCB      "NO NAME    FAT32   ",0
000438  414d4520
00043c  20202046
000440  41543332
000444  20202000
                  |L23.1096|
000448  a179              ADR      r1,|L23.1584|
00044a  f104002b          ADD      r0,r4,#0x2b           ;4220
00044e  f7fffffe          BL       mem_cpy
                  |L23.1106|
000452  2055              MOVS     r0,#0x55              ;4222
000454  f88401fe          STRB     r0,[r4,#0x1fe]        ;4222
000458  21aa              MOVS     r1,#0xaa              ;4222
00045a  f24010ff          MOV      r0,#0x1ff             ;4222
00045e  5501              STRB     r1,[r0,r4]            ;4222
000460  2301              MOVS     r3,#1                 ;4223
000462  464a              MOV      r2,r9                 ;4223
000464  4621              MOV      r1,r4                 ;4223
000466  980c              LDR      r0,[sp,#0x30]         ;4223
000468  f7fffffe          BL       disk_write
00046c  b108              CBZ      r0,|L23.1138|
00046e  2001              MOVS     r0,#1                 ;4224
000470  e5ce              B        |L23.16|
                  |L23.1138|
000472  2d03              CMP      r5,#3                 ;4225
000474  d106              BNE      |L23.1156|
000476  2301              MOVS     r3,#1                 ;4226
000478  f1090206          ADD      r2,r9,#6              ;4226
00047c  4621              MOV      r1,r4                 ;4226
00047e  980c              LDR      r0,[sp,#0x30]         ;4226
000480  f7fffffe          BL       disk_write
                  |L23.1156|
000484  9807              LDR      r0,[sp,#0x1c]         ;4229
000486  9008              STR      r0,[sp,#0x20]         ;4229
000488  f04f0a00          MOV      r10,#0                ;4230
00048c  e061              B        |L23.1362|
                  |L23.1166|
00048e  f44f7200          MOV      r2,#0x200             ;4231
000492  2100              MOVS     r1,#0                 ;4231
000494  4620              MOV      r0,r4                 ;4231
000496  f7fffffe          BL       mem_set
00049a  980e              LDR      r0,[sp,#0x38]         ;4232
00049c  9009              STR      r0,[sp,#0x24]         ;4232
00049e  2d03              CMP      r5,#3                 ;4233
0004a0  d014              BEQ      |L23.1228|
0004a2  2d01              CMP      r5,#1                 ;4234
0004a4  d101              BNE      |L23.1194|
0004a6  4867              LDR      r0,|L23.1604|
0004a8  e001              B        |L23.1198|
                  |L23.1194|
0004aa  f06f00ff          MVN      r0,#0xff              ;4234
                  |L23.1198|
0004ae  9909              LDR      r1,[sp,#0x24]         ;4234
0004b0  4308              ORRS     r0,r0,r1              ;4234
0004b2  9009              STR      r0,[sp,#0x24]         ;4234
0004b4  9809              LDR      r0,[sp,#0x24]         ;4235
0004b6  7020              STRB     r0,[r4,#0]            ;4235
0004b8  9809              LDR      r0,[sp,#0x24]         ;4235
0004ba  0a00              LSRS     r0,r0,#8              ;4235
0004bc  7060              STRB     r0,[r4,#1]            ;4235
0004be  9809              LDR      r0,[sp,#0x24]         ;4235
0004c0  0c00              LSRS     r0,r0,#16             ;4235
0004c2  70a0              STRB     r0,[r4,#2]            ;4235
0004c4  9809              LDR      r0,[sp,#0x24]         ;4235
0004c6  0e00              LSRS     r0,r0,#24             ;4235
0004c8  70e0              STRB     r0,[r4,#3]            ;4235
0004ca  e019              B        |L23.1280|
                  |L23.1228|
0004cc  9809              LDR      r0,[sp,#0x24]         ;4237
0004ce  f06000ff          ORN      r0,r0,#0xff           ;4237
0004d2  9009              STR      r0,[sp,#0x24]         ;4237
0004d4  9809              LDR      r0,[sp,#0x24]         ;4238
0004d6  7020              STRB     r0,[r4,#0]            ;4238
0004d8  9809              LDR      r0,[sp,#0x24]         ;4238
0004da  0a00              LSRS     r0,r0,#8              ;4238
0004dc  7060              STRB     r0,[r4,#1]            ;4238
0004de  9809              LDR      r0,[sp,#0x24]         ;4238
0004e0  0c00              LSRS     r0,r0,#16             ;4238
0004e2  70a0              STRB     r0,[r4,#2]            ;4238
0004e4  9809              LDR      r0,[sp,#0x24]         ;4238
0004e6  0e00              LSRS     r0,r0,#24             ;4238
0004e8  70e0              STRB     r0,[r4,#3]            ;4238
0004ea  20ff              MOVS     r0,#0xff              ;4239
0004ec  7120              STRB     r0,[r4,#4]            ;4239
0004ee  21ff              MOVS     r1,#0xff              ;4239
0004f0  7161              STRB     r1,[r4,#5]            ;4239
0004f2  71a1              STRB     r1,[r4,#6]            ;4239
0004f4  71e1              STRB     r1,[r4,#7]            ;4239
0004f6  7220              STRB     r0,[r4,#8]            ;4240
0004f8  7261              STRB     r1,[r4,#9]            ;4240
0004fa  72a1              STRB     r1,[r4,#0xa]          ;4240
0004fc  210f              MOVS     r1,#0xf               ;4240
0004fe  72e1              STRB     r1,[r4,#0xb]          ;4240
                  |L23.1280|
000500  9808              LDR      r0,[sp,#0x20]         ;4242
000502  1c41              ADDS     r1,r0,#1              ;4242
000504  4602              MOV      r2,r0                 ;4242
000506  2301              MOVS     r3,#1                 ;4242
000508  9108              STR      r1,[sp,#0x20]         ;4242
00050a  4621              MOV      r1,r4                 ;4242
00050c  980c              LDR      r0,[sp,#0x30]         ;4242
00050e  f7fffffe          BL       disk_write
000512  b108              CBZ      r0,|L23.1304|
000514  2001              MOVS     r0,#1                 ;4243
000516  e57b              B        |L23.16|
                  |L23.1304|
000518  f44f7200          MOV      r2,#0x200             ;4244
00051c  2100              MOVS     r1,#0                 ;4244
00051e  4620              MOV      r0,r4                 ;4244
000520  f7fffffe          BL       mem_set
000524  2001              MOVS     r0,#1                 ;4245
000526  9009              STR      r0,[sp,#0x24]         ;4245
000528  e00e              B        |L23.1352|
                  |L23.1322|
00052a  9808              LDR      r0,[sp,#0x20]         ;4246
00052c  1c41              ADDS     r1,r0,#1              ;4246
00052e  4602              MOV      r2,r0                 ;4246
000530  2301              MOVS     r3,#1                 ;4246
000532  9108              STR      r1,[sp,#0x20]         ;4246
000534  4621              MOV      r1,r4                 ;4246
000536  980c              LDR      r0,[sp,#0x30]         ;4246
000538  f7fffffe          BL       disk_write
00053c  b108              CBZ      r0,|L23.1346|
00053e  2001              MOVS     r0,#1                 ;4247
000540  e566              B        |L23.16|
                  |L23.1346|
000542  9809              LDR      r0,[sp,#0x24]         ;4245
000544  1c40              ADDS     r0,r0,#1              ;4245
000546  9009              STR      r0,[sp,#0x24]         ;4245
                  |L23.1352|
000548  9809              LDR      r0,[sp,#0x24]         ;4245
00054a  42b0              CMP      r0,r6                 ;4245
00054c  d3ed              BCC      |L23.1322|
00054e  f10a0a01          ADD      r10,r10,#1            ;4230
                  |L23.1362|
000552  f1ba0f00          CMP      r10,#0                ;4230
000556  d09a              BEQ      |L23.1166|
000558  2d03              CMP      r5,#3                 ;4252
00055a  d101              BNE      |L23.1376|
00055c  4640              MOV      r0,r8                 ;4252
00055e  e000              B        |L23.1378|
                  |L23.1376|
000560  9802              LDR      r0,[sp,#8]            ;4252
                  |L23.1378|
000562  4682              MOV      r10,r0                ;4252
000564  bf00              NOP                            ;4253
                  |L23.1382|
000566  9808              LDR      r0,[sp,#0x20]         ;4254
000568  1c41              ADDS     r1,r0,#1              ;4254
00056a  4602              MOV      r2,r0                 ;4254
00056c  2301              MOVS     r3,#1                 ;4254
00056e  9108              STR      r1,[sp,#0x20]         ;4254
000570  4621              MOV      r1,r4                 ;4254
000572  980c              LDR      r0,[sp,#0x30]         ;4254
000574  f7fffffe          BL       disk_write
000578  b108              CBZ      r0,|L23.1406|
00057a  2001              MOVS     r0,#1                 ;4255
00057c  e548              B        |L23.16|
                  |L23.1406|
00057e  f1aa0001          SUB      r0,r10,#1             ;4256
000582  f1b00a00          SUBS     r10,r0,#0             ;4256
000586  d1ee              BNE      |L23.1382|
000588  2d03              CMP      r5,#3                 ;4266
00058a  d146              BNE      |L23.1562|
00058c  2052              MOVS     r0,#0x52              ;4267
00058e  7020              STRB     r0,[r4,#0]            ;4267
000590  7060              STRB     r0,[r4,#1]            ;4267
000592  2061              MOVS     r0,#0x61              ;4267
000594  70a0              STRB     r0,[r4,#2]            ;4267
000596  2041              MOVS     r0,#0x41              ;4267
000598  70e0              STRB     r0,[r4,#3]            ;4267
00059a  2072              MOVS     r0,#0x72              ;4268
00059c  f88401e4          STRB     r0,[r4,#0x1e4]        ;4268
0005a0  2172              MOVS     r1,#0x72              ;4268
0005a2  f24010e5          MOV      r0,#0x1e5             ;4268
0005a6  5501              STRB     r1,[r0,r4]            ;4268
0005a8  2141              MOVS     r1,#0x41              ;4268
0005aa  1c40              ADDS     r0,r0,#1              ;4268
0005ac  5501              STRB     r1,[r0,r4]            ;4268
0005ae  2161              MOVS     r1,#0x61              ;4268
0005b0  1c40              ADDS     r0,r0,#1              ;4268
0005b2  5501              STRB     r1,[r0,r4]            ;4268
0005b4  1e78              SUBS     r0,r7,#1              ;4269
0005b6  f88401e8          STRB     r0,[r4,#0x1e8]        ;4269
0005ba  f3c02107          UBFX     r1,r0,#8,#8           ;4269
0005be  f24010e9          MOV      r0,#0x1e9             ;4269
0005c2  5501              STRB     r1,[r0,r4]            ;4269
0005c4  1e78              SUBS     r0,r7,#1              ;4269
0005c6  f3c04107          UBFX     r1,r0,#16,#8          ;4269
0005ca  f44f70f5          MOV      r0,#0x1ea             ;4269
0005ce  5501              STRB     r1,[r0,r4]            ;4269
0005d0  1e78              SUBS     r0,r7,#1              ;4269
0005d2  0e01              LSRS     r1,r0,#24             ;4269
0005d4  f24010eb          MOV      r0,#0x1eb             ;4269
0005d8  5501              STRB     r1,[r0,r4]            ;4269
0005da  2002              MOVS     r0,#2                 ;4270
0005dc  f88401ec          STRB     r0,[r4,#0x1ec]        ;4270
0005e0  2100              MOVS     r1,#0                 ;4270
0005e2  f24010ed          MOV      r0,#0x1ed             ;4270
0005e6  5501              STRB     r1,[r0,r4]            ;4270
0005e8  1c40              ADDS     r0,r0,#1              ;4270
0005ea  5501              STRB     r1,[r0,r4]            ;4270
0005ec  1c40              ADDS     r0,r0,#1              ;4270
0005ee  5501              STRB     r1,[r0,r4]            ;4270
0005f0  2055              MOVS     r0,#0x55              ;4271
0005f2  f88401fe          STRB     r0,[r4,#0x1fe]        ;4271
0005f6  21aa              MOVS     r1,#0xaa              ;4271
0005f8  f24010ff          MOV      r0,#0x1ff             ;4271
0005fc  5501              STRB     r1,[r0,r4]            ;4271
0005fe  2301              MOVS     r3,#1                 ;4272
000600  f1090201          ADD      r2,r9,#1              ;4272
000604  4621              MOV      r1,r4                 ;4272
000606  980c              LDR      r0,[sp,#0x30]         ;4272
000608  f7fffffe          BL       disk_write
00060c  2301              MOVS     r3,#1                 ;4273
00060e  f1090207          ADD      r2,r9,#7              ;4273
000612  4621              MOV      r1,r4                 ;4273
000614  980c              LDR      r0,[sp,#0x30]         ;4273
000616  f7fffffe          BL       disk_write
                  |L23.1562|
00061a  2200              MOVS     r2,#0                 ;4276
00061c  4611              MOV      r1,r2                 ;4276
00061e  980c              LDR      r0,[sp,#0x30]         ;4276
000620  f7fffffe          BL       disk_ioctl
000624  b108              CBZ      r0,|L23.1578|
000626  2001              MOVS     r0,#1                 ;4276
000628  e4f2              B        |L23.16|
                  |L23.1578|
00062a  2000              MOVS     r0,#0                 ;4276
00062c  e4f0              B        |L23.16|
;;;4278   
                          ENDP

00062e  0000              DCW      0x0000
                  |L23.1584|
000630  4e4f204e          DCB      "NO NAME    FAT     ",0
000634  414d4520
000638  20202046
00063c  41542020
000640  20202000
                  |L23.1604|
                          DCD      0x00ffff00

                          AREA ||i.f_mount||, CODE, READONLY, ALIGN=2

                  f_mount PROC
;;;2376   
;;;2377   FRESULT f_mount (
000000  b5f7              PUSH     {r0-r2,r4-r7,lr}
;;;2378   	FATFS* fs,			/* Pointer to the file system object (NULL:unmount)*/
;;;2379   	const TCHAR* path,	/* Logical drive number to be mounted/unmounted */
;;;2380   	BYTE opt			/* 0:Do not mount (delayed mount), 1:Mount immediately */
;;;2381   )
;;;2382   {
000002  b082              SUB      sp,sp,#8
000004  4616              MOV      r6,r2
;;;2383   	FATFS *cfs;
;;;2384   	int vol;
;;;2385   	FRESULT res;
;;;2386   	const TCHAR *rp = path;
000006  9803              LDR      r0,[sp,#0xc]
000008  9001              STR      r0,[sp,#4]
;;;2387   
;;;2388   
;;;2389   	vol = get_ldnumber(&rp);
00000a  a801              ADD      r0,sp,#4
00000c  f7fffffe          BL       get_ldnumber
000010  4605              MOV      r5,r0
;;;2390   	if (vol < 0) return FR_INVALID_DRIVE;
000012  2d00              CMP      r5,#0
000014  da02              BGE      |L24.28|
000016  200b              MOVS     r0,#0xb
                  |L24.24|
;;;2391   	cfs = FatFs[vol];					/* Pointer to fs object */
;;;2392   
;;;2393   	if (cfs) {
;;;2394   #if _FS_LOCK
;;;2395   		clear_lock(cfs);
;;;2396   #endif
;;;2397   #if _FS_REENTRANT						/* Discard sync object of the current volume */
;;;2398   		if (!ff_del_syncobj(cfs->sobj)) return FR_INT_ERR;
;;;2399   #endif
;;;2400   		cfs->fs_type = 0;				/* Clear old fs object */
;;;2401   	}
;;;2402   
;;;2403   	if (fs) {
;;;2404   		fs->fs_type = 0;				/* Clear new fs object */
;;;2405   #if _FS_REENTRANT						/* Create sync object for the new volume */
;;;2406   		if (!ff_cre_syncobj((BYTE)vol, &fs->sobj)) return FR_INT_ERR;
;;;2407   #endif
;;;2408   	}
;;;2409   	FatFs[vol] = fs;					/* Register new fs object */
;;;2410   
;;;2411   	if (!fs || opt != 1) return FR_OK;	/* Do not mount now, it will be mounted later */
;;;2412   
;;;2413   	res = find_volume(&fs, &path, 0);	/* Force mounted the volume */
;;;2414   	LEAVE_FF(fs, res);
;;;2415   }
000018  b005              ADD      sp,sp,#0x14
00001a  bdf0              POP      {r4-r7,pc}
                  |L24.28|
00001c  480e              LDR      r0,|L24.88|
00001e  f8504025          LDR      r4,[r0,r5,LSL #2]     ;2391
000022  b10c              CBZ      r4,|L24.40|
000024  2000              MOVS     r0,#0                 ;2400
000026  7020              STRB     r0,[r4,#0]            ;2400
                  |L24.40|
000028  9802              LDR      r0,[sp,#8]            ;2403
00002a  b110              CBZ      r0,|L24.50|
00002c  2000              MOVS     r0,#0                 ;2404
00002e  9902              LDR      r1,[sp,#8]            ;2404
000030  7008              STRB     r0,[r1,#0]            ;2404
                  |L24.50|
000032  4909              LDR      r1,|L24.88|
000034  9802              LDR      r0,[sp,#8]            ;2409
000036  f8410025          STR      r0,[r1,r5,LSL #2]     ;2409
00003a  9802              LDR      r0,[sp,#8]            ;2411
00003c  b108              CBZ      r0,|L24.66|
00003e  2e01              CMP      r6,#1                 ;2411
000040  d001              BEQ      |L24.70|
                  |L24.66|
000042  2000              MOVS     r0,#0                 ;2411
000044  e7e8              B        |L24.24|
                  |L24.70|
000046  2200              MOVS     r2,#0                 ;2413
000048  a903              ADD      r1,sp,#0xc            ;2413
00004a  a802              ADD      r0,sp,#8              ;2413
00004c  f7fffffe          BL       find_volume
000050  4607              MOV      r7,r0                 ;2413
000052  4638              MOV      r0,r7                 ;2414
000054  e7e0              B        |L24.24|
;;;2416   
                          ENDP

000056  0000              DCW      0x0000
                  |L24.88|
                          DCD      FatFs

                          AREA ||i.f_open||, CODE, READONLY, ALIGN=1

                  f_open PROC
;;;2423   
;;;2424   FRESULT f_open (
000000  e92d47f7          PUSH     {r0-r2,r4-r10,lr}
;;;2425   	FIL* fp,			/* Pointer to the blank file object */
;;;2426   	const TCHAR* path,	/* Pointer to the file name */
;;;2427   	BYTE mode			/* Access mode and file open mode flags */
;;;2428   )
;;;2429   {
000004  b08d              SUB      sp,sp,#0x34
000006  4605              MOV      r5,r0
000008  4616              MOV      r6,r2
;;;2430   	FRESULT res;
;;;2431   	DIR dj;
;;;2432   	BYTE *dir;
;;;2433   	DEFINE_NAMEBUF;
;;;2434   #if !_FS_READONLY
;;;2435   	DWORD dw, cl;
;;;2436   #endif
;;;2437   
;;;2438   
;;;2439   	if (!fp) return FR_INVALID_OBJECT;
00000a  b91d              CBNZ     r5,|L25.20|
00000c  2009              MOVS     r0,#9
                  |L25.14|
;;;2440   	fp->fs = 0;			/* Clear file object */
;;;2441   
;;;2442   	/* Get logical drive number */
;;;2443   #if !_FS_READONLY
;;;2444   	mode &= FA_READ | FA_WRITE | FA_CREATE_ALWAYS | FA_OPEN_ALWAYS | FA_CREATE_NEW;
;;;2445   	res = find_volume(&dj.fs, &path, (BYTE)(mode & ~FA_READ));
;;;2446   #else
;;;2447   	mode &= FA_READ;
;;;2448   	res = find_volume(&dj.fs, &path, 0);
;;;2449   #endif
;;;2450   	if (res == FR_OK) {
;;;2451   		INIT_BUF(dj);
;;;2452   		res = follow_path(&dj, path);	/* Follow the file path */
;;;2453   		dir = dj.dir;
;;;2454   #if !_FS_READONLY	/* R/W configuration */
;;;2455   		if (res == FR_OK) {
;;;2456   			if (!dir)	/* Default directory itself */
;;;2457   				res = FR_INVALID_NAME;
;;;2458   #if _FS_LOCK
;;;2459   			else
;;;2460   				res = chk_lock(&dj, (mode & ~FA_READ) ? 1 : 0);
;;;2461   #endif
;;;2462   		}
;;;2463   		/* Create or Open a file */
;;;2464   		if (mode & (FA_CREATE_ALWAYS | FA_OPEN_ALWAYS | FA_CREATE_NEW)) {
;;;2465   			if (res != FR_OK) {					/* No file, create new */
;;;2466   				if (res == FR_NO_FILE)			/* There is no file to open, create a new entry */
;;;2467   #if _FS_LOCK
;;;2468   					res = enq_lock() ? dir_register(&dj) : FR_TOO_MANY_OPEN_FILES;
;;;2469   #else
;;;2470   					res = dir_register(&dj);
;;;2471   #endif
;;;2472   				mode |= FA_CREATE_ALWAYS;		/* File is created */
;;;2473   				dir = dj.dir;					/* New entry */
;;;2474   			}
;;;2475   			else {								/* Any object is already existing */
;;;2476   				if (dir[DIR_Attr] & (AM_RDO | AM_DIR)) {	/* Cannot overwrite it (R/O or DIR) */
;;;2477   					res = FR_DENIED;
;;;2478   				} else {
;;;2479   					if (mode & FA_CREATE_NEW)	/* Cannot create as new file */
;;;2480   						res = FR_EXIST;
;;;2481   				}
;;;2482   			}
;;;2483   			if (res == FR_OK && (mode & FA_CREATE_ALWAYS)) {	/* Truncate it if overwrite mode */
;;;2484   				dw = GET_FATTIME();				/* Created time */
;;;2485   				ST_DWORD(dir + DIR_CrtTime, dw);
;;;2486   				dir[DIR_Attr] = 0;				/* Reset attribute */
;;;2487   				ST_DWORD(dir + DIR_FileSize, 0);/* size = 0 */
;;;2488   				cl = ld_clust(dj.fs, dir);		/* Get start cluster */
;;;2489   				st_clust(dir, 0);				/* cluster = 0 */
;;;2490   				dj.fs->wflag = 1;
;;;2491   				if (cl) {						/* Remove the cluster chain if exist */
;;;2492   					dw = dj.fs->winsect;
;;;2493   					res = remove_chain(dj.fs, cl);
;;;2494   					if (res == FR_OK) {
;;;2495   						dj.fs->last_clust = cl - 1;	/* Reuse the cluster hole */
;;;2496   						res = move_window(dj.fs, dw);
;;;2497   					}
;;;2498   				}
;;;2499   			}
;;;2500   		}
;;;2501   		else {	/* Open an existing file */
;;;2502   			if (res == FR_OK) {					/* Follow succeeded */
;;;2503   				if (dir[DIR_Attr] & AM_DIR) {	/* It is a directory */
;;;2504   					res = FR_NO_FILE;
;;;2505   				} else {
;;;2506   					if ((mode & FA_WRITE) && (dir[DIR_Attr] & AM_RDO)) /* R/O violation */
;;;2507   						res = FR_DENIED;
;;;2508   				}
;;;2509   			}
;;;2510   		}
;;;2511   		if (res == FR_OK) {
;;;2512   			if (mode & FA_CREATE_ALWAYS)		/* Set file change flag if created or overwritten */
;;;2513   				mode |= FA__WRITTEN;
;;;2514   			fp->dir_sect = dj.fs->winsect;		/* Pointer to the directory entry */
;;;2515   			fp->dir_ptr = dir;
;;;2516   #if _FS_LOCK
;;;2517   			fp->lockid = inc_lock(&dj, (mode & ~FA_READ) ? 1 : 0);
;;;2518   			if (!fp->lockid) res = FR_INT_ERR;
;;;2519   #endif
;;;2520   		}
;;;2521   
;;;2522   #else				/* R/O configuration */
;;;2523   		if (res == FR_OK) {					/* Follow succeeded */
;;;2524   			dir = dj.dir;
;;;2525   			if (!dir) {						/* Current directory itself */
;;;2526   				res = FR_INVALID_NAME;
;;;2527   			} else {
;;;2528   				if (dir[DIR_Attr] & AM_DIR)	/* It is a directory */
;;;2529   					res = FR_NO_FILE;
;;;2530   			}
;;;2531   		}
;;;2532   #endif
;;;2533   		FREE_BUF();
;;;2534   
;;;2535   		if (res == FR_OK) {
;;;2536   			fp->flag = mode;					/* File access mode */
;;;2537   			fp->err = 0;						/* Clear error flag */
;;;2538   			fp->sclust = ld_clust(dj.fs, dir);	/* File start cluster */
;;;2539   			fp->fsize = LD_DWORD(dir + DIR_FileSize);	/* File size */
;;;2540   			fp->fptr = 0;						/* File pointer */
;;;2541   			fp->dsect = 0;
;;;2542   #if _USE_FASTSEEK
;;;2543   			fp->cltbl = 0;						/* Normal seek mode */
;;;2544   #endif
;;;2545   			fp->fs = dj.fs;	 					/* Validate file object */
;;;2546   			fp->id = fp->fs->id;
;;;2547   		}
;;;2548   	}
;;;2549   
;;;2550   	LEAVE_FF(dj.fs, res);
;;;2551   }
00000e  b010              ADD      sp,sp,#0x40
000010  e8bd87f0          POP      {r4-r10,pc}
                  |L25.20|
000014  2000              MOVS     r0,#0                 ;2440
000016  6028              STR      r0,[r5,#0]            ;2440
000018  f006061f          AND      r6,r6,#0x1f           ;2444
00001c  f0260201          BIC      r2,r6,#1              ;2445
000020  a90e              ADD      r1,sp,#0x38           ;2445
000022  a804              ADD      r0,sp,#0x10           ;2445
000024  f7fffffe          BL       find_volume
000028  4607              MOV      r7,r0                 ;2445
00002a  2f00              CMP      r7,#0                 ;2450
00002c  d173              BNE      |L25.278|
00002e  f44f7000          MOV      r0,#0x200             ;2451
000032  f7fffffe          BL       ff_memalloc
000036  4681              MOV      r9,r0                 ;2451
000038  f1b90f00          CMP      r9,#0                 ;2451
00003c  d101              BNE      |L25.66|
00003e  2011              MOVS     r0,#0x11              ;2451
000040  e7e5              B        |L25.14|
                  |L25.66|
000042  f8cd902c          STR      r9,[sp,#0x2c]         ;2451
000046  a801              ADD      r0,sp,#4              ;2451
000048  900a              STR      r0,[sp,#0x28]         ;2451
00004a  a804              ADD      r0,sp,#0x10           ;2452
00004c  990e              LDR      r1,[sp,#0x38]         ;2452
00004e  f7fffffe          BL       follow_path
000052  4607              MOV      r7,r0                 ;2452
000054  9c09              LDR      r4,[sp,#0x24]         ;2453
000056  b90f              CBNZ     r7,|L25.92|
000058  b904              CBNZ     r4,|L25.92|
00005a  2706              MOVS     r7,#6                 ;2457
                  |L25.92|
00005c  f006001c          AND      r0,r6,#0x1c           ;2464
000060  2800              CMP      r0,#0                 ;2464
000062  d051              BEQ      |L25.264|
000064  b14f              CBZ      r7,|L25.122|
000066  2f04              CMP      r7,#4                 ;2466
000068  d103              BNE      |L25.114|
00006a  a804              ADD      r0,sp,#0x10           ;2470
00006c  f7fffffe          BL       dir_register
000070  4607              MOV      r7,r0                 ;2470
                  |L25.114|
000072  f0460608          ORR      r6,r6,#8              ;2472
000076  9c09              LDR      r4,[sp,#0x24]         ;2473
000078  e009              B        |L25.142|
                  |L25.122|
00007a  7ae0              LDRB     r0,[r4,#0xb]          ;2476
00007c  f0000011          AND      r0,r0,#0x11           ;2476
000080  b108              CBZ      r0,|L25.134|
000082  2707              MOVS     r7,#7                 ;2477
000084  e003              B        |L25.142|
                  |L25.134|
000086  f0060004          AND      r0,r6,#4              ;2479
00008a  b100              CBZ      r0,|L25.142|
00008c  2708              MOVS     r7,#8                 ;2480
                  |L25.142|
00008e  2f00              CMP      r7,#0                 ;2483
000090  d14a              BNE      |L25.296|
000092  f0060008          AND      r0,r6,#8              ;2483
000096  2800              CMP      r0,#0                 ;2483
000098  d046              BEQ      |L25.296|
00009a  f7fffffe          BL       get_fattime
00009e  4680              MOV      r8,r0                 ;2484
0000a0  f884800e          STRB     r8,[r4,#0xe]          ;2485
0000a4  ea4f2118          LSR      r1,r8,#8              ;2485
0000a8  73e1              STRB     r1,[r4,#0xf]          ;2485
0000aa  ea4f4118          LSR      r1,r8,#16             ;2485
0000ae  7421              STRB     r1,[r4,#0x10]         ;2485
0000b0  ea4f6118          LSR      r1,r8,#24             ;2485
0000b4  7461              STRB     r1,[r4,#0x11]         ;2485
0000b6  2000              MOVS     r0,#0                 ;2486
0000b8  72e0              STRB     r0,[r4,#0xb]          ;2486
0000ba  7720              STRB     r0,[r4,#0x1c]         ;2487
0000bc  2100              MOVS     r1,#0                 ;2487
0000be  7761              STRB     r1,[r4,#0x1d]         ;2487
0000c0  77a1              STRB     r1,[r4,#0x1e]         ;2487
0000c2  77e1              STRB     r1,[r4,#0x1f]         ;2487
0000c4  4621              MOV      r1,r4                 ;2488
0000c6  9804              LDR      r0,[sp,#0x10]         ;2488
0000c8  f7fffffe          BL       ld_clust
0000cc  4682              MOV      r10,r0                ;2488
0000ce  2100              MOVS     r1,#0                 ;2489
0000d0  4620              MOV      r0,r4                 ;2489
0000d2  f7fffffe          BL       st_clust
0000d6  2001              MOVS     r0,#1                 ;2490
0000d8  9904              LDR      r1,[sp,#0x10]         ;2490
0000da  7108              STRB     r0,[r1,#4]            ;2490
0000dc  f1ba0f00          CMP      r10,#0                ;2491
0000e0  d022              BEQ      |L25.296|
0000e2  9804              LDR      r0,[sp,#0x10]         ;2492
0000e4  f8d0802c          LDR      r8,[r0,#0x2c]         ;2492
0000e8  4651              MOV      r1,r10                ;2493
0000ea  9804              LDR      r0,[sp,#0x10]         ;2493
0000ec  f7fffffe          BL       remove_chain
0000f0  4607              MOV      r7,r0                 ;2493
0000f2  b9cf              CBNZ     r7,|L25.296|
0000f4  f1aa0001          SUB      r0,r10,#1             ;2495
0000f8  9904              LDR      r1,[sp,#0x10]         ;2495
0000fa  60c8              STR      r0,[r1,#0xc]          ;2495
0000fc  4641              MOV      r1,r8                 ;2496
0000fe  9804              LDR      r0,[sp,#0x10]         ;2496
000100  f7fffffe          BL       move_window
000104  4607              MOV      r7,r0                 ;2496
000106  e00f              B        |L25.296|
                  |L25.264|
000108  b977              CBNZ     r7,|L25.296|
00010a  7ae0              LDRB     r0,[r4,#0xb]          ;2503
00010c  f0000010          AND      r0,r0,#0x10           ;2503
000110  b110              CBZ      r0,|L25.280|
000112  2704              MOVS     r7,#4                 ;2504
000114  e008              B        |L25.296|
                  |L25.278|
000116  e031              B        |L25.380|
                  |L25.280|
000118  f0060002          AND      r0,r6,#2              ;2506
00011c  b120              CBZ      r0,|L25.296|
00011e  7ae0              LDRB     r0,[r4,#0xb]          ;2506
000120  f0000001          AND      r0,r0,#1              ;2506
000124  b100              CBZ      r0,|L25.296|
000126  2707              MOVS     r7,#7                 ;2507
                  |L25.296|
000128  b947              CBNZ     r7,|L25.316|
00012a  f0060008          AND      r0,r6,#8              ;2512
00012e  b108              CBZ      r0,|L25.308|
000130  f0460620          ORR      r6,r6,#0x20           ;2513
                  |L25.308|
000134  9804              LDR      r0,[sp,#0x10]         ;2514
000136  6ac0              LDR      r0,[r0,#0x2c]         ;2514
000138  61e8              STR      r0,[r5,#0x1c]         ;2514
00013a  622c              STR      r4,[r5,#0x20]         ;2515
                  |L25.316|
00013c  4648              MOV      r0,r9                 ;2533
00013e  f7fffffe          BL       ff_memfree
000142  b9df              CBNZ     r7,|L25.380|
000144  71ae              STRB     r6,[r5,#6]            ;2536
000146  2000              MOVS     r0,#0                 ;2537
000148  71e8              STRB     r0,[r5,#7]            ;2537
00014a  4621              MOV      r1,r4                 ;2538
00014c  9804              LDR      r0,[sp,#0x10]         ;2538
00014e  f7fffffe          BL       ld_clust
000152  6128              STR      r0,[r5,#0x10]         ;2538
000154  7fe0              LDRB     r0,[r4,#0x1f]         ;2539
000156  0601              LSLS     r1,r0,#24             ;2539
000158  7fa0              LDRB     r0,[r4,#0x1e]         ;2539
00015a  ea414100          ORR      r1,r1,r0,LSL #16      ;2539
00015e  7f60              LDRB     r0,[r4,#0x1d]         ;2539
000160  ea412000          ORR      r0,r1,r0,LSL #8       ;2539
000164  7f21              LDRB     r1,[r4,#0x1c]         ;2539
000166  4308              ORRS     r0,r0,r1              ;2539
000168  60e8              STR      r0,[r5,#0xc]          ;2539
00016a  2000              MOVS     r0,#0                 ;2540
00016c  60a8              STR      r0,[r5,#8]            ;2540
00016e  61a8              STR      r0,[r5,#0x18]         ;2541
000170  6268              STR      r0,[r5,#0x24]         ;2543
000172  9804              LDR      r0,[sp,#0x10]         ;2545
000174  6028              STR      r0,[r5,#0]            ;2545
000176  6828              LDR      r0,[r5,#0]            ;2546
000178  88c0              LDRH     r0,[r0,#6]            ;2546
00017a  80a8              STRH     r0,[r5,#4]            ;2546
                  |L25.380|
00017c  4638              MOV      r0,r7                 ;2550
00017e  e746              B        |L25.14|
;;;2552   
                          ENDP


                          AREA ||i.f_opendir||, CODE, READONLY, ALIGN=1

                  f_opendir PROC
;;;3161   
;;;3162   FRESULT f_opendir (
000000  b573              PUSH     {r0,r1,r4-r6,lr}
;;;3163   	DIR* dp,			/* Pointer to directory object to create */
;;;3164   	const TCHAR* path	/* Pointer to the directory path */
;;;3165   )
;;;3166   {
000002  b084              SUB      sp,sp,#0x10
000004  4604              MOV      r4,r0
;;;3167   	FRESULT res;
;;;3168   	FATFS* fs;
;;;3169   	DEFINE_NAMEBUF;
;;;3170   
;;;3171   
;;;3172   	if (!dp) return FR_INVALID_OBJECT;
000006  b914              CBNZ     r4,|L26.14|
000008  2009              MOVS     r0,#9
                  |L26.10|
;;;3173   
;;;3174   	/* Get logical drive number */
;;;3175   	res = find_volume(&fs, &path, 0);
;;;3176   	if (res == FR_OK) {
;;;3177   		dp->fs = fs;
;;;3178   		INIT_BUF(*dp);
;;;3179   		res = follow_path(dp, path);			/* Follow the path to the directory */
;;;3180   		FREE_BUF();
;;;3181   		if (res == FR_OK) {						/* Follow completed */
;;;3182   			if (dp->dir) {						/* It is not the origin directory itself */
;;;3183   				if (dp->dir[DIR_Attr] & AM_DIR)	/* The object is a sub directory */
;;;3184   					dp->sclust = ld_clust(fs, dp->dir);
;;;3185   				else							/* The object is a file */
;;;3186   					res = FR_NO_PATH;
;;;3187   			}
;;;3188   			if (res == FR_OK) {
;;;3189   				dp->id = fs->id;
;;;3190   				res = dir_sdi(dp, 0);			/* Rewind directory */
;;;3191   #if _FS_LOCK
;;;3192   				if (res == FR_OK) {
;;;3193   					if (dp->sclust) {
;;;3194   						dp->lockid = inc_lock(dp, 0);	/* Lock the sub directory */
;;;3195   						if (!dp->lockid)
;;;3196   							res = FR_TOO_MANY_OPEN_FILES;
;;;3197   					} else {
;;;3198   						dp->lockid = 0;	/* Root directory need not to be locked */
;;;3199   					}
;;;3200   				}
;;;3201   #endif
;;;3202   			}
;;;3203   		}
;;;3204   		if (res == FR_NO_FILE) res = FR_NO_PATH;
;;;3205   	}
;;;3206   	if (res != FR_OK) dp->fs = 0;		/* Invalidate the directory object if function faild */
;;;3207   
;;;3208   	LEAVE_FF(fs, res);
;;;3209   }
00000a  b006              ADD      sp,sp,#0x18
00000c  bd70              POP      {r4-r6,pc}
                  |L26.14|
00000e  2200              MOVS     r2,#0                 ;3175
000010  a905              ADD      r1,sp,#0x14           ;3175
000012  a803              ADD      r0,sp,#0xc            ;3175
000014  f7fffffe          BL       find_volume
000018  4605              MOV      r5,r0                 ;3175
00001a  2d00              CMP      r5,#0                 ;3176
00001c  d12f              BNE      |L26.126|
00001e  9803              LDR      r0,[sp,#0xc]          ;3177
000020  6020              STR      r0,[r4,#0]            ;3177
000022  f44f7000          MOV      r0,#0x200             ;3178
000026  f7fffffe          BL       ff_memalloc
00002a  4606              MOV      r6,r0                 ;3178
00002c  b90e              CBNZ     r6,|L26.50|
00002e  2011              MOVS     r0,#0x11              ;3178
000030  e7eb              B        |L26.10|
                  |L26.50|
000032  61e6              STR      r6,[r4,#0x1c]         ;3178
000034  f8c4d018          STR      sp,[r4,#0x18]         ;3178
000038  4620              MOV      r0,r4                 ;3179
00003a  9905              LDR      r1,[sp,#0x14]         ;3179
00003c  f7fffffe          BL       follow_path
000040  4605              MOV      r5,r0                 ;3179
000042  4630              MOV      r0,r6                 ;3180
000044  f7fffffe          BL       ff_memfree
000048  b9b5              CBNZ     r5,|L26.120|
00004a  6960              LDR      r0,[r4,#0x14]         ;3182
00004c  b158              CBZ      r0,|L26.102|
00004e  6960              LDR      r0,[r4,#0x14]         ;3183
000050  7ac0              LDRB     r0,[r0,#0xb]          ;3183
000052  f0000010          AND      r0,r0,#0x10           ;3183
000056  b128              CBZ      r0,|L26.100|
000058  6961              LDR      r1,[r4,#0x14]         ;3184
00005a  9803              LDR      r0,[sp,#0xc]          ;3184
00005c  f7fffffe          BL       ld_clust
000060  60a0              STR      r0,[r4,#8]            ;3184
000062  e000              B        |L26.102|
                  |L26.100|
000064  2505              MOVS     r5,#5                 ;3186
                  |L26.102|
000066  b93d              CBNZ     r5,|L26.120|
000068  9803              LDR      r0,[sp,#0xc]          ;3189
00006a  88c0              LDRH     r0,[r0,#6]            ;3189
00006c  80a0              STRH     r0,[r4,#4]            ;3189
00006e  2100              MOVS     r1,#0                 ;3190
000070  4620              MOV      r0,r4                 ;3190
000072  f7fffffe          BL       dir_sdi
000076  4605              MOV      r5,r0                 ;3190
                  |L26.120|
000078  2d04              CMP      r5,#4                 ;3204
00007a  d100              BNE      |L26.126|
00007c  2505              MOVS     r5,#5                 ;3204
                  |L26.126|
00007e  b10d              CBZ      r5,|L26.132|
000080  2000              MOVS     r0,#0                 ;3206
000082  6020              STR      r0,[r4,#0]            ;3206
                  |L26.132|
000084  4628              MOV      r0,r5                 ;3208
000086  e7c0              B        |L26.10|
;;;3210   
                          ENDP


                          AREA ||i.f_printf||, CODE, READONLY, ALIGN=1

                  f_printf PROC
;;;4555   
;;;4556   int f_printf (
000000  b40f              PUSH     {r0-r3}
;;;4557   	FIL* fp,			/* Pointer to the file object */
;;;4558   	const TCHAR* fmt,	/* Pointer to the format string */
;;;4559   	...					/* Optional arguments... */
;;;4560   )
;;;4561   {
000002  e92d4ff0          PUSH     {r4-r11,lr}
000006  b09b              SUB      sp,sp,#0x6c
;;;4562   	va_list arp;
;;;4563   	BYTE f, r;
;;;4564   	UINT nw, i, j, w;
;;;4565   	DWORD v;
;;;4566   	TCHAR c, d, s[16], *p;
;;;4567   	putbuff pb;
;;;4568   
;;;4569   
;;;4570   	pb.fp = fp;				/* Initialize output buffer */
000008  9824              LDR      r0,[sp,#0x90]
00000a  9001              STR      r0,[sp,#4]
;;;4571   	pb.nchr = pb.idx = 0;
00000c  2000              MOVS     r0,#0
00000e  9002              STR      r0,[sp,#8]
000010  9003              STR      r0,[sp,#0xc]
;;;4572   
;;;4573   	va_start(arp, fmt);
000012  a826              ADD      r0,sp,#0x98
000014  901a              STR      r0,[sp,#0x68]
;;;4574   
;;;4575   	for (;;) {
000016  bf00              NOP      
                  |L27.24|
;;;4576   		c = *fmt++;
000018  9825              LDR      r0,[sp,#0x94]
00001a  f8104b01          LDRB     r4,[r0],#1
00001e  9025              STR      r0,[sp,#0x94]
;;;4577   		if (c == 0) break;			/* End of string */
000020  b904              CBNZ     r4,|L27.36|
000022  e10d              B        |L27.576|
                  |L27.36|
;;;4578   		if (c != '%') {				/* Non escape character */
000024  2c25              CMP      r4,#0x25
000026  d004              BEQ      |L27.50|
;;;4579   			putc_bfd(&pb, c);
000028  4621              MOV      r1,r4
00002a  a801              ADD      r0,sp,#4
00002c  f7fffffe          BL       putc_bfd
;;;4580   			continue;
000030  e7f2              B        |L27.24|
                  |L27.50|
;;;4581   		}
;;;4582   		w = f = 0;
000032  2000              MOVS     r0,#0
000034  4606              MOV      r6,r0
000036  4681              MOV      r9,r0
;;;4583   		c = *fmt++;
000038  9825              LDR      r0,[sp,#0x94]
00003a  f8104b01          LDRB     r4,[r0],#1
00003e  9025              STR      r0,[sp,#0x94]
;;;4584   		if (c == '0') {				/* Flag: '0' padding */
000040  2c30              CMP      r4,#0x30
000042  d105              BNE      |L27.80|
;;;4585   			f = 1; c = *fmt++;
000044  2601              MOVS     r6,#1
000046  9825              LDR      r0,[sp,#0x94]
000048  f8104b01          LDRB     r4,[r0],#1
00004c  9025              STR      r0,[sp,#0x94]
00004e  e006              B        |L27.94|
                  |L27.80|
;;;4586   		} else {
;;;4587   			if (c == '-') {			/* Flag: left justified */
000050  2c2d              CMP      r4,#0x2d
000052  d104              BNE      |L27.94|
;;;4588   				f = 2; c = *fmt++;
000054  2602              MOVS     r6,#2
000056  9825              LDR      r0,[sp,#0x94]
000058  f8104b01          LDRB     r4,[r0],#1
00005c  9025              STR      r0,[sp,#0x94]
                  |L27.94|
;;;4589   			}
;;;4590   		}
;;;4591   		while (IsDigit(c)) {		/* Precision */
00005e  e009              B        |L27.116|
                  |L27.96|
;;;4592   			w = w * 10 + c - '0';
000060  eb090089          ADD      r0,r9,r9,LSL #2
000064  eb040040          ADD      r0,r4,r0,LSL #1
000068  f1a00930          SUB      r9,r0,#0x30
;;;4593   			c = *fmt++;
00006c  9825              LDR      r0,[sp,#0x94]
00006e  f8104b01          LDRB     r4,[r0],#1
000072  9025              STR      r0,[sp,#0x94]
                  |L27.116|
000074  2c30              CMP      r4,#0x30              ;4591
000076  db01              BLT      |L27.124|
000078  2c39              CMP      r4,#0x39              ;4591
00007a  ddf1              BLE      |L27.96|
                  |L27.124|
;;;4594   		}
;;;4595   		if (c == 'l' || c == 'L') {	/* Prefix: Size is long int */
00007c  2c6c              CMP      r4,#0x6c
00007e  d001              BEQ      |L27.132|
000080  2c4c              CMP      r4,#0x4c
000082  d105              BNE      |L27.144|
                  |L27.132|
;;;4596   			f |= 4; c = *fmt++;
000084  f0460604          ORR      r6,r6,#4
000088  9825              LDR      r0,[sp,#0x94]
00008a  f8104b01          LDRB     r4,[r0],#1
00008e  9025              STR      r0,[sp,#0x94]
                  |L27.144|
;;;4597   		}
;;;4598   		if (!c) break;
000090  b904              CBNZ     r4,|L27.148|
000092  e0d5              B        |L27.576|
                  |L27.148|
;;;4599   		d = c;
000094  4625              MOV      r5,r4
;;;4600   		if (IsLower(d)) d -= 0x20;
000096  2d61              CMP      r5,#0x61
000098  db04              BLT      |L27.164|
00009a  2d7a              CMP      r5,#0x7a
00009c  dc02              BGT      |L27.164|
00009e  f1a50020          SUB      r0,r5,#0x20
0000a2  b2c5              UXTB     r5,r0
                  |L27.164|
;;;4601   		switch (d) {				/* Type is... */
0000a4  2d4f              CMP      r5,#0x4f
0000a6  d049              BEQ      |L27.316|
0000a8  dc06              BGT      |L27.184|
0000aa  2d42              CMP      r5,#0x42
0000ac  d043              BEQ      |L27.310|
0000ae  2d43              CMP      r5,#0x43
0000b0  d038              BEQ      |L27.292|
0000b2  2d44              CMP      r5,#0x44
0000b4  d14c              BNE      |L27.336|
0000b6  e044              B        |L27.322|
                  |L27.184|
0000b8  2d53              CMP      r5,#0x53
0000ba  d004              BEQ      |L27.198|
0000bc  2d55              CMP      r5,#0x55
0000be  d041              BEQ      |L27.324|
0000c0  2d58              CMP      r5,#0x58
0000c2  d145              BNE      |L27.336|
0000c4  e041              B        |L27.330|
                  |L27.198|
;;;4602   		case 'S' :					/* String */
;;;4603   			p = va_arg(arp, TCHAR*);
0000c6  981a              LDR      r0,[sp,#0x68]
0000c8  f850bb04          LDR      r11,[r0],#4
0000cc  901a              STR      r0,[sp,#0x68]
;;;4604   			for (j = 0; p[j]; j++) ;
0000ce  f04f0800          MOV      r8,#0
0000d2  e001              B        |L27.216|
                  |L27.212|
0000d4  f1080801          ADD      r8,r8,#1
                  |L27.216|
0000d8  f81b0008          LDRB     r0,[r11,r8]
0000dc  2800              CMP      r0,#0
0000de  d1f9              BNE      |L27.212|
;;;4605   			if (!(f & 2)) {
0000e0  f0060002          AND      r0,r6,#2
0000e4  b948              CBNZ     r0,|L27.250|
;;;4606   				while (j++ < w) putc_bfd(&pb, ' ');
0000e6  e003              B        |L27.240|
                  |L27.232|
0000e8  2120              MOVS     r1,#0x20
0000ea  a801              ADD      r0,sp,#4
0000ec  f7fffffe          BL       putc_bfd
                  |L27.240|
0000f0  4640              MOV      r0,r8
0000f2  f1080801          ADD      r8,r8,#1
0000f6  4548              CMP      r0,r9
0000f8  d3f6              BCC      |L27.232|
                  |L27.250|
;;;4607   			}
;;;4608   			while (*p) putc_bfd(&pb, *p++);
0000fa  e004              B        |L27.262|
                  |L27.252|
0000fc  f81b1b01          LDRB     r1,[r11],#1
000100  a801              ADD      r0,sp,#4
000102  f7fffffe          BL       putc_bfd
                  |L27.262|
000106  f89b0000          LDRB     r0,[r11,#0]
00010a  2800              CMP      r0,#0
00010c  d1f6              BNE      |L27.252|
;;;4609   			while (j++ < w) putc_bfd(&pb, ' ');
00010e  e003              B        |L27.280|
                  |L27.272|
000110  2120              MOVS     r1,#0x20
000112  a801              ADD      r0,sp,#4
000114  f7fffffe          BL       putc_bfd
                  |L27.280|
000118  4640              MOV      r0,r8
00011a  f1080801          ADD      r8,r8,#1
00011e  4548              CMP      r0,r9
000120  d3f6              BCC      |L27.272|
;;;4610   			continue;
000122  e779              B        |L27.24|
                  |L27.292|
;;;4611   		case 'C' :					/* Character */
;;;4612   			putc_bfd(&pb, (TCHAR)va_arg(arp, int)); continue;
000124  981a              LDR      r0,[sp,#0x68]
000126  f8102b04          LDRB     r2,[r0],#4
00012a  b2d1              UXTB     r1,r2
00012c  901a              STR      r0,[sp,#0x68]
00012e  a801              ADD      r0,sp,#4
000130  f7fffffe          BL       putc_bfd
000134  e770              B        |L27.24|
                  |L27.310|
;;;4613   		case 'B' :					/* Binary */
;;;4614   			r = 2; break;
000136  2002              MOVS     r0,#2
000138  9019              STR      r0,[sp,#0x64]
00013a  e00e              B        |L27.346|
                  |L27.316|
;;;4615   		case 'O' :					/* Octal */
;;;4616   			r = 8; break;
00013c  2008              MOVS     r0,#8
00013e  9019              STR      r0,[sp,#0x64]
000140  e00b              B        |L27.346|
                  |L27.322|
;;;4617   		case 'D' :					/* Signed decimal */
;;;4618   		case 'U' :					/* Unsigned decimal */
000142  bf00              NOP      
                  |L27.324|
;;;4619   			r = 10; break;
000144  200a              MOVS     r0,#0xa
000146  9019              STR      r0,[sp,#0x64]
000148  e007              B        |L27.346|
                  |L27.330|
;;;4620   		case 'X' :					/* Hexdecimal */
;;;4621   			r = 16; break;
00014a  2010              MOVS     r0,#0x10
00014c  9019              STR      r0,[sp,#0x64]
00014e  e004              B        |L27.346|
                  |L27.336|
;;;4622   		default:					/* Unknown type (pass-through) */
;;;4623   			putc_bfd(&pb, c); continue;
000150  4621              MOV      r1,r4
000152  a801              ADD      r0,sp,#4
000154  f7fffffe          BL       putc_bfd
000158  e75e              B        |L27.24|
                  |L27.346|
00015a  bf00              NOP                            ;4614
;;;4624   		}
;;;4625   
;;;4626   		/* Get an argument and put it in numeral */
;;;4627   		v = (f & 4) ? (DWORD)va_arg(arp, long) : ((d == 'D') ? (DWORD)(long)va_arg(arp, int) : (DWORD)va_arg(arp, unsigned int));
00015c  f0060004          AND      r0,r6,#4
000160  b128              CBZ      r0,|L27.366|
000162  981a              LDR      r0,[sp,#0x68]
000164  6800              LDR      r0,[r0,#0]
000166  991a              LDR      r1,[sp,#0x68]
000168  1d09              ADDS     r1,r1,#4
00016a  911a              STR      r1,[sp,#0x68]
00016c  e00c              B        |L27.392|
                  |L27.366|
00016e  2d44              CMP      r5,#0x44
000170  d105              BNE      |L27.382|
000172  981a              LDR      r0,[sp,#0x68]
000174  6800              LDR      r0,[r0,#0]
000176  991a              LDR      r1,[sp,#0x68]
000178  1d09              ADDS     r1,r1,#4
00017a  911a              STR      r1,[sp,#0x68]
00017c  e004              B        |L27.392|
                  |L27.382|
00017e  981a              LDR      r0,[sp,#0x68]
000180  6800              LDR      r0,[r0,#0]
000182  991a              LDR      r1,[sp,#0x68]
000184  1d09              ADDS     r1,r1,#4
000186  911a              STR      r1,[sp,#0x68]
                  |L27.392|
000188  4682              MOV      r10,r0
;;;4628   		if (d == 'D' && (v & 0x80000000)) {
00018a  2d44              CMP      r5,#0x44
00018c  d106              BNE      |L27.412|
00018e  f00a4000          AND      r0,r10,#0x80000000
000192  b118              CBZ      r0,|L27.412|
;;;4629   			v = 0 - v;
000194  f1ca0a00          RSB      r10,r10,#0
;;;4630   			f |= 8;
000198  f0460608          ORR      r6,r6,#8
                  |L27.412|
;;;4631   		}
;;;4632   		i = 0;
00019c  2700              MOVS     r7,#0
;;;4633   		do {
00019e  bf00              NOP      
                  |L27.416|
;;;4634   			d = (TCHAR)(v % r); v /= r;
0001a0  9819              LDR      r0,[sp,#0x64]
0001a2  fbbaf1f0          UDIV     r1,r10,r0
0001a6  fb00a011          MLS      r0,r0,r1,r10
0001aa  b2c5              UXTB     r5,r0
0001ac  9819              LDR      r0,[sp,#0x64]
0001ae  fbbafaf0          UDIV     r10,r10,r0
;;;4635   			if (d > 9) d += (c == 'x') ? 0x27 : 0x07;
0001b2  2d09              CMP      r5,#9
0001b4  dd06              BLE      |L27.452|
0001b6  2c78              CMP      r4,#0x78
0001b8  d101              BNE      |L27.446|
0001ba  2027              MOVS     r0,#0x27
0001bc  e000              B        |L27.448|
                  |L27.446|
0001be  2007              MOVS     r0,#7
                  |L27.448|
0001c0  4428              ADD      r0,r0,r5
0001c2  b2c5              UXTB     r5,r0
                  |L27.452|
;;;4636   			s[i++] = d + '0';
0001c4  f1050030          ADD      r0,r5,#0x30
0001c8  b2c2              UXTB     r2,r0
0001ca  4638              MOV      r0,r7
0001cc  1c7f              ADDS     r7,r7,#1
0001ce  a914              ADD      r1,sp,#0x50
0001d0  540a              STRB     r2,[r1,r0]
;;;4637   		} while (v && i < sizeof s / sizeof s[0]);
0001d2  f1ba0f00          CMP      r10,#0
0001d6  d001              BEQ      |L27.476|
0001d8  2f10              CMP      r7,#0x10
0001da  d3e1              BCC      |L27.416|
                  |L27.476|
;;;4638   		if (f & 8) s[i++] = '-';
0001dc  f0060008          AND      r0,r6,#8
0001e0  b120              CBZ      r0,|L27.492|
0001e2  222d              MOVS     r2,#0x2d
0001e4  4638              MOV      r0,r7
0001e6  1c7f              ADDS     r7,r7,#1
0001e8  a914              ADD      r1,sp,#0x50
0001ea  540a              STRB     r2,[r1,r0]
                  |L27.492|
;;;4639   		j = i; d = (f & 1) ? '0' : ' ';
0001ec  46b8              MOV      r8,r7
0001ee  f0060001          AND      r0,r6,#1
0001f2  b108              CBZ      r0,|L27.504|
0001f4  2030              MOVS     r0,#0x30
0001f6  e000              B        |L27.506|
                  |L27.504|
0001f8  2020              MOVS     r0,#0x20
                  |L27.506|
0001fa  4605              MOV      r5,r0
;;;4640   		while (!(f & 2) && j++ < w) putc_bfd(&pb, d);
0001fc  e003              B        |L27.518|
                  |L27.510|
0001fe  4629              MOV      r1,r5
000200  a801              ADD      r0,sp,#4
000202  f7fffffe          BL       putc_bfd
                  |L27.518|
000206  f0060002          AND      r0,r6,#2
00020a  b920              CBNZ     r0,|L27.534|
00020c  4640              MOV      r0,r8
00020e  f1080801          ADD      r8,r8,#1
000212  4548              CMP      r0,r9
000214  d3f3              BCC      |L27.510|
                  |L27.534|
;;;4641   		do putc_bfd(&pb, s[--i]); while (i);
000216  bf00              NOP      
                  |L27.536|
000218  1e78              SUBS     r0,r7,#1
00021a  4607              MOV      r7,r0
00021c  aa14              ADD      r2,sp,#0x50
00021e  5c11              LDRB     r1,[r2,r0]
000220  a801              ADD      r0,sp,#4
000222  f7fffffe          BL       putc_bfd
000226  2f00              CMP      r7,#0
000228  d1f6              BNE      |L27.536|
;;;4642   		while (j++ < w) putc_bfd(&pb, d);
00022a  e003              B        |L27.564|
                  |L27.556|
00022c  4629              MOV      r1,r5
00022e  a801              ADD      r0,sp,#4
000230  f7fffffe          BL       putc_bfd
                  |L27.564|
000234  4640              MOV      r0,r8
000236  f1080801          ADD      r8,r8,#1
00023a  4548              CMP      r0,r9
00023c  d3f6              BCC      |L27.556|
00023e  e6eb              B        |L27.24|
                  |L27.576|
000240  bf00              NOP                            ;4577
;;;4643   	}
;;;4644   
;;;4645   	va_end(arp);
000242  2000              MOVS     r0,#0
000244  901a              STR      r0,[sp,#0x68]
;;;4646   
;;;4647   	if (   pb.idx >= 0		/* Flush buffered characters to the file */
000246  9802              LDR      r0,[sp,#8]
000248  2800              CMP      r0,#0
00024a  db10              BLT      |L27.622|
;;;4648   		&& f_write(pb.fp, pb.buf, (UINT)pb.idx, &nw) == FR_OK
00024c  ab18              ADD      r3,sp,#0x60
00024e  a904              ADD      r1,sp,#0x10
000250  e9dd0201          LDRD     r0,r2,[sp,#4]
000254  f7fffffe          BL       f_write
000258  b948              CBNZ     r0,|L27.622|
;;;4649   		&& (UINT)pb.idx == nw) return pb.nchr;
00025a  9918              LDR      r1,[sp,#0x60]
00025c  9802              LDR      r0,[sp,#8]
00025e  4288              CMP      r0,r1
000260  d105              BNE      |L27.622|
000262  9803              LDR      r0,[sp,#0xc]
                  |L27.612|
;;;4650   	return EOF;
;;;4651   }
000264  b01b              ADD      sp,sp,#0x6c
000266  e8bd0ff0          POP      {r4-r11}
00026a  f85dfb14          LDR      pc,[sp],#0x14
                  |L27.622|
00026e  f04f30ff          MOV      r0,#0xffffffff        ;4650
000272  e7f7              B        |L27.612|
;;;4652   
                          ENDP


                          AREA ||i.f_putc||, CODE, READONLY, ALIGN=1

                  f_putc PROC
;;;4500   
;;;4501   int f_putc (
000000  b530              PUSH     {r4,r5,lr}
;;;4502   	TCHAR c,	/* A character to be output */
;;;4503   	FIL* fp		/* Pointer to the file object */
;;;4504   )
;;;4505   {
000002  b095              SUB      sp,sp,#0x54
000004  4604              MOV      r4,r0
000006  460d              MOV      r5,r1
;;;4506   	putbuff pb;
;;;4507   	UINT nw;
;;;4508   
;;;4509   
;;;4510   	pb.fp = fp;			/* Initialize output buffer */
000008  9502              STR      r5,[sp,#8]
;;;4511   	pb.nchr = pb.idx = 0;
00000a  2000              MOVS     r0,#0
00000c  9003              STR      r0,[sp,#0xc]
00000e  9004              STR      r0,[sp,#0x10]
;;;4512   
;;;4513   	putc_bfd(&pb, c);	/* Put a character */
000010  4621              MOV      r1,r4
000012  a802              ADD      r0,sp,#8
000014  f7fffffe          BL       putc_bfd
;;;4514   
;;;4515   	if (   pb.idx >= 0	/* Flush buffered characters to the file */
000018  9803              LDR      r0,[sp,#0xc]
00001a  2800              CMP      r0,#0
00001c  db0d              BLT      |L28.58|
;;;4516   		&& f_write(pb.fp, pb.buf, (UINT)pb.idx, &nw) == FR_OK
00001e  ab01              ADD      r3,sp,#4
000020  a905              ADD      r1,sp,#0x14
000022  e9dd0202          LDRD     r0,r2,[sp,#8]
000026  f7fffffe          BL       f_write
00002a  b930              CBNZ     r0,|L28.58|
;;;4517   		&& (UINT)pb.idx == nw) return pb.nchr;
00002c  9901              LDR      r1,[sp,#4]
00002e  9803              LDR      r0,[sp,#0xc]
000030  4288              CMP      r0,r1
000032  d102              BNE      |L28.58|
000034  9804              LDR      r0,[sp,#0x10]
                  |L28.54|
;;;4518   	return EOF;
;;;4519   }
000036  b015              ADD      sp,sp,#0x54
000038  bd30              POP      {r4,r5,pc}
                  |L28.58|
00003a  f04f30ff          MOV      r0,#0xffffffff        ;4518
00003e  e7fa              B        |L28.54|
;;;4520   
                          ENDP


                          AREA ||i.f_puts||, CODE, READONLY, ALIGN=1

                  f_puts PROC
;;;4527   
;;;4528   int f_puts (
000000  b530              PUSH     {r4,r5,lr}
;;;4529   	const TCHAR* str,	/* Pointer to the string to be output */
;;;4530   	FIL* fp				/* Pointer to the file object */
;;;4531   )
;;;4532   {
000002  b095              SUB      sp,sp,#0x54
000004  4604              MOV      r4,r0
000006  460d              MOV      r5,r1
;;;4533   	putbuff pb;
;;;4534   	UINT nw;
;;;4535   
;;;4536   
;;;4537   	pb.fp = fp;				/* Initialize output buffer */
000008  9502              STR      r5,[sp,#8]
;;;4538   	pb.nchr = pb.idx = 0;
00000a  2000              MOVS     r0,#0
00000c  9003              STR      r0,[sp,#0xc]
00000e  9004              STR      r0,[sp,#0x10]
;;;4539   
;;;4540   	while (*str)			/* Put the string */
000010  e004              B        |L29.28|
                  |L29.18|
;;;4541   		putc_bfd(&pb, *str++);
000012  f8141b01          LDRB     r1,[r4],#1
000016  a802              ADD      r0,sp,#8
000018  f7fffffe          BL       putc_bfd
                  |L29.28|
00001c  7820              LDRB     r0,[r4,#0]            ;4540
00001e  2800              CMP      r0,#0                 ;4540
000020  d1f7              BNE      |L29.18|
;;;4542   
;;;4543   	if (   pb.idx >= 0		/* Flush buffered characters to the file */
000022  9803              LDR      r0,[sp,#0xc]
000024  2800              CMP      r0,#0
000026  db0d              BLT      |L29.68|
;;;4544   		&& f_write(pb.fp, pb.buf, (UINT)pb.idx, &nw) == FR_OK
000028  ab01              ADD      r3,sp,#4
00002a  a905              ADD      r1,sp,#0x14
00002c  e9dd0202          LDRD     r0,r2,[sp,#8]
000030  f7fffffe          BL       f_write
000034  b930              CBNZ     r0,|L29.68|
;;;4545   		&& (UINT)pb.idx == nw) return pb.nchr;
000036  9901              LDR      r1,[sp,#4]
000038  9803              LDR      r0,[sp,#0xc]
00003a  4288              CMP      r0,r1
00003c  d102              BNE      |L29.68|
00003e  9804              LDR      r0,[sp,#0x10]
                  |L29.64|
;;;4546   	return EOF;
;;;4547   }
000040  b015              ADD      sp,sp,#0x54
000042  bd30              POP      {r4,r5,pc}
                  |L29.68|
000044  f04f30ff          MOV      r0,#0xffffffff        ;4546
000048  e7fa              B        |L29.64|
;;;4548   
                          ENDP


                          AREA ||i.f_read||, CODE, READONLY, ALIGN=1

                  f_read PROC
;;;2559   
;;;2560   FRESULT f_read (
000000  e92d4fff          PUSH     {r0-r11,lr}
;;;2561   	FIL* fp, 		/* Pointer to the file object */
;;;2562   	void* buff,		/* Pointer to data buffer */
;;;2563   	UINT btr,		/* Number of bytes to read */
;;;2564   	UINT* br		/* Pointer to number of bytes read */
;;;2565   )
;;;2566   {
000004  b083              SUB      sp,sp,#0xc
000006  4604              MOV      r4,r0
000008  4615              MOV      r5,r2
00000a  469a              MOV      r10,r3
;;;2567   	FRESULT res;
;;;2568   	DWORD clst, sect, remain;
;;;2569   	UINT rcnt, cc;
;;;2570   	BYTE csect, *rbuff = (BYTE*)buff;
00000c  f8ddb010          LDR      r11,[sp,#0x10]
;;;2571   
;;;2572   
;;;2573   	*br = 0;	/* Clear read byte counter */
000010  2000              MOVS     r0,#0
000012  f8ca0000          STR      r0,[r10,#0]
;;;2574   
;;;2575   	res = validate(fp);							/* Check validity */
000016  4620              MOV      r0,r4
000018  f7fffffe          BL       validate
00001c  9002              STR      r0,[sp,#8]
;;;2576   	if (res != FR_OK) LEAVE_FF(fp->fs, res);
00001e  9802              LDR      r0,[sp,#8]
000020  b118              CBZ      r0,|L30.42|
000022  9802              LDR      r0,[sp,#8]
                  |L30.36|
;;;2577   	if (fp->err)								/* Check error */
;;;2578   		LEAVE_FF(fp->fs, (FRESULT)fp->err);
;;;2579   	if (!(fp->flag & FA_READ)) 					/* Check access mode */
;;;2580   		LEAVE_FF(fp->fs, FR_DENIED);
;;;2581   	remain = fp->fsize - fp->fptr;
;;;2582   	if (btr > remain) btr = (UINT)remain;		/* Truncate btr by remaining bytes */
;;;2583   
;;;2584   	for ( ;  btr;								/* Repeat until all data read */
;;;2585   		rbuff += rcnt, fp->fptr += rcnt, *br += rcnt, btr -= rcnt) {
;;;2586   		if ((fp->fptr % SS(fp->fs)) == 0) {		/* On the sector boundary? */
;;;2587   			csect = (BYTE)(fp->fptr / SS(fp->fs) & (fp->fs->csize - 1));	/* Sector offset in the cluster */
;;;2588   			if (!csect) {						/* On the cluster boundary? */
;;;2589   				if (fp->fptr == 0) {			/* On the top of the file? */
;;;2590   					clst = fp->sclust;			/* Follow from the origin */
;;;2591   				} else {						/* Middle or end of the file */
;;;2592   #if _USE_FASTSEEK
;;;2593   					if (fp->cltbl)
;;;2594   						clst = clmt_clust(fp, fp->fptr);	/* Get cluster# from the CLMT */
;;;2595   					else
;;;2596   #endif
;;;2597   						clst = get_fat(fp->fs, fp->clust);	/* Follow cluster chain on the FAT */
;;;2598   				}
;;;2599   				if (clst < 2) ABORT(fp->fs, FR_INT_ERR);
;;;2600   				if (clst == 0xFFFFFFFF) ABORT(fp->fs, FR_DISK_ERR);
;;;2601   				fp->clust = clst;				/* Update current cluster */
;;;2602   			}
;;;2603   			sect = clust2sect(fp->fs, fp->clust);	/* Get current sector */
;;;2604   			if (!sect) ABORT(fp->fs, FR_INT_ERR);
;;;2605   			sect += csect;
;;;2606   			cc = btr / SS(fp->fs);				/* When remaining bytes >= sector size, */
;;;2607   			if (cc) {							/* Read maximum contiguous sectors directly */
;;;2608   				if (csect + cc > fp->fs->csize)	/* Clip at cluster boundary */
;;;2609   					cc = fp->fs->csize - csect;
;;;2610   				if (disk_read(fp->fs->drv, rbuff, sect, cc) != RES_OK)
;;;2611   					ABORT(fp->fs, FR_DISK_ERR);
;;;2612   #if !_FS_READONLY && _FS_MINIMIZE <= 2			/* Replace one of the read sectors with cached data if it contains a dirty sector */
;;;2613   #if _FS_TINY
;;;2614   				if (fp->fs->wflag && fp->fs->winsect - sect < cc)
;;;2615   					mem_cpy(rbuff + ((fp->fs->winsect - sect) * SS(fp->fs)), fp->fs->win, SS(fp->fs));
;;;2616   #else
;;;2617   				if ((fp->flag & FA__DIRTY) && fp->dsect - sect < cc)
;;;2618   					mem_cpy(rbuff + ((fp->dsect - sect) * SS(fp->fs)), fp->buf, SS(fp->fs));
;;;2619   #endif
;;;2620   #endif
;;;2621   				rcnt = SS(fp->fs) * cc;			/* Number of bytes transferred */
;;;2622   				continue;
;;;2623   			}
;;;2624   #if !_FS_TINY
;;;2625   			if (fp->dsect != sect) {			/* Load data sector if not in cache */
;;;2626   #if !_FS_READONLY
;;;2627   				if (fp->flag & FA__DIRTY) {		/* Write-back dirty sector cache */
;;;2628   					if (disk_write(fp->fs->drv, fp->buf, fp->dsect, 1) != RES_OK)
;;;2629   						ABORT(fp->fs, FR_DISK_ERR);
;;;2630   					fp->flag &= ~FA__DIRTY;
;;;2631   				}
;;;2632   #endif
;;;2633   				if (disk_read(fp->fs->drv, fp->buf, sect, 1) != RES_OK)	/* Fill sector cache */
;;;2634   					ABORT(fp->fs, FR_DISK_ERR);
;;;2635   			}
;;;2636   #endif
;;;2637   			fp->dsect = sect;
;;;2638   		}
;;;2639   		rcnt = SS(fp->fs) - ((UINT)fp->fptr % SS(fp->fs));	/* Get partial sector data from sector buffer */
;;;2640   		if (rcnt > btr) rcnt = btr;
;;;2641   #if _FS_TINY
;;;2642   		if (move_window(fp->fs, fp->dsect) != FR_OK)		/* Move sector window */
;;;2643   			ABORT(fp->fs, FR_DISK_ERR);
;;;2644   		mem_cpy(rbuff, &fp->fs->win[fp->fptr % SS(fp->fs)], rcnt);	/* Pick partial sector */
;;;2645   #else
;;;2646   		mem_cpy(rbuff, &fp->buf[fp->fptr % SS(fp->fs)], rcnt);	/* Pick partial sector */
;;;2647   #endif
;;;2648   	}
;;;2649   
;;;2650   	LEAVE_FF(fp->fs, FR_OK);
;;;2651   }
000024  b007              ADD      sp,sp,#0x1c
000026  e8bd8ff0          POP      {r4-r11,pc}
                  |L30.42|
00002a  79e0              LDRB     r0,[r4,#7]            ;2577
00002c  b108              CBZ      r0,|L30.50|
00002e  79e0              LDRB     r0,[r4,#7]            ;2578
000030  e7f8              B        |L30.36|
                  |L30.50|
000032  79a0              LDRB     r0,[r4,#6]            ;2579
000034  f0000001          AND      r0,r0,#1              ;2579
000038  b908              CBNZ     r0,|L30.62|
00003a  2007              MOVS     r0,#7                 ;2580
00003c  e7f2              B        |L30.36|
                  |L30.62|
00003e  e9d41002          LDRD     r1,r0,[r4,#8]         ;2581
000042  1a40              SUBS     r0,r0,r1              ;2581
000044  9000              STR      r0,[sp,#0]            ;2581
000046  9800              LDR      r0,[sp,#0]            ;2582
000048  4285              CMP      r5,r0                 ;2582
00004a  d900              BLS      |L30.78|
00004c  9d00              LDR      r5,[sp,#0]            ;2582
                  |L30.78|
00004e  e0aa              B        |L30.422|
                  |L30.80|
000050  8920              LDRH     r0,[r4,#8]            ;2586
000052  f3c00008          UBFX     r0,r0,#0,#9           ;2586
000056  2800              CMP      r0,#0                 ;2586
000058  d176              BNE      |L30.328|
00005a  6820              LDR      r0,[r4,#0]            ;2587
00005c  7880              LDRB     r0,[r0,#2]            ;2587
00005e  1e40              SUBS     r0,r0,#1              ;2587
000060  68a1              LDR      r1,[r4,#8]            ;2587
000062  ea002051          AND      r0,r0,r1,LSR #9       ;2587
000066  f00009ff          AND      r9,r0,#0xff           ;2587
00006a  f1b90f00          CMP      r9,#0                 ;2588
00006e  d11f              BNE      |L30.176|
000070  68a0              LDR      r0,[r4,#8]            ;2589
000072  b910              CBNZ     r0,|L30.122|
000074  6920              LDR      r0,[r4,#0x10]         ;2590
000076  9001              STR      r0,[sp,#4]            ;2590
000078  e00c              B        |L30.148|
                  |L30.122|
00007a  6a60              LDR      r0,[r4,#0x24]         ;2593
00007c  b128              CBZ      r0,|L30.138|
00007e  4620              MOV      r0,r4                 ;2594
000080  68a1              LDR      r1,[r4,#8]            ;2594
000082  f7fffffe          BL       clmt_clust
000086  9001              STR      r0,[sp,#4]            ;2594
000088  e004              B        |L30.148|
                  |L30.138|
00008a  6961              LDR      r1,[r4,#0x14]         ;2597
00008c  6820              LDR      r0,[r4,#0]            ;2597
00008e  f7fffffe          BL       get_fat
000092  9001              STR      r0,[sp,#4]            ;2597
                  |L30.148|
000094  9801              LDR      r0,[sp,#4]            ;2599
000096  2802              CMP      r0,#2                 ;2599
000098  d202              BCS      |L30.160|
00009a  2002              MOVS     r0,#2                 ;2599
00009c  71e0              STRB     r0,[r4,#7]            ;2599
00009e  e7c1              B        |L30.36|
                  |L30.160|
0000a0  9801              LDR      r0,[sp,#4]            ;2600
0000a2  1c40              ADDS     r0,r0,#1              ;2600
0000a4  b910              CBNZ     r0,|L30.172|
0000a6  2001              MOVS     r0,#1                 ;2600
0000a8  71e0              STRB     r0,[r4,#7]            ;2600
0000aa  e7bb              B        |L30.36|
                  |L30.172|
0000ac  9801              LDR      r0,[sp,#4]            ;2601
0000ae  6160              STR      r0,[r4,#0x14]         ;2601
                  |L30.176|
0000b0  6961              LDR      r1,[r4,#0x14]         ;2603
0000b2  6820              LDR      r0,[r4,#0]            ;2603
0000b4  f7fffffe          BL       clust2sect
0000b8  4606              MOV      r6,r0                 ;2603
0000ba  b916              CBNZ     r6,|L30.194|
0000bc  2002              MOVS     r0,#2                 ;2604
0000be  71e0              STRB     r0,[r4,#7]            ;2604
0000c0  e7b0              B        |L30.36|
                  |L30.194|
0000c2  444e              ADD      r6,r6,r9              ;2605
0000c4  ea4f2855          LSR      r8,r5,#9              ;2606
0000c8  f1b80f00          CMP      r8,#0                 ;2607
0000cc  d029              BEQ      |L30.290|
0000ce  eb090008          ADD      r0,r9,r8              ;2608
0000d2  6821              LDR      r1,[r4,#0]            ;2608
0000d4  7889              LDRB     r1,[r1,#2]            ;2608
0000d6  4288              CMP      r0,r1                 ;2608
0000d8  d903              BLS      |L30.226|
0000da  6820              LDR      r0,[r4,#0]            ;2609
0000dc  7880              LDRB     r0,[r0,#2]            ;2609
0000de  eba00809          SUB      r8,r0,r9              ;2609
                  |L30.226|
0000e2  6821              LDR      r1,[r4,#0]            ;2610
0000e4  7848              LDRB     r0,[r1,#1]            ;2610
0000e6  4643              MOV      r3,r8                 ;2610
0000e8  4632              MOV      r2,r6                 ;2610
0000ea  4659              MOV      r1,r11                ;2610
0000ec  f7fffffe          BL       disk_read
0000f0  b110              CBZ      r0,|L30.248|
0000f2  2001              MOVS     r0,#1                 ;2611
0000f4  71e0              STRB     r0,[r4,#7]            ;2611
0000f6  e795              B        |L30.36|
                  |L30.248|
0000f8  79a0              LDRB     r0,[r4,#6]            ;2617
0000fa  f0000040          AND      r0,r0,#0x40           ;2617
0000fe  b168              CBZ      r0,|L30.284|
000100  69a0              LDR      r0,[r4,#0x18]         ;2617
000102  1b80              SUBS     r0,r0,r6              ;2617
000104  4540              CMP      r0,r8                 ;2617
000106  d209              BCS      |L30.284|
000108  69a1              LDR      r1,[r4,#0x18]         ;2618
00010a  1b89              SUBS     r1,r1,r6              ;2618
00010c  eb0b2041          ADD      r0,r11,r1,LSL #9      ;2618
000110  f44f7200          MOV      r2,#0x200             ;2618
000114  f1040128          ADD      r1,r4,#0x28           ;2618
000118  f7fffffe          BL       mem_cpy
                  |L30.284|
00011c  ea4f2748          LSL      r7,r8,#9              ;2621
000120  e037              B        |L30.402|
                  |L30.290|
000122  69a0              LDR      r0,[r4,#0x18]         ;2625
000124  42b0              CMP      r0,r6                 ;2625
000126  d020              BEQ      |L30.362|
000128  79a0              LDRB     r0,[r4,#6]            ;2627
00012a  f0000040          AND      r0,r0,#0x40           ;2627
00012e  b180              CBZ      r0,|L30.338|
000130  6821              LDR      r1,[r4,#0]            ;2628
000132  7848              LDRB     r0,[r1,#1]            ;2628
000134  2301              MOVS     r3,#1                 ;2628
000136  f1040128          ADD      r1,r4,#0x28           ;2628
00013a  69a2              LDR      r2,[r4,#0x18]         ;2628
00013c  f7fffffe          BL       disk_write
000140  b118              CBZ      r0,|L30.330|
000142  2001              MOVS     r0,#1                 ;2629
000144  71e0              STRB     r0,[r4,#7]            ;2629
000146  e76d              B        |L30.36|
                  |L30.328|
000148  e010              B        |L30.364|
                  |L30.330|
00014a  79a0              LDRB     r0,[r4,#6]            ;2630
00014c  f0200040          BIC      r0,r0,#0x40           ;2630
000150  71a0              STRB     r0,[r4,#6]            ;2630
                  |L30.338|
000152  6821              LDR      r1,[r4,#0]            ;2633
000154  7848              LDRB     r0,[r1,#1]            ;2633
000156  2301              MOVS     r3,#1                 ;2633
000158  4632              MOV      r2,r6                 ;2633
00015a  f1040128          ADD      r1,r4,#0x28           ;2633
00015e  f7fffffe          BL       disk_read
000162  b110              CBZ      r0,|L30.362|
000164  2001              MOVS     r0,#1                 ;2634
000166  71e0              STRB     r0,[r4,#7]            ;2634
000168  e75c              B        |L30.36|
                  |L30.362|
00016a  61a6              STR      r6,[r4,#0x18]         ;2637
                  |L30.364|
00016c  8920              LDRH     r0,[r4,#8]            ;2639
00016e  f3c00008          UBFX     r0,r0,#0,#9           ;2639
000172  f5c07700          RSB      r7,r0,#0x200          ;2639
000176  42af              CMP      r7,r5                 ;2640
000178  d900              BLS      |L30.380|
00017a  462f              MOV      r7,r5                 ;2640
                  |L30.380|
00017c  8920              LDRH     r0,[r4,#8]            ;2646
00017e  f3c00208          UBFX     r2,r0,#0,#9           ;2646
000182  f1040028          ADD      r0,r4,#0x28           ;2646
000186  1811              ADDS     r1,r2,r0              ;2646
000188  463a              MOV      r2,r7                 ;2646
00018a  4658              MOV      r0,r11                ;2646
00018c  f7fffffe          BL       mem_cpy
000190  bf00              NOP                            ;2622
                  |L30.402|
000192  44bb              ADD      r11,r11,r7            ;2585
000194  68a0              LDR      r0,[r4,#8]            ;2585
000196  4438              ADD      r0,r0,r7              ;2585
000198  60a0              STR      r0,[r4,#8]            ;2585
00019a  f8da0000          LDR      r0,[r10,#0]           ;2585
00019e  4438              ADD      r0,r0,r7              ;2585
0001a0  f8ca0000          STR      r0,[r10,#0]           ;2585
0001a4  1bed              SUBS     r5,r5,r7              ;2585
                  |L30.422|
0001a6  2d00              CMP      r5,#0                 ;2584
0001a8  f47faf52          BNE      |L30.80|
0001ac  2000              MOVS     r0,#0                 ;2650
0001ae  e739              B        |L30.36|
;;;2652   
                          ENDP


                          AREA ||i.f_readdir||, CODE, READONLY, ALIGN=1

                  f_readdir PROC
;;;3249   
;;;3250   FRESULT f_readdir (
000000  b5fe              PUSH     {r1-r7,lr}
;;;3251   	DIR* dp,			/* Pointer to the open directory object */
;;;3252   	FILINFO* fno		/* Pointer to file information to return */
;;;3253   )
;;;3254   {
000002  4604              MOV      r4,r0
000004  460f              MOV      r7,r1
;;;3255   	FRESULT res;
;;;3256   	DEFINE_NAMEBUF;
;;;3257   
;;;3258   
;;;3259   	res = validate(dp);						/* Check validity of the object */
000006  4620              MOV      r0,r4
000008  f7fffffe          BL       validate
00000c  4605              MOV      r5,r0
;;;3260   	if (res == FR_OK) {
00000e  2d00              CMP      r5,#0
000010  d12d              BNE      |L31.110|
;;;3261   		if (!fno) {
000012  b92f              CBNZ     r7,|L31.32|
;;;3262   			res = dir_sdi(dp, 0);			/* Rewind the directory object */
000014  2100              MOVS     r1,#0
000016  4620              MOV      r0,r4
000018  f7fffffe          BL       dir_sdi
00001c  4605              MOV      r5,r0
00001e  e026              B        |L31.110|
                  |L31.32|
;;;3263   		} else {
;;;3264   			INIT_BUF(*dp);
000020  f44f7000          MOV      r0,#0x200
000024  f7fffffe          BL       ff_memalloc
000028  4606              MOV      r6,r0
00002a  b90e              CBNZ     r6,|L31.48|
00002c  2011              MOVS     r0,#0x11
                  |L31.46|
;;;3265   			res = dir_read(dp, 0);			/* Read an item */
;;;3266   			if (res == FR_NO_FILE) {		/* Reached end of directory */
;;;3267   				dp->sect = 0;
;;;3268   				res = FR_OK;
;;;3269   			}
;;;3270   			if (res == FR_OK) {				/* A valid entry is found */
;;;3271   				get_fileinfo(dp, fno);		/* Get the object information */
;;;3272   				res = dir_next(dp, 0);		/* Increment index for next */
;;;3273   				if (res == FR_NO_FILE) {
;;;3274   					dp->sect = 0;
;;;3275   					res = FR_OK;
;;;3276   				}
;;;3277   			}
;;;3278   			FREE_BUF();
;;;3279   		}
;;;3280   	}
;;;3281   
;;;3282   	LEAVE_FF(dp->fs, res);
;;;3283   }
00002e  bdfe              POP      {r1-r7,pc}
                  |L31.48|
000030  61e6              STR      r6,[r4,#0x1c]         ;3264
000032  f8c4d018          STR      sp,[r4,#0x18]         ;3264
000036  2100              MOVS     r1,#0                 ;3265
000038  4620              MOV      r0,r4                 ;3265
00003a  f7fffffe          BL       dir_read
00003e  4605              MOV      r5,r0                 ;3265
000040  2d04              CMP      r5,#4                 ;3266
000042  d102              BNE      |L31.74|
000044  2000              MOVS     r0,#0                 ;3267
000046  6120              STR      r0,[r4,#0x10]         ;3267
000048  2500              MOVS     r5,#0                 ;3268
                  |L31.74|
00004a  b96d              CBNZ     r5,|L31.104|
00004c  4639              MOV      r1,r7                 ;3271
00004e  4620              MOV      r0,r4                 ;3271
000050  f7fffffe          BL       get_fileinfo
000054  2100              MOVS     r1,#0                 ;3272
000056  4620              MOV      r0,r4                 ;3272
000058  f7fffffe          BL       dir_next
00005c  4605              MOV      r5,r0                 ;3272
00005e  2d04              CMP      r5,#4                 ;3273
000060  d102              BNE      |L31.104|
000062  2000              MOVS     r0,#0                 ;3274
000064  6120              STR      r0,[r4,#0x10]         ;3274
000066  2500              MOVS     r5,#0                 ;3275
                  |L31.104|
000068  4630              MOV      r0,r6                 ;3278
00006a  f7fffffe          BL       ff_memfree
                  |L31.110|
00006e  4628              MOV      r0,r5                 ;3282
000070  e7dd              B        |L31.46|
;;;3284   
                          ENDP


                          AREA ||i.f_rename||, CODE, READONLY, ALIGN=1

                  f_rename PROC
;;;3687   
;;;3688   FRESULT f_rename (
000000  e92d41f3          PUSH     {r0,r1,r4-r8,lr}
;;;3689   	const TCHAR* path_old,	/* Pointer to the object to be renamed */
;;;3690   	const TCHAR* path_new	/* Pointer to the new name */
;;;3691   )
;;;3692   {
000004  b09c              SUB      sp,sp,#0x70
;;;3693   	FRESULT res;
;;;3694   	DIR djo, djn;
;;;3695   	BYTE buf[21], *dir;
;;;3696   	DWORD dw;
;;;3697   	DEFINE_NAMEBUF;
;;;3698   
;;;3699   
;;;3700   	/* Get logical drive number of the source object */
;;;3701   	res = find_volume(&djo.fs, &path_old, 1);
000006  2201              MOVS     r2,#1
000008  a91c              ADD      r1,sp,#0x70
00000a  a813              ADD      r0,sp,#0x4c
00000c  f7fffffe          BL       find_volume
000010  4604              MOV      r4,r0
;;;3702   	if (res == FR_OK) {
000012  2c00              CMP      r4,#0
000014  d17e              BNE      |L32.276|
;;;3703   		djn.fs = djo.fs;
000016  9813              LDR      r0,[sp,#0x4c]
000018  900a              STR      r0,[sp,#0x28]
;;;3704   		INIT_BUF(djo);
00001a  f44f7000          MOV      r0,#0x200
00001e  f7fffffe          BL       ff_memalloc
000022  4607              MOV      r7,r0
000024  b91f              CBNZ     r7,|L32.46|
000026  2011              MOVS     r0,#0x11
                  |L32.40|
;;;3705   		res = follow_path(&djo, path_old);		/* Check old object */
;;;3706   		if (_FS_RPATH && res == FR_OK && (djo.fn[NSFLAG] & NS_DOT))
;;;3707   			res = FR_INVALID_NAME;
;;;3708   #if _FS_LOCK
;;;3709   		if (res == FR_OK) res = chk_lock(&djo, 2);
;;;3710   #endif
;;;3711   		if (res == FR_OK) {						/* Old object is found */
;;;3712   			if (!djo.dir) {						/* Is root dir? */
;;;3713   				res = FR_NO_FILE;
;;;3714   			} else {
;;;3715   				mem_cpy(buf, djo.dir + DIR_Attr, 21);	/* Save information about object except name */
;;;3716   				mem_cpy(&djn, &djo, sizeof (DIR));		/* Duplicate the directory object */
;;;3717   				if (get_ldnumber(&path_new) >= 0)		/* Snip drive number off and ignore it */
;;;3718   					res = follow_path(&djn, path_new);	/* and make sure if new object name is not conflicting */
;;;3719   				else
;;;3720   					res = FR_INVALID_DRIVE;
;;;3721   				if (res == FR_OK) res = FR_EXIST;		/* The new object name is already existing */
;;;3722   				if (res == FR_NO_FILE) { 				/* It is a valid path and no name collision */
;;;3723   					res = dir_register(&djn);			/* Register the new entry */
;;;3724   					if (res == FR_OK) {
;;;3725   /* Start of critical section where any interruption can cause a cross-link */
;;;3726   						dir = djn.dir;					/* Copy information about object except name */
;;;3727   						mem_cpy(dir + 13, buf + 2, 19);
;;;3728   						dir[DIR_Attr] = buf[0] | AM_ARC;
;;;3729   						djo.fs->wflag = 1;
;;;3730   						if ((dir[DIR_Attr] & AM_DIR) && djo.sclust != djn.sclust) {	/* Update .. entry in the sub-directory if needed */
;;;3731   							dw = clust2sect(djo.fs, ld_clust(djo.fs, dir));
;;;3732   							if (!dw) {
;;;3733   								res = FR_INT_ERR;
;;;3734   							} else {
;;;3735   								res = move_window(djo.fs, dw);
;;;3736   								dir = djo.fs->win + SZ_DIRE * 1;	/* Ptr to .. entry */
;;;3737   								if (res == FR_OK && dir[1] == '.') {
;;;3738   									st_clust(dir, djn.sclust);
;;;3739   									djo.fs->wflag = 1;
;;;3740   								}
;;;3741   							}
;;;3742   						}
;;;3743   						if (res == FR_OK) {
;;;3744   							res = dir_remove(&djo);		/* Remove old entry */
;;;3745   							if (res == FR_OK)
;;;3746   								res = sync_fs(djo.fs);
;;;3747   						}
;;;3748   /* End of critical section */
;;;3749   					}
;;;3750   				}
;;;3751   			}
;;;3752   		}
;;;3753   		FREE_BUF();
;;;3754   	}
;;;3755   
;;;3756   	LEAVE_FF(djo.fs, res);
;;;3757   }
000028  b01e              ADD      sp,sp,#0x78
00002a  e8bd81f0          POP      {r4-r8,pc}
                  |L32.46|
00002e  971a              STR      r7,[sp,#0x68]         ;3704
000030  a801              ADD      r0,sp,#4              ;3704
000032  9019              STR      r0,[sp,#0x64]         ;3704
000034  a813              ADD      r0,sp,#0x4c           ;3705
000036  991c              LDR      r1,[sp,#0x70]         ;3705
000038  f7fffffe          BL       follow_path
00003c  4604              MOV      r4,r0                 ;3705
00003e  bf00              NOP                            ;3706
000040  2c00              CMP      r4,#0                 ;3711
000042  d169              BNE      |L32.280|
000044  9818              LDR      r0,[sp,#0x60]         ;3712
000046  b908              CBNZ     r0,|L32.76|
000048  2404              MOVS     r4,#4                 ;3713
00004a  e065              B        |L32.280|
                  |L32.76|
00004c  9818              LDR      r0,[sp,#0x60]         ;3715
00004e  f100010b          ADD      r1,r0,#0xb            ;3715
000052  2215              MOVS     r2,#0x15              ;3715
000054  a804              ADD      r0,sp,#0x10           ;3715
000056  f7fffffe          BL       mem_cpy
00005a  2224              MOVS     r2,#0x24              ;3716
00005c  a913              ADD      r1,sp,#0x4c           ;3716
00005e  a80a              ADD      r0,sp,#0x28           ;3716
000060  f7fffffe          BL       mem_cpy
000064  a81d              ADD      r0,sp,#0x74           ;3717
000066  f7fffffe          BL       get_ldnumber
00006a  2800              CMP      r0,#0                 ;3717
00006c  db05              BLT      |L32.122|
00006e  a80a              ADD      r0,sp,#0x28           ;3718
000070  991d              LDR      r1,[sp,#0x74]         ;3718
000072  f7fffffe          BL       follow_path
000076  4604              MOV      r4,r0                 ;3718
000078  e000              B        |L32.124|
                  |L32.122|
00007a  240b              MOVS     r4,#0xb               ;3720
                  |L32.124|
00007c  b904              CBNZ     r4,|L32.128|
00007e  2408              MOVS     r4,#8                 ;3721
                  |L32.128|
000080  2c04              CMP      r4,#4                 ;3722
000082  d149              BNE      |L32.280|
000084  a80a              ADD      r0,sp,#0x28           ;3723
000086  f7fffffe          BL       dir_register
00008a  4604              MOV      r4,r0                 ;3723
00008c  2c00              CMP      r4,#0                 ;3724
00008e  d143              BNE      |L32.280|
000090  9d0f              LDR      r5,[sp,#0x3c]         ;3726
000092  2213              MOVS     r2,#0x13              ;3727
000094  f10d0112          ADD      r1,sp,#0x12           ;3727
000098  f105000d          ADD      r0,r5,#0xd            ;3727
00009c  f7fffffe          BL       mem_cpy
0000a0  f89d0010          LDRB     r0,[sp,#0x10]         ;3728
0000a4  f0400020          ORR      r0,r0,#0x20           ;3728
0000a8  72e8              STRB     r0,[r5,#0xb]          ;3728
0000aa  2001              MOVS     r0,#1                 ;3729
0000ac  9913              LDR      r1,[sp,#0x4c]         ;3729
0000ae  7108              STRB     r0,[r1,#4]            ;3729
0000b0  7ae8              LDRB     r0,[r5,#0xb]          ;3730
0000b2  f0000010          AND      r0,r0,#0x10           ;3730
0000b6  b318              CBZ      r0,|L32.256|
0000b8  990c              LDR      r1,[sp,#0x30]         ;3730
0000ba  9815              LDR      r0,[sp,#0x54]         ;3730
0000bc  4288              CMP      r0,r1                 ;3730
0000be  d01f              BEQ      |L32.256|
0000c0  4629              MOV      r1,r5                 ;3731
0000c2  9813              LDR      r0,[sp,#0x4c]         ;3731
0000c4  f7fffffe          BL       ld_clust
0000c8  4680              MOV      r8,r0                 ;3731
0000ca  4641              MOV      r1,r8                 ;3731
0000cc  9813              LDR      r0,[sp,#0x4c]         ;3731
0000ce  f7fffffe          BL       clust2sect
0000d2  4606              MOV      r6,r0                 ;3731
0000d4  b90e              CBNZ     r6,|L32.218|
0000d6  2402              MOVS     r4,#2                 ;3733
0000d8  e012              B        |L32.256|
                  |L32.218|
0000da  4631              MOV      r1,r6                 ;3735
0000dc  9813              LDR      r0,[sp,#0x4c]         ;3735
0000de  f7fffffe          BL       move_window
0000e2  4604              MOV      r4,r0                 ;3735
0000e4  9813              LDR      r0,[sp,#0x4c]         ;3736
0000e6  f1000550          ADD      r5,r0,#0x50           ;3736
0000ea  b94c              CBNZ     r4,|L32.256|
0000ec  7868              LDRB     r0,[r5,#1]            ;3737
0000ee  282e              CMP      r0,#0x2e              ;3737
0000f0  d106              BNE      |L32.256|
0000f2  4628              MOV      r0,r5                 ;3738
0000f4  990c              LDR      r1,[sp,#0x30]         ;3738
0000f6  f7fffffe          BL       st_clust
0000fa  2001              MOVS     r0,#1                 ;3739
0000fc  9913              LDR      r1,[sp,#0x4c]         ;3739
0000fe  7108              STRB     r0,[r1,#4]            ;3739
                  |L32.256|
000100  b954              CBNZ     r4,|L32.280|
000102  a813              ADD      r0,sp,#0x4c           ;3744
000104  f7fffffe          BL       dir_remove
000108  4604              MOV      r4,r0                 ;3744
00010a  b92c              CBNZ     r4,|L32.280|
00010c  9813              LDR      r0,[sp,#0x4c]         ;3746
00010e  f7fffffe          BL       sync_fs
000112  e000              B        |L32.278|
                  |L32.276|
000114  e003              B        |L32.286|
                  |L32.278|
000116  4604              MOV      r4,r0                 ;3746
                  |L32.280|
000118  4638              MOV      r0,r7                 ;3753
00011a  f7fffffe          BL       ff_memfree
                  |L32.286|
00011e  4620              MOV      r0,r4                 ;3756
000120  e782              B        |L32.40|
;;;3758   
                          ENDP


                          AREA ||i.f_setlabel||, CODE, READONLY, ALIGN=2

                  f_setlabel PROC
;;;3880   
;;;3881   FRESULT f_setlabel (
000000  e92d47f1          PUSH     {r0,r4-r10,lr}
;;;3882   	const TCHAR* label	/* Pointer to the volume label to set */
;;;3883   )
;;;3884   {
000004  b08d              SUB      sp,sp,#0x34
;;;3885   	FRESULT res;
;;;3886   	DIR dj;
;;;3887   	BYTE vn[11];
;;;3888   	UINT i, j, sl;
;;;3889   	WCHAR w;
;;;3890   	DWORD tm;
;;;3891   
;;;3892   
;;;3893   	/* Get logical drive number */
;;;3894   	res = find_volume(&dj.fs, &label, 1);
000006  2201              MOVS     r2,#1
000008  a90d              ADD      r1,sp,#0x34
00000a  a804              ADD      r0,sp,#0x10
00000c  f7fffffe          BL       find_volume
000010  4681              MOV      r9,r0
;;;3895   	if (res) LEAVE_FF(dj.fs, res);
000012  f1b90f00          CMP      r9,#0
000016  d003              BEQ      |L33.32|
000018  4648              MOV      r0,r9
                  |L33.26|
;;;3896   
;;;3897   	/* Create a volume label in directory form */
;;;3898   	vn[0] = 0;
;;;3899   	for (sl = 0; label[sl]; sl++) ;				/* Get name length */
;;;3900   	for ( ; sl && label[sl - 1] == ' '; sl--) ;	/* Remove trailing spaces */
;;;3901   	if (sl) {	/* Create volume label in directory form */
;;;3902   		i = j = 0;
;;;3903   		do {
;;;3904   #if _USE_LFN && _LFN_UNICODE
;;;3905   			w = ff_convert(ff_wtoupper(label[i++]), 0);
;;;3906   #else
;;;3907   			w = (BYTE)label[i++];
;;;3908   			if (IsDBCS1(w))
;;;3909   				w = (j < 10 && i < sl && IsDBCS2(label[i])) ? w << 8 | (BYTE)label[i++] : 0;
;;;3910   #if _USE_LFN
;;;3911   			w = ff_convert(ff_wtoupper(ff_convert(w, 1)), 0);
;;;3912   #else
;;;3913   			if (IsLower(w)) w -= 0x20;			/* To upper ASCII characters */
;;;3914   #ifdef _EXCVT
;;;3915   			if (w >= 0x80) w = ExCvt[w - 0x80];	/* To upper extended characters (SBCS cfg) */
;;;3916   #else
;;;3917   			if (!_DF1S && w >= 0x80) w = 0;		/* Reject extended characters (ASCII cfg) */
;;;3918   #endif
;;;3919   #endif
;;;3920   #endif
;;;3921   			if (!w || chk_chr("\"*+,.:;<=>\?[]|\x7F", w) || j >= (UINT)((w >= 0x100) ? 10 : 11)) /* Reject invalid characters for volume label */
;;;3922   				LEAVE_FF(dj.fs, FR_INVALID_NAME);
;;;3923   			if (w >= 0x100) vn[j++] = (BYTE)(w >> 8);
;;;3924   			vn[j++] = (BYTE)w;
;;;3925   		} while (i < sl);
;;;3926   		while (j < 11) vn[j++] = ' ';	/* Fill remaining name field */
;;;3927   		if (vn[0] == DDEM) LEAVE_FF(dj.fs, FR_INVALID_NAME);	/* Reject illegal name (heading DDEM) */
;;;3928   	}
;;;3929   
;;;3930   	/* Set volume label */
;;;3931   	dj.sclust = 0;					/* Open root directory */
;;;3932   	res = dir_sdi(&dj, 0);
;;;3933   	if (res == FR_OK) {
;;;3934   		res = dir_read(&dj, 1);		/* Get an entry with AM_VOL */
;;;3935   		if (res == FR_OK) {			/* A volume label is found */
;;;3936   			if (vn[0]) {
;;;3937   				mem_cpy(dj.dir, vn, 11);	/* Change the volume label name */
;;;3938   				tm = GET_FATTIME();
;;;3939   				ST_DWORD(dj.dir + DIR_WrtTime, tm);
;;;3940   			} else {
;;;3941   				dj.dir[0] = DDEM;			/* Remove the volume label */
;;;3942   			}
;;;3943   			dj.fs->wflag = 1;
;;;3944   			res = sync_fs(dj.fs);
;;;3945   		} else {					/* No volume label is found or error */
;;;3946   			if (res == FR_NO_FILE) {
;;;3947   				res = FR_OK;
;;;3948   				if (vn[0]) {				/* Create volume label as new */
;;;3949   					res = dir_alloc(&dj, 1);	/* Allocate an entry for volume label */
;;;3950   					if (res == FR_OK) {
;;;3951   						mem_set(dj.dir, 0, SZ_DIRE);	/* Set volume label */
;;;3952   						mem_cpy(dj.dir, vn, 11);
;;;3953   						dj.dir[DIR_Attr] = AM_VOL;
;;;3954   						tm = GET_FATTIME();
;;;3955   						ST_DWORD(dj.dir + DIR_WrtTime, tm);
;;;3956   						dj.fs->wflag = 1;
;;;3957   						res = sync_fs(dj.fs);
;;;3958   					}
;;;3959   				}
;;;3960   			}
;;;3961   		}
;;;3962   	}
;;;3963   
;;;3964   	LEAVE_FF(dj.fs, res);
;;;3965   }
00001a  b00e              ADD      sp,sp,#0x38
00001c  e8bd87f0          POP      {r4-r10,pc}
                  |L33.32|
000020  2000              MOVS     r0,#0                 ;3898
000022  f88d0004          STRB     r0,[sp,#4]            ;3898
000026  2700              MOVS     r7,#0                 ;3899
000028  e000              B        |L33.44|
                  |L33.42|
00002a  1c7f              ADDS     r7,r7,#1              ;3899
                  |L33.44|
00002c  980d              LDR      r0,[sp,#0x34]         ;3899
00002e  5dc0              LDRB     r0,[r0,r7]            ;3899
000030  2800              CMP      r0,#0                 ;3899
000032  d1fa              BNE      |L33.42|
000034  e000              B        |L33.56|
                  |L33.54|
000036  1e7f              SUBS     r7,r7,#1              ;3900
                  |L33.56|
000038  b127              CBZ      r7,|L33.68|
00003a  1e78              SUBS     r0,r7,#1              ;3900
00003c  990d              LDR      r1,[sp,#0x34]         ;3900
00003e  5c08              LDRB     r0,[r1,r0]            ;3900
000040  2820              CMP      r0,#0x20              ;3900
000042  d0f8              BEQ      |L33.54|
                  |L33.68|
000044  2f00              CMP      r7,#0                 ;3901
000046  d063              BEQ      |L33.272|
000048  2600              MOVS     r6,#0                 ;3902
00004a  46b0              MOV      r8,r6                 ;3902
00004c  bf00              NOP                            ;3903
                  |L33.78|
00004e  4630              MOV      r0,r6                 ;3907
000050  1c76              ADDS     r6,r6,#1              ;3907
000052  990d              LDR      r1,[sp,#0x34]         ;3907
000054  5c0c              LDRB     r4,[r1,r0]            ;3907
000056  2c81              CMP      r4,#0x81              ;3908
000058  db20              BLT      |L33.156|
00005a  b2e0              UXTB     r0,r4                 ;3908
00005c  28fe              CMP      r0,#0xfe              ;3908
00005e  dc1d              BGT      |L33.156|
000060  f1b80f0a          CMP      r8,#0xa               ;3909
000064  d218              BCS      |L33.152|
000066  42be              CMP      r6,r7                 ;3909
000068  d216              BCS      |L33.152|
00006a  980d              LDR      r0,[sp,#0x34]         ;3909
00006c  5d80              LDRB     r0,[r0,r6]            ;3909
00006e  2840              CMP      r0,#0x40              ;3909
000070  db03              BLT      |L33.122|
000072  980d              LDR      r0,[sp,#0x34]         ;3909
000074  5d80              LDRB     r0,[r0,r6]            ;3909
000076  287e              CMP      r0,#0x7e              ;3909
000078  dd07              BLE      |L33.138|
                  |L33.122|
00007a  980d              LDR      r0,[sp,#0x34]         ;3909
00007c  5d80              LDRB     r0,[r0,r6]            ;3909
00007e  2880              CMP      r0,#0x80              ;3909
000080  db0a              BLT      |L33.152|
000082  980d              LDR      r0,[sp,#0x34]         ;3909
000084  5d80              LDRB     r0,[r0,r6]            ;3909
000086  28fe              CMP      r0,#0xfe              ;3909
000088  dc06              BGT      |L33.152|
                  |L33.138|
00008a  4630              MOV      r0,r6                 ;3909
00008c  1c76              ADDS     r6,r6,#1              ;3909
00008e  990d              LDR      r1,[sp,#0x34]         ;3909
000090  5c08              LDRB     r0,[r1,r0]            ;3909
000092  ea402004          ORR      r0,r0,r4,LSL #8       ;3909
000096  e000              B        |L33.154|
                  |L33.152|
000098  2000              MOVS     r0,#0                 ;3909
                  |L33.154|
00009a  b284              UXTH     r4,r0                 ;3909
                  |L33.156|
00009c  2101              MOVS     r1,#1                 ;3911
00009e  4620              MOV      r0,r4                 ;3911
0000a0  f7fffffe          BL       ff_convert
0000a4  4682              MOV      r10,r0                ;3911
0000a6  f7fffffe          BL       ff_wtoupper
0000aa  4603              MOV      r3,r0                 ;3911
0000ac  2100              MOVS     r1,#0                 ;3911
0000ae  f7fffffe          BL       ff_convert
0000b2  4604              MOV      r4,r0                 ;3911
0000b4  b15c              CBZ      r4,|L33.206|
0000b6  4621              MOV      r1,r4                 ;3921
0000b8  a049              ADR      r0,|L33.480|
0000ba  f7fffffe          BL       chk_chr
0000be  b930              CBNZ     r0,|L33.206|
0000c0  2cff              CMP      r4,#0xff              ;3921
0000c2  dd01              BLE      |L33.200|
0000c4  200a              MOVS     r0,#0xa               ;3921
0000c6  e000              B        |L33.202|
                  |L33.200|
0000c8  200b              MOVS     r0,#0xb               ;3921
                  |L33.202|
0000ca  4540              CMP      r0,r8                 ;3921
0000cc  d801              BHI      |L33.210|
                  |L33.206|
0000ce  2006              MOVS     r0,#6                 ;3922
0000d0  e7a3              B        |L33.26|
                  |L33.210|
0000d2  2cff              CMP      r4,#0xff              ;3923
0000d4  dd05              BLE      |L33.226|
0000d6  1222              ASRS     r2,r4,#8              ;3923
0000d8  4640              MOV      r0,r8                 ;3923
0000da  f1080801          ADD      r8,r8,#1              ;3923
0000de  a901              ADD      r1,sp,#4              ;3923
0000e0  540a              STRB     r2,[r1,r0]            ;3923
                  |L33.226|
0000e2  4640              MOV      r0,r8                 ;3924
0000e4  f1080801          ADD      r8,r8,#1              ;3924
0000e8  a901              ADD      r1,sp,#4              ;3924
0000ea  540c              STRB     r4,[r1,r0]            ;3924
0000ec  42be              CMP      r6,r7                 ;3925
0000ee  d3ae              BCC      |L33.78|
0000f0  e005              B        |L33.254|
                  |L33.242|
0000f2  2220              MOVS     r2,#0x20              ;3926
0000f4  4641              MOV      r1,r8                 ;3926
0000f6  f1080801          ADD      r8,r8,#1              ;3926
0000fa  a801              ADD      r0,sp,#4              ;3926
0000fc  5442              STRB     r2,[r0,r1]            ;3926
                  |L33.254|
0000fe  f1b80f0b          CMP      r8,#0xb               ;3926
000102  d3f6              BCC      |L33.242|
000104  f89d0004          LDRB     r0,[sp,#4]            ;3927
000108  28e5              CMP      r0,#0xe5              ;3927
00010a  d101              BNE      |L33.272|
00010c  2006              MOVS     r0,#6                 ;3927
00010e  e784              B        |L33.26|
                  |L33.272|
000110  2000              MOVS     r0,#0                 ;3931
000112  9006              STR      r0,[sp,#0x18]         ;3931
000114  2100              MOVS     r1,#0                 ;3932
000116  a804              ADD      r0,sp,#0x10           ;3932
000118  f7fffffe          BL       dir_sdi
00011c  4681              MOV      r9,r0                 ;3932
00011e  f1b90f00          CMP      r9,#0                 ;3933
000122  d15b              BNE      |L33.476|
000124  2101              MOVS     r1,#1                 ;3934
000126  a804              ADD      r0,sp,#0x10           ;3934
000128  f7fffffe          BL       dir_read
00012c  4681              MOV      r9,r0                 ;3934
00012e  f1b90f00          CMP      r9,#0                 ;3935
000132  d121              BNE      |L33.376|
000134  f89d0004          LDRB     r0,[sp,#4]            ;3936
000138  b198              CBZ      r0,|L33.354|
00013a  220b              MOVS     r2,#0xb               ;3937
00013c  a901              ADD      r1,sp,#4              ;3937
00013e  9809              LDR      r0,[sp,#0x24]         ;3937
000140  f7fffffe          BL       mem_cpy
000144  f7fffffe          BL       get_fattime
000148  4605              MOV      r5,r0                 ;3938
00014a  9909              LDR      r1,[sp,#0x24]         ;3939
00014c  758d              STRB     r5,[r1,#0x16]         ;3939
00014e  0a29              LSRS     r1,r5,#8              ;3939
000150  9809              LDR      r0,[sp,#0x24]         ;3939
000152  75c1              STRB     r1,[r0,#0x17]         ;3939
000154  0c29              LSRS     r1,r5,#16             ;3939
000156  9809              LDR      r0,[sp,#0x24]         ;3939
000158  7601              STRB     r1,[r0,#0x18]         ;3939
00015a  0e29              LSRS     r1,r5,#24             ;3939
00015c  9809              LDR      r0,[sp,#0x24]         ;3939
00015e  7641              STRB     r1,[r0,#0x19]         ;3939
000160  e002              B        |L33.360|
                  |L33.354|
000162  20e5              MOVS     r0,#0xe5              ;3941
000164  9909              LDR      r1,[sp,#0x24]         ;3941
000166  7008              STRB     r0,[r1,#0]            ;3941
                  |L33.360|
000168  2001              MOVS     r0,#1                 ;3943
00016a  9904              LDR      r1,[sp,#0x10]         ;3943
00016c  7108              STRB     r0,[r1,#4]            ;3943
00016e  9804              LDR      r0,[sp,#0x10]         ;3944
000170  f7fffffe          BL       sync_fs
000174  4681              MOV      r9,r0                 ;3944
000176  e031              B        |L33.476|
                  |L33.376|
000178  f1b90f04          CMP      r9,#4                 ;3946
00017c  d12e              BNE      |L33.476|
00017e  f04f0900          MOV      r9,#0                 ;3947
000182  f89d0004          LDRB     r0,[sp,#4]            ;3948
000186  b348              CBZ      r0,|L33.476|
000188  2101              MOVS     r1,#1                 ;3949
00018a  a804              ADD      r0,sp,#0x10           ;3949
00018c  f7fffffe          BL       dir_alloc
000190  4681              MOV      r9,r0                 ;3949
000192  f1b90f00          CMP      r9,#0                 ;3950
000196  d121              BNE      |L33.476|
000198  2220              MOVS     r2,#0x20              ;3951
00019a  2100              MOVS     r1,#0                 ;3951
00019c  9809              LDR      r0,[sp,#0x24]         ;3951
00019e  f7fffffe          BL       mem_set
0001a2  220b              MOVS     r2,#0xb               ;3952
0001a4  a901              ADD      r1,sp,#4              ;3952
0001a6  9809              LDR      r0,[sp,#0x24]         ;3952
0001a8  f7fffffe          BL       mem_cpy
0001ac  2008              MOVS     r0,#8                 ;3953
0001ae  9909              LDR      r1,[sp,#0x24]         ;3953
0001b0  72c8              STRB     r0,[r1,#0xb]          ;3953
0001b2  f7fffffe          BL       get_fattime
0001b6  4605              MOV      r5,r0                 ;3954
0001b8  9909              LDR      r1,[sp,#0x24]         ;3955
0001ba  758d              STRB     r5,[r1,#0x16]         ;3955
0001bc  0a29              LSRS     r1,r5,#8              ;3955
0001be  9809              LDR      r0,[sp,#0x24]         ;3955
0001c0  75c1              STRB     r1,[r0,#0x17]         ;3955
0001c2  0c29              LSRS     r1,r5,#16             ;3955
0001c4  9809              LDR      r0,[sp,#0x24]         ;3955
0001c6  7601              STRB     r1,[r0,#0x18]         ;3955
0001c8  0e29              LSRS     r1,r5,#24             ;3955
0001ca  9809              LDR      r0,[sp,#0x24]         ;3955
0001cc  7641              STRB     r1,[r0,#0x19]         ;3955
0001ce  2001              MOVS     r0,#1                 ;3956
0001d0  9904              LDR      r1,[sp,#0x10]         ;3956
0001d2  7108              STRB     r0,[r1,#4]            ;3956
0001d4  9804              LDR      r0,[sp,#0x10]         ;3957
0001d6  f7fffffe          BL       sync_fs
0001da  4681              MOV      r9,r0                 ;3957
                  |L33.476|
0001dc  4648              MOV      r0,r9                 ;3964
0001de  e71c              B        |L33.26|
;;;3966   
                          ENDP

                  |L33.480|
0001e0  222a2b2c          DCB      """*+,.:;<=>?[]|",127,0
0001e4  2e3a3b3c
0001e8  3d3e3f5b
0001ec  5d7c7f00

                          AREA ||i.f_stat||, CODE, READONLY, ALIGN=1

                  f_stat PROC
;;;3343   
;;;3344   FRESULT f_stat (
000000  b573              PUSH     {r0,r1,r4-r6,lr}
;;;3345   	const TCHAR* path,	/* Pointer to the file path */
;;;3346   	FILINFO* fno		/* Pointer to file information to return */
;;;3347   )
;;;3348   {
000002  b08c              SUB      sp,sp,#0x30
000004  460e              MOV      r6,r1
;;;3349   	FRESULT res;
;;;3350   	DIR dj;
;;;3351   	DEFINE_NAMEBUF;
;;;3352   
;;;3353   
;;;3354   	/* Get logical drive number */
;;;3355   	res = find_volume(&dj.fs, &path, 0);
000006  2200              MOVS     r2,#0
000008  a90c              ADD      r1,sp,#0x30
00000a  a803              ADD      r0,sp,#0xc
00000c  f7fffffe          BL       find_volume
000010  4605              MOV      r5,r0
;;;3356   	if (res == FR_OK) {
000012  b9ed              CBNZ     r5,|L34.80|
;;;3357   		INIT_BUF(dj);
000014  f44f7000          MOV      r0,#0x200
000018  f7fffffe          BL       ff_memalloc
00001c  4604              MOV      r4,r0
00001e  b914              CBNZ     r4,|L34.38|
000020  2011              MOVS     r0,#0x11
                  |L34.34|
;;;3358   		res = follow_path(&dj, path);	/* Follow the file path */
;;;3359   		if (res == FR_OK) {				/* Follow completed */
;;;3360   			if (dj.dir) {		/* Found an object */
;;;3361   				if (fno) get_fileinfo(&dj, fno);
;;;3362   			} else {			/* It is root directory */
;;;3363   				res = FR_INVALID_NAME;
;;;3364   			}
;;;3365   		}
;;;3366   		FREE_BUF();
;;;3367   	}
;;;3368   
;;;3369   	LEAVE_FF(dj.fs, res);
;;;3370   }
000022  b00e              ADD      sp,sp,#0x38
000024  bd70              POP      {r4-r6,pc}
                  |L34.38|
000026  940a              STR      r4,[sp,#0x28]         ;3357
000028  f8cdd024          STR      sp,[sp,#0x24]         ;3357
00002c  a803              ADD      r0,sp,#0xc            ;3358
00002e  990c              LDR      r1,[sp,#0x30]         ;3358
000030  f7fffffe          BL       follow_path
000034  4605              MOV      r5,r0                 ;3358
000036  b945              CBNZ     r5,|L34.74|
000038  9808              LDR      r0,[sp,#0x20]         ;3360
00003a  b128              CBZ      r0,|L34.72|
00003c  b12e              CBZ      r6,|L34.74|
00003e  4631              MOV      r1,r6                 ;3361
000040  a803              ADD      r0,sp,#0xc            ;3361
000042  f7fffffe          BL       get_fileinfo
000046  e000              B        |L34.74|
                  |L34.72|
000048  2506              MOVS     r5,#6                 ;3363
                  |L34.74|
00004a  4620              MOV      r0,r4                 ;3366
00004c  f7fffffe          BL       ff_memfree
                  |L34.80|
000050  4628              MOV      r0,r5                 ;3369
000052  e7e6              B        |L34.34|
;;;3371   
                          ENDP


                          AREA ||i.f_sync||, CODE, READONLY, ALIGN=1

                  f_sync PROC
;;;2782   
;;;2783   FRESULT f_sync (
000000  e92d41f0          PUSH     {r4-r8,lr}
;;;2784   	FIL* fp		/* Pointer to the file object */
;;;2785   )
;;;2786   {
000004  4604              MOV      r4,r0
;;;2787   	FRESULT res;
;;;2788   	DWORD tm;
;;;2789   	BYTE *dir;
;;;2790   
;;;2791   
;;;2792   	res = validate(fp);					/* Check validity of the object */
000006  4620              MOV      r0,r4
000008  f7fffffe          BL       validate
00000c  4607              MOV      r7,r0
;;;2793   	if (res == FR_OK) {
00000e  2f00              CMP      r7,#0
000010  d14c              BNE      |L35.172|
;;;2794   		if (fp->flag & FA__WRITTEN) {	/* Has the file been written? */
000012  79a0              LDRB     r0,[r4,#6]
000014  f0000020          AND      r0,r0,#0x20
000018  2800              CMP      r0,#0
00001a  d047              BEQ      |L35.172|
;;;2795   			/* Write-back dirty buffer */
;;;2796   #if !_FS_TINY
;;;2797   			if (fp->flag & FA__DIRTY) {
00001c  79a0              LDRB     r0,[r4,#6]
00001e  f0000040          AND      r0,r0,#0x40
000022  b178              CBZ      r0,|L35.68|
;;;2798   				if (disk_write(fp->fs->drv, fp->buf, fp->dsect, 1) != RES_OK)
000024  6821              LDR      r1,[r4,#0]
000026  7848              LDRB     r0,[r1,#1]
000028  2301              MOVS     r3,#1
00002a  f1040128          ADD      r1,r4,#0x28
00002e  69a2              LDR      r2,[r4,#0x18]
000030  f7fffffe          BL       disk_write
000034  b110              CBZ      r0,|L35.60|
;;;2799   					LEAVE_FF(fp->fs, FR_DISK_ERR);
000036  2001              MOVS     r0,#1
                  |L35.56|
;;;2800   				fp->flag &= ~FA__DIRTY;
;;;2801   			}
;;;2802   #endif
;;;2803   			/* Update the directory entry */
;;;2804   			res = move_window(fp->fs, fp->dir_sect);
;;;2805   			if (res == FR_OK) {
;;;2806   				dir = fp->dir_ptr;
;;;2807   				dir[DIR_Attr] |= AM_ARC;					/* Set archive bit */
;;;2808   				ST_DWORD(dir + DIR_FileSize, fp->fsize);	/* Update file size */
;;;2809   				st_clust(dir, fp->sclust);					/* Update start cluster */
;;;2810   				tm = GET_FATTIME();							/* Update updated time */
;;;2811   				ST_DWORD(dir + DIR_WrtTime, tm);
;;;2812   				ST_WORD(dir + DIR_LstAccDate, 0);
;;;2813   				fp->flag &= ~FA__WRITTEN;
;;;2814   				fp->fs->wflag = 1;
;;;2815   				res = sync_fs(fp->fs);
;;;2816   			}
;;;2817   		}
;;;2818   	}
;;;2819   
;;;2820   	LEAVE_FF(fp->fs, res);
;;;2821   }
000038  e8bd81f0          POP      {r4-r8,pc}
                  |L35.60|
00003c  79a0              LDRB     r0,[r4,#6]            ;2800
00003e  f0200040          BIC      r0,r0,#0x40           ;2800
000042  71a0              STRB     r0,[r4,#6]            ;2800
                  |L35.68|
000044  69e1              LDR      r1,[r4,#0x1c]         ;2804
000046  6820              LDR      r0,[r4,#0]            ;2804
000048  f7fffffe          BL       move_window
00004c  4607              MOV      r7,r0                 ;2804
00004e  2f00              CMP      r7,#0                 ;2805
000050  d12c              BNE      |L35.172|
000052  6a25              LDR      r5,[r4,#0x20]         ;2806
000054  7ae8              LDRB     r0,[r5,#0xb]          ;2807
000056  f0400020          ORR      r0,r0,#0x20           ;2807
00005a  72e8              STRB     r0,[r5,#0xb]          ;2807
00005c  7b20              LDRB     r0,[r4,#0xc]          ;2808
00005e  7728              STRB     r0,[r5,#0x1c]         ;2808
000060  89a0              LDRH     r0,[r4,#0xc]          ;2808
000062  0a01              LSRS     r1,r0,#8              ;2808
000064  7769              STRB     r1,[r5,#0x1d]         ;2808
000066  68e0              LDR      r0,[r4,#0xc]          ;2808
000068  0c01              LSRS     r1,r0,#16             ;2808
00006a  77a9              STRB     r1,[r5,#0x1e]         ;2808
00006c  68e0              LDR      r0,[r4,#0xc]          ;2808
00006e  0e01              LSRS     r1,r0,#24             ;2808
000070  77e9              STRB     r1,[r5,#0x1f]         ;2808
000072  4628              MOV      r0,r5                 ;2809
000074  6921              LDR      r1,[r4,#0x10]         ;2809
000076  f7fffffe          BL       st_clust
00007a  f7fffffe          BL       get_fattime
00007e  4606              MOV      r6,r0                 ;2810
000080  75ae              STRB     r6,[r5,#0x16]         ;2811
000082  0a31              LSRS     r1,r6,#8              ;2811
000084  75e9              STRB     r1,[r5,#0x17]         ;2811
000086  0c31              LSRS     r1,r6,#16             ;2811
000088  7629              STRB     r1,[r5,#0x18]         ;2811
00008a  0e31              LSRS     r1,r6,#24             ;2811
00008c  7669              STRB     r1,[r5,#0x19]         ;2811
00008e  2000              MOVS     r0,#0                 ;2812
000090  74a8              STRB     r0,[r5,#0x12]         ;2812
000092  2100              MOVS     r1,#0                 ;2812
000094  74e9              STRB     r1,[r5,#0x13]         ;2812
000096  79a0              LDRB     r0,[r4,#6]            ;2813
000098  f0200020          BIC      r0,r0,#0x20           ;2813
00009c  71a0              STRB     r0,[r4,#6]            ;2813
00009e  2001              MOVS     r0,#1                 ;2814
0000a0  6821              LDR      r1,[r4,#0]            ;2814
0000a2  7108              STRB     r0,[r1,#4]            ;2814
0000a4  6820              LDR      r0,[r4,#0]            ;2815
0000a6  f7fffffe          BL       sync_fs
0000aa  4607              MOV      r7,r0                 ;2815
                  |L35.172|
0000ac  4638              MOV      r0,r7                 ;2820
0000ae  e7c3              B        |L35.56|
;;;2822   
                          ENDP


                          AREA ||i.f_truncate||, CODE, READONLY, ALIGN=1

                  f_truncate PROC
;;;3445   
;;;3446   FRESULT f_truncate (
000000  b570              PUSH     {r4-r6,lr}
;;;3447   	FIL* fp		/* Pointer to the file object */
;;;3448   )
;;;3449   {
000002  4604              MOV      r4,r0
;;;3450   	FRESULT res;
;;;3451   	DWORD ncl;
;;;3452   
;;;3453   
;;;3454   	res = validate(fp);						/* Check validity of the object */
000004  4620              MOV      r0,r4
000006  f7fffffe          BL       validate
00000a  4605              MOV      r5,r0
;;;3455   	if (res == FR_OK) {
00000c  b945              CBNZ     r5,|L36.32|
;;;3456   		if (fp->err) {						/* Check error */
00000e  79e0              LDRB     r0,[r4,#7]
000010  b108              CBZ      r0,|L36.22|
;;;3457   			res = (FRESULT)fp->err;
000012  79e5              LDRB     r5,[r4,#7]
000014  e004              B        |L36.32|
                  |L36.22|
;;;3458   		} else {
;;;3459   			if (!(fp->flag & FA_WRITE))		/* Check access mode */
000016  79a0              LDRB     r0,[r4,#6]
000018  f0000002          AND      r0,r0,#2
00001c  b900              CBNZ     r0,|L36.32|
;;;3460   				res = FR_DENIED;
00001e  2507              MOVS     r5,#7
                  |L36.32|
;;;3461   		}
;;;3462   	}
;;;3463   	if (res == FR_OK) {
000020  2d00              CMP      r5,#0
000022  d147              BNE      |L36.180|
;;;3464   		if (fp->fsize > fp->fptr) {
000024  e9d41002          LDRD     r1,r0,[r4,#8]
000028  4288              CMP      r0,r1
00002a  d941              BLS      |L36.176|
;;;3465   			fp->fsize = fp->fptr;	/* Set file size to current R/W point */
00002c  68a0              LDR      r0,[r4,#8]
00002e  60e0              STR      r0,[r4,#0xc]
;;;3466   			fp->flag |= FA__WRITTEN;
000030  79a0              LDRB     r0,[r4,#6]
000032  f0400020          ORR      r0,r0,#0x20
000036  71a0              STRB     r0,[r4,#6]
;;;3467   			if (fp->fptr == 0) {	/* When set file size to zero, remove entire cluster chain */
000038  68a0              LDR      r0,[r4,#8]
00003a  b938              CBNZ     r0,|L36.76|
;;;3468   				res = remove_chain(fp->fs, fp->sclust);
00003c  6921              LDR      r1,[r4,#0x10]
00003e  6820              LDR      r0,[r4,#0]
000040  f7fffffe          BL       remove_chain
000044  4605              MOV      r5,r0
;;;3469   				fp->sclust = 0;
000046  2000              MOVS     r0,#0
000048  6120              STR      r0,[r4,#0x10]
00004a  e01d              B        |L36.136|
                  |L36.76|
;;;3470   			} else {				/* When truncate a part of the file, remove remaining clusters */
;;;3471   				ncl = get_fat(fp->fs, fp->clust);
00004c  6961              LDR      r1,[r4,#0x14]
00004e  6820              LDR      r0,[r4,#0]
000050  f7fffffe          BL       get_fat
000054  4606              MOV      r6,r0
;;;3472   				res = FR_OK;
000056  2500              MOVS     r5,#0
;;;3473   				if (ncl == 0xFFFFFFFF) res = FR_DISK_ERR;
000058  1c70              ADDS     r0,r6,#1
00005a  b900              CBNZ     r0,|L36.94|
00005c  2501              MOVS     r5,#1
                  |L36.94|
;;;3474   				if (ncl == 1) res = FR_INT_ERR;
00005e  2e01              CMP      r6,#1
000060  d100              BNE      |L36.100|
000062  2502              MOVS     r5,#2
                  |L36.100|
;;;3475   				if (res == FR_OK && ncl < fp->fs->n_fatent) {
000064  b985              CBNZ     r5,|L36.136|
000066  6820              LDR      r0,[r4,#0]
000068  6940              LDR      r0,[r0,#0x14]
00006a  42b0              CMP      r0,r6
00006c  d90c              BLS      |L36.136|
;;;3476   					res = put_fat(fp->fs, fp->clust, 0x0FFFFFFF);
00006e  f06f4270          MVN      r2,#0xf0000000
000072  6961              LDR      r1,[r4,#0x14]
000074  6820              LDR      r0,[r4,#0]
000076  f7fffffe          BL       put_fat
00007a  4605              MOV      r5,r0
;;;3477   					if (res == FR_OK) res = remove_chain(fp->fs, ncl);
00007c  b925              CBNZ     r5,|L36.136|
00007e  4631              MOV      r1,r6
000080  6820              LDR      r0,[r4,#0]
000082  f7fffffe          BL       remove_chain
000086  4605              MOV      r5,r0
                  |L36.136|
;;;3478   				}
;;;3479   			}
;;;3480   #if !_FS_TINY
;;;3481   			if (res == FR_OK && (fp->flag & FA__DIRTY)) {
000088  b995              CBNZ     r5,|L36.176|
00008a  79a0              LDRB     r0,[r4,#6]
00008c  f0000040          AND      r0,r0,#0x40
000090  b170              CBZ      r0,|L36.176|
;;;3482   				if (disk_write(fp->fs->drv, fp->buf, fp->dsect, 1) != RES_OK)
000092  6821              LDR      r1,[r4,#0]
000094  7848              LDRB     r0,[r1,#1]
000096  2301              MOVS     r3,#1
000098  f1040128          ADD      r1,r4,#0x28
00009c  69a2              LDR      r2,[r4,#0x18]
00009e  f7fffffe          BL       disk_write
0000a2  b108              CBZ      r0,|L36.168|
;;;3483   					res = FR_DISK_ERR;
0000a4  2501              MOVS     r5,#1
0000a6  e003              B        |L36.176|
                  |L36.168|
;;;3484   				else
;;;3485   					fp->flag &= ~FA__DIRTY;
0000a8  79a0              LDRB     r0,[r4,#6]
0000aa  f0200040          BIC      r0,r0,#0x40
0000ae  71a0              STRB     r0,[r4,#6]
                  |L36.176|
;;;3486   			}
;;;3487   #endif
;;;3488   		}
;;;3489   		if (res != FR_OK) fp->err = (FRESULT)res;
0000b0  b105              CBZ      r5,|L36.180|
0000b2  71e5              STRB     r5,[r4,#7]
                  |L36.180|
;;;3490   	}
;;;3491   
;;;3492   	LEAVE_FF(fp->fs, res);
0000b4  4628              MOV      r0,r5
;;;3493   }
0000b6  bd70              POP      {r4-r6,pc}
;;;3494   
                          ENDP


                          AREA ||i.f_unlink||, CODE, READONLY, ALIGN=1

                  f_unlink PROC
;;;3501   
;;;3502   FRESULT f_unlink (
000000  b5f1              PUSH     {r0,r4-r7,lr}
;;;3503   	const TCHAR* path		/* Pointer to the file or directory path */
;;;3504   )
;;;3505   {
000002  b096              SUB      sp,sp,#0x58
;;;3506   	FRESULT res;
;;;3507   	DIR dj, sdj;
;;;3508   	BYTE *dir;
;;;3509   	DWORD dclst = 0;
000004  2600              MOVS     r6,#0
;;;3510   	DEFINE_NAMEBUF;
;;;3511   
;;;3512   
;;;3513   	/* Get logical drive number */
;;;3514   	res = find_volume(&dj.fs, &path, 1);
000006  2201              MOVS     r2,#1
000008  a916              ADD      r1,sp,#0x58
00000a  a80d              ADD      r0,sp,#0x34
00000c  f7fffffe          BL       find_volume
000010  4604              MOV      r4,r0
;;;3515   	if (res == FR_OK) {
000012  2c00              CMP      r4,#0
000014  d151              BNE      |L37.186|
;;;3516   		INIT_BUF(dj);
000016  f44f7000          MOV      r0,#0x200
00001a  f7fffffe          BL       ff_memalloc
00001e  4607              MOV      r7,r0
000020  b917              CBNZ     r7,|L37.40|
000022  2011              MOVS     r0,#0x11
                  |L37.36|
;;;3517   		res = follow_path(&dj, path);		/* Follow the file path */
;;;3518   		if (_FS_RPATH && res == FR_OK && (dj.fn[NSFLAG] & NS_DOT))
;;;3519   			res = FR_INVALID_NAME;			/* Cannot remove dot entry */
;;;3520   #if _FS_LOCK
;;;3521   		if (res == FR_OK) res = chk_lock(&dj, 2);	/* Cannot remove open object */
;;;3522   #endif
;;;3523   		if (res == FR_OK) {					/* The object is accessible */
;;;3524   			dir = dj.dir;
;;;3525   			if (!dir) {
;;;3526   				res = FR_INVALID_NAME;		/* Cannot remove the origin directory */
;;;3527   			} else {
;;;3528   				if (dir[DIR_Attr] & AM_RDO)
;;;3529   					res = FR_DENIED;		/* Cannot remove R/O object */
;;;3530   			}
;;;3531   			if (res == FR_OK) {
;;;3532   				dclst = ld_clust(dj.fs, dir);
;;;3533   				if (dclst && (dir[DIR_Attr] & AM_DIR)) {	/* Is it a sub-directory ? */
;;;3534   #if _FS_RPATH
;;;3535   					if (dclst == dj.fs->cdir) {		 		/* Is it the current directory? */
;;;3536   						res = FR_DENIED;
;;;3537   					} else
;;;3538   #endif
;;;3539   					{
;;;3540   						mem_cpy(&sdj, &dj, sizeof (DIR));	/* Open the sub-directory */
;;;3541   						sdj.sclust = dclst;
;;;3542   						res = dir_sdi(&sdj, 2);
;;;3543   						if (res == FR_OK) {
;;;3544   							res = dir_read(&sdj, 0);			/* Read an item (excluding dot entries) */
;;;3545   							if (res == FR_OK) res = FR_DENIED;	/* Not empty? (cannot remove) */
;;;3546   							if (res == FR_NO_FILE) res = FR_OK;	/* Empty? (can remove) */
;;;3547   						}
;;;3548   					}
;;;3549   				}
;;;3550   			}
;;;3551   			if (res == FR_OK) {
;;;3552   				res = dir_remove(&dj);		/* Remove the directory entry */
;;;3553   				if (res == FR_OK && dclst)	/* Remove the cluster chain if exist */
;;;3554   					res = remove_chain(dj.fs, dclst);
;;;3555   				if (res == FR_OK) res = sync_fs(dj.fs);
;;;3556   			}
;;;3557   		}
;;;3558   		FREE_BUF();
;;;3559   	}
;;;3560   
;;;3561   	LEAVE_FF(dj.fs, res);
;;;3562   }
000024  b017              ADD      sp,sp,#0x5c
000026  bdf0              POP      {r4-r7,pc}
                  |L37.40|
000028  9714              STR      r7,[sp,#0x50]         ;3516
00002a  a801              ADD      r0,sp,#4              ;3516
00002c  9013              STR      r0,[sp,#0x4c]         ;3516
00002e  a80d              ADD      r0,sp,#0x34           ;3517
000030  9916              LDR      r1,[sp,#0x58]         ;3517
000032  f7fffffe          BL       follow_path
000036  4604              MOV      r4,r0                 ;3517
000038  bf00              NOP                            ;3518
00003a  2c00              CMP      r4,#0                 ;3523
00003c  d13a              BNE      |L37.180|
00003e  9d12              LDR      r5,[sp,#0x48]         ;3524
000040  b90d              CBNZ     r5,|L37.70|
000042  2406              MOVS     r4,#6                 ;3526
000044  e004              B        |L37.80|
                  |L37.70|
000046  7ae8              LDRB     r0,[r5,#0xb]          ;3528
000048  f0000001          AND      r0,r0,#1              ;3528
00004c  b100              CBZ      r0,|L37.80|
00004e  2407              MOVS     r4,#7                 ;3529
                  |L37.80|
000050  b9fc              CBNZ     r4,|L37.146|
000052  4629              MOV      r1,r5                 ;3532
000054  980d              LDR      r0,[sp,#0x34]         ;3532
000056  f7fffffe          BL       ld_clust
00005a  4606              MOV      r6,r0                 ;3532
00005c  b1ce              CBZ      r6,|L37.146|
00005e  7ae8              LDRB     r0,[r5,#0xb]          ;3533
000060  f0000010          AND      r0,r0,#0x10           ;3533
000064  b1a8              CBZ      r0,|L37.146|
000066  2224              MOVS     r2,#0x24              ;3540
000068  a90d              ADD      r1,sp,#0x34           ;3540
00006a  a804              ADD      r0,sp,#0x10           ;3540
00006c  f7fffffe          BL       mem_cpy
000070  9606              STR      r6,[sp,#0x18]         ;3541
000072  2102              MOVS     r1,#2                 ;3542
000074  a804              ADD      r0,sp,#0x10           ;3542
000076  f7fffffe          BL       dir_sdi
00007a  4604              MOV      r4,r0                 ;3542
00007c  b94c              CBNZ     r4,|L37.146|
00007e  2100              MOVS     r1,#0                 ;3544
000080  a804              ADD      r0,sp,#0x10           ;3544
000082  f7fffffe          BL       dir_read
000086  4604              MOV      r4,r0                 ;3544
000088  b904              CBNZ     r4,|L37.140|
00008a  2407              MOVS     r4,#7                 ;3545
                  |L37.140|
00008c  2c04              CMP      r4,#4                 ;3546
00008e  d100              BNE      |L37.146|
000090  2400              MOVS     r4,#0                 ;3546
                  |L37.146|
000092  b97c              CBNZ     r4,|L37.180|
000094  a80d              ADD      r0,sp,#0x34           ;3552
000096  f7fffffe          BL       dir_remove
00009a  4604              MOV      r4,r0                 ;3552
00009c  b92c              CBNZ     r4,|L37.170|
00009e  b126              CBZ      r6,|L37.170|
0000a0  4631              MOV      r1,r6                 ;3554
0000a2  980d              LDR      r0,[sp,#0x34]         ;3554
0000a4  f7fffffe          BL       remove_chain
0000a8  4604              MOV      r4,r0                 ;3554
                  |L37.170|
0000aa  b91c              CBNZ     r4,|L37.180|
0000ac  980d              LDR      r0,[sp,#0x34]         ;3555
0000ae  f7fffffe          BL       sync_fs
0000b2  4604              MOV      r4,r0                 ;3555
                  |L37.180|
0000b4  4638              MOV      r0,r7                 ;3558
0000b6  f7fffffe          BL       ff_memfree
                  |L37.186|
0000ba  4620              MOV      r0,r4                 ;3561
0000bc  e7b2              B        |L37.36|
;;;3563   
                          ENDP


                          AREA ||i.f_utime||, CODE, READONLY, ALIGN=1

                  f_utime PROC
;;;3765   
;;;3766   FRESULT f_utime (
000000  b5f3              PUSH     {r0,r1,r4-r7,lr}
;;;3767   	const TCHAR* path,	/* Pointer to the file/directory name */
;;;3768   	const FILINFO* fno	/* Pointer to the time stamp to be set */
;;;3769   )
;;;3770   {
000002  b08d              SUB      sp,sp,#0x34
000004  460d              MOV      r5,r1
;;;3771   	FRESULT res;
;;;3772   	DIR dj;
;;;3773   	BYTE *dir;
;;;3774   	DEFINE_NAMEBUF;
;;;3775   
;;;3776   
;;;3777   	/* Get logical drive number */
;;;3778   	res = find_volume(&dj.fs, &path, 1);
000006  2201              MOVS     r2,#1
000008  a90d              ADD      r1,sp,#0x34
00000a  a804              ADD      r0,sp,#0x10
00000c  f7fffffe          BL       find_volume
000010  4607              MOV      r7,r0
;;;3779   	if (res == FR_OK) {
000012  bb57              CBNZ     r7,|L38.106|
;;;3780   		INIT_BUF(dj);
000014  f44f7000          MOV      r0,#0x200
000018  f7fffffe          BL       ff_memalloc
00001c  4606              MOV      r6,r0
00001e  b916              CBNZ     r6,|L38.38|
000020  2011              MOVS     r0,#0x11
                  |L38.34|
;;;3781   		res = follow_path(&dj, path);	/* Follow the file path */
;;;3782   		FREE_BUF();
;;;3783   		if (_FS_RPATH && res == FR_OK && (dj.fn[NSFLAG] & NS_DOT))
;;;3784   			res = FR_INVALID_NAME;
;;;3785   		if (res == FR_OK) {
;;;3786   			dir = dj.dir;
;;;3787   			if (!dir) {					/* Root directory */
;;;3788   				res = FR_INVALID_NAME;
;;;3789   			} else {					/* File or sub-directory */
;;;3790   				ST_WORD(dir + DIR_WrtTime, fno->ftime);
;;;3791   				ST_WORD(dir + DIR_WrtDate, fno->fdate);
;;;3792   				dj.fs->wflag = 1;
;;;3793   				res = sync_fs(dj.fs);
;;;3794   			}
;;;3795   		}
;;;3796   	}
;;;3797   
;;;3798   	LEAVE_FF(dj.fs, res);
;;;3799   }
000022  b00f              ADD      sp,sp,#0x3c
000024  bdf0              POP      {r4-r7,pc}
                  |L38.38|
000026  960b              STR      r6,[sp,#0x2c]         ;3780
000028  a801              ADD      r0,sp,#4              ;3780
00002a  900a              STR      r0,[sp,#0x28]         ;3780
00002c  a804              ADD      r0,sp,#0x10           ;3781
00002e  990d              LDR      r1,[sp,#0x34]         ;3781
000030  f7fffffe          BL       follow_path
000034  4607              MOV      r7,r0                 ;3781
000036  4630              MOV      r0,r6                 ;3782
000038  f7fffffe          BL       ff_memfree
00003c  bf00              NOP                            ;3783
00003e  b9a7              CBNZ     r7,|L38.106|
000040  9c09              LDR      r4,[sp,#0x24]         ;3786
000042  b90c              CBNZ     r4,|L38.72|
000044  2706              MOVS     r7,#6                 ;3788
000046  e010              B        |L38.106|
                  |L38.72|
000048  79a8              LDRB     r0,[r5,#6]            ;3790
00004a  75a0              STRB     r0,[r4,#0x16]         ;3790
00004c  88e8              LDRH     r0,[r5,#6]            ;3790
00004e  1201              ASRS     r1,r0,#8              ;3790
000050  75e1              STRB     r1,[r4,#0x17]         ;3790
000052  7928              LDRB     r0,[r5,#4]            ;3791
000054  7620              STRB     r0,[r4,#0x18]         ;3791
000056  88a8              LDRH     r0,[r5,#4]            ;3791
000058  1201              ASRS     r1,r0,#8              ;3791
00005a  7661              STRB     r1,[r4,#0x19]         ;3791
00005c  2001              MOVS     r0,#1                 ;3792
00005e  9904              LDR      r1,[sp,#0x10]         ;3792
000060  7108              STRB     r0,[r1,#4]            ;3792
000062  9804              LDR      r0,[sp,#0x10]         ;3793
000064  f7fffffe          BL       sync_fs
000068  4607              MOV      r7,r0                 ;3793
                  |L38.106|
00006a  4638              MOV      r0,r7                 ;3798
00006c  e7d9              B        |L38.34|
;;;3800   
                          ENDP


                          AREA ||i.f_write||, CODE, READONLY, ALIGN=1

                  f_write PROC
;;;2660   
;;;2661   FRESULT f_write (
000000  e92d4fff          PUSH     {r0-r11,lr}
;;;2662   	FIL* fp,			/* Pointer to the file object */
;;;2663   	const void *buff,	/* Pointer to the data to be written */
;;;2664   	UINT btw,			/* Number of bytes to write */
;;;2665   	UINT* bw			/* Pointer to number of bytes written */
;;;2666   )
;;;2667   {
000004  b083              SUB      sp,sp,#0xc
000006  4604              MOV      r4,r0
000008  4615              MOV      r5,r2
00000a  469b              MOV      r11,r3
;;;2668   	FRESULT res;
;;;2669   	DWORD clst, sect;
;;;2670   	UINT wcnt, cc;
;;;2671   	const BYTE *wbuff = (const BYTE*)buff;
00000c  9804              LDR      r0,[sp,#0x10]
00000e  9001              STR      r0,[sp,#4]
;;;2672   	BYTE csect;
;;;2673   
;;;2674   
;;;2675   	*bw = 0;	/* Clear write byte counter */
000010  2000              MOVS     r0,#0
000012  f8cb0000          STR      r0,[r11,#0]
;;;2676   
;;;2677   	res = validate(fp);						/* Check validity */
000016  4620              MOV      r0,r4
000018  f7fffffe          BL       validate
00001c  9002              STR      r0,[sp,#8]
;;;2678   	if (res != FR_OK) LEAVE_FF(fp->fs, res);
00001e  9802              LDR      r0,[sp,#8]
000020  b118              CBZ      r0,|L39.42|
000022  9802              LDR      r0,[sp,#8]
                  |L39.36|
;;;2679   	if (fp->err)							/* Check error */
;;;2680   		LEAVE_FF(fp->fs, (FRESULT)fp->err);
;;;2681   	if (!(fp->flag & FA_WRITE))				/* Check access mode */
;;;2682   		LEAVE_FF(fp->fs, FR_DENIED);
;;;2683   	if (fp->fptr + btw < fp->fptr) btw = 0;	/* File size cannot reach 4GB */
;;;2684   
;;;2685   	for ( ;  btw;							/* Repeat until all data written */
;;;2686   		wbuff += wcnt, fp->fptr += wcnt, *bw += wcnt, btw -= wcnt) {
;;;2687   		if ((fp->fptr % SS(fp->fs)) == 0) {	/* On the sector boundary? */
;;;2688   			csect = (BYTE)(fp->fptr / SS(fp->fs) & (fp->fs->csize - 1));	/* Sector offset in the cluster */
;;;2689   			if (!csect) {					/* On the cluster boundary? */
;;;2690   				if (fp->fptr == 0) {		/* On the top of the file? */
;;;2691   					clst = fp->sclust;		/* Follow from the origin */
;;;2692   					if (clst == 0)			/* When no cluster is allocated, */
;;;2693   						clst = create_chain(fp->fs, 0);	/* Create a new cluster chain */
;;;2694   				} else {					/* Middle or end of the file */
;;;2695   #if _USE_FASTSEEK
;;;2696   					if (fp->cltbl)
;;;2697   						clst = clmt_clust(fp, fp->fptr);	/* Get cluster# from the CLMT */
;;;2698   					else
;;;2699   #endif
;;;2700   						clst = create_chain(fp->fs, fp->clust);	/* Follow or stretch cluster chain on the FAT */
;;;2701   				}
;;;2702   				if (clst == 0) break;		/* Could not allocate a new cluster (disk full) */
;;;2703   				if (clst == 1) ABORT(fp->fs, FR_INT_ERR);
;;;2704   				if (clst == 0xFFFFFFFF) ABORT(fp->fs, FR_DISK_ERR);
;;;2705   				fp->clust = clst;			/* Update current cluster */
;;;2706   				if (fp->sclust == 0) fp->sclust = clst;	/* Set start cluster if the first write */
;;;2707   			}
;;;2708   #if _FS_TINY
;;;2709   			if (fp->fs->winsect == fp->dsect && sync_window(fp->fs))	/* Write-back sector cache */
;;;2710   				ABORT(fp->fs, FR_DISK_ERR);
;;;2711   #else
;;;2712   			if (fp->flag & FA__DIRTY) {		/* Write-back sector cache */
;;;2713   				if (disk_write(fp->fs->drv, fp->buf, fp->dsect, 1) != RES_OK)
;;;2714   					ABORT(fp->fs, FR_DISK_ERR);
;;;2715   				fp->flag &= ~FA__DIRTY;
;;;2716   			}
;;;2717   #endif
;;;2718   			sect = clust2sect(fp->fs, fp->clust);	/* Get current sector */
;;;2719   			if (!sect) ABORT(fp->fs, FR_INT_ERR);
;;;2720   			sect += csect;
;;;2721   			cc = btw / SS(fp->fs);			/* When remaining bytes >= sector size, */
;;;2722   			if (cc) {						/* Write maximum contiguous sectors directly */
;;;2723   				if (csect + cc > fp->fs->csize)	/* Clip at cluster boundary */
;;;2724   					cc = fp->fs->csize - csect;
;;;2725   				if (disk_write(fp->fs->drv, wbuff, sect, cc) != RES_OK)
;;;2726   					ABORT(fp->fs, FR_DISK_ERR);
;;;2727   #if _FS_MINIMIZE <= 2
;;;2728   #if _FS_TINY
;;;2729   				if (fp->fs->winsect - sect < cc) {	/* Refill sector cache if it gets invalidated by the direct write */
;;;2730   					mem_cpy(fp->fs->win, wbuff + ((fp->fs->winsect - sect) * SS(fp->fs)), SS(fp->fs));
;;;2731   					fp->fs->wflag = 0;
;;;2732   				}
;;;2733   #else
;;;2734   				if (fp->dsect - sect < cc) { /* Refill sector cache if it gets invalidated by the direct write */
;;;2735   					mem_cpy(fp->buf, wbuff + ((fp->dsect - sect) * SS(fp->fs)), SS(fp->fs));
;;;2736   					fp->flag &= ~FA__DIRTY;
;;;2737   				}
;;;2738   #endif
;;;2739   #endif
;;;2740   				wcnt = SS(fp->fs) * cc;		/* Number of bytes transferred */
;;;2741   				continue;
;;;2742   			}
;;;2743   #if _FS_TINY
;;;2744   			if (fp->fptr >= fp->fsize) {	/* Avoid silly cache filling at growing edge */
;;;2745   				if (sync_window(fp->fs)) ABORT(fp->fs, FR_DISK_ERR);
;;;2746   				fp->fs->winsect = sect;
;;;2747   			}
;;;2748   #else
;;;2749   			if (fp->dsect != sect) {		/* Fill sector cache with file data */
;;;2750   				if (fp->fptr < fp->fsize &&
;;;2751   					disk_read(fp->fs->drv, fp->buf, sect, 1) != RES_OK)
;;;2752   						ABORT(fp->fs, FR_DISK_ERR);
;;;2753   			}
;;;2754   #endif
;;;2755   			fp->dsect = sect;
;;;2756   		}
;;;2757   		wcnt = SS(fp->fs) - ((UINT)fp->fptr % SS(fp->fs));/* Put partial sector into file I/O buffer */
;;;2758   		if (wcnt > btw) wcnt = btw;
;;;2759   #if _FS_TINY
;;;2760   		if (move_window(fp->fs, fp->dsect) != FR_OK)	/* Move sector window */
;;;2761   			ABORT(fp->fs, FR_DISK_ERR);
;;;2762   		mem_cpy(&fp->fs->win[fp->fptr % SS(fp->fs)], wbuff, wcnt);	/* Fit partial sector */
;;;2763   		fp->fs->wflag = 1;
;;;2764   #else
;;;2765   		mem_cpy(&fp->buf[fp->fptr % SS(fp->fs)], wbuff, wcnt);	/* Fit partial sector */
;;;2766   		fp->flag |= FA__DIRTY;
;;;2767   #endif
;;;2768   	}
;;;2769   
;;;2770   	if (fp->fptr > fp->fsize) fp->fsize = fp->fptr;	/* Update file size if needed */
;;;2771   	fp->flag |= FA__WRITTEN;						/* Set file change flag */
;;;2772   
;;;2773   	LEAVE_FF(fp->fs, FR_OK);
;;;2774   }
000024  b007              ADD      sp,sp,#0x1c
000026  e8bd8ff0          POP      {r4-r11,pc}
                  |L39.42|
00002a  79e0              LDRB     r0,[r4,#7]            ;2679
00002c  b108              CBZ      r0,|L39.50|
00002e  79e0              LDRB     r0,[r4,#7]            ;2680
000030  e7f8              B        |L39.36|
                  |L39.50|
000032  79a0              LDRB     r0,[r4,#6]            ;2681
000034  f0000002          AND      r0,r0,#2              ;2681
000038  b908              CBNZ     r0,|L39.62|
00003a  2007              MOVS     r0,#7                 ;2682
00003c  e7f2              B        |L39.36|
                  |L39.62|
00003e  68a0              LDR      r0,[r4,#8]            ;2683
000040  4428              ADD      r0,r0,r5              ;2683
000042  68a1              LDR      r1,[r4,#8]            ;2683
000044  4288              CMP      r0,r1                 ;2683
000046  d200              BCS      |L39.74|
000048  2500              MOVS     r5,#0                 ;2683
                  |L39.74|
00004a  e0be              B        |L39.458|
                  |L39.76|
00004c  8920              LDRH     r0,[r4,#8]            ;2687
00004e  f3c00008          UBFX     r0,r0,#0,#9           ;2687
000052  2800              CMP      r0,#0                 ;2687
000054  d17d              BNE      |L39.338|
000056  6820              LDR      r0,[r4,#0]            ;2688
000058  7880              LDRB     r0,[r0,#2]            ;2688
00005a  1e40              SUBS     r0,r0,#1              ;2688
00005c  68a1              LDR      r1,[r4,#8]            ;2688
00005e  ea002051          AND      r0,r0,r1,LSR #9       ;2688
000062  f0000aff          AND      r10,r0,#0xff          ;2688
000066  f1ba0f00          CMP      r10,#0                ;2689
00006a  d126              BNE      |L39.186|
00006c  68a0              LDR      r0,[r4,#8]            ;2690
00006e  b938              CBNZ     r0,|L39.128|
000070  6927              LDR      r7,[r4,#0x10]         ;2691
000072  b997              CBNZ     r7,|L39.154|
000074  2100              MOVS     r1,#0                 ;2693
000076  6820              LDR      r0,[r4,#0]            ;2693
000078  f7fffffe          BL       create_chain
00007c  4607              MOV      r7,r0                 ;2693
00007e  e00c              B        |L39.154|
                  |L39.128|
000080  6a60              LDR      r0,[r4,#0x24]         ;2696
000082  b128              CBZ      r0,|L39.144|
000084  4620              MOV      r0,r4                 ;2697
000086  68a1              LDR      r1,[r4,#8]            ;2697
000088  f7fffffe          BL       clmt_clust
00008c  4607              MOV      r7,r0                 ;2697
00008e  e004              B        |L39.154|
                  |L39.144|
000090  6961              LDR      r1,[r4,#0x14]         ;2700
000092  6820              LDR      r0,[r4,#0]            ;2700
000094  f7fffffe          BL       create_chain
000098  4607              MOV      r7,r0                 ;2700
                  |L39.154|
00009a  b907              CBNZ     r7,|L39.158|
00009c  e098              B        |L39.464|
                  |L39.158|
00009e  2f01              CMP      r7,#1                 ;2703
0000a0  d102              BNE      |L39.168|
0000a2  2002              MOVS     r0,#2                 ;2703
0000a4  71e0              STRB     r0,[r4,#7]            ;2703
0000a6  e7bd              B        |L39.36|
                  |L39.168|
0000a8  1c78              ADDS     r0,r7,#1              ;2704
0000aa  b910              CBNZ     r0,|L39.178|
0000ac  2001              MOVS     r0,#1                 ;2704
0000ae  71e0              STRB     r0,[r4,#7]            ;2704
0000b0  e7b8              B        |L39.36|
                  |L39.178|
0000b2  6167              STR      r7,[r4,#0x14]         ;2705
0000b4  6920              LDR      r0,[r4,#0x10]         ;2706
0000b6  b900              CBNZ     r0,|L39.186|
0000b8  6127              STR      r7,[r4,#0x10]         ;2706
                  |L39.186|
0000ba  79a0              LDRB     r0,[r4,#6]            ;2712
0000bc  f0000040          AND      r0,r0,#0x40           ;2712
0000c0  b178              CBZ      r0,|L39.226|
0000c2  6821              LDR      r1,[r4,#0]            ;2713
0000c4  7848              LDRB     r0,[r1,#1]            ;2713
0000c6  2301              MOVS     r3,#1                 ;2713
0000c8  f1040128          ADD      r1,r4,#0x28           ;2713
0000cc  69a2              LDR      r2,[r4,#0x18]         ;2713
0000ce  f7fffffe          BL       disk_write
0000d2  b110              CBZ      r0,|L39.218|
0000d4  2001              MOVS     r0,#1                 ;2714
0000d6  71e0              STRB     r0,[r4,#7]            ;2714
0000d8  e7a4              B        |L39.36|
                  |L39.218|
0000da  79a0              LDRB     r0,[r4,#6]            ;2715
0000dc  f0200040          BIC      r0,r0,#0x40           ;2715
0000e0  71a0              STRB     r0,[r4,#6]            ;2715
                  |L39.226|
0000e2  6961              LDR      r1,[r4,#0x14]         ;2718
0000e4  6820              LDR      r0,[r4,#0]            ;2718
0000e6  f7fffffe          BL       clust2sect
0000ea  4606              MOV      r6,r0                 ;2718
0000ec  b916              CBNZ     r6,|L39.244|
0000ee  2002              MOVS     r0,#2                 ;2719
0000f0  71e0              STRB     r0,[r4,#7]            ;2719
0000f2  e797              B        |L39.36|
                  |L39.244|
0000f4  4456              ADD      r6,r6,r10             ;2720
0000f6  ea4f2955          LSR      r9,r5,#9              ;2721
0000fa  f1b90f00          CMP      r9,#0                 ;2722
0000fe  d02c              BEQ      |L39.346|
000100  eb0a0009          ADD      r0,r10,r9             ;2723
000104  6821              LDR      r1,[r4,#0]            ;2723
000106  7889              LDRB     r1,[r1,#2]            ;2723
000108  4288              CMP      r0,r1                 ;2723
00010a  d903              BLS      |L39.276|
00010c  6820              LDR      r0,[r4,#0]            ;2724
00010e  7880              LDRB     r0,[r0,#2]            ;2724
000110  eba0090a          SUB      r9,r0,r10             ;2724
                  |L39.276|
000114  6821              LDR      r1,[r4,#0]            ;2725
000116  7848              LDRB     r0,[r1,#1]            ;2725
000118  464b              MOV      r3,r9                 ;2725
00011a  4632              MOV      r2,r6                 ;2725
00011c  9901              LDR      r1,[sp,#4]            ;2725
00011e  f7fffffe          BL       disk_write
000122  b110              CBZ      r0,|L39.298|
000124  2001              MOVS     r0,#1                 ;2726
000126  71e0              STRB     r0,[r4,#7]            ;2726
000128  e77c              B        |L39.36|
                  |L39.298|
00012a  69a0              LDR      r0,[r4,#0x18]         ;2734
00012c  1b80              SUBS     r0,r0,r6              ;2734
00012e  4548              CMP      r0,r9                 ;2734
000130  d20e              BCS      |L39.336|
000132  69a0              LDR      r0,[r4,#0x18]         ;2735
000134  1b80              SUBS     r0,r0,r6              ;2735
000136  9a01              LDR      r2,[sp,#4]            ;2735
000138  eb022140          ADD      r1,r2,r0,LSL #9       ;2735
00013c  f44f7200          MOV      r2,#0x200             ;2735
000140  f1040028          ADD      r0,r4,#0x28           ;2735
000144  f7fffffe          BL       mem_cpy
000148  79a0              LDRB     r0,[r4,#6]            ;2736
00014a  f0200040          BIC      r0,r0,#0x40           ;2736
00014e  71a0              STRB     r0,[r4,#6]            ;2736
                  |L39.336|
000150  e000              B        |L39.340|
                  |L39.338|
000152  e016              B        |L39.386|
                  |L39.340|
000154  ea4f2849          LSL      r8,r9,#9              ;2740
000158  e02a              B        |L39.432|
                  |L39.346|
00015a  69a0              LDR      r0,[r4,#0x18]         ;2749
00015c  42b0              CMP      r0,r6                 ;2749
00015e  d00f              BEQ      |L39.384|
000160  e9d40102          LDRD     r0,r1,[r4,#8]         ;2750
000164  4288              CMP      r0,r1                 ;2750
000166  d20b              BCS      |L39.384|
000168  6821              LDR      r1,[r4,#0]            ;2751
00016a  7848              LDRB     r0,[r1,#1]            ;2751
00016c  2301              MOVS     r3,#1                 ;2751
00016e  4632              MOV      r2,r6                 ;2751
000170  f1040128          ADD      r1,r4,#0x28           ;2751
000174  f7fffffe          BL       disk_read
000178  b110              CBZ      r0,|L39.384|
00017a  2001              MOVS     r0,#1                 ;2752
00017c  71e0              STRB     r0,[r4,#7]            ;2752
00017e  e751              B        |L39.36|
                  |L39.384|
000180  61a6              STR      r6,[r4,#0x18]         ;2755
                  |L39.386|
000182  8920              LDRH     r0,[r4,#8]            ;2757
000184  f3c00008          UBFX     r0,r0,#0,#9           ;2757
000188  f5c07800          RSB      r8,r0,#0x200          ;2757
00018c  45a8              CMP      r8,r5                 ;2758
00018e  d900              BLS      |L39.402|
000190  46a8              MOV      r8,r5                 ;2758
                  |L39.402|
000192  8921              LDRH     r1,[r4,#8]            ;2765
000194  f3c10208          UBFX     r2,r1,#0,#9           ;2765
000198  f1040128          ADD      r1,r4,#0x28           ;2765
00019c  1850              ADDS     r0,r2,r1              ;2765
00019e  4642              MOV      r2,r8                 ;2765
0001a0  9901              LDR      r1,[sp,#4]            ;2765
0001a2  f7fffffe          BL       mem_cpy
0001a6  79a0              LDRB     r0,[r4,#6]            ;2766
0001a8  f0400040          ORR      r0,r0,#0x40           ;2766
0001ac  71a0              STRB     r0,[r4,#6]            ;2766
0001ae  bf00              NOP                            ;2741
                  |L39.432|
0001b0  9801              LDR      r0,[sp,#4]            ;2686
0001b2  4440              ADD      r0,r0,r8              ;2686
0001b4  9001              STR      r0,[sp,#4]            ;2686
0001b6  68a0              LDR      r0,[r4,#8]            ;2686
0001b8  4440              ADD      r0,r0,r8              ;2686
0001ba  60a0              STR      r0,[r4,#8]            ;2686
0001bc  f8db0000          LDR      r0,[r11,#0]           ;2686
0001c0  4440              ADD      r0,r0,r8              ;2686
0001c2  f8cb0000          STR      r0,[r11,#0]           ;2686
0001c6  eba50508          SUB      r5,r5,r8              ;2686
                  |L39.458|
0001ca  2d00              CMP      r5,#0                 ;2685
0001cc  f47faf3e          BNE      |L39.76|
                  |L39.464|
0001d0  bf00              NOP                            ;2702
0001d2  e9d40102          LDRD     r0,r1,[r4,#8]         ;2770
0001d6  4288              CMP      r0,r1                 ;2770
0001d8  d901              BLS      |L39.478|
0001da  68a0              LDR      r0,[r4,#8]            ;2770
0001dc  60e0              STR      r0,[r4,#0xc]          ;2770
                  |L39.478|
0001de  79a0              LDRB     r0,[r4,#6]            ;2771
0001e0  f0400020          ORR      r0,r0,#0x20           ;2771
0001e4  71a0              STRB     r0,[r4,#6]            ;2771
0001e6  2000              MOVS     r0,#0                 ;2773
0001e8  e71c              B        |L39.36|
;;;2775   
                          ENDP


                          AREA ||i.ff_convert||, CODE, READONLY, ALIGN=1

                  ff_convert PROC
;;;33     }
;;;34     WCHAR ff_convert (	/* Converted code, 0 means conversion error */
000000  4770              BX       lr
;;;35     	WCHAR	src,	/* Character code to be converted */
;;;36     	UINT	dir		/* 0: Unicode to OEMCP, 1: OEMCP to Unicode */
;;;37     )
;;;38     {
;;;39     	return src;
;;;40     }		  
;;;41     
                          ENDP


                          AREA ||i.ff_wtoupper||, CODE, READONLY, ALIGN=2

                  ff_wtoupper PROC
;;;80     #endif
;;;21     WCHAR ff_wtoupper (	/* Upper converted character */
000000  4602              MOV      r2,r0
;;;22     	WCHAR chr		/* Input character */
;;;23     )
;;;24     {
;;;25     	static const WCHAR tbl_lower[] = { 0x61, 0x62, 0x63, 0x64, 0x65, 0x66, 0x67, 0x68, 0x69, 0x6A, 0x6B, 0x6C, 0x6D, 0x6E, 0x6F, 0x70, 0x71, 0x72, 0x73, 0x74, 0x75, 0x76, 0x77, 0x78, 0x79, 0x7A, 0xA1, 0x00A2, 0x00A3, 0x00A5, 0x00AC, 0x00AF, 0xE0, 0xE1, 0xE2, 0xE3, 0xE4, 0xE5, 0xE6, 0xE7, 0xE8, 0xE9, 0xEA, 0xEB, 0xEC, 0xED, 0xEE, 0xEF, 0xF0, 0xF1, 0xF2, 0xF3, 0xF4, 0xF5, 0xF6, 0xF8, 0xF9, 0xFA, 0xFB, 0xFC, 0xFD, 0xFE, 0x0FF, 0x101, 0x103, 0x105, 0x107, 0x109, 0x10B, 0x10D, 0x10F, 0x111, 0x113, 0x115, 0x117, 0x119, 0x11B, 0x11D, 0x11F, 0x121, 0x123, 0x125, 0x127, 0x129, 0x12B, 0x12D, 0x12F, 0x131, 0x133, 0x135, 0x137, 0x13A, 0x13C, 0x13E, 0x140, 0x142, 0x144, 0x146, 0x148, 0x14B, 0x14D, 0x14F, 0x151, 0x153, 0x155, 0x157, 0x159, 0x15B, 0x15D, 0x15F, 0x161, 0x163, 0x165, 0x167, 0x169, 0x16B, 0x16D, 0x16F, 0x171, 0x173, 0x175, 0x177, 0x17A, 0x17C, 0x17E, 0x192, 0x3B1, 0x3B2, 0x3B3, 0x3B4, 0x3B5, 0x3B6, 0x3B7, 0x3B8, 0x3B9, 0x3BA, 0x3BB, 0x3BC, 0x3BD, 0x3BE, 0x3BF, 0x3C0, 0x3C1, 0x3C3, 0x3C4, 0x3C5, 0x3C6, 0x3C7, 0x3C8, 0x3C9, 0x3CA, 0x430, 0x431, 0x432, 0x433, 0x434, 0x435, 0x436, 0x437, 0x438, 0x439, 0x43A, 0x43B, 0x43C, 0x43D, 0x43E, 0x43F, 0x440, 0x441, 0x442, 0x443, 0x444, 0x445, 0x446, 0x447, 0x448, 0x449, 0x44A, 0x44B, 0x44C, 0x44D, 0x44E, 0x44F, 0x451, 0x452, 0x453, 0x454, 0x455, 0x456, 0x457, 0x458, 0x459, 0x45A, 0x45B, 0x45C, 0x45E, 0x45F, 0x2170, 0x2171, 0x2172, 0x2173, 0x2174, 0x2175, 0x2176, 0x2177, 0x2178, 0x2179, 0x217A, 0x217B, 0x217C, 0x217D, 0x217E, 0x217F, 0xFF41, 0xFF42, 0xFF43, 0xFF44, 0xFF45, 0xFF46, 0xFF47, 0xFF48, 0xFF49, 0xFF4A, 0xFF4B, 0xFF4C, 0xFF4D, 0xFF4E, 0xFF4F, 0xFF50, 0xFF51, 0xFF52, 0xFF53, 0xFF54, 0xFF55, 0xFF56, 0xFF57, 0xFF58, 0xFF59, 0xFF5A, 0 };
;;;26     	static const WCHAR tbl_upper[] = { 0x41, 0x42, 0x43, 0x44, 0x45, 0x46, 0x47, 0x48, 0x49, 0x4A, 0x4B, 0x4C, 0x4D, 0x4E, 0x4F, 0x50, 0x51, 0x52, 0x53, 0x54, 0x55, 0x56, 0x57, 0x58, 0x59, 0x5A, 0x21, 0xFFE0, 0xFFE1, 0xFFE5, 0xFFE2, 0xFFE3, 0xC0, 0xC1, 0xC2, 0xC3, 0xC4, 0xC5, 0xC6, 0xC7, 0xC8, 0xC9, 0xCA, 0xCB, 0xCC, 0xCD, 0xCE, 0xCF, 0xD0, 0xD1, 0xD2, 0xD3, 0xD4, 0xD5, 0xD6, 0xD8, 0xD9, 0xDA, 0xDB, 0xDC, 0xDD, 0xDE, 0x178, 0x100, 0x102, 0x104, 0x106, 0x108, 0x10A, 0x10C, 0x10E, 0x110, 0x112, 0x114, 0x116, 0x118, 0x11A, 0x11C, 0x11E, 0x120, 0x122, 0x124, 0x126, 0x128, 0x12A, 0x12C, 0x12E, 0x130, 0x132, 0x134, 0x136, 0x139, 0x13B, 0x13D, 0x13F, 0x141, 0x143, 0x145, 0x147, 0x14A, 0x14C, 0x14E, 0x150, 0x152, 0x154, 0x156, 0x158, 0x15A, 0x15C, 0x15E, 0x160, 0x162, 0x164, 0x166, 0x168, 0x16A, 0x16C, 0x16E, 0x170, 0x172, 0x174, 0x176, 0x179, 0x17B, 0x17D, 0x191, 0x391, 0x392, 0x393, 0x394, 0x395, 0x396, 0x397, 0x398, 0x399, 0x39A, 0x39B, 0x39C, 0x39D, 0x39E, 0x39F, 0x3A0, 0x3A1, 0x3A3, 0x3A4, 0x3A5, 0x3A6, 0x3A7, 0x3A8, 0x3A9, 0x3AA, 0x410, 0x411, 0x412, 0x413, 0x414, 0x415, 0x416, 0x417, 0x418, 0x419, 0x41A, 0x41B, 0x41C, 0x41D, 0x41E, 0x41F, 0x420, 0x421, 0x422, 0x423, 0x424, 0x425, 0x426, 0x427, 0x428, 0x429, 0x42A, 0x42B, 0x42C, 0x42D, 0x42E, 0x42F, 0x401, 0x402, 0x403, 0x404, 0x405, 0x406, 0x407, 0x408, 0x409, 0x40A, 0x40B, 0x40C, 0x40E, 0x40F, 0x2160, 0x2161, 0x2162, 0x2163, 0x2164, 0x2165, 0x2166, 0x2167, 0x2168, 0x2169, 0x216A, 0x216B, 0x216C, 0x216D, 0x216E, 0x216F, 0xFF21, 0xFF22, 0xFF23, 0xFF24, 0xFF25, 0xFF26, 0xFF27, 0xFF28, 0xFF29, 0xFF2A, 0xFF2B, 0xFF2C, 0xFF2D, 0xFF2E, 0xFF2F, 0xFF30, 0xFF31, 0xFF32, 0xFF33, 0xFF34, 0xFF35, 0xFF36, 0xFF37, 0xFF38, 0xFF39, 0xFF3A, 0 };
;;;27     	int i;
;;;28     
;;;29     
;;;30     	for (i = 0; tbl_lower[i] && chr != tbl_lower[i]; i++) ;
000002  2100              MOVS     r1,#0
000004  e000              B        |L41.8|
                  |L41.6|
000006  1c49              ADDS     r1,r1,#1
                  |L41.8|
000008  4809              LDR      r0,|L41.48|
00000a  f8300011          LDRH     r0,[r0,r1,LSL #1]
00000e  b120              CBZ      r0,|L41.26|
000010  4807              LDR      r0,|L41.48|
000012  f8300011          LDRH     r0,[r0,r1,LSL #1]
000016  4290              CMP      r0,r2
000018  d1f5              BNE      |L41.6|
                  |L41.26|
;;;31     
;;;32     	return tbl_lower[i] ? tbl_upper[i] : chr;
00001a  4805              LDR      r0,|L41.48|
00001c  f8300011          LDRH     r0,[r0,r1,LSL #1]
000020  b118              CBZ      r0,|L41.42|
000022  4804              LDR      r0,|L41.52|
000024  f8300011          LDRH     r0,[r0,r1,LSL #1]
                  |L41.40|
;;;33     }
000028  4770              BX       lr
                  |L41.42|
00002a  4610              MOV      r0,r2                 ;32
00002c  e7fc              B        |L41.40|
;;;34     WCHAR ff_convert (	/* Converted code, 0 means conversion error */
                          ENDP

00002e  0000              DCW      0x0000
                  |L41.48|
                          DCD      tbl_lower
                  |L41.52|
                          DCD      tbl_upper

                          AREA ||i.find_volume||, CODE, READONLY, ALIGN=2

                  find_volume PROC
;;;2174   static
;;;2175   FRESULT find_volume (	/* FR_OK(0): successful, !=0: any error occurred */
000000  e92d4ff7          PUSH     {r0-r2,r4-r11,lr}
;;;2176   	FATFS** rfs,		/* Pointer to pointer to the found file system object */
;;;2177   	const TCHAR** path,	/* Pointer to pointer to the path name (drive number) */
;;;2178   	BYTE wmode			/* !=0: Check write protection for write access */
;;;2179   )
;;;2180   {
000004  b08a              SUB      sp,sp,#0x28
;;;2181   	BYTE fmt, *pt;
;;;2182   	int vol;
;;;2183   	DSTATUS stat;
;;;2184   	DWORD bsect, fasize, tsect, sysect, nclst, szbfat, br[4];
;;;2185   	WORD nrsv;
;;;2186   	FATFS *fs;
;;;2187   	UINT i;
;;;2188   
;;;2189   
;;;2190   	/* Get logical drive number from the path name */
;;;2191   	*rfs = 0;
000006  2100              MOVS     r1,#0
000008  980a              LDR      r0,[sp,#0x28]
00000a  6001              STR      r1,[r0,#0]
;;;2192   	vol = get_ldnumber(path);
00000c  980b              LDR      r0,[sp,#0x2c]
00000e  f7fffffe          BL       get_ldnumber
000012  9009              STR      r0,[sp,#0x24]
;;;2193   	if (vol < 0) return FR_INVALID_DRIVE;
000014  9809              LDR      r0,[sp,#0x24]
000016  2800              CMP      r0,#0
000018  da03              BGE      |L42.34|
00001a  200b              MOVS     r0,#0xb
                  |L42.28|
;;;2194   
;;;2195   	/* Check if the file system object is valid or not */
;;;2196   	fs = FatFs[vol];					/* Get pointer to the file system object */
;;;2197   	if (!fs) return FR_NOT_ENABLED;		/* Is the file system object available? */
;;;2198   
;;;2199   	ENTER_FF(fs);						/* Lock the volume */
;;;2200   	*rfs = fs;							/* Return pointer to the file system object */
;;;2201   
;;;2202   	if (fs->fs_type) {					/* If the volume has been mounted */
;;;2203   		stat = disk_status(fs->drv);
;;;2204   		if (!(stat & STA_NOINIT)) {		/* and the physical drive is kept initialized */
;;;2205   			if (!_FS_READONLY && wmode && (stat & STA_PROTECT))	/* Check write protection if needed */
;;;2206   				return FR_WRITE_PROTECTED;
;;;2207   			return FR_OK;				/* The file system object is valid */
;;;2208   		}
;;;2209   	}
;;;2210   
;;;2211   	/* The file system object is not valid. */
;;;2212   	/* Following code attempts to mount the volume. (analyze BPB and initialize the fs object) */
;;;2213   
;;;2214   	fs->fs_type = 0;					/* Clear the file system object */
;;;2215   	fs->drv = LD2PD(vol);				/* Bind the logical drive and a physical drive */
;;;2216   	stat = disk_initialize(fs->drv);	/* Initialize the physical drive */
;;;2217   	if (stat & STA_NOINIT)				/* Check if the initialization succeeded */
;;;2218   		return FR_NOT_READY;			/* Failed to initialize due to no medium or hard error */
;;;2219   	if (!_FS_READONLY && wmode && (stat & STA_PROTECT))	/* Check disk write protection if needed */
;;;2220   		return FR_WRITE_PROTECTED;
;;;2221   #if _MAX_SS != _MIN_SS						/* Get sector size (multiple sector size cfg only) */
;;;2222   	if (disk_ioctl(fs->drv, GET_SECTOR_SIZE, &SS(fs)) != RES_OK
;;;2223   		|| SS(fs) < _MIN_SS || SS(fs) > _MAX_SS) return FR_DISK_ERR;
;;;2224   #endif
;;;2225   	/* Find an FAT partition on the drive. Supports only generic partitioning, FDISK and SFD. */
;;;2226   	bsect = 0;
;;;2227   	fmt = check_fs(fs, bsect);					/* Load sector 0 and check if it is an FAT boot sector as SFD */
;;;2228   	if (fmt == 1 || (!fmt && (LD2PT(vol)))) {	/* Not an FAT boot sector or forced partition number */
;;;2229   		for (i = 0; i < 4; i++) {			/* Get partition offset */
;;;2230   			pt = fs->win + MBR_Table + i * SZ_PTE;
;;;2231   			br[i] = pt[4] ? LD_DWORD(&pt[8]) : 0;
;;;2232   		}
;;;2233   		i = LD2PT(vol);						/* Partition number: 0:auto, 1-4:forced */
;;;2234   		if (i) i--;
;;;2235   		do {								/* Find an FAT volume */
;;;2236   			bsect = br[i];
;;;2237   			fmt = bsect ? check_fs(fs, bsect) : 2;	/* Check the partition */
;;;2238   		} while (!LD2PT(vol) && fmt && ++i < 4);
;;;2239   	}
;;;2240   	if (fmt == 3) return FR_DISK_ERR;		/* An error occured in the disk I/O layer */
;;;2241   	if (fmt) return FR_NO_FILESYSTEM;		/* No FAT volume is found */
;;;2242   
;;;2243   	/* An FAT volume is found. Following code initializes the file system object */
;;;2244   
;;;2245   	if (LD_WORD(fs->win + BPB_BytsPerSec) != SS(fs))	/* (BPB_BytsPerSec must be equal to the physical sector size) */
;;;2246   		return FR_NO_FILESYSTEM;
;;;2247   
;;;2248   	fasize = LD_WORD(fs->win + BPB_FATSz16);			/* Number of sectors per FAT */
;;;2249   	if (!fasize) fasize = LD_DWORD(fs->win + BPB_FATSz32);
;;;2250   	fs->fsize = fasize;
;;;2251   
;;;2252   	fs->n_fats = fs->win[BPB_NumFATs];					/* Number of FAT copies */
;;;2253   	if (fs->n_fats != 1 && fs->n_fats != 2)				/* (Must be 1 or 2) */
;;;2254   		return FR_NO_FILESYSTEM;
;;;2255   	fasize *= fs->n_fats;								/* Number of sectors for FAT area */
;;;2256   
;;;2257   	fs->csize = fs->win[BPB_SecPerClus];				/* Number of sectors per cluster */
;;;2258   	if (!fs->csize || (fs->csize & (fs->csize - 1)))	/* (Must be power of 2) */
;;;2259   		return FR_NO_FILESYSTEM;
;;;2260   
;;;2261   	fs->n_rootdir = LD_WORD(fs->win + BPB_RootEntCnt);	/* Number of root directory entries */
;;;2262   	if (fs->n_rootdir % (SS(fs) / SZ_DIRE))				/* (Must be sector aligned) */
;;;2263   		return FR_NO_FILESYSTEM;
;;;2264   
;;;2265   	tsect = LD_WORD(fs->win + BPB_TotSec16);			/* Number of sectors on the volume */
;;;2266   	if (!tsect) tsect = LD_DWORD(fs->win + BPB_TotSec32);
;;;2267   
;;;2268   	nrsv = LD_WORD(fs->win + BPB_RsvdSecCnt);			/* Number of reserved sectors */
;;;2269   	if (!nrsv) return FR_NO_FILESYSTEM;					/* (Must not be 0) */
;;;2270   
;;;2271   	/* Determine the FAT sub type */
;;;2272   	sysect = nrsv + fasize + fs->n_rootdir / (SS(fs) / SZ_DIRE);	/* RSV + FAT + DIR */
;;;2273   	if (tsect < sysect) return FR_NO_FILESYSTEM;		/* (Invalid volume size) */
;;;2274   	nclst = (tsect - sysect) / fs->csize;				/* Number of clusters */
;;;2275   	if (!nclst) return FR_NO_FILESYSTEM;				/* (Invalid volume size) */
;;;2276   	fmt = FS_FAT12;
;;;2277   	if (nclst >= MIN_FAT16) fmt = FS_FAT16;
;;;2278   	if (nclst >= MIN_FAT32) fmt = FS_FAT32;
;;;2279   
;;;2280   	/* Boundaries and Limits */
;;;2281   	fs->n_fatent = nclst + 2;							/* Number of FAT entries */
;;;2282   	fs->volbase = bsect;								/* Volume start sector */
;;;2283   	fs->fatbase = bsect + nrsv; 						/* FAT start sector */
;;;2284   	fs->database = bsect + sysect;						/* Data start sector */
;;;2285   	if (fmt == FS_FAT32) {
;;;2286   		if (fs->n_rootdir) return FR_NO_FILESYSTEM;		/* (BPB_RootEntCnt must be 0) */
;;;2287   		fs->dirbase = LD_DWORD(fs->win + BPB_RootClus);	/* Root directory start cluster */
;;;2288   		szbfat = fs->n_fatent * 4;						/* (Needed FAT size) */
;;;2289   	} else {
;;;2290   		if (!fs->n_rootdir)	return FR_NO_FILESYSTEM;	/* (BPB_RootEntCnt must not be 0) */
;;;2291   		fs->dirbase = fs->fatbase + fasize;				/* Root directory start sector */
;;;2292   		szbfat = (fmt == FS_FAT16) ?					/* (Needed FAT size) */
;;;2293   			fs->n_fatent * 2 : fs->n_fatent * 3 / 2 + (fs->n_fatent & 1);
;;;2294   	}
;;;2295   	if (fs->fsize < (szbfat + (SS(fs) - 1)) / SS(fs))	/* (BPB_FATSz must not be less than the size needed) */
;;;2296   		return FR_NO_FILESYSTEM;
;;;2297   
;;;2298   #if !_FS_READONLY
;;;2299   	/* Initialize cluster allocation information */
;;;2300   	fs->last_clust = fs->free_clust = 0xFFFFFFFF;
;;;2301   
;;;2302   	/* Get fsinfo if available */
;;;2303   	fs->fsi_flag = 0x80;
;;;2304   #if (_FS_NOFSINFO & 3) != 3
;;;2305   	if (fmt == FS_FAT32				/* Enable FSINFO only if FAT32 and BPB_FSInfo is 1 */
;;;2306   		&& LD_WORD(fs->win + BPB_FSInfo) == 1
;;;2307   		&& move_window(fs, bsect + 1) == FR_OK)
;;;2308   	{
;;;2309   		fs->fsi_flag = 0;
;;;2310   		if (LD_WORD(fs->win + BS_55AA) == 0xAA55	/* Load FSINFO data if available */
;;;2311   			&& LD_DWORD(fs->win + FSI_LeadSig) == 0x41615252
;;;2312   			&& LD_DWORD(fs->win + FSI_StrucSig) == 0x61417272)
;;;2313   		{
;;;2314   #if (_FS_NOFSINFO & 1) == 0
;;;2315   			fs->free_clust = LD_DWORD(fs->win + FSI_Free_Count);
;;;2316   #endif
;;;2317   #if (_FS_NOFSINFO & 2) == 0
;;;2318   			fs->last_clust = LD_DWORD(fs->win + FSI_Nxt_Free);
;;;2319   #endif
;;;2320   		}
;;;2321   	}
;;;2322   #endif
;;;2323   #endif
;;;2324   	fs->fs_type = fmt;	/* FAT sub-type */
;;;2325   	fs->id = ++Fsid;	/* File system mount ID */
;;;2326   #if _FS_RPATH
;;;2327   	fs->cdir = 0;		/* Set current directory to root */
;;;2328   #endif
;;;2329   #if _FS_LOCK			/* Clear file lock semaphores */
;;;2330   	clear_lock(fs);
;;;2331   #endif
;;;2332   
;;;2333   	return FR_OK;
;;;2334   }
00001c  b00d              ADD      sp,sp,#0x34
00001e  e8bd8ff0          POP      {r4-r11,pc}
                  |L42.34|
000022  49d8              LDR      r1,|L42.900|
000024  9809              LDR      r0,[sp,#0x24]         ;2196
000026  f8514020          LDR      r4,[r1,r0,LSL #2]     ;2196
00002a  b90c              CBNZ     r4,|L42.48|
00002c  200c              MOVS     r0,#0xc               ;2197
00002e  e7f5              B        |L42.28|
                  |L42.48|
000030  980a              LDR      r0,[sp,#0x28]         ;2200
000032  6004              STR      r4,[r0,#0]            ;2200
000034  7820              LDRB     r0,[r4,#0]            ;2202
000036  b178              CBZ      r0,|L42.88|
000038  7860              LDRB     r0,[r4,#1]            ;2203
00003a  f7fffffe          BL       disk_status
00003e  4681              MOV      r9,r0                 ;2203
000040  f0090001          AND      r0,r9,#1              ;2204
000044  b940              CBNZ     r0,|L42.88|
000046  980c              LDR      r0,[sp,#0x30]         ;2205
000048  b120              CBZ      r0,|L42.84|
00004a  f0090004          AND      r0,r9,#4              ;2205
00004e  b108              CBZ      r0,|L42.84|
000050  200a              MOVS     r0,#0xa               ;2206
000052  e7e3              B        |L42.28|
                  |L42.84|
000054  2000              MOVS     r0,#0                 ;2207
000056  e7e1              B        |L42.28|
                  |L42.88|
000058  2000              MOVS     r0,#0                 ;2214
00005a  7020              STRB     r0,[r4,#0]            ;2214
00005c  9809              LDR      r0,[sp,#0x24]         ;2215
00005e  7060              STRB     r0,[r4,#1]            ;2215
000060  7860              LDRB     r0,[r4,#1]            ;2216
000062  f7fffffe          BL       disk_initialize
000066  4681              MOV      r9,r0                 ;2216
000068  f0090001          AND      r0,r9,#1              ;2217
00006c  b108              CBZ      r0,|L42.114|
00006e  2003              MOVS     r0,#3                 ;2218
000070  e7d4              B        |L42.28|
                  |L42.114|
000072  980c              LDR      r0,[sp,#0x30]         ;2219
000074  b120              CBZ      r0,|L42.128|
000076  f0090004          AND      r0,r9,#4              ;2219
00007a  b108              CBZ      r0,|L42.128|
00007c  200a              MOVS     r0,#0xa               ;2220
00007e  e7cd              B        |L42.28|
                  |L42.128|
000080  2700              MOVS     r7,#0                 ;2226
000082  4639              MOV      r1,r7                 ;2227
000084  4620              MOV      r0,r4                 ;2227
000086  f7fffffe          BL       check_fs
00008a  4605              MOV      r5,r0                 ;2227
00008c  2d01              CMP      r5,#1                 ;2228
00008e  d001              BEQ      |L42.148|
000090  bb9d              CBNZ     r5,|L42.250|
000092  e032              B        |L42.250|
                  |L42.148|
000094  2600              MOVS     r6,#0                 ;2229
000096  e01a              B        |L42.206|
                  |L42.152|
000098  f50470f7          ADD      r0,r4,#0x1ee          ;2230
00009c  eb001806          ADD      r8,r0,r6,LSL #4       ;2230
0000a0  f8980004          LDRB     r0,[r8,#4]            ;2231
0000a4  b170              CBZ      r0,|L42.196|
0000a6  f898000b          LDRB     r0,[r8,#0xb]          ;2231
0000aa  0601              LSLS     r1,r0,#24             ;2231
0000ac  f898000a          LDRB     r0,[r8,#0xa]          ;2231
0000b0  ea414100          ORR      r1,r1,r0,LSL #16      ;2231
0000b4  f8980009          LDRB     r0,[r8,#9]            ;2231
0000b8  ea412000          ORR      r0,r1,r0,LSL #8       ;2231
0000bc  f8981008          LDRB     r1,[r8,#8]            ;2231
0000c0  4308              ORRS     r0,r0,r1              ;2231
0000c2  e000              B        |L42.198|
                  |L42.196|
0000c4  2000              MOVS     r0,#0                 ;2231
                  |L42.198|
0000c6  a902              ADD      r1,sp,#8              ;2231
0000c8  f8410026          STR      r0,[r1,r6,LSL #2]     ;2231
0000cc  1c76              ADDS     r6,r6,#1              ;2229
                  |L42.206|
0000ce  2e04              CMP      r6,#4                 ;2229
0000d0  d3e2              BCC      |L42.152|
0000d2  2600              MOVS     r6,#0                 ;2233
0000d4  b106              CBZ      r6,|L42.216|
0000d6  1e76              SUBS     r6,r6,#1              ;2234
                  |L42.216|
0000d8  bf00              NOP                            ;2235
                  |L42.218|
0000da  a802              ADD      r0,sp,#8              ;2236
0000dc  f8507026          LDR      r7,[r0,r6,LSL #2]     ;2236
0000e0  b127              CBZ      r7,|L42.236|
0000e2  4639              MOV      r1,r7                 ;2237
0000e4  4620              MOV      r0,r4                 ;2237
0000e6  f7fffffe          BL       check_fs
0000ea  e000              B        |L42.238|
                  |L42.236|
0000ec  2002              MOVS     r0,#2                 ;2237
                  |L42.238|
0000ee  4605              MOV      r5,r0                 ;2237
0000f0  b11d              CBZ      r5,|L42.250|
0000f2  1c70              ADDS     r0,r6,#1              ;2238
0000f4  4606              MOV      r6,r0                 ;2238
0000f6  2804              CMP      r0,#4                 ;2238
0000f8  d3ef              BCC      |L42.218|
                  |L42.250|
0000fa  2d03              CMP      r5,#3                 ;2240
0000fc  d101              BNE      |L42.258|
0000fe  2001              MOVS     r0,#1                 ;2240
000100  e78c              B        |L42.28|
                  |L42.258|
000102  b10d              CBZ      r5,|L42.264|
000104  200d              MOVS     r0,#0xd               ;2241
000106  e789              B        |L42.28|
                  |L42.264|
000108  203b              MOVS     r0,#0x3b              ;2245
00010a  5d01              LDRB     r1,[r0,r4]            ;2245
00010c  f894003c          LDRB     r0,[r4,#0x3c]         ;2245
000110  ea412000          ORR      r0,r1,r0,LSL #8       ;2245
000114  f5b07f00          CMP      r0,#0x200             ;2245
000118  d001              BEQ      |L42.286|
00011a  200d              MOVS     r0,#0xd               ;2246
00011c  e77e              B        |L42.28|
                  |L42.286|
00011e  2046              MOVS     r0,#0x46              ;2248
000120  5d01              LDRB     r1,[r0,r4]            ;2248
000122  f8940047          LDRB     r0,[r4,#0x47]         ;2248
000126  ea412a00          ORR      r10,r1,r0,LSL #8      ;2248
00012a  f1ba0f00          CMP      r10,#0                ;2249
00012e  d10e              BNE      |L42.334|
000130  f8940057          LDRB     r0,[r4,#0x57]         ;2249
000134  0601              LSLS     r1,r0,#24             ;2249
000136  f8940056          LDRB     r0,[r4,#0x56]         ;2249
00013a  ea414100          ORR      r1,r1,r0,LSL #16      ;2249
00013e  f8940055          LDRB     r0,[r4,#0x55]         ;2249
000142  ea412000          ORR      r0,r1,r0,LSL #8       ;2249
000146  f8941054          LDRB     r1,[r4,#0x54]         ;2249
00014a  ea400a01          ORR      r10,r0,r1             ;2249
                  |L42.334|
00014e  f8c4a018          STR      r10,[r4,#0x18]        ;2250
000152  2040              MOVS     r0,#0x40              ;2252
000154  5d00              LDRB     r0,[r0,r4]            ;2252
000156  70e0              STRB     r0,[r4,#3]            ;2252
000158  78e0              LDRB     r0,[r4,#3]            ;2253
00015a  2801              CMP      r0,#1                 ;2253
00015c  d004              BEQ      |L42.360|
00015e  78e0              LDRB     r0,[r4,#3]            ;2253
000160  2802              CMP      r0,#2                 ;2253
000162  d001              BEQ      |L42.360|
000164  200d              MOVS     r0,#0xd               ;2254
000166  e759              B        |L42.28|
                  |L42.360|
000168  78e0              LDRB     r0,[r4,#3]            ;2255
00016a  fb0afa00          MUL      r10,r10,r0            ;2255
00016e  203d              MOVS     r0,#0x3d              ;2257
000170  5d00              LDRB     r0,[r0,r4]            ;2257
000172  70a0              STRB     r0,[r4,#2]            ;2257
000174  78a0              LDRB     r0,[r4,#2]            ;2258
000176  b118              CBZ      r0,|L42.384|
000178  78a0              LDRB     r0,[r4,#2]            ;2258
00017a  1e41              SUBS     r1,r0,#1              ;2258
00017c  4008              ANDS     r0,r0,r1              ;2258
00017e  b108              CBZ      r0,|L42.388|
                  |L42.384|
000180  200d              MOVS     r0,#0xd               ;2259
000182  e74b              B        |L42.28|
                  |L42.388|
000184  2041              MOVS     r0,#0x41              ;2261
000186  5d01              LDRB     r1,[r0,r4]            ;2261
000188  f8940042          LDRB     r0,[r4,#0x42]         ;2261
00018c  ea412000          ORR      r0,r1,r0,LSL #8       ;2261
000190  8120              STRH     r0,[r4,#8]            ;2261
000192  7a20              LDRB     r0,[r4,#8]            ;2262
000194  f000000f          AND      r0,r0,#0xf            ;2262
000198  b108              CBZ      r0,|L42.414|
00019a  200d              MOVS     r0,#0xd               ;2263
00019c  e73e              B        |L42.28|
                  |L42.414|
00019e  2043              MOVS     r0,#0x43              ;2265
0001a0  5d01              LDRB     r1,[r0,r4]            ;2265
0001a2  f8940044          LDRB     r0,[r4,#0x44]         ;2265
0001a6  ea412000          ORR      r0,r1,r0,LSL #8       ;2265
0001aa  9008              STR      r0,[sp,#0x20]         ;2265
0001ac  9808              LDR      r0,[sp,#0x20]         ;2266
0001ae  b970              CBNZ     r0,|L42.462|
0001b0  f8940053          LDRB     r0,[r4,#0x53]         ;2266
0001b4  0601              LSLS     r1,r0,#24             ;2266
0001b6  f8940052          LDRB     r0,[r4,#0x52]         ;2266
0001ba  ea414100          ORR      r1,r1,r0,LSL #16      ;2266
0001be  f8940051          LDRB     r0,[r4,#0x51]         ;2266
0001c2  ea412000          ORR      r0,r1,r0,LSL #8       ;2266
0001c6  f8941050          LDRB     r1,[r4,#0x50]         ;2266
0001ca  4308              ORRS     r0,r0,r1              ;2266
0001cc  9008              STR      r0,[sp,#0x20]         ;2266
                  |L42.462|
0001ce  203e              MOVS     r0,#0x3e              ;2268
0001d0  5d01              LDRB     r1,[r0,r4]            ;2268
0001d2  f894003f          LDRB     r0,[r4,#0x3f]         ;2268
0001d6  ea412000          ORR      r0,r1,r0,LSL #8       ;2268
0001da  9001              STR      r0,[sp,#4]            ;2268
0001dc  9801              LDR      r0,[sp,#4]            ;2269
0001de  b908              CBNZ     r0,|L42.484|
0001e0  200d              MOVS     r0,#0xd               ;2269
0001e2  e71b              B        |L42.28|
                  |L42.484|
0001e4  9801              LDR      r0,[sp,#4]            ;2272
0001e6  4450              ADD      r0,r0,r10             ;2272
0001e8  8921              LDRH     r1,[r4,#8]            ;2272
0001ea  eb001011          ADD      r0,r0,r1,LSR #4       ;2272
0001ee  9007              STR      r0,[sp,#0x1c]         ;2272
0001f0  e9dd0107          LDRD     r0,r1,[sp,#0x1c]      ;2273
0001f4  4281              CMP      r1,r0                 ;2273
0001f6  d201              BCS      |L42.508|
0001f8  200d              MOVS     r0,#0xd               ;2273
0001fa  e70f              B        |L42.28|
                  |L42.508|
0001fc  e9dd1007          LDRD     r1,r0,[sp,#0x1c]      ;2274
000200  1a40              SUBS     r0,r0,r1              ;2274
000202  78a1              LDRB     r1,[r4,#2]            ;2274
000204  fbb0fbf1          UDIV     r11,r0,r1             ;2274
000208  f1bb0f00          CMP      r11,#0                ;2275
00020c  d101              BNE      |L42.530|
00020e  200d              MOVS     r0,#0xd               ;2275
000210  e704              B        |L42.28|
                  |L42.530|
000212  2501              MOVS     r5,#1                 ;2276
000214  f64070f6          MOV      r0,#0xff6             ;2277
000218  4583              CMP      r11,r0                ;2277
00021a  d300              BCC      |L42.542|
00021c  2502              MOVS     r5,#2                 ;2277
                  |L42.542|
00021e  f64f70f6          MOV      r0,#0xfff6            ;2278
000222  4583              CMP      r11,r0                ;2278
000224  d300              BCC      |L42.552|
000226  2503              MOVS     r5,#3                 ;2278
                  |L42.552|
000228  f10b0002          ADD      r0,r11,#2             ;2281
00022c  6160              STR      r0,[r4,#0x14]         ;2281
00022e  61e7              STR      r7,[r4,#0x1c]         ;2282
000230  9801              LDR      r0,[sp,#4]            ;2283
000232  4438              ADD      r0,r0,r7              ;2283
000234  6220              STR      r0,[r4,#0x20]         ;2283
000236  9807              LDR      r0,[sp,#0x1c]         ;2284
000238  4438              ADD      r0,r0,r7              ;2284
00023a  62a0              STR      r0,[r4,#0x28]         ;2284
00023c  2d03              CMP      r5,#3                 ;2285
00023e  d116              BNE      |L42.622|
000240  8920              LDRH     r0,[r4,#8]            ;2286
000242  b108              CBZ      r0,|L42.584|
000244  200d              MOVS     r0,#0xd               ;2286
000246  e6e9              B        |L42.28|
                  |L42.584|
000248  f894005f          LDRB     r0,[r4,#0x5f]         ;2287
00024c  0601              LSLS     r1,r0,#24             ;2287
00024e  f894005e          LDRB     r0,[r4,#0x5e]         ;2287
000252  ea414100          ORR      r1,r1,r0,LSL #16      ;2287
000256  f894005d          LDRB     r0,[r4,#0x5d]         ;2287
00025a  ea412000          ORR      r0,r1,r0,LSL #8       ;2287
00025e  f894105c          LDRB     r1,[r4,#0x5c]         ;2287
000262  4308              ORRS     r0,r0,r1              ;2287
000264  6260              STR      r0,[r4,#0x24]         ;2287
000266  6960              LDR      r0,[r4,#0x14]         ;2288
000268  0080              LSLS     r0,r0,#2              ;2288
00026a  9006              STR      r0,[sp,#0x18]         ;2288
00026c  e014              B        |L42.664|
                  |L42.622|
00026e  8920              LDRH     r0,[r4,#8]            ;2290
000270  b908              CBNZ     r0,|L42.630|
000272  200d              MOVS     r0,#0xd               ;2290
000274  e6d2              B        |L42.28|
                  |L42.630|
000276  6a20              LDR      r0,[r4,#0x20]         ;2291
000278  4450              ADD      r0,r0,r10             ;2291
00027a  6260              STR      r0,[r4,#0x24]         ;2291
00027c  2d02              CMP      r5,#2                 ;2292
00027e  d102              BNE      |L42.646|
000280  6960              LDR      r0,[r4,#0x14]         ;2293
000282  0040              LSLS     r0,r0,#1              ;2293
000284  e007              B        |L42.662|
                  |L42.646|
000286  7d20              LDRB     r0,[r4,#0x14]         ;2293
000288  f0000001          AND      r0,r0,#1              ;2293
00028c  6961              LDR      r1,[r4,#0x14]         ;2293
00028e  eb010141          ADD      r1,r1,r1,LSL #1       ;2293
000292  eb000051          ADD      r0,r0,r1,LSR #1       ;2293
                  |L42.662|
000296  9006              STR      r0,[sp,#0x18]         ;2293
                  |L42.664|
000298  69a1              LDR      r1,[r4,#0x18]         ;2295
00029a  9806              LDR      r0,[sp,#0x18]         ;2295
00029c  f20010ff          ADD      r0,r0,#0x1ff          ;2295
0002a0  ebb12f50          CMP      r1,r0,LSR #9          ;2295
0002a4  d201              BCS      |L42.682|
0002a6  200d              MOVS     r0,#0xd               ;2296
0002a8  e6b8              B        |L42.28|
                  |L42.682|
0002aa  f04f30ff          MOV      r0,#0xffffffff        ;2300
0002ae  6120              STR      r0,[r4,#0x10]         ;2300
0002b0  60e0              STR      r0,[r4,#0xc]          ;2300
0002b2  2080              MOVS     r0,#0x80              ;2303
0002b4  7160              STRB     r0,[r4,#5]            ;2303
0002b6  2d03              CMP      r5,#3                 ;2305
0002b8  d15a              BNE      |L42.880|
0002ba  f8941060          LDRB     r1,[r4,#0x60]         ;2306
0002be  f8940061          LDRB     r0,[r4,#0x61]         ;2306
0002c2  ea412000          ORR      r0,r1,r0,LSL #8       ;2306
0002c6  2801              CMP      r0,#1                 ;2306
0002c8  d152              BNE      |L42.880|
0002ca  1c79              ADDS     r1,r7,#1              ;2307
0002cc  4620              MOV      r0,r4                 ;2307
0002ce  f7fffffe          BL       move_window
0002d2  bbe8              CBNZ     r0,|L42.848|
0002d4  2000              MOVS     r0,#0                 ;2309
0002d6  7160              STRB     r0,[r4,#5]            ;2309
0002d8  f894122e          LDRB     r1,[r4,#0x22e]        ;2310
0002dc  f894022f          LDRB     r0,[r4,#0x22f]        ;2310
0002e0  ea412000          ORR      r0,r1,r0,LSL #8       ;2310
0002e4  f64a2155          MOV      r1,#0xaa55            ;2310
0002e8  4288              CMP      r0,r1                 ;2310
0002ea  d141              BNE      |L42.880|
0002ec  2033              MOVS     r0,#0x33              ;2311
0002ee  5d00              LDRB     r0,[r0,r4]            ;2311
0002f0  0601              LSLS     r1,r0,#24             ;2311
0002f2  2032              MOVS     r0,#0x32              ;2311
0002f4  5d00              LDRB     r0,[r0,r4]            ;2311
0002f6  ea414100          ORR      r1,r1,r0,LSL #16      ;2311
0002fa  2031              MOVS     r0,#0x31              ;2311
0002fc  5d00              LDRB     r0,[r0,r4]            ;2311
0002fe  ea412000          ORR      r0,r1,r0,LSL #8       ;2311
000302  f8941030          LDRB     r1,[r4,#0x30]         ;2311
000306  4308              ORRS     r0,r0,r1              ;2311
000308  491f              LDR      r1,|L42.904|
00030a  4288              CMP      r0,r1                 ;2311
00030c  d130              BNE      |L42.880|
00030e  f8940217          LDRB     r0,[r4,#0x217]        ;2312
000312  0601              LSLS     r1,r0,#24             ;2312
000314  f8940216          LDRB     r0,[r4,#0x216]        ;2312
000318  ea414100          ORR      r1,r1,r0,LSL #16      ;2312
00031c  f8940215          LDRB     r0,[r4,#0x215]        ;2312
000320  ea412000          ORR      r0,r1,r0,LSL #8       ;2312
000324  f8941214          LDRB     r1,[r4,#0x214]        ;2312
000328  4308              ORRS     r0,r0,r1              ;2312
00032a  4918              LDR      r1,|L42.908|
00032c  4288              CMP      r0,r1                 ;2312
00032e  d11f              BNE      |L42.880|
000330  f894021b          LDRB     r0,[r4,#0x21b]        ;2315
000334  0601              LSLS     r1,r0,#24             ;2315
000336  f894021a          LDRB     r0,[r4,#0x21a]        ;2315
00033a  ea414100          ORR      r1,r1,r0,LSL #16      ;2315
00033e  f8940219          LDRB     r0,[r4,#0x219]        ;2315
000342  ea412000          ORR      r0,r1,r0,LSL #8       ;2315
000346  f8941218          LDRB     r1,[r4,#0x218]        ;2315
00034a  4308              ORRS     r0,r0,r1              ;2315
00034c  6120              STR      r0,[r4,#0x10]         ;2315
00034e  e000              B        |L42.850|
                  |L42.848|
000350  e00e              B        |L42.880|
                  |L42.850|
000352  f894021f          LDRB     r0,[r4,#0x21f]        ;2318
000356  0601              LSLS     r1,r0,#24             ;2318
000358  f894021e          LDRB     r0,[r4,#0x21e]        ;2318
00035c  ea414100          ORR      r1,r1,r0,LSL #16      ;2318
000360  f894021d          LDRB     r0,[r4,#0x21d]        ;2318
000364  ea412000          ORR      r0,r1,r0,LSL #8       ;2318
000368  f894121c          LDRB     r1,[r4,#0x21c]        ;2318
00036c  4308              ORRS     r0,r0,r1              ;2318
00036e  60e0              STR      r0,[r4,#0xc]          ;2318
                  |L42.880|
000370  7025              STRB     r5,[r4,#0]            ;2324
000372  4807              LDR      r0,|L42.912|
000374  8800              LDRH     r0,[r0,#0]            ;2325  ; Fsid
000376  1c40              ADDS     r0,r0,#1              ;2325
000378  b280              UXTH     r0,r0                 ;2325
00037a  4905              LDR      r1,|L42.912|
00037c  8008              STRH     r0,[r1,#0]            ;2325
00037e  80e0              STRH     r0,[r4,#6]            ;2325
000380  2000              MOVS     r0,#0                 ;2333
000382  e64b              B        |L42.28|
;;;2335   
                          ENDP

                  |L42.900|
                          DCD      FatFs
                  |L42.904|
                          DCD      0x41615252
                  |L42.908|
                          DCD      0x61417272
                  |L42.912|
                          DCD      Fsid

                          AREA ||i.fit_lfn||, CODE, READONLY, ALIGN=2

                  fit_lfn PROC
;;;1311   static
;;;1312   void fit_lfn (
000000  b5f0              PUSH     {r4-r7,lr}
;;;1313   	const WCHAR* lfnbuf,	/* Pointer to the LFN buffer */
;;;1314   	BYTE* dir,				/* Pointer to the directory entry */
;;;1315   	BYTE ord,				/* LFN order (1-20) */
;;;1316   	BYTE sum				/* SFN sum */
;;;1317   )
;;;1318   {
000002  4604              MOV      r4,r0
000004  461d              MOV      r5,r3
;;;1319   	UINT i, s;
;;;1320   	WCHAR wc;
;;;1321   
;;;1322   
;;;1323   	dir[LDIR_Chksum] = sum;			/* Set check sum */
000006  734d              STRB     r5,[r1,#0xd]
;;;1324   	dir[LDIR_Attr] = AM_LFN;		/* Set attribute. LFN entry */
000008  270f              MOVS     r7,#0xf
00000a  72cf              STRB     r7,[r1,#0xb]
;;;1325   	dir[LDIR_Type] = 0;
00000c  2700              MOVS     r7,#0
00000e  730f              STRB     r7,[r1,#0xc]
;;;1326   	ST_WORD(dir + LDIR_FstClusLO, 0);
000010  768f              STRB     r7,[r1,#0x1a]
000012  46bc              MOV      r12,r7
000014  f881c01b          STRB     r12,[r1,#0x1b]
;;;1327   
;;;1328   	i = (ord - 1) * 13;				/* Get offset in the LFN buffer */
000018  1e57              SUBS     r7,r2,#1
00001a  eb070c87          ADD      r12,r7,r7,LSL #2
00001e  eb0c06c7          ADD      r6,r12,r7,LSL #3
;;;1329   	s = wc = 0;
000022  2700              MOVS     r7,#0
000024  4638              MOV      r0,r7
000026  463b              MOV      r3,r7
;;;1330   	do {
000028  bf00              NOP      
                  |L43.42|
;;;1331   		if (wc != 0xFFFF) wc = lfnbuf[i++];	/* Get an effective character */
00002a  f64f77ff          MOV      r7,#0xffff
00002e  42b8              CMP      r0,r7
000030  d003              BEQ      |L43.58|
000032  4637              MOV      r7,r6
000034  1c76              ADDS     r6,r6,#1
000036  f8340017          LDRH     r0,[r4,r7,LSL #1]
                  |L43.58|
;;;1332   		ST_WORD(dir+LfnOfs[s], wc);	/* Put it */
00003a  f8dfc040          LDR      r12,|L43.124|
00003e  f81cc003          LDRB     r12,[r12,r3]
000042  f801000c          STRB     r0,[r1,r12]
000046  1207              ASRS     r7,r0,#8
000048  f8dfc030          LDR      r12,|L43.124|
00004c  f81cc003          LDRB     r12,[r12,r3]
000050  448c              ADD      r12,r12,r1
000052  f88c7001          STRB     r7,[r12,#1]
;;;1333   		if (!wc) wc = 0xFFFF;		/* Padding characters following last character */
000056  b908              CBNZ     r0,|L43.92|
000058  f64f70ff          MOV      r0,#0xffff
                  |L43.92|
;;;1334   	} while (++s < 13);
00005c  1c5f              ADDS     r7,r3,#1
00005e  463b              MOV      r3,r7
000060  2f0d              CMP      r7,#0xd
000062  d3e2              BCC      |L43.42|
;;;1335   	if (wc == 0xFFFF || !lfnbuf[i]) ord |= LLEF;	/* Bottom LFN part is the start of LFN sequence */
000064  f64f77ff          MOV      r7,#0xffff
000068  42b8              CMP      r0,r7
00006a  d002              BEQ      |L43.114|
00006c  f8347016          LDRH     r7,[r4,r6,LSL #1]
000070  b90f              CBNZ     r7,|L43.118|
                  |L43.114|
000072  f0420240          ORR      r2,r2,#0x40
                  |L43.118|
;;;1336   	dir[LDIR_Ord] = ord;			/* Set the LFN order */
000076  700a              STRB     r2,[r1,#0]
;;;1337   }
000078  bdf0              POP      {r4-r7,pc}
;;;1338   
                          ENDP

00007a  0000              DCW      0x0000
                  |L43.124|
                          DCD      LfnOfs

                          AREA ||i.follow_path||, CODE, READONLY, ALIGN=1

                  follow_path PROC
;;;2023   static
;;;2024   FRESULT follow_path (	/* FR_OK(0): successful, !=0: error code */
000000  e92d41f3          PUSH     {r0,r1,r4-r8,lr}
;;;2025   	DIR* dp,			/* Directory object to return last directory and found object */
;;;2026   	const TCHAR* path	/* Full-path string to find a file or directory */
;;;2027   )
;;;2028   {
000004  4604              MOV      r4,r0
;;;2029   	FRESULT res;
;;;2030   	BYTE *dir, ns;
;;;2031   
;;;2032   
;;;2033   #if _FS_RPATH
;;;2034   	if (*path == '/' || *path == '\\') {	/* There is a heading separator */
;;;2035   		path++;	dp->sclust = 0;				/* Strip it and start from the root directory */
;;;2036   	} else {								/* No heading separator */
;;;2037   		dp->sclust = dp->fs->cdir;			/* Start from the current directory */
;;;2038   	}
;;;2039   #else
;;;2040   	if (*path == '/' || *path == '\\')		/* Strip heading separator if exist */
000006  9801              LDR      r0,[sp,#4]
000008  7800              LDRB     r0,[r0,#0]
00000a  282f              CMP      r0,#0x2f
00000c  d003              BEQ      |L44.22|
00000e  9801              LDR      r0,[sp,#4]
000010  7800              LDRB     r0,[r0,#0]
000012  285c              CMP      r0,#0x5c
000014  d102              BNE      |L44.28|
                  |L44.22|
;;;2041   		path++;
000016  9801              LDR      r0,[sp,#4]
000018  1c40              ADDS     r0,r0,#1
00001a  9001              STR      r0,[sp,#4]
                  |L44.28|
;;;2042   	dp->sclust = 0;							/* Always start from the root directory */
00001c  2000              MOVS     r0,#0
00001e  60a0              STR      r0,[r4,#8]
;;;2043   #endif
;;;2044   
;;;2045   	if ((UINT)*path < ' ') {				/* Null path name is the origin directory itself */
000020  9801              LDR      r0,[sp,#4]
000022  7800              LDRB     r0,[r0,#0]
000024  2820              CMP      r0,#0x20
000026  d207              BCS      |L44.56|
;;;2046   		res = dir_sdi(dp, 0);
000028  2100              MOVS     r1,#0
00002a  4620              MOV      r0,r4
00002c  f7fffffe          BL       dir_sdi
000030  4605              MOV      r5,r0
;;;2047   		dp->dir = 0;
000032  2000              MOVS     r0,#0
000034  6160              STR      r0,[r4,#0x14]
000036  e028              B        |L44.138|
                  |L44.56|
;;;2048   	} else {								/* Follow path */
;;;2049   		for (;;) {
000038  bf00              NOP      
                  |L44.58|
;;;2050   			res = create_name(dp, &path);	/* Get a segment name of the path */
00003a  a901              ADD      r1,sp,#4
00003c  4620              MOV      r0,r4
00003e  f7fffffe          BL       create_name
000042  4605              MOV      r5,r0
;;;2051   			if (res != FR_OK) break;
000044  b105              CBZ      r5,|L44.72|
000046  e01f              B        |L44.136|
                  |L44.72|
;;;2052   			res = dir_find(dp);				/* Find an object with the sagment name */
000048  4620              MOV      r0,r4
00004a  f7fffffe          BL       dir_find
00004e  4605              MOV      r5,r0
;;;2053   			ns = dp->fn[NSFLAG];
000050  69a0              LDR      r0,[r4,#0x18]
000052  7ac6              LDRB     r6,[r0,#0xb]
;;;2054   			if (res != FR_OK) {				/* Failed to find the object */
000054  b13d              CBZ      r5,|L44.102|
;;;2055   				if (res == FR_NO_FILE) {	/* Object is not found */
000056  2d04              CMP      r5,#4
000058  d104              BNE      |L44.100|
;;;2056   					if (_FS_RPATH && (ns & NS_DOT)) {	/* If dot entry is not exist, */
00005a  bf00              NOP      
;;;2057   						dp->sclust = 0; dp->dir = 0;	/* it is the root directory and stay there */
;;;2058   						if (!(ns & NS_LAST)) continue;	/* Continue to follow if not last segment */
;;;2059   						res = FR_OK;					/* Ended at the root directroy. Function completed. */
;;;2060   					} else {							/* Could not find the object */
;;;2061   						if (!(ns & NS_LAST)) res = FR_NO_PATH;	/* Adjust error code if not last segment */
00005c  f0060004          AND      r0,r6,#4
000060  b900              CBNZ     r0,|L44.100|
000062  2505              MOVS     r5,#5
                  |L44.100|
;;;2062   					}
;;;2063   				}
;;;2064   				break;
000064  e010              B        |L44.136|
                  |L44.102|
;;;2065   			}
;;;2066   			if (ns & NS_LAST) break;			/* Last segment matched. Function completed. */
000066  f0060004          AND      r0,r6,#4
00006a  b100              CBZ      r0,|L44.110|
00006c  e00c              B        |L44.136|
                  |L44.110|
;;;2067   			dir = dp->dir;						/* Follow the sub-directory */
00006e  6967              LDR      r7,[r4,#0x14]
;;;2068   			if (!(dir[DIR_Attr] & AM_DIR)) {	/* It is not a sub-directory and cannot follow */
000070  7af8              LDRB     r0,[r7,#0xb]
000072  f0000010          AND      r0,r0,#0x10
000076  b908              CBNZ     r0,|L44.124|
;;;2069   				res = FR_NO_PATH; break;
000078  2505              MOVS     r5,#5
00007a  e005              B        |L44.136|
                  |L44.124|
;;;2070   			}
;;;2071   			dp->sclust = ld_clust(dp->fs, dir);
00007c  4639              MOV      r1,r7
00007e  6820              LDR      r0,[r4,#0]
000080  f7fffffe          BL       ld_clust
000084  60a0              STR      r0,[r4,#8]
000086  e7d8              B        |L44.58|
                  |L44.136|
000088  bf00              NOP                            ;2051
                  |L44.138|
;;;2072   		}
;;;2073   	}
;;;2074   
;;;2075   	return res;
00008a  4628              MOV      r0,r5
;;;2076   }
00008c  e8bd81fc          POP      {r2-r8,pc}
;;;2077   
                          ENDP


                          AREA ||i.gen_numname||, CODE, READONLY, ALIGN=2

                  gen_numname PROC
;;;1349   static
;;;1350   void gen_numname (
000000  e92d4fff          PUSH     {r0-r11,lr}
;;;1351   	BYTE* dst,			/* Pointer to the buffer to store numbered SFN */
;;;1352   	const BYTE* src,	/* Pointer to SFN */
;;;1353   	const WCHAR* lfn,	/* Pointer to LFN */
;;;1354   	UINT seq			/* Sequence number */
;;;1355   )
;;;1356   {
000004  b083              SUB      sp,sp,#0xc
000006  4607              MOV      r7,r0
000008  4691              MOV      r9,r2
00000a  461e              MOV      r6,r3
;;;1357   	BYTE ns[8], c;
;;;1358   	UINT i, j;
;;;1359   	WCHAR wc;
;;;1360   	DWORD sr;
;;;1361   
;;;1362   
;;;1363   	mem_cpy(dst, src, 11);
00000c  220b              MOVS     r2,#0xb
00000e  4638              MOV      r0,r7
000010  9904              LDR      r1,[sp,#0x10]
000012  f7fffffe          BL       mem_cpy
;;;1364   
;;;1365   	if (seq > 5) {	/* On many collisions, generate a hash number instead of sequential number */
000016  2e05              CMP      r6,#5
000018  d919              BLS      |L45.78|
;;;1366   		sr = seq;
00001a  46b0              MOV      r8,r6
;;;1367   		while (*lfn) {	/* Create a CRC */
00001c  e012              B        |L45.68|
                  |L45.30|
;;;1368   			wc = *lfn++;
00001e  f839bb02          LDRH     r11,[r9],#2
;;;1369   			for (i = 0; i < 16; i++) {
000022  2500              MOVS     r5,#0
000024  e00c              B        |L45.64|
                  |L45.38|
;;;1370   				sr = (sr << 1) + (wc & 1);
000026  4658              MOV      r0,r11
000028  f368005f          BFI      r0,r8,#1,#31
00002c  4680              MOV      r8,r0
;;;1371   				wc >>= 1;
00002e  ea4f0b6b          ASR      r11,r11,#1
;;;1372   				if (sr & 0x10000) sr ^= 0x11021;
000032  f4083080          AND      r0,r8,#0x10000
000036  b110              CBZ      r0,|L45.62|
000038  4823              LDR      r0,|L45.200|
00003a  ea880800          EOR      r8,r8,r0
                  |L45.62|
00003e  1c6d              ADDS     r5,r5,#1              ;1369
                  |L45.64|
000040  2d10              CMP      r5,#0x10              ;1369
000042  d3f0              BCC      |L45.38|
                  |L45.68|
000044  f8b90000          LDRH     r0,[r9,#0]            ;1367
000048  2800              CMP      r0,#0                 ;1367
00004a  d1e8              BNE      |L45.30|
;;;1373   			}
;;;1374   		}
;;;1375   		seq = (UINT)sr;
00004c  4646              MOV      r6,r8
                  |L45.78|
;;;1376   	}
;;;1377   
;;;1378   	/* itoa (hexdecimal) */
;;;1379   	i = 7;
00004e  2507              MOVS     r5,#7
;;;1380   	do {
000050  bf00              NOP      
                  |L45.82|
;;;1381   		c = (seq % 16) + '0';
000052  f006000f          AND      r0,r6,#0xf
000056  f1000a30          ADD      r10,r0,#0x30
;;;1382   		if (c > '9') c += 7;
00005a  f1ba0f39          CMP      r10,#0x39
00005e  dd03              BLE      |L45.104|
000060  f10a0007          ADD      r0,r10,#7
000064  f0000aff          AND      r10,r0,#0xff
                  |L45.104|
;;;1383   		ns[i--] = c;
000068  4628              MOV      r0,r5
00006a  1e6d              SUBS     r5,r5,#1
00006c  a901              ADD      r1,sp,#4
00006e  f801a000          STRB     r10,[r1,r0]
;;;1384   		seq /= 16;
000072  0936              LSRS     r6,r6,#4
;;;1385   	} while (seq);
000074  2e00              CMP      r6,#0
000076  d1ec              BNE      |L45.82|
;;;1386   	ns[i] = '~';
000078  207e              MOVS     r0,#0x7e
00007a  5548              STRB     r0,[r1,r5]
;;;1387   
;;;1388   	/* Append the number */
;;;1389   	for (j = 0; j < i && dst[j] != ' '; j++) {
00007c  2400              MOVS     r4,#0
00007e  e00b              B        |L45.152|
                  |L45.128|
;;;1390   		if (IsDBCS1(dst[j])) {
000080  5d38              LDRB     r0,[r7,r4]
000082  2881              CMP      r0,#0x81
000084  db07              BLT      |L45.150|
000086  5d38              LDRB     r0,[r7,r4]
000088  28fe              CMP      r0,#0xfe
00008a  dc04              BGT      |L45.150|
;;;1391   			if (j == i - 1) break;
00008c  1e68              SUBS     r0,r5,#1
00008e  42a0              CMP      r0,r4
000090  d100              BNE      |L45.148|
000092  e006              B        |L45.162|
                  |L45.148|
;;;1392   			j++;
000094  1c64              ADDS     r4,r4,#1
                  |L45.150|
000096  1c64              ADDS     r4,r4,#1              ;1389
                  |L45.152|
000098  42ac              CMP      r4,r5                 ;1389
00009a  d202              BCS      |L45.162|
00009c  5d38              LDRB     r0,[r7,r4]            ;1389
00009e  2820              CMP      r0,#0x20              ;1389
0000a0  d1ee              BNE      |L45.128|
                  |L45.162|
0000a2  bf00              NOP                            ;1391
;;;1393   		}
;;;1394   	}
;;;1395   	do {
0000a4  bf00              NOP      
                  |L45.166|
;;;1396   		dst[j++] = (i < 8) ? ns[i++] : ' ';
0000a6  2d08              CMP      r5,#8
0000a8  d204              BCS      |L45.180|
0000aa  4628              MOV      r0,r5
0000ac  1c6d              ADDS     r5,r5,#1
0000ae  a901              ADD      r1,sp,#4
0000b0  5c09              LDRB     r1,[r1,r0]
0000b2  e000              B        |L45.182|
                  |L45.180|
0000b4  2120              MOVS     r1,#0x20
                  |L45.182|
0000b6  4620              MOV      r0,r4
0000b8  1c64              ADDS     r4,r4,#1
0000ba  5439              STRB     r1,[r7,r0]
;;;1397   	} while (j < 8);
0000bc  2c08              CMP      r4,#8
0000be  d3f2              BCC      |L45.166|
;;;1398   }
0000c0  b007              ADD      sp,sp,#0x1c
0000c2  e8bd8ff0          POP      {r4-r11,pc}
;;;1399   #endif
                          ENDP

0000c6  0000              DCW      0x0000
                  |L45.200|
                          DCD      0x00011021

                          AREA ||i.get_fat||, CODE, READONLY, ALIGN=1

                  get_fat PROC
;;;791    
;;;792    DWORD get_fat (	/* 0xFFFFFFFF:Disk error, 1:Internal error, 2..0x0FFFFFFF:Cluster status */
000000  e92d47f0          PUSH     {r4-r10,lr}
;;;793    	FATFS* fs,	/* File system object */
;;;794    	DWORD clst	/* FAT index number (cluster number) to get the value */
;;;795    )
;;;796    {
000004  4605              MOV      r5,r0
000006  460c              MOV      r4,r1
;;;797    	UINT wc, bc;
;;;798    	BYTE *p;
;;;799    	DWORD val;
;;;800    
;;;801    
;;;802    	if (clst < 2 || clst >= fs->n_fatent) {	/* Check range */
000008  2c02              CMP      r4,#2
00000a  d302              BCC      |L46.18|
00000c  6968              LDR      r0,[r5,#0x14]
00000e  42a0              CMP      r0,r4
000010  d802              BHI      |L46.24|
                  |L46.18|
;;;803    		val = 1;	/* Internal error */
000012  f04f0901          MOV      r9,#1
000016  e069              B        |L46.236|
                  |L46.24|
;;;804    
;;;805    	} else {
;;;806    		val = 0xFFFFFFFF;	/* Default value falls on disk error */
000018  f04f39ff          MOV      r9,#0xffffffff
;;;807    
;;;808    		switch (fs->fs_type) {
00001c  7828              LDRB     r0,[r5,#0]
00001e  2801              CMP      r0,#1
000020  d004              BEQ      |L46.44|
000022  2802              CMP      r0,#2
000024  d02e              BEQ      |L46.132|
000026  2803              CMP      r0,#3
000028  d15c              BNE      |L46.228|
00002a  e03f              B        |L46.172|
                  |L46.44|
;;;809    		case FS_FAT12 :
;;;810    			bc = (UINT)clst; bc += bc / 2;
00002c  4627              MOV      r7,r4
00002e  eb070757          ADD      r7,r7,r7,LSR #1
;;;811    			if (move_window(fs, fs->fatbase + (bc / SS(fs))) != FR_OK) break;
000032  6a28              LDR      r0,[r5,#0x20]
000034  eb002157          ADD      r1,r0,r7,LSR #9
000038  4628              MOV      r0,r5
00003a  f7fffffe          BL       move_window
00003e  b100              CBZ      r0,|L46.66|
000040  e053              B        |L46.234|
                  |L46.66|
;;;812    			wc = fs->win[bc++ % SS(fs)];
000042  4638              MOV      r0,r7
000044  1c7f              ADDS     r7,r7,#1
000046  f3c00108          UBFX     r1,r0,#0,#9
00004a  f1050030          ADD      r0,r5,#0x30
00004e  f8108001          LDRB     r8,[r0,r1]
;;;813    			if (move_window(fs, fs->fatbase + (bc / SS(fs))) != FR_OK) break;
000052  6a28              LDR      r0,[r5,#0x20]
000054  eb002157          ADD      r1,r0,r7,LSR #9
000058  4628              MOV      r0,r5
00005a  f7fffffe          BL       move_window
00005e  b100              CBZ      r0,|L46.98|
000060  e043              B        |L46.234|
                  |L46.98|
;;;814    			wc |= fs->win[bc % SS(fs)] << 8;
000062  f3c70108          UBFX     r1,r7,#0,#9
000066  f1050030          ADD      r0,r5,#0x30
00006a  5c40              LDRB     r0,[r0,r1]
00006c  ea482800          ORR      r8,r8,r0,LSL #8
;;;815    			val = clst & 1 ? wc >> 4 : (wc & 0xFFF);
000070  f0040001          AND      r0,r4,#1
000074  b110              CBZ      r0,|L46.124|
000076  ea4f1018          LSR      r0,r8,#4
00007a  e001              B        |L46.128|
                  |L46.124|
00007c  f3c8000b          UBFX     r0,r8,#0,#12
                  |L46.128|
000080  4681              MOV      r9,r0
;;;816    			break;
000082  e032              B        |L46.234|
                  |L46.132|
;;;817    
;;;818    		case FS_FAT16 :
;;;819    			if (move_window(fs, fs->fatbase + (clst / (SS(fs) / 2))) != FR_OK) break;
000084  6a28              LDR      r0,[r5,#0x20]
000086  eb002114          ADD      r1,r0,r4,LSR #8
00008a  4628              MOV      r0,r5
00008c  f7fffffe          BL       move_window
000090  b100              CBZ      r0,|L46.148|
000092  e02a              B        |L46.234|
                  |L46.148|
;;;820    			p = &fs->win[clst * 2 % SS(fs)];
000094  f24010ff          MOV      r0,#0x1ff
000098  ea000144          AND      r1,r0,r4,LSL #1
00009c  f1050030          ADD      r0,r5,#0x30
0000a0  180e              ADDS     r6,r1,r0
;;;821    			val = LD_WORD(p);
0000a2  7830              LDRB     r0,[r6,#0]
0000a4  7871              LDRB     r1,[r6,#1]
0000a6  ea402901          ORR      r9,r0,r1,LSL #8
;;;822    			break;
0000aa  e01e              B        |L46.234|
                  |L46.172|
;;;823    
;;;824    		case FS_FAT32 :
;;;825    			if (move_window(fs, fs->fatbase + (clst / (SS(fs) / 4))) != FR_OK) break;
0000ac  6a28              LDR      r0,[r5,#0x20]
0000ae  eb0011d4          ADD      r1,r0,r4,LSR #7
0000b2  4628              MOV      r0,r5
0000b4  f7fffffe          BL       move_window
0000b8  b100              CBZ      r0,|L46.188|
0000ba  e016              B        |L46.234|
                  |L46.188|
;;;826    			p = &fs->win[clst * 4 % SS(fs)];
0000bc  f24010ff          MOV      r0,#0x1ff
0000c0  ea000184          AND      r1,r0,r4,LSL #2
0000c4  f1050030          ADD      r0,r5,#0x30
0000c8  180e              ADDS     r6,r1,r0
;;;827    			val = LD_DWORD(p) & 0x0FFFFFFF;
0000ca  78f0              LDRB     r0,[r6,#3]
0000cc  0600              LSLS     r0,r0,#24
0000ce  78b1              LDRB     r1,[r6,#2]
0000d0  ea404001          ORR      r0,r0,r1,LSL #16
0000d4  7871              LDRB     r1,[r6,#1]
0000d6  ea402001          ORR      r0,r0,r1,LSL #8
0000da  7831              LDRB     r1,[r6,#0]
0000dc  4308              ORRS     r0,r0,r1
0000de  f0204970          BIC      r9,r0,#0xf0000000
;;;828    			break;
0000e2  e002              B        |L46.234|
                  |L46.228|
;;;829    
;;;830    		default:
;;;831    			val = 1;	/* Internal error */
0000e4  f04f0901          MOV      r9,#1
0000e8  bf00              NOP                            ;808
                  |L46.234|
0000ea  bf00              NOP                            ;811
                  |L46.236|
;;;832    		}
;;;833    	}
;;;834    
;;;835    	return val;
0000ec  4648              MOV      r0,r9
;;;836    }
0000ee  e8bd87f0          POP      {r4-r10,pc}
;;;837    
                          ENDP


                          AREA ||i.get_fileinfo||, CODE, READONLY, ALIGN=1

                  get_fileinfo PROC
;;;1673   static
;;;1674   void get_fileinfo (		/* No return code */
000000  e92d43f0          PUSH     {r4-r9,lr}
;;;1675   	DIR* dp,			/* Pointer to the directory object */
;;;1676   	FILINFO* fno	 	/* Pointer to the file information to be filled */
;;;1677   )
;;;1678   {
000004  4606              MOV      r6,r0
000006  460b              MOV      r3,r1
;;;1679   	UINT i;
;;;1680   	TCHAR *p, c;
;;;1681   	BYTE *dir;
;;;1682   #if _USE_LFN
;;;1683   	WCHAR w, *lfn;
;;;1684   #endif
;;;1685   
;;;1686   	p = fno->fname;
000008  f1030509          ADD      r5,r3,#9
;;;1687   	if (dp->sect) {		/* Get SFN */
00000c  6930              LDR      r0,[r6,#0x10]
00000e  2800              CMP      r0,#0
000010  d03b              BEQ      |L47.138|
;;;1688   		dir = dp->dir;
000012  6972              LDR      r2,[r6,#0x14]
;;;1689   		i = 0;
000014  2400              MOVS     r4,#0
;;;1690   		while (i < 11) {		/* Copy name body and extension */
000016  e01f              B        |L47.88|
                  |L47.24|
;;;1691   			c = (TCHAR)dir[i++];
000018  4620              MOV      r0,r4
00001a  1c64              ADDS     r4,r4,#1
00001c  5c17              LDRB     r7,[r2,r0]
;;;1692   			if (c == ' ') continue;				/* Skip padding spaces */
00001e  2f20              CMP      r7,#0x20
000020  d100              BNE      |L47.36|
000022  e019              B        |L47.88|
                  |L47.36|
;;;1693   			if (c == RDDEM) c = (TCHAR)DDEM;	/* Restore replaced DDEM character */
000024  2f05              CMP      r7,#5
000026  d100              BNE      |L47.42|
000028  27e5              MOVS     r7,#0xe5
                  |L47.42|
;;;1694   			if (i == 9) *p++ = '.';				/* Insert a . if extension is exist */
00002a  2c09              CMP      r4,#9
00002c  d102              BNE      |L47.52|
00002e  202e              MOVS     r0,#0x2e
000030  f8050b01          STRB     r0,[r5],#1
                  |L47.52|
;;;1695   #if _USE_LFN
;;;1696   			if (IsUpper(c) && (dir[DIR_NTres] & (i >= 9 ? NS_EXT : NS_BODY)))
000034  2f41              CMP      r7,#0x41
000036  db0c              BLT      |L47.82|
000038  2f5a              CMP      r7,#0x5a
00003a  dc0a              BGT      |L47.82|
00003c  7b10              LDRB     r0,[r2,#0xc]
00003e  2c09              CMP      r4,#9
000040  d301              BCC      |L47.70|
000042  2110              MOVS     r1,#0x10
000044  e000              B        |L47.72|
                  |L47.70|
000046  2108              MOVS     r1,#8
                  |L47.72|
000048  4008              ANDS     r0,r0,r1
00004a  b110              CBZ      r0,|L47.82|
;;;1697   				c += 0x20;			/* To lower */
00004c  f1070020          ADD      r0,r7,#0x20
000050  b2c7              UXTB     r7,r0
                  |L47.82|
;;;1698   #if _LFN_UNICODE
;;;1699   			if (IsDBCS1(c) && i != 8 && i != 11 && IsDBCS2(dir[i]))
;;;1700   				c = c << 8 | dir[i++];
;;;1701   			c = ff_convert(c, 1);	/* OEM -> Unicode */
;;;1702   			if (!c) c = '?';
;;;1703   #endif
;;;1704   #endif
;;;1705   			*p++ = c;
000052  f8057b01          STRB     r7,[r5],#1
000056  bf00              NOP                            ;1692
                  |L47.88|
000058  2c0b              CMP      r4,#0xb               ;1690
00005a  d3dd              BCC      |L47.24|
;;;1706   		}
;;;1707   		fno->fattrib = dir[DIR_Attr];				/* Attribute */
00005c  7ad0              LDRB     r0,[r2,#0xb]
00005e  7218              STRB     r0,[r3,#8]
;;;1708   		fno->fsize = LD_DWORD(dir + DIR_FileSize);	/* Size */
000060  7fd0              LDRB     r0,[r2,#0x1f]
000062  0601              LSLS     r1,r0,#24
000064  7f90              LDRB     r0,[r2,#0x1e]
000066  ea414100          ORR      r1,r1,r0,LSL #16
00006a  7f50              LDRB     r0,[r2,#0x1d]
00006c  ea412000          ORR      r0,r1,r0,LSL #8
000070  7f11              LDRB     r1,[r2,#0x1c]
000072  4308              ORRS     r0,r0,r1
000074  6018              STR      r0,[r3,#0]
;;;1709   		fno->fdate = LD_WORD(dir + DIR_WrtDate);	/* Date */
000076  7e11              LDRB     r1,[r2,#0x18]
000078  7e50              LDRB     r0,[r2,#0x19]
00007a  ea412000          ORR      r0,r1,r0,LSL #8
00007e  8098              STRH     r0,[r3,#4]
;;;1710   		fno->ftime = LD_WORD(dir + DIR_WrtTime);	/* Time */
000080  7d91              LDRB     r1,[r2,#0x16]
000082  7dd0              LDRB     r0,[r2,#0x17]
000084  ea412000          ORR      r0,r1,r0,LSL #8
000088  80d8              STRH     r0,[r3,#6]
                  |L47.138|
;;;1711   	}
;;;1712   	*p = 0;		/* Terminate SFN string by a \0 */
00008a  2000              MOVS     r0,#0
00008c  7028              STRB     r0,[r5,#0]
;;;1713   
;;;1714   #if _USE_LFN
;;;1715   	if (fno->lfname) {
00008e  6998              LDR      r0,[r3,#0x18]
000090  b390              CBZ      r0,|L47.248|
;;;1716   		i = 0; p = fno->lfname;
000092  2400              MOVS     r4,#0
000094  699d              LDR      r5,[r3,#0x18]
;;;1717   		if (dp->sect && fno->lfsize && dp->lfn_idx != 0xFFFF) {	/* Get LFN if available */
000096  6930              LDR      r0,[r6,#0x10]
000098  b360              CBZ      r0,|L47.244|
00009a  69d8              LDR      r0,[r3,#0x1c]
00009c  b350              CBZ      r0,|L47.244|
00009e  8c30              LDRH     r0,[r6,#0x20]
0000a0  f64f71ff          MOV      r1,#0xffff
0000a4  4288              CMP      r0,r1
0000a6  d025              BEQ      |L47.244|
;;;1718   			lfn = dp->lfn;
0000a8  f8d6901c          LDR      r9,[r6,#0x1c]
;;;1719   			while ((w = *lfn++) != 0) {		/* Get an LFN character */
0000ac  e01c              B        |L47.232|
                  |L47.174|
;;;1720   #if !_LFN_UNICODE
;;;1721   				w = ff_convert(w, 0);		/* Unicode -> OEM */
0000ae  2100              MOVS     r1,#0
0000b0  4640              MOV      r0,r8
0000b2  f7fffffe          BL       ff_convert
0000b6  4680              MOV      r8,r0
;;;1722   				if (!w) { i = 0; break; }	/* No LFN if it could not be converted */
0000b8  f1b80f00          CMP      r8,#0
0000bc  d101              BNE      |L47.194|
0000be  2400              MOVS     r4,#0
0000c0  e017              B        |L47.242|
                  |L47.194|
;;;1723   				if (_DF1S && w >= 0x100)	/* Put 1st byte if it is a DBC (always false on SBCS cfg) */
0000c2  f1b80fff          CMP      r8,#0xff
0000c6  dd05              BLE      |L47.212|
;;;1724   					p[i++] = (TCHAR)(w >> 8);
0000c8  ea4f2c28          ASR      r12,r8,#8
0000cc  4620              MOV      r0,r4
0000ce  1c64              ADDS     r4,r4,#1
0000d0  f805c000          STRB     r12,[r5,r0]
                  |L47.212|
;;;1725   #endif
;;;1726   				if (i >= fno->lfsize - 1) { i = 0; break; }	/* No LFN if buffer overflow */
0000d4  69d8              LDR      r0,[r3,#0x1c]
0000d6  1e40              SUBS     r0,r0,#1
0000d8  42a0              CMP      r0,r4
0000da  d801              BHI      |L47.224|
0000dc  2400              MOVS     r4,#0
0000de  e008              B        |L47.242|
                  |L47.224|
;;;1727   				p[i++] = (TCHAR)w;
0000e0  4620              MOV      r0,r4
0000e2  1c64              ADDS     r4,r4,#1
0000e4  f8058000          STRB     r8,[r5,r0]
                  |L47.232|
0000e8  f8391b02          LDRH     r1,[r9],#2            ;1719
0000ec  f1b10800          SUBS     r8,r1,#0              ;1719
0000f0  d1dd              BNE      |L47.174|
                  |L47.242|
0000f2  bf00              NOP                            ;1722
                  |L47.244|
;;;1728   			}
;;;1729   		}
;;;1730   		p[i] = 0;	/* Terminate LFN string by a \0 */
0000f4  2000              MOVS     r0,#0
0000f6  5528              STRB     r0,[r5,r4]
                  |L47.248|
;;;1731   	}
;;;1732   #endif
;;;1733   }
0000f8  e8bd83f0          POP      {r4-r9,pc}
;;;1734   #endif /* _FS_MINIMIZE <= 1 || _FS_RPATH >= 2 */
                          ENDP


                          AREA ||i.get_ldnumber||, CODE, READONLY, ALIGN=1

                  get_ldnumber PROC
;;;2085   static
;;;2086   int get_ldnumber (		/* Returns logical drive number (-1:invalid drive) */
000000  b570              PUSH     {r4-r6,lr}
;;;2087   	const TCHAR** path	/* Pointer to pointer to the path name */
;;;2088   )
;;;2089   {
000002  4602              MOV      r2,r0
;;;2090   	const TCHAR *tp, *tt;
;;;2091   	UINT i;
;;;2092   	int vol = -1;
000004  f04f30ff          MOV      r0,#0xffffffff
;;;2093   #if _STR_VOLUME_ID		/* Find string drive id */
;;;2094   	static const char* const str[] = {_VOLUME_STRS};
;;;2095   	const char *sp;
;;;2096   	char c;
;;;2097   	TCHAR tc;
;;;2098   #endif
;;;2099   
;;;2100   
;;;2101   	if (*path) {	/* If the pointer is not a null */
000008  6815              LDR      r5,[r2,#0]
00000a  b1e5              CBZ      r5,|L48.70|
;;;2102   		for (tt = *path; (UINT)*tt >= (_USE_LFN ? ' ' : '!') && *tt != ':'; tt++) ;	/* Find ':' in the path */
00000c  6811              LDR      r1,[r2,#0]
00000e  e000              B        |L48.18|
                  |L48.16|
000010  1c49              ADDS     r1,r1,#1
                  |L48.18|
000012  780d              LDRB     r5,[r1,#0]
000014  2d20              CMP      r5,#0x20
000016  d302              BCC      |L48.30|
000018  780d              LDRB     r5,[r1,#0]
00001a  2d3a              CMP      r5,#0x3a
00001c  d1f8              BNE      |L48.16|
                  |L48.30|
;;;2103   		if (*tt == ':') {	/* If a ':' is exist in the path name */
00001e  780d              LDRB     r5,[r1,#0]
000020  2d3a              CMP      r5,#0x3a
000022  d10f              BNE      |L48.68|
;;;2104   			tp = *path;
000024  6814              LDR      r4,[r2,#0]
;;;2105   			i = *tp++ - '0'; 
000026  f8145b01          LDRB     r5,[r4],#1
00002a  f1a50330          SUB      r3,r5,#0x30
;;;2106   			if (i < 10 && tp == tt) {	/* Is there a numeric drive id? */
00002e  2b0a              CMP      r3,#0xa
000030  d207              BCS      |L48.66|
000032  428c              CMP      r4,r1
000034  d105              BNE      |L48.66|
;;;2107   				if (i < _VOLUMES) {	/* If a drive id is found, get the value and strip it */
000036  2b02              CMP      r3,#2
000038  d203              BCS      |L48.66|
;;;2108   					vol = (int)i;
00003a  4618              MOV      r0,r3
;;;2109   					*path = ++tt;
00003c  1c4d              ADDS     r5,r1,#1
00003e  4629              MOV      r1,r5
000040  6015              STR      r5,[r2,#0]
                  |L48.66|
;;;2110   				}
;;;2111   			}
;;;2112   #if _STR_VOLUME_ID
;;;2113   			 else {	/* No numeric drive number, find string drive id */
;;;2114   				i = 0; tt++;
;;;2115   				do {
;;;2116   					sp = str[i]; tp = *path;
;;;2117   					do {	/* Compare a string drive id with path name */
;;;2118   						c = *sp++; tc = *tp++;
;;;2119   						if (IsLower(tc)) tc -= 0x20;
;;;2120   					} while (c && (TCHAR)c == tc);
;;;2121   				} while ((c || tp != tt) && ++i < _VOLUMES);	/* Repeat for each id until pattern match */
;;;2122   				if (i < _VOLUMES) {	/* If a drive id is found, get the value and strip it */
;;;2123   					vol = (int)i;
;;;2124   					*path = tt;
;;;2125   				}
;;;2126   			}
;;;2127   #endif
;;;2128   			return vol;
;;;2129   		}
;;;2130   #if _FS_RPATH && _VOLUMES >= 2
;;;2131   		vol = CurrVol;	/* Current drive */
;;;2132   #else
;;;2133   		vol = 0;		/* Drive 0 */
;;;2134   #endif
;;;2135   	}
;;;2136   	return vol;
;;;2137   }
000042  bd70              POP      {r4-r6,pc}
                  |L48.68|
000044  2000              MOVS     r0,#0                 ;2133
                  |L48.70|
000046  bf00              NOP                            ;2136
000048  e7fb              B        |L48.66|
;;;2138   
                          ENDP


                          AREA ||i.ld_clust||, CODE, READONLY, ALIGN=1

                  ld_clust PROC
;;;1208   static
;;;1209   DWORD ld_clust (
000000  b510              PUSH     {r4,lr}
;;;1210   	FATFS* fs,	/* Pointer to the fs object */
;;;1211   	BYTE* dir	/* Pointer to the directory entry */
;;;1212   )
;;;1213   {
000002  4602              MOV      r2,r0
;;;1214   	DWORD cl;
;;;1215   
;;;1216   	cl = LD_WORD(dir + DIR_FstClusLO);
000004  7e8c              LDRB     r4,[r1,#0x1a]
000006  7ecb              LDRB     r3,[r1,#0x1b]
000008  ea442003          ORR      r0,r4,r3,LSL #8
;;;1217   	if (fs->fs_type == FS_FAT32)
00000c  7813              LDRB     r3,[r2,#0]
00000e  2b03              CMP      r3,#3
000010  d105              BNE      |L49.30|
;;;1218   		cl |= (DWORD)LD_WORD(dir + DIR_FstClusHI) << 16;
000012  7d0c              LDRB     r4,[r1,#0x14]
000014  7d4b              LDRB     r3,[r1,#0x15]
000016  ea442303          ORR      r3,r4,r3,LSL #8
00001a  ea404003          ORR      r0,r0,r3,LSL #16
                  |L49.30|
;;;1219   
;;;1220   	return cl;
;;;1221   }
00001e  bd10              POP      {r4,pc}
;;;1222   
                          ENDP


                          AREA ||i.mem_cmp||, CODE, READONLY, ALIGN=1

                  mem_cmp PROC
;;;506    static
;;;507    int mem_cmp (const void* dst, const void* src, UINT cnt) {
000000  b5f0              PUSH     {r4-r7,lr}
000002  4603              MOV      r3,r0
;;;508    	const BYTE *d = (const BYTE *)dst, *s = (const BYTE *)src;
000004  461c              MOV      r4,r3
000006  460d              MOV      r5,r1
;;;509    	int r = 0;
000008  2000              MOVS     r0,#0
;;;510    
;;;511    	while (cnt-- && (r = *d++ - *s++) == 0) ;
00000a  bf00              NOP      
                  |L50.12|
00000c  1e16              SUBS     r6,r2,#0
00000e  f1a20201          SUB      r2,r2,#1
000012  d007              BEQ      |L50.36|
000014  f8147b01          LDRB     r7,[r4],#1
000018  f815cb01          LDRB     r12,[r5],#1
00001c  eba7060c          SUB      r6,r7,r12
000020  1e30              SUBS     r0,r6,#0
000022  d0f3              BEQ      |L50.12|
                  |L50.36|
;;;512    	return r;
;;;513    }
000024  bdf0              POP      {r4-r7,pc}
;;;514    
                          ENDP


                          AREA ||i.mem_cpy||, CODE, READONLY, ALIGN=1

                  mem_cpy PROC
;;;480    static
;;;481    void mem_cpy (void* dst, const void* src, UINT cnt) {
000000  b570              PUSH     {r4-r6,lr}
;;;482    	BYTE *d = (BYTE*)dst;
000002  4603              MOV      r3,r0
;;;483    	const BYTE *s = (const BYTE*)src;
000004  460c              MOV      r4,r1
;;;484    
;;;485    #if _WORD_ACCESS == 1
;;;486    	while (cnt >= sizeof (int)) {
;;;487    		*(int*)d = *(int*)s;
;;;488    		d += sizeof (int); s += sizeof (int);
;;;489    		cnt -= sizeof (int);
;;;490    	}
;;;491    #endif
;;;492    	while (cnt--)
000006  e003              B        |L51.16|
                  |L51.8|
;;;493    		*d++ = *s++;
000008  f8145b01          LDRB     r5,[r4],#1
00000c  f8035b01          STRB     r5,[r3],#1
                  |L51.16|
000010  1e15              SUBS     r5,r2,#0              ;492
000012  f1a20201          SUB      r2,r2,#1              ;492
000016  d1f7              BNE      |L51.8|
;;;494    }
000018  bd70              POP      {r4-r6,pc}
;;;495    
                          ENDP


                          AREA ||i.mem_set||, CODE, READONLY, ALIGN=1

                  mem_set PROC
;;;497    static
;;;498    void mem_set (void* dst, int val, UINT cnt) {
000000  b530              PUSH     {r4,r5,lr}
;;;499    	BYTE *d = (BYTE*)dst;
000002  4603              MOV      r3,r0
;;;500    
;;;501    	while (cnt--)
000004  e001              B        |L52.10|
                  |L52.6|
;;;502    		*d++ = (BYTE)val;
000006  f8031b01          STRB     r1,[r3],#1
                  |L52.10|
00000a  1e14              SUBS     r4,r2,#0              ;501
00000c  f1a20201          SUB      r2,r2,#1              ;501
000010  d1f9              BNE      |L52.6|
;;;503    }
000012  bd30              POP      {r4,r5,pc}
;;;504    
                          ENDP


                          AREA ||i.move_window||, CODE, READONLY, ALIGN=1

                  move_window PROC
;;;702    static
;;;703    FRESULT move_window (
000000  b570              PUSH     {r4-r6,lr}
;;;704    	FATFS* fs,		/* File system object */
;;;705    	DWORD sector	/* Sector number to make appearance in the fs->win[] */
;;;706    )
;;;707    {
000002  4604              MOV      r4,r0
000004  460d              MOV      r5,r1
;;;708    	FRESULT res = FR_OK;
000006  2600              MOVS     r6,#0
;;;709    
;;;710    
;;;711    	if (sector != fs->winsect) {	/* Window offset changed? */
000008  6ae0              LDR      r0,[r4,#0x2c]
00000a  42a8              CMP      r0,r5
00000c  d010              BEQ      |L53.48|
;;;712    #if !_FS_READONLY
;;;713    		res = sync_window(fs);		/* Write-back changes */
00000e  4620              MOV      r0,r4
000010  f7fffffe          BL       sync_window
000014  4606              MOV      r6,r0
;;;714    #endif
;;;715    		if (res == FR_OK) {			/* Fill sector window with new data */
000016  b95e              CBNZ     r6,|L53.48|
;;;716    			if (disk_read(fs->drv, fs->win, sector, 1) != RES_OK) {
000018  7860              LDRB     r0,[r4,#1]
00001a  2301              MOVS     r3,#1
00001c  462a              MOV      r2,r5
00001e  f1040130          ADD      r1,r4,#0x30
000022  f7fffffe          BL       disk_read
000026  b110              CBZ      r0,|L53.46|
;;;717    				sector = 0xFFFFFFFF;	/* Invalidate window if data is not reliable */
000028  f04f35ff          MOV      r5,#0xffffffff
;;;718    				res = FR_DISK_ERR;
00002c  2601              MOVS     r6,#1
                  |L53.46|
;;;719    			}
;;;720    			fs->winsect = sector;
00002e  62e5              STR      r5,[r4,#0x2c]
                  |L53.48|
;;;721    		}
;;;722    	}
;;;723    	return res;
000030  4630              MOV      r0,r6
;;;724    }
000032  bd70              POP      {r4-r6,pc}
;;;725    
                          ENDP


                          AREA ||i.pick_lfn||, CODE, READONLY, ALIGN=2

                  pick_lfn PROC
;;;1278   static
;;;1279   int pick_lfn (			/* 1:Succeeded, 0:Buffer overflow */
000000  b5f0              PUSH     {r4-r7,lr}
;;;1280   	WCHAR* lfnbuf,		/* Pointer to the Unicode-LFN buffer */
;;;1281   	BYTE* dir			/* Pointer to the directory entry */
;;;1282   )
;;;1283   {
000002  4603              MOV      r3,r0
;;;1284   	UINT i, s;
;;;1285   	WCHAR wc, uc;
;;;1286   
;;;1287   
;;;1288   	i = ((dir[LDIR_Ord] & 0x3F) - 1) * 13;	/* Offset in the LFN buffer */
000004  7808              LDRB     r0,[r1,#0]
000006  f000003f          AND      r0,r0,#0x3f
00000a  1e40              SUBS     r0,r0,#1
00000c  eb000780          ADD      r7,r0,r0,LSL #2
000010  eb0702c0          ADD      r2,r7,r0,LSL #3
;;;1289   
;;;1290   	s = 0; wc = 1;
000014  2500              MOVS     r5,#0
000016  2601              MOVS     r6,#1
;;;1291   	do {
000018  bf00              NOP      
                  |L54.26|
;;;1292   		uc = LD_WORD(dir + LfnOfs[s]);		/* Pick an LFN character from the entry */
00001a  4815              LDR      r0,|L54.112|
00001c  5d40              LDRB     r0,[r0,r5]
00001e  5c08              LDRB     r0,[r1,r0]
000020  4f13              LDR      r7,|L54.112|
000022  5d7f              LDRB     r7,[r7,r5]
000024  440f              ADD      r7,r7,r1
000026  787f              LDRB     r7,[r7,#1]
000028  ea402407          ORR      r4,r0,r7,LSL #8
;;;1293   		if (wc) {	/* Last character has not been processed */
00002c  b14e              CBZ      r6,|L54.66|
;;;1294   			if (i >= _MAX_LFN) return 0;	/* Buffer overflow? */
00002e  2aff              CMP      r2,#0xff
000030  d301              BCC      |L54.54|
000032  2000              MOVS     r0,#0
                  |L54.52|
;;;1295   			lfnbuf[i++] = wc = uc;			/* Store it */
;;;1296   		} else {
;;;1297   			if (uc != 0xFFFF) return 0;		/* Check filler */
;;;1298   		}
;;;1299   	} while (++s < 13);						/* Read all character in the entry */
;;;1300   
;;;1301   	if (dir[LDIR_Ord] & LLEF) {				/* Put terminator if it is the last LFN part */
;;;1302   		if (i >= _MAX_LFN) return 0;		/* Buffer overflow? */
;;;1303   		lfnbuf[i] = 0;
;;;1304   	}
;;;1305   
;;;1306   	return 1;
;;;1307   }
000034  bdf0              POP      {r4-r7,pc}
                  |L54.54|
000036  4626              MOV      r6,r4                 ;1295
000038  4610              MOV      r0,r2                 ;1295
00003a  1c52              ADDS     r2,r2,#1              ;1295
00003c  f8234010          STRH     r4,[r3,r0,LSL #1]     ;1295
000040  e005              B        |L54.78|
                  |L54.66|
000042  f64f70ff          MOV      r0,#0xffff            ;1297
000046  4284              CMP      r4,r0                 ;1297
000048  d001              BEQ      |L54.78|
00004a  2000              MOVS     r0,#0                 ;1297
00004c  e7f2              B        |L54.52|
                  |L54.78|
00004e  1c68              ADDS     r0,r5,#1              ;1299
000050  4605              MOV      r5,r0                 ;1299
000052  280d              CMP      r0,#0xd               ;1299
000054  d3e1              BCC      |L54.26|
000056  7808              LDRB     r0,[r1,#0]            ;1301
000058  f0000040          AND      r0,r0,#0x40           ;1301
00005c  b130              CBZ      r0,|L54.108|
00005e  2aff              CMP      r2,#0xff              ;1302
000060  d301              BCC      |L54.102|
000062  2000              MOVS     r0,#0                 ;1302
000064  e7e6              B        |L54.52|
                  |L54.102|
000066  2000              MOVS     r0,#0                 ;1303
000068  f8230012          STRH     r0,[r3,r2,LSL #1]     ;1303
                  |L54.108|
00006c  2001              MOVS     r0,#1                 ;1306
00006e  e7e1              B        |L54.52|
;;;1308   
                          ENDP

                  |L54.112|
                          DCD      LfnOfs

                          AREA ||i.put_fat||, CODE, READONLY, ALIGN=1

                  put_fat PROC
;;;846    #if !_FS_READONLY
;;;847    FRESULT put_fat (
000000  e92d47f0          PUSH     {r4-r10,lr}
;;;848    	FATFS* fs,	/* File system object */
;;;849    	DWORD clst,	/* FAT index number (cluster number) to be changed */
;;;850    	DWORD val	/* New value to be set to the entry */
;;;851    )
;;;852    {
000004  4605              MOV      r5,r0
000006  460e              MOV      r6,r1
000008  4617              MOV      r7,r2
;;;853    	UINT bc;
;;;854    	BYTE *p;
;;;855    	FRESULT res;
;;;856    
;;;857    
;;;858    	if (clst < 2 || clst >= fs->n_fatent) {	/* Check range */
00000a  2e02              CMP      r6,#2
00000c  d302              BCC      |L55.20|
00000e  6968              LDR      r0,[r5,#0x14]
000010  42b0              CMP      r0,r6
000012  d802              BHI      |L55.26|
                  |L55.20|
;;;859    		res = FR_INT_ERR;
000014  f04f0802          MOV      r8,#2
000018  e090              B        |L55.316|
                  |L55.26|
;;;860    
;;;861    	} else {
;;;862    		switch (fs->fs_type) {
00001a  7828              LDRB     r0,[r5,#0]
00001c  2801              CMP      r0,#1
00001e  d004              BEQ      |L55.42|
000020  2802              CMP      r0,#2
000022  d044              BEQ      |L55.174|
000024  2803              CMP      r0,#3
000026  d17d              BNE      |L55.292|
000028  e059              B        |L55.222|
                  |L55.42|
;;;863    		case FS_FAT12 :
;;;864    			bc = (UINT)clst; bc += bc / 2;
00002a  46b1              MOV      r9,r6
00002c  eb090959          ADD      r9,r9,r9,LSR #1
;;;865    			res = move_window(fs, fs->fatbase + (bc / SS(fs)));
000030  6a28              LDR      r0,[r5,#0x20]
000032  eb002159          ADD      r1,r0,r9,LSR #9
000036  4628              MOV      r0,r5
000038  f7fffffe          BL       move_window
00003c  4680              MOV      r8,r0
;;;866    			if (res != FR_OK) break;
00003e  f1b80f00          CMP      r8,#0
000042  d000              BEQ      |L55.70|
000044  e079              B        |L55.314|
                  |L55.70|
;;;867    			p = &fs->win[bc++ % SS(fs)];
000046  4648              MOV      r0,r9
000048  f1090901          ADD      r9,r9,#1
00004c  f3c00108          UBFX     r1,r0,#0,#9
000050  f1050030          ADD      r0,r5,#0x30
000054  180c              ADDS     r4,r1,r0
;;;868    			*p = (clst & 1) ? ((*p & 0x0F) | ((BYTE)val << 4)) : (BYTE)val;
000056  f0060001          AND      r0,r6,#1
00005a  b120              CBZ      r0,|L55.102|
00005c  b2f9              UXTB     r1,r7
00005e  7820              LDRB     r0,[r4,#0]
000060  f361101f          BFI      r0,r1,#4,#28
000064  e000              B        |L55.104|
                  |L55.102|
000066  4638              MOV      r0,r7
                  |L55.104|
000068  7020              STRB     r0,[r4,#0]
;;;869    			fs->wflag = 1;
00006a  2001              MOVS     r0,#1
00006c  7128              STRB     r0,[r5,#4]
;;;870    			res = move_window(fs, fs->fatbase + (bc / SS(fs)));
00006e  6a28              LDR      r0,[r5,#0x20]
000070  eb002159          ADD      r1,r0,r9,LSR #9
000074  4628              MOV      r0,r5
000076  f7fffffe          BL       move_window
00007a  4680              MOV      r8,r0
;;;871    			if (res != FR_OK) break;
00007c  f1b80f00          CMP      r8,#0
000080  d000              BEQ      |L55.132|
000082  e05a              B        |L55.314|
                  |L55.132|
;;;872    			p = &fs->win[bc % SS(fs)];
000084  f3c90108          UBFX     r1,r9,#0,#9
000088  f1050030          ADD      r0,r5,#0x30
00008c  180c              ADDS     r4,r1,r0
;;;873    			*p = (clst & 1) ? (BYTE)(val >> 4) : ((*p & 0xF0) | ((BYTE)(val >> 8) & 0x0F));
00008e  f0060001          AND      r0,r6,#1
000092  b110              CBZ      r0,|L55.154|
000094  f3c71007          UBFX     r0,r7,#4,#8
000098  e005              B        |L55.166|
                  |L55.154|
00009a  7820              LDRB     r0,[r4,#0]
00009c  f00000f0          AND      r0,r0,#0xf0
0000a0  f3c72103          UBFX     r1,r7,#8,#4
0000a4  4308              ORRS     r0,r0,r1
                  |L55.166|
0000a6  7020              STRB     r0,[r4,#0]
;;;874    			fs->wflag = 1;
0000a8  2001              MOVS     r0,#1
0000aa  7128              STRB     r0,[r5,#4]
;;;875    			break;
0000ac  e045              B        |L55.314|
                  |L55.174|
;;;876    
;;;877    		case FS_FAT16 :
;;;878    			res = move_window(fs, fs->fatbase + (clst / (SS(fs) / 2)));
0000ae  6a28              LDR      r0,[r5,#0x20]
0000b0  eb002116          ADD      r1,r0,r6,LSR #8
0000b4  4628              MOV      r0,r5
0000b6  f7fffffe          BL       move_window
0000ba  4680              MOV      r8,r0
;;;879    			if (res != FR_OK) break;
0000bc  f1b80f00          CMP      r8,#0
0000c0  d000              BEQ      |L55.196|
0000c2  e03a              B        |L55.314|
                  |L55.196|
;;;880    			p = &fs->win[clst * 2 % SS(fs)];
0000c4  f24010ff          MOV      r0,#0x1ff
0000c8  ea000146          AND      r1,r0,r6,LSL #1
0000cc  f1050030          ADD      r0,r5,#0x30
0000d0  180c              ADDS     r4,r1,r0
;;;881    			ST_WORD(p, (WORD)val);
0000d2  7027              STRB     r7,[r4,#0]
0000d4  0a38              LSRS     r0,r7,#8
0000d6  7060              STRB     r0,[r4,#1]
;;;882    			fs->wflag = 1;
0000d8  2001              MOVS     r0,#1
0000da  7128              STRB     r0,[r5,#4]
;;;883    			break;
0000dc  e02d              B        |L55.314|
                  |L55.222|
;;;884    
;;;885    		case FS_FAT32 :
;;;886    			res = move_window(fs, fs->fatbase + (clst / (SS(fs) / 4)));
0000de  6a28              LDR      r0,[r5,#0x20]
0000e0  eb0011d6          ADD      r1,r0,r6,LSR #7
0000e4  4628              MOV      r0,r5
0000e6  f7fffffe          BL       move_window
0000ea  4680              MOV      r8,r0
;;;887    			if (res != FR_OK) break;
0000ec  f1b80f00          CMP      r8,#0
0000f0  d000              BEQ      |L55.244|
0000f2  e022              B        |L55.314|
                  |L55.244|
;;;888    			p = &fs->win[clst * 4 % SS(fs)];
0000f4  f24010ff          MOV      r0,#0x1ff
0000f8  ea000186          AND      r1,r0,r6,LSL #2
0000fc  f1050030          ADD      r0,r5,#0x30
000100  180c              ADDS     r4,r1,r0
;;;889    			val |= LD_DWORD(p) & 0xF0000000;
000102  78e0              LDRB     r0,[r4,#3]
000104  0600              LSLS     r0,r0,#24
000106  78a1              LDRB     r1,[r4,#2]
000108  ea404001          ORR      r0,r0,r1,LSL #16
00010c  7861              LDRB     r1,[r4,#1]
00010e  ea402001          ORR      r0,r0,r1,LSL #8
000112  7821              LDRB     r1,[r4,#0]
000114  4308              ORRS     r0,r0,r1
000116  f0004070          AND      r0,r0,#0xf0000000
00011a  4307              ORRS     r7,r7,r0
;;;890    			ST_DWORD(p, val);
00011c  7027              STRB     r7,[r4,#0]
00011e  0a38              LSRS     r0,r7,#8
000120  7060              STRB     r0,[r4,#1]
000122  e000              B        |L55.294|
                  |L55.292|
000124  e006              B        |L55.308|
                  |L55.294|
000126  0c38              LSRS     r0,r7,#16
000128  70a0              STRB     r0,[r4,#2]
00012a  0e38              LSRS     r0,r7,#24
00012c  70e0              STRB     r0,[r4,#3]
;;;891    			fs->wflag = 1;
00012e  2001              MOVS     r0,#1
000130  7128              STRB     r0,[r5,#4]
;;;892    			break;
000132  e002              B        |L55.314|
                  |L55.308|
;;;893    
;;;894    		default :
;;;895    			res = FR_INT_ERR;
000134  f04f0802          MOV      r8,#2
000138  bf00              NOP                            ;862
                  |L55.314|
00013a  bf00              NOP                            ;866
                  |L55.316|
;;;896    		}
;;;897    	}
;;;898    
;;;899    	return res;
00013c  4640              MOV      r0,r8
;;;900    }
00013e  e8bd87f0          POP      {r4-r10,pc}
;;;901    #endif /* !_FS_READONLY */
                          ENDP


                          AREA ||i.putc_bfd||, CODE, READONLY, ALIGN=1

                  putc_bfd PROC
;;;4445   static
;;;4446   void putc_bfd (
000000  b5f8              PUSH     {r3-r7,lr}
;;;4447   	putbuff* pb,
;;;4448   	TCHAR c
;;;4449   )
;;;4450   {
000002  4604              MOV      r4,r0
000004  460e              MOV      r6,r1
;;;4451   	UINT bw;
;;;4452   	int i;
;;;4453   
;;;4454   
;;;4455   	if (_USE_STRFUNC == 2 && c == '\n')	 /* LF -> CRLF conversion */
000006  bf00              NOP      
;;;4456   		putc_bfd(pb, '\r');
;;;4457   
;;;4458   	i = pb->idx;	/* Buffer write index (-1:error) */
000008  6865              LDR      r5,[r4,#4]
;;;4459   	if (i < 0) return;
00000a  2d00              CMP      r5,#0
00000c  da00              BGE      |L56.16|
                  |L56.14|
;;;4460   
;;;4461   #if _USE_LFN && _LFN_UNICODE
;;;4462   #if _STRF_ENCODE == 3			/* Write a character in UTF-8 */
;;;4463   	if (c < 0x80) {				/* 7-bit */
;;;4464   		pb->buf[i++] = (BYTE)c;
;;;4465   	} else {
;;;4466   		if (c < 0x800) {		/* 11-bit */
;;;4467   			pb->buf[i++] = (BYTE)(0xC0 | c >> 6);
;;;4468   		} else {				/* 16-bit */
;;;4469   			pb->buf[i++] = (BYTE)(0xE0 | c >> 12);
;;;4470   			pb->buf[i++] = (BYTE)(0x80 | (c >> 6 & 0x3F));
;;;4471   		}
;;;4472   		pb->buf[i++] = (BYTE)(0x80 | (c & 0x3F));
;;;4473   	}
;;;4474   #elif _STRF_ENCODE == 2			/* Write a character in UTF-16BE */
;;;4475   	pb->buf[i++] = (BYTE)(c >> 8);
;;;4476   	pb->buf[i++] = (BYTE)c;
;;;4477   #elif _STRF_ENCODE == 1			/* Write a character in UTF-16LE */
;;;4478   	pb->buf[i++] = (BYTE)c;
;;;4479   	pb->buf[i++] = (BYTE)(c >> 8);
;;;4480   #else							/* Write a character in ANSI/OEM */
;;;4481   	c = ff_convert(c, 0);	/* Unicode -> OEM */
;;;4482   	if (!c) c = '?';
;;;4483   	if (c >= 0x100)
;;;4484   		pb->buf[i++] = (BYTE)(c >> 8);
;;;4485   	pb->buf[i++] = (BYTE)c;
;;;4486   #endif
;;;4487   #else							/* Write a character without conversion */
;;;4488   	pb->buf[i++] = (BYTE)c;
;;;4489   #endif
;;;4490   
;;;4491   	if (i >= (int)(sizeof pb->buf) - 3) {	/* Write buffered characters to the file */
;;;4492   		f_write(pb->fp, pb->buf, (UINT)i, &bw);
;;;4493   		i = (bw == (UINT)i) ? 0 : -1;
;;;4494   	}
;;;4495   	pb->idx = i;
;;;4496   	pb->nchr++;
;;;4497   }
00000e  bdf8              POP      {r3-r7,pc}
                  |L56.16|
000010  4628              MOV      r0,r5                 ;4488
000012  1c6d              ADDS     r5,r5,#1              ;4488
000014  f104010c          ADD      r1,r4,#0xc            ;4488
000018  540e              STRB     r6,[r1,r0]            ;4488
00001a  2d3d              CMP      r5,#0x3d              ;4491
00001c  db0c              BLT      |L56.56|
00001e  466b              MOV      r3,sp                 ;4492
000020  462a              MOV      r2,r5                 ;4492
000022  6820              LDR      r0,[r4,#0]            ;4492
000024  f7fffffe          BL       f_write
000028  9800              LDR      r0,[sp,#0]            ;4493
00002a  42a8              CMP      r0,r5                 ;4493
00002c  d101              BNE      |L56.50|
00002e  2000              MOVS     r0,#0                 ;4493
000030  e001              B        |L56.54|
                  |L56.50|
000032  f04f30ff          MOV      r0,#0xffffffff        ;4493
                  |L56.54|
000036  4605              MOV      r5,r0                 ;4493
                  |L56.56|
000038  6065              STR      r5,[r4,#4]            ;4495
00003a  68a0              LDR      r0,[r4,#8]            ;4496
00003c  1c40              ADDS     r0,r0,#1              ;4496
00003e  60a0              STR      r0,[r4,#8]            ;4496
000040  bf00              NOP      
000042  e7e4              B        |L56.14|
;;;4498   
                          ENDP


                          AREA ||i.remove_chain||, CODE, READONLY, ALIGN=1

                  remove_chain PROC
;;;910    static
;;;911    FRESULT remove_chain (
000000  e92d41f0          PUSH     {r4-r8,lr}
;;;912    	FATFS* fs,			/* File system object */
;;;913    	DWORD clst			/* Cluster# to remove a chain from */
;;;914    )
;;;915    {
000004  4604              MOV      r4,r0
000006  460e              MOV      r6,r1
;;;916    	FRESULT res;
;;;917    	DWORD nxt;
;;;918    #if _USE_TRIM
;;;919    	DWORD scl = clst, ecl = clst, rt[2];
;;;920    #endif
;;;921    
;;;922    	if (clst < 2 || clst >= fs->n_fatent) {	/* Check range */
000008  2e02              CMP      r6,#2
00000a  d302              BCC      |L57.18|
00000c  6960              LDR      r0,[r4,#0x14]
00000e  42b0              CMP      r0,r6
000010  d801              BHI      |L57.22|
                  |L57.18|
;;;923    		res = FR_INT_ERR;
000012  2702              MOVS     r7,#2
000014  e027              B        |L57.102|
                  |L57.22|
;;;924    
;;;925    	} else {
;;;926    		res = FR_OK;
000016  2700              MOVS     r7,#0
;;;927    		while (clst < fs->n_fatent) {			/* Not a last link? */
000018  e021              B        |L57.94|
                  |L57.26|
;;;928    			nxt = get_fat(fs, clst);			/* Get cluster status */
00001a  4631              MOV      r1,r6
00001c  4620              MOV      r0,r4
00001e  f7fffffe          BL       get_fat
000022  4605              MOV      r5,r0
;;;929    			if (nxt == 0) break;				/* Empty cluster? */
000024  b905              CBNZ     r5,|L57.40|
000026  e01d              B        |L57.100|
                  |L57.40|
;;;930    			if (nxt == 1) { res = FR_INT_ERR; break; }	/* Internal error? */
000028  2d01              CMP      r5,#1
00002a  d101              BNE      |L57.48|
00002c  2702              MOVS     r7,#2
00002e  e019              B        |L57.100|
                  |L57.48|
;;;931    			if (nxt == 0xFFFFFFFF) { res = FR_DISK_ERR; break; }	/* Disk error? */
000030  1c68              ADDS     r0,r5,#1
000032  b908              CBNZ     r0,|L57.56|
000034  2701              MOVS     r7,#1
000036  e015              B        |L57.100|
                  |L57.56|
;;;932    			res = put_fat(fs, clst, 0);			/* Mark the cluster "empty" */
000038  2200              MOVS     r2,#0
00003a  4631              MOV      r1,r6
00003c  4620              MOV      r0,r4
00003e  f7fffffe          BL       put_fat
000042  4607              MOV      r7,r0
;;;933    			if (res != FR_OK) break;
000044  b107              CBZ      r7,|L57.72|
000046  e00d              B        |L57.100|
                  |L57.72|
;;;934    			if (fs->free_clust != 0xFFFFFFFF) {	/* Update FSINFO */
000048  6920              LDR      r0,[r4,#0x10]
00004a  1c40              ADDS     r0,r0,#1
00004c  b130              CBZ      r0,|L57.92|
;;;935    				fs->free_clust++;
00004e  6920              LDR      r0,[r4,#0x10]
000050  1c40              ADDS     r0,r0,#1
000052  6120              STR      r0,[r4,#0x10]
;;;936    				fs->fsi_flag |= 1;
000054  7960              LDRB     r0,[r4,#5]
000056  f0400001          ORR      r0,r0,#1
00005a  7160              STRB     r0,[r4,#5]
                  |L57.92|
;;;937    			}
;;;938    #if _USE_TRIM
;;;939    			if (ecl + 1 == nxt) {	/* Is next cluster contiguous? */
;;;940    				ecl = nxt;
;;;941    			} else {				/* End of contiguous clusters */ 
;;;942    				rt[0] = clust2sect(fs, scl);					/* Start sector */
;;;943    				rt[1] = clust2sect(fs, ecl) + fs->csize - 1;	/* End sector */
;;;944    				disk_ioctl(fs->drv, CTRL_TRIM, rt);				/* Erase the block */
;;;945    				scl = ecl = nxt;
;;;946    			}
;;;947    #endif
;;;948    			clst = nxt;	/* Next cluster */
00005c  462e              MOV      r6,r5
                  |L57.94|
00005e  6960              LDR      r0,[r4,#0x14]         ;927
000060  42b0              CMP      r0,r6                 ;927
000062  d8da              BHI      |L57.26|
                  |L57.100|
000064  bf00              NOP                            ;929
                  |L57.102|
;;;949    		}
;;;950    	}
;;;951    
;;;952    	return res;
000066  4638              MOV      r0,r7
;;;953    }
000068  e8bd81f0          POP      {r4-r8,pc}
;;;954    #endif
                          ENDP


                          AREA ||i.st_clust||, CODE, READONLY, ALIGN=1

                  st_clust PROC
;;;1225   static
;;;1226   void st_clust (
000000  7681              STRB     r1,[r0,#0x1a]
;;;1227   	BYTE* dir,	/* Pointer to the directory entry */
;;;1228   	DWORD cl	/* Value to be set */
;;;1229   )
;;;1230   {
;;;1231   	ST_WORD(dir + DIR_FstClusLO, cl);
000002  0a0b              LSRS     r3,r1,#8
000004  76c3              STRB     r3,[r0,#0x1b]
;;;1232   	ST_WORD(dir + DIR_FstClusHI, cl >> 16);
000006  0c0a              LSRS     r2,r1,#16
000008  7502              STRB     r2,[r0,#0x14]
00000a  0e0b              LSRS     r3,r1,#24
00000c  7543              STRB     r3,[r0,#0x15]
;;;1233   }
00000e  4770              BX       lr
;;;1234   #endif
                          ENDP


                          AREA ||i.sum_sfn||, CODE, READONLY, ALIGN=1

                  sum_sfn PROC
;;;1408   static
;;;1409   BYTE sum_sfn (
000000  b530              PUSH     {r4,r5,lr}
;;;1410   	const BYTE* dir		/* Pointer to the SFN entry */
;;;1411   )
;;;1412   {
000002  4601              MOV      r1,r0
;;;1413   	BYTE sum = 0;
000004  2000              MOVS     r0,#0
;;;1414   	UINT n = 11;
000006  220b              MOVS     r2,#0xb
;;;1415   
;;;1416   	do sum = (sum >> 1) + (sum << 7) + *dir++; while (--n);
000008  bf00              NOP      
                  |L59.10|
00000a  1043              ASRS     r3,r0,#1
00000c  eb0314c0          ADD      r4,r3,r0,LSL #7
000010  f8115b01          LDRB     r5,[r1],#1
000014  1963              ADDS     r3,r4,r5
000016  b2d8              UXTB     r0,r3
000018  1e53              SUBS     r3,r2,#1
00001a  1e1a              SUBS     r2,r3,#0
00001c  d1f5              BNE      |L59.10|
;;;1417   	return sum;
;;;1418   }
00001e  bd30              POP      {r4,r5,pc}
;;;1419   #endif
                          ENDP


                          AREA ||i.sync_fs||, CODE, READONLY, ALIGN=1

                  sync_fs PROC
;;;733    static
;;;734    FRESULT sync_fs (	/* FR_OK: successful, FR_DISK_ERR: failed */
000000  b570              PUSH     {r4-r6,lr}
;;;735    	FATFS* fs		/* File system object */
;;;736    )
;;;737    {
000002  4604              MOV      r4,r0
;;;738    	FRESULT res;
;;;739    
;;;740    
;;;741    	res = sync_window(fs);
000004  4620              MOV      r0,r4
000006  f7fffffe          BL       sync_window
00000a  4605              MOV      r5,r0
;;;742    	if (res == FR_OK) {
00000c  2d00              CMP      r5,#0
00000e  d159              BNE      |L60.196|
;;;743    		/* Update FSINFO sector if needed */
;;;744    		if (fs->fs_type == FS_FAT32 && fs->fsi_flag == 1) {
000010  7820              LDRB     r0,[r4,#0]
000012  2803              CMP      r0,#3
000014  d14f              BNE      |L60.182|
000016  7960              LDRB     r0,[r4,#5]
000018  2801              CMP      r0,#1
00001a  d14c              BNE      |L60.182|
;;;745    			/* Create FSINFO structure */
;;;746    			mem_set(fs->win, 0, SS(fs));
00001c  0242              LSLS     r2,r0,#9
00001e  2100              MOVS     r1,#0
000020  f1040030          ADD      r0,r4,#0x30
000024  f7fffffe          BL       mem_set
;;;747    			ST_WORD(fs->win + BS_55AA, 0xAA55);
000028  2155              MOVS     r1,#0x55
00002a  f884122e          STRB     r1,[r4,#0x22e]
00002e  21aa              MOVS     r1,#0xaa
000030  f884122f          STRB     r1,[r4,#0x22f]
;;;748    			ST_DWORD(fs->win + FSI_LeadSig, 0x41615252);
000034  2052              MOVS     r0,#0x52
000036  f8840030          STRB     r0,[r4,#0x30]
00003a  2152              MOVS     r1,#0x52
00003c  2031              MOVS     r0,#0x31
00003e  5501              STRB     r1,[r0,r4]
000040  2161              MOVS     r1,#0x61
000042  2032              MOVS     r0,#0x32
000044  5501              STRB     r1,[r0,r4]
000046  2141              MOVS     r1,#0x41
000048  2033              MOVS     r0,#0x33
00004a  5501              STRB     r1,[r0,r4]
;;;749    			ST_DWORD(fs->win + FSI_StrucSig, 0x61417272);
00004c  2172              MOVS     r1,#0x72
00004e  f8841214          STRB     r1,[r4,#0x214]
000052  f8841215          STRB     r1,[r4,#0x215]
000056  2141              MOVS     r1,#0x41
000058  f8841216          STRB     r1,[r4,#0x216]
00005c  2161              MOVS     r1,#0x61
00005e  f8841217          STRB     r1,[r4,#0x217]
;;;750    			ST_DWORD(fs->win + FSI_Free_Count, fs->free_clust);
000062  7c21              LDRB     r1,[r4,#0x10]
000064  f8841218          STRB     r1,[r4,#0x218]
000068  8a20              LDRH     r0,[r4,#0x10]
00006a  0a01              LSRS     r1,r0,#8
00006c  f8841219          STRB     r1,[r4,#0x219]
000070  6920              LDR      r0,[r4,#0x10]
000072  0c01              LSRS     r1,r0,#16
000074  f884121a          STRB     r1,[r4,#0x21a]
000078  6920              LDR      r0,[r4,#0x10]
00007a  0e01              LSRS     r1,r0,#24
00007c  f884121b          STRB     r1,[r4,#0x21b]
;;;751    			ST_DWORD(fs->win + FSI_Nxt_Free, fs->last_clust);
000080  7b21              LDRB     r1,[r4,#0xc]
000082  f884121c          STRB     r1,[r4,#0x21c]
000086  89a0              LDRH     r0,[r4,#0xc]
000088  0a01              LSRS     r1,r0,#8
00008a  f884121d          STRB     r1,[r4,#0x21d]
00008e  68e0              LDR      r0,[r4,#0xc]
000090  0c01              LSRS     r1,r0,#16
000092  f884121e          STRB     r1,[r4,#0x21e]
000096  68e0              LDR      r0,[r4,#0xc]
000098  0e01              LSRS     r1,r0,#24
00009a  f884121f          STRB     r1,[r4,#0x21f]
;;;752    			/* Write it into the FSINFO sector */
;;;753    			fs->winsect = fs->volbase + 1;
00009e  69e0              LDR      r0,[r4,#0x1c]
0000a0  1c40              ADDS     r0,r0,#1
0000a2  62e0              STR      r0,[r4,#0x2c]
;;;754    			disk_write(fs->drv, fs->win, fs->winsect, 1);
0000a4  7860              LDRB     r0,[r4,#1]
0000a6  2301              MOVS     r3,#1
0000a8  f1040130          ADD      r1,r4,#0x30
0000ac  6ae2              LDR      r2,[r4,#0x2c]
0000ae  f7fffffe          BL       disk_write
;;;755    			fs->fsi_flag = 0;
0000b2  2000              MOVS     r0,#0
0000b4  7160              STRB     r0,[r4,#5]
                  |L60.182|
;;;756    		}
;;;757    		/* Make sure that no pending write process in the physical drive */
;;;758    		if (disk_ioctl(fs->drv, CTRL_SYNC, 0) != RES_OK)
0000b6  7860              LDRB     r0,[r4,#1]
0000b8  2200              MOVS     r2,#0
0000ba  4611              MOV      r1,r2
0000bc  f7fffffe          BL       disk_ioctl
0000c0  b100              CBZ      r0,|L60.196|
;;;759    			res = FR_DISK_ERR;
0000c2  2501              MOVS     r5,#1
                  |L60.196|
;;;760    	}
;;;761    
;;;762    	return res;
0000c4  4628              MOV      r0,r5
;;;763    }
0000c6  bd70              POP      {r4-r6,pc}
;;;764    #endif
                          ENDP


                          AREA ||i.sync_window||, CODE, READONLY, ALIGN=1

                  sync_window PROC
;;;673    static
;;;674    FRESULT sync_window (
000000  e92d41f0          PUSH     {r4-r8,lr}
;;;675    	FATFS* fs		/* File system object */
;;;676    )
;;;677    {
000004  4604              MOV      r4,r0
;;;678    	DWORD wsect;
;;;679    	UINT nf;
;;;680    	FRESULT res = FR_OK;
000006  2700              MOVS     r7,#0
;;;681    
;;;682    
;;;683    	if (fs->wflag) {	/* Write back the sector if it is dirty */
000008  7920              LDRB     r0,[r4,#4]
00000a  b1f8              CBZ      r0,|L61.76|
;;;684    		wsect = fs->winsect;	/* Current sector number */
00000c  6ae5              LDR      r5,[r4,#0x2c]
;;;685    		if (disk_write(fs->drv, fs->win, wsect, 1) != RES_OK) {
00000e  7860              LDRB     r0,[r4,#1]
000010  2301              MOVS     r3,#1
000012  462a              MOV      r2,r5
000014  f1040130          ADD      r1,r4,#0x30
000018  f7fffffe          BL       disk_write
00001c  b108              CBZ      r0,|L61.34|
;;;686    			res = FR_DISK_ERR;
00001e  2701              MOVS     r7,#1
000020  e014              B        |L61.76|
                  |L61.34|
;;;687    		} else {
;;;688    			fs->wflag = 0;
000022  2000              MOVS     r0,#0
000024  7120              STRB     r0,[r4,#4]
;;;689    			if (wsect - fs->fatbase < fs->fsize) {		/* Is it in the FAT area? */
000026  6a20              LDR      r0,[r4,#0x20]
000028  1a28              SUBS     r0,r5,r0
00002a  69a1              LDR      r1,[r4,#0x18]
00002c  4288              CMP      r0,r1
00002e  d20d              BCS      |L61.76|
;;;690    				for (nf = fs->n_fats; nf >= 2; nf--) {	/* Reflect the change to all FAT copies */
000030  78e6              LDRB     r6,[r4,#3]
000032  e009              B        |L61.72|
                  |L61.52|
;;;691    					wsect += fs->fsize;
000034  69a0              LDR      r0,[r4,#0x18]
000036  4405              ADD      r5,r5,r0
;;;692    					disk_write(fs->drv, fs->win, wsect, 1);
000038  7860              LDRB     r0,[r4,#1]
00003a  2301              MOVS     r3,#1
00003c  462a              MOV      r2,r5
00003e  f1040130          ADD      r1,r4,#0x30
000042  f7fffffe          BL       disk_write
000046  1e76              SUBS     r6,r6,#1              ;690
                  |L61.72|
000048  2e02              CMP      r6,#2                 ;690
00004a  d2f3              BCS      |L61.52|
                  |L61.76|
;;;693    				}
;;;694    			}
;;;695    		}
;;;696    	}
;;;697    	return res;
00004c  4638              MOV      r0,r7
;;;698    }
00004e  e8bd81f0          POP      {r4-r8,pc}
;;;699    #endif
                          ENDP


                          AREA ||i.validate||, CODE, READONLY, ALIGN=1

                  validate PROC
;;;2343   static
;;;2344   FRESULT validate (	/* FR_OK(0): The object is valid, !=0: Invalid */
000000  b570              PUSH     {r4-r6,lr}
;;;2345   	void* obj		/* Pointer to the object FIL/DIR to check validity */
;;;2346   )
;;;2347   {
000002  4605              MOV      r5,r0
;;;2348   	FIL *fil = (FIL*)obj;	/* Assuming offset of .fs and .id in the FIL/DIR structure is identical */
000004  462c              MOV      r4,r5
;;;2349   
;;;2350   
;;;2351   	if (!fil || !fil->fs || !fil->fs->fs_type || fil->fs->id != fil->id)
000006  b14c              CBZ      r4,|L62.28|
000008  6820              LDR      r0,[r4,#0]
00000a  b138              CBZ      r0,|L62.28|
00000c  6820              LDR      r0,[r4,#0]
00000e  7800              LDRB     r0,[r0,#0]
000010  b120              CBZ      r0,|L62.28|
000012  6820              LDR      r0,[r4,#0]
000014  88c0              LDRH     r0,[r0,#6]
000016  88a1              LDRH     r1,[r4,#4]
000018  4288              CMP      r0,r1
00001a  d001              BEQ      |L62.32|
                  |L62.28|
;;;2352   		return FR_INVALID_OBJECT;
00001c  2009              MOVS     r0,#9
                  |L62.30|
;;;2353   
;;;2354   	ENTER_FF(fil->fs);		/* Lock file system */
;;;2355   
;;;2356   	if (disk_status(fil->fs->drv) & STA_NOINIT)
;;;2357   		return FR_NOT_READY;
;;;2358   
;;;2359   	return FR_OK;
;;;2360   }
00001e  bd70              POP      {r4-r6,pc}
                  |L62.32|
000020  6821              LDR      r1,[r4,#0]            ;2356
000022  7848              LDRB     r0,[r1,#1]            ;2356
000024  f7fffffe          BL       disk_status
000028  f0000001          AND      r0,r0,#1              ;2356
00002c  b108              CBZ      r0,|L62.50|
00002e  2003              MOVS     r0,#3                 ;2357
000030  e7f5              B        |L62.30|
                  |L62.50|
000032  2000              MOVS     r0,#0                 ;2359
000034  e7f3              B        |L62.30|
;;;2361   
                          ENDP


                          AREA ||.constdata||, DATA, READONLY, ALIGN=1

                  LfnOfs
000000  01030507          DCB      0x01,0x03,0x05,0x07
000004  090e1012          DCB      0x09,0x0e,0x10,0x12
000008  1416181c          DCB      0x14,0x16,0x18,0x1c
00000c  1e00              DCB      0x1e,0x00
                  tbl_lower
00000e  0061              DCW      0x0061
000010  00620063          DCW      0x0062,0x0063
000014  00640065          DCW      0x0064,0x0065
000018  00660067          DCW      0x0066,0x0067
00001c  00680069          DCW      0x0068,0x0069
000020  006a006b          DCW      0x006a,0x006b
000024  006c006d          DCW      0x006c,0x006d
000028  006e006f          DCW      0x006e,0x006f
00002c  00700071          DCW      0x0070,0x0071
000030  00720073          DCW      0x0072,0x0073
000034  00740075          DCW      0x0074,0x0075
000038  00760077          DCW      0x0076,0x0077
00003c  00780079          DCW      0x0078,0x0079
000040  007a00a1          DCW      0x007a,0x00a1
000044  00a200a3          DCW      0x00a2,0x00a3
000048  00a500ac          DCW      0x00a5,0x00ac
00004c  00af00e0          DCW      0x00af,0x00e0
000050  00e100e2          DCW      0x00e1,0x00e2
000054  00e300e4          DCW      0x00e3,0x00e4
000058  00e500e6          DCW      0x00e5,0x00e6
00005c  00e700e8          DCW      0x00e7,0x00e8
000060  00e900ea          DCW      0x00e9,0x00ea
000064  00eb00ec          DCW      0x00eb,0x00ec
000068  00ed00ee          DCW      0x00ed,0x00ee
00006c  00ef00f0          DCW      0x00ef,0x00f0
000070  00f100f2          DCW      0x00f1,0x00f2
000074  00f300f4          DCW      0x00f3,0x00f4
000078  00f500f6          DCW      0x00f5,0x00f6
00007c  00f800f9          DCW      0x00f8,0x00f9
000080  00fa00fb          DCW      0x00fa,0x00fb
000084  00fc00fd          DCW      0x00fc,0x00fd
000088  00fe00ff          DCW      0x00fe,0x00ff
00008c  01010103          DCW      0x0101,0x0103
000090  01050107          DCW      0x0105,0x0107
000094  0109010b          DCW      0x0109,0x010b
000098  010d010f          DCW      0x010d,0x010f
00009c  01110113          DCW      0x0111,0x0113
0000a0  01150117          DCW      0x0115,0x0117
0000a4  0119011b          DCW      0x0119,0x011b
0000a8  011d011f          DCW      0x011d,0x011f
0000ac  01210123          DCW      0x0121,0x0123
0000b0  01250127          DCW      0x0125,0x0127
0000b4  0129012b          DCW      0x0129,0x012b
0000b8  012d012f          DCW      0x012d,0x012f
0000bc  01310133          DCW      0x0131,0x0133
0000c0  01350137          DCW      0x0135,0x0137
0000c4  013a013c          DCW      0x013a,0x013c
0000c8  013e0140          DCW      0x013e,0x0140
0000cc  01420144          DCW      0x0142,0x0144
0000d0  01460148          DCW      0x0146,0x0148
0000d4  014b014d          DCW      0x014b,0x014d
0000d8  014f0151          DCW      0x014f,0x0151
0000dc  01530155          DCW      0x0153,0x0155
0000e0  01570159          DCW      0x0157,0x0159
0000e4  015b015d          DCW      0x015b,0x015d
0000e8  015f0161          DCW      0x015f,0x0161
0000ec  01630165          DCW      0x0163,0x0165
0000f0  01670169          DCW      0x0167,0x0169
0000f4  016b016d          DCW      0x016b,0x016d
0000f8  016f0171          DCW      0x016f,0x0171
0000fc  01730175          DCW      0x0173,0x0175
000100  0177017a          DCW      0x0177,0x017a
000104  017c017e          DCW      0x017c,0x017e
000108  019203b1          DCW      0x0192,0x03b1
00010c  03b203b3          DCW      0x03b2,0x03b3
000110  03b403b5          DCW      0x03b4,0x03b5
000114  03b603b7          DCW      0x03b6,0x03b7
000118  03b803b9          DCW      0x03b8,0x03b9
00011c  03ba03bb          DCW      0x03ba,0x03bb
000120  03bc03bd          DCW      0x03bc,0x03bd
000124  03be03bf          DCW      0x03be,0x03bf
000128  03c003c1          DCW      0x03c0,0x03c1
00012c  03c303c4          DCW      0x03c3,0x03c4
000130  03c503c6          DCW      0x03c5,0x03c6
000134  03c703c8          DCW      0x03c7,0x03c8
000138  03c903ca          DCW      0x03c9,0x03ca
00013c  04300431          DCW      0x0430,0x0431
000140  04320433          DCW      0x0432,0x0433
000144  04340435          DCW      0x0434,0x0435
000148  04360437          DCW      0x0436,0x0437
00014c  04380439          DCW      0x0438,0x0439
000150  043a043b          DCW      0x043a,0x043b
000154  043c043d          DCW      0x043c,0x043d
000158  043e043f          DCW      0x043e,0x043f
00015c  04400441          DCW      0x0440,0x0441
000160  04420443          DCW      0x0442,0x0443
000164  04440445          DCW      0x0444,0x0445
000168  04460447          DCW      0x0446,0x0447
00016c  04480449          DCW      0x0448,0x0449
000170  044a044b          DCW      0x044a,0x044b
000174  044c044d          DCW      0x044c,0x044d
000178  044e044f          DCW      0x044e,0x044f
00017c  04510452          DCW      0x0451,0x0452
000180  04530454          DCW      0x0453,0x0454
000184  04550456          DCW      0x0455,0x0456
000188  04570458          DCW      0x0457,0x0458
00018c  0459045a          DCW      0x0459,0x045a
000190  045b045c          DCW      0x045b,0x045c
000194  045e045f          DCW      0x045e,0x045f
000198  21702171          DCW      0x2170,0x2171
00019c  21722173          DCW      0x2172,0x2173
0001a0  21742175          DCW      0x2174,0x2175
0001a4  21762177          DCW      0x2176,0x2177
0001a8  21782179          DCW      0x2178,0x2179
0001ac  217a217b          DCW      0x217a,0x217b
0001b0  217c217d          DCW      0x217c,0x217d
0001b4  217e217f          DCW      0x217e,0x217f
0001b8  ff41ff42          DCW      0xff41,0xff42
0001bc  ff43ff44          DCW      0xff43,0xff44
0001c0  ff45ff46          DCW      0xff45,0xff46
0001c4  ff47ff48          DCW      0xff47,0xff48
0001c8  ff49ff4a          DCW      0xff49,0xff4a
0001cc  ff4bff4c          DCW      0xff4b,0xff4c
0001d0  ff4dff4e          DCW      0xff4d,0xff4e
0001d4  ff4fff50          DCW      0xff4f,0xff50
0001d8  ff51ff52          DCW      0xff51,0xff52
0001dc  ff53ff54          DCW      0xff53,0xff54
0001e0  ff55ff56          DCW      0xff55,0xff56
0001e4  ff57ff58          DCW      0xff57,0xff58
0001e8  ff59ff5a          DCW      0xff59,0xff5a
0001ec  0000              DCW      0x0000
                  tbl_upper
0001ee  0041              DCW      0x0041
0001f0  00420043          DCW      0x0042,0x0043
0001f4  00440045          DCW      0x0044,0x0045
0001f8  00460047          DCW      0x0046,0x0047
0001fc  00480049          DCW      0x0048,0x0049
000200  004a004b          DCW      0x004a,0x004b
000204  004c004d          DCW      0x004c,0x004d
000208  004e004f          DCW      0x004e,0x004f
00020c  00500051          DCW      0x0050,0x0051
000210  00520053          DCW      0x0052,0x0053
000214  00540055          DCW      0x0054,0x0055
000218  00560057          DCW      0x0056,0x0057
00021c  00580059          DCW      0x0058,0x0059
000220  005a0021          DCW      0x005a,0x0021
000224  ffe0ffe1          DCW      0xffe0,0xffe1
000228  ffe5ffe2          DCW      0xffe5,0xffe2
00022c  ffe300c0          DCW      0xffe3,0x00c0
000230  00c100c2          DCW      0x00c1,0x00c2
000234  00c300c4          DCW      0x00c3,0x00c4
000238  00c500c6          DCW      0x00c5,0x00c6
00023c  00c700c8          DCW      0x00c7,0x00c8
000240  00c900ca          DCW      0x00c9,0x00ca
000244  00cb00cc          DCW      0x00cb,0x00cc
000248  00cd00ce          DCW      0x00cd,0x00ce
00024c  00cf00d0          DCW      0x00cf,0x00d0
000250  00d100d2          DCW      0x00d1,0x00d2
000254  00d300d4          DCW      0x00d3,0x00d4
000258  00d500d6          DCW      0x00d5,0x00d6
00025c  00d800d9          DCW      0x00d8,0x00d9
000260  00da00db          DCW      0x00da,0x00db
000264  00dc00dd          DCW      0x00dc,0x00dd
000268  00de0178          DCW      0x00de,0x0178
00026c  01000102          DCW      0x0100,0x0102
000270  01040106          DCW      0x0104,0x0106
000274  0108010a          DCW      0x0108,0x010a
000278  010c010e          DCW      0x010c,0x010e
00027c  01100112          DCW      0x0110,0x0112
000280  01140116          DCW      0x0114,0x0116
000284  0118011a          DCW      0x0118,0x011a
000288  011c011e          DCW      0x011c,0x011e
00028c  01200122          DCW      0x0120,0x0122
000290  01240126          DCW      0x0124,0x0126
000294  0128012a          DCW      0x0128,0x012a
000298  012c012e          DCW      0x012c,0x012e
00029c  01300132          DCW      0x0130,0x0132
0002a0  01340136          DCW      0x0134,0x0136
0002a4  0139013b          DCW      0x0139,0x013b
0002a8  013d013f          DCW      0x013d,0x013f
0002ac  01410143          DCW      0x0141,0x0143
0002b0  01450147          DCW      0x0145,0x0147
0002b4  014a014c          DCW      0x014a,0x014c
0002b8  014e0150          DCW      0x014e,0x0150
0002bc  01520154          DCW      0x0152,0x0154
0002c0  01560158          DCW      0x0156,0x0158
0002c4  015a015c          DCW      0x015a,0x015c
0002c8  015e0160          DCW      0x015e,0x0160
0002cc  01620164          DCW      0x0162,0x0164
0002d0  01660168          DCW      0x0166,0x0168
0002d4  016a016c          DCW      0x016a,0x016c
0002d8  016e0170          DCW      0x016e,0x0170
0002dc  01720174          DCW      0x0172,0x0174
0002e0  01760179          DCW      0x0176,0x0179
0002e4  017b017d          DCW      0x017b,0x017d
0002e8  01910391          DCW      0x0191,0x0391
0002ec  03920393          DCW      0x0392,0x0393
0002f0  03940395          DCW      0x0394,0x0395
0002f4  03960397          DCW      0x0396,0x0397
0002f8  03980399          DCW      0x0398,0x0399
0002fc  039a039b          DCW      0x039a,0x039b
000300  039c039d          DCW      0x039c,0x039d
000304  039e039f          DCW      0x039e,0x039f
000308  03a003a1          DCW      0x03a0,0x03a1
00030c  03a303a4          DCW      0x03a3,0x03a4
000310  03a503a6          DCW      0x03a5,0x03a6
000314  03a703a8          DCW      0x03a7,0x03a8
000318  03a903aa          DCW      0x03a9,0x03aa
00031c  04100411          DCW      0x0410,0x0411
000320  04120413          DCW      0x0412,0x0413
000324  04140415          DCW      0x0414,0x0415
000328  04160417          DCW      0x0416,0x0417
00032c  04180419          DCW      0x0418,0x0419
000330  041a041b          DCW      0x041a,0x041b
000334  041c041d          DCW      0x041c,0x041d
000338  041e041f          DCW      0x041e,0x041f
00033c  04200421          DCW      0x0420,0x0421
000340  04220423          DCW      0x0422,0x0423
000344  04240425          DCW      0x0424,0x0425
000348  04260427          DCW      0x0426,0x0427
00034c  04280429          DCW      0x0428,0x0429
000350  042a042b          DCW      0x042a,0x042b
000354  042c042d          DCW      0x042c,0x042d
000358  042e042f          DCW      0x042e,0x042f
00035c  04010402          DCW      0x0401,0x0402
000360  04030404          DCW      0x0403,0x0404
000364  04050406          DCW      0x0405,0x0406
000368  04070408          DCW      0x0407,0x0408
00036c  0409040a          DCW      0x0409,0x040a
000370  040b040c          DCW      0x040b,0x040c
000374  040e040f          DCW      0x040e,0x040f
000378  21602161          DCW      0x2160,0x2161
00037c  21622163          DCW      0x2162,0x2163
000380  21642165          DCW      0x2164,0x2165
000384  21662167          DCW      0x2166,0x2167
000388  21682169          DCW      0x2168,0x2169
00038c  216a216b          DCW      0x216a,0x216b
000390  216c216d          DCW      0x216c,0x216d
000394  216e216f          DCW      0x216e,0x216f
000398  ff21ff22          DCW      0xff21,0xff22
00039c  ff23ff24          DCW      0xff23,0xff24
0003a0  ff25ff26          DCW      0xff25,0xff26
0003a4  ff27ff28          DCW      0xff27,0xff28
0003a8  ff29ff2a          DCW      0xff29,0xff2a
0003ac  ff2bff2c          DCW      0xff2b,0xff2c
0003b0  ff2dff2e          DCW      0xff2d,0xff2e
0003b4  ff2fff30          DCW      0xff2f,0xff30
0003b8  ff31ff32          DCW      0xff31,0xff32
0003bc  ff33ff34          DCW      0xff33,0xff34
0003c0  ff35ff36          DCW      0xff35,0xff36
0003c4  ff37ff38          DCW      0xff37,0xff38
0003c8  ff39ff3a          DCW      0xff39,0xff3a
0003cc  0000              DCW      0x0000
                  vst
0003ce  0400              DCW      0x0400
0003d0  02000100          DCW      0x0200,0x0100
0003d4  00800040          DCW      0x0080,0x0040
0003d8  00200010          DCW      0x0020,0x0010
0003dc  00080004          DCW      0x0008,0x0004
0003e0  00020000          DCW      0x0002,0x0000
                  ||cst||
0003e4  80004000          DCW      0x8000,0x4000
0003e8  20001000          DCW      0x2000,0x1000
0003ec  08004000          DCW      0x0800,0x4000
0003f0  20001000          DCW      0x2000,0x1000
0003f4  08000400          DCW      0x0800,0x0400
0003f8  0200              DCW      0x0200

                          AREA ||.data||, DATA, ALIGN=2

                  FatFs
                          %        8
                  Fsid
000008  0000              DCB      0x00,0x00
